<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-应急响应/入侵排查/Linux入侵排查" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Linux入侵排查 | d4m1ts 知识库</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blog.gm7.org/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blog.gm7.org/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blog.gm7.org/docs/应急响应/入侵排查/Linux入侵排查"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Linux入侵排查 | d4m1ts 知识库"><meta data-rh="true" name="description" content="一、账号"><meta data-rh="true" property="og:description" content="一、账号"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.gm7.org/docs/应急响应/入侵排查/Linux入侵排查"><link data-rh="true" rel="alternate" href="https://blog.gm7.org/docs/应急响应/入侵排查/Linux入侵排查" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://blog.gm7.org/docs/应急响应/入侵排查/Linux入侵排查" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://0LMFVYF6KV-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"入侵排查","item":"https://blog.gm7.org/docs/category/入侵排查"},{"@type":"ListItem","position":2,"name":"Linux入侵排查","item":"https://blog.gm7.org/docs/应急响应/入侵排查/Linux入侵排查"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="d4m1ts 知识库 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="d4m1ts 知识库 Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="d4m1ts 知识库" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.933499b4.css">
<script src="/assets/js/runtime~main.188591bd.js" defer="defer"></script>
<script src="/assets/js/main.f3e1b88f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">知识库</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/damit5/damit5.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/渗透测试/">渗透测试</a><button aria-label="展开侧边栏分类 &#x27;渗透测试&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/代码审计/">代码审计</a><button aria-label="展开侧边栏分类 &#x27;代码审计&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/编程开发/GO/GO基础/">编程开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/category/前置基础知识">移动安全</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/应急响应/简介/">应急响应</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/应急响应/简介/">简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/入侵排查">入侵排查</a><button aria-label="折叠侧边栏分类 &#x27;入侵排查&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/应急响应/入侵排查/Windows入侵排查">Windows入侵排查</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/应急响应/入侵排查/Linux入侵排查">Linux入侵排查</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/应急响应/入侵排查/WEB入侵排查">WEB入侵排查</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/溯源">溯源</a><button aria-label="展开侧边栏分类 &#x27;溯源&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/高阶技巧-1">高阶技巧</a><button aria-label="展开侧边栏分类 &#x27;高阶技巧&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/杂项-2">杂项</a><button aria-label="展开侧边栏分类 &#x27;杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/category/日常使用">AI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/暂未分类/自建网盘/h5ai/">暂未分类</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/致谢">致谢</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/更新日志">更新日志</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">应急响应</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/入侵排查"><span>入侵排查</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Linux入侵排查</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Linux入侵排查</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一账号">一、账号<a href="#一账号" class="hash-link" aria-label="一、账号的直接链接" title="一、账号的直接链接">​</a></h2>
<ul>
<li>1、用户信息文件 <code>/etc/passwd</code></li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root:x:0:0:root:/root:/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">account:password:UID:GID:GECOS:directory:shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">用户名：密码：用户ID：组ID：用户说明：家目录：登陆之后的 shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">注意：无密码只允许本机登陆，远程不允许登陆</span><br></span></code></pre></div></div>
<ul>
<li>2、影子文件 <code>/etc/shadow</code></li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root:$6$oGs1PqhL2p3ZetrE$X7o7bzoouHQVSEmSgsYN5UD4.kMHx6qgbTqwNVC5oOAouXvcjQSt.Ft7ql1WpkopY0UV9ajBwUt1DpYxTCVvI/:16809:0:99999:7:::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">用户名：加密密码：密码最后一次修改日期：两次密码的修改时间间隔：密码有效期：密码修改到期到的警告天数：密码过期之后的宽限天数：账号失效时间：保留</span><br></span></code></pre></div></div>
<ul>
<li>3、其他相关的</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">who     查看当前登录用户（tty 本地登陆  pts 远程登录）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w       查看系统信息，想知道某一时刻用户的行为</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uptime  查看登陆多久、多少用户，负载状态</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1是否为弱口令">1、是否为弱口令<a href="#1是否为弱口令" class="hash-link" aria-label="1、是否为弱口令的直接链接" title="1、是否为弱口令的直接链接">​</a></h3>
<ul>
<li>检查方法：询问管理员</li>
<li>检查方法：空口令用户：<code>awk -F: &#x27;length($2)==0 {print $1}&#x27; /etc/shadow</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2查询是否有可疑账号">2、查询是否有可疑账号<a href="#2查询是否有可疑账号" class="hash-link" aria-label="2、查询是否有可疑账号的直接链接" title="2、查询是否有可疑账号的直接链接">​</a></h3>
<ul>
<li>检查方法：执行命令：<code>cat /etc/passwd</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3查询特权用户uid0">3、查询特权用户(uid=0)<a href="#3查询特权用户uid0" class="hash-link" aria-label="3、查询特权用户(uid=0)的直接链接" title="3、查询特权用户(uid=0)的直接链接">​</a></h3>
<ul>
<li>检查方法：执行命令：<code>awk -F: &#x27;$3==0{print $1}&#x27; /etc/passwd</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4查询可以远程登录的账号">4、查询可以远程登录的账号<a href="#4查询可以远程登录的账号" class="hash-link" aria-label="4、查询可以远程登录的账号的直接链接" title="4、查询可以远程登录的账号的直接链接">​</a></h3>
<ul>
<li>检查方法：执行命令：<code>awk &#x27;/\$1|\$6/{print $1}&#x27; /etc/shadow</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5其他账号是否拥有sudo权限">5、其他账号是否拥有sudo权限<a href="#5其他账号是否拥有sudo权限" class="hash-link" aria-label="5、其他账号是否拥有sudo权限的直接链接" title="5、其他账号是否拥有sudo权限的直接链接">​</a></h3>
<p>如非管理需要，普通帐号应删除sudo权限</p>
<ul>
<li>检查方法：执行命令：<code>cat /etc/sudoers | grep -v &quot;^#\|^$&quot; | grep &quot;ALL=(ALL)&quot;</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6公私钥免密登陆">6、公私钥免密登陆<a href="#6公私钥免密登陆" class="hash-link" aria-label="6、公私钥免密登陆的直接链接" title="6、公私钥免密登陆的直接链接">​</a></h3>
<ul>
<li>检查方法：查看<code>/root/.ssh/authorized_keys</code>是否被修改</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7登陆日志">7、登陆日志<a href="#7登陆日志" class="hash-link" aria-label="7、登陆日志的直接链接" title="7、登陆日志的直接链接">​</a></h3>
<ul>
<li>注意：<!-- -->
<ul>
<li>使用 <code>ssh root@ip whoami</code>这种执行命令的，是没有登陆日志的。</li>
</ul>
</li>
</ul>
<ul>
<li>检查方法：<!-- -->
<ul>
<li>执行命令：<code>last</code> 和 <code>lastlog</code>（不建议，<code>ssh -T root@127.0.0.1 /bin/bash -i</code>可以隐藏记录）</li>
<li>执行命令：<code>cat /var/log/secure | grep -E &quot;Accepted|Failed&quot;</code>（建议）</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二历史命令">二、历史命令<a href="#二历史命令" class="hash-link" aria-label="二、历史命令的直接链接" title="二、历史命令的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1查看系统执行过的历史命令">1、查看系统执行过的历史命令<a href="#1查看系统执行过的历史命令" class="hash-link" aria-label="1、查看系统执行过的历史命令的直接链接" title="1、查看系统执行过的历史命令的直接链接">​</a></h3>
<ul>
<li>检查方法：执行命令：<code>cat /root/.bash_history</code>、<code>cat /home/$USER/.bash_history</code>，检查是否有可疑的命令操作</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="三端口和进程">三、端口和进程<a href="#三端口和进程" class="hash-link" aria-label="三、端口和进程的直接链接" title="三、端口和进程的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1检查是否有异常连接的端口">1、检查是否有异常连接的端口<a href="#1检查是否有异常连接的端口" class="hash-link" aria-label="1、检查是否有异常连接的端口的直接链接" title="1、检查是否有异常连接的端口的直接链接">​</a></h3>
<ul>
<li>检查方法：<!-- -->
<ul>
<li>执行命令<code>netstat -antlp | more</code>，根据查询到的建立连接的IP，可以去微步上查一下是否为C2</li>
<li>根据获取到的 <code>pid</code>执行 <code>ls -l /proc/$ PID/exe</code> 或 <code>file /proc/$ PID/exe</code>（$PID 为对应的 pid 号），看一下路径。</li>
</ul>
</li>
</ul>
<p><img decoding="async" loading="lazy" alt="image-20201029233328339" src="/assets/images/image-20201029233328339-33b4a8a7dfb7bb6a2f54da101d109974.png" width="2008" height="1098" class="img_ev3q"></p>
<ul>
<li>也可通过<code>lsof -i:port</code>来查看所有打开指定端口的进程</li>
</ul>
<p><img decoding="async" loading="lazy" alt="image-20201102083254336" src="/assets/images/image-20201102083254336-fcec5137e6b3fc45f9bbde75226af134.png" width="2696" height="348" class="img_ev3q"></p>
<ul>
<li>根据查询到的建立连接的IP，可以去<a href="https://x.threatbook.com/" target="_blank" rel="noopener noreferrer">微步</a>上查一下是否为已知C2</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2检查异常进程">2、检查异常进程<a href="#2检查异常进程" class="hash-link" aria-label="2、检查异常进程的直接链接" title="2、检查异常进程的直接链接">​</a></h3>
<ul>
<li>注意事项<!-- -->
<ul>
<li>注意有没有命名奇怪的进程，如以<code>.xxx</code>开头的进程</li>
<li>注意有没有CPU占用比较高的进程。</li>
<li><code>kill -9 PID</code>后是否重启复活</li>
<li>命名为<code>[xxx]</code>的不一定都是正常的，比如<code>[ksoftirqd/0]</code>，可能是被种到内核了，可以用下方的<code>lsof</code>来辅助分析</li>
</ul>
</li>
</ul>
<ul>
<li>检查方法：<!-- -->
<ul>
<li>执行命令<code>ps -auxwww</code>（常规，针对可见的进程）</li>
<li>使用工具<a href="http://www.unhide-forensics.info/" target="_blank" rel="noopener noreferrer"><code>unhide</code></a>（针对隐藏的进程，如使用工具<a href="https://github.com/gianlucaborello/libprocesshider" target="_blank" rel="noopener noreferrer"><code>libprocesshider</code></a>进行隐藏）</li>
<li><code>lsof -p PID</code>可以看到文件的完整路径和连接状态，<code>lsof -u user</code>可以看到user用户的所有进程</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="四开机启动项计划任务服务">四、开机启动项、计划任务、服务<a href="#四开机启动项计划任务服务" class="hash-link" aria-label="四、开机启动项、计划任务、服务的直接链接" title="四、开机启动项、计划任务、服务的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1开机启动项">1、开机启动项<a href="#1开机启动项" class="hash-link" aria-label="1、开机启动项的直接链接" title="1、开机启动项的直接链接">​</a></h3>
<p>系统运行级别示意图：</p>
<table><thead><tr><th style="text-align:center">运行级别</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">关机</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">单用户模式，可以想象为windows的安全模式，主要用于系统修复</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">不完全的命令行模式，不含NFS服务</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">完全的命令行模式，就是标准字符界面</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">系统保留</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">图形模式</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">重启动</td></tr></tbody></table>
<p>查看运行级别命令 <code>runlevel</code></p>
<p>系统默认允许级别</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vi  /etc/inittab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id=3：initdefault  #系统开机后直接进入哪个运行级别</span><br></span></code></pre></div></div>
<p>开机启动配置文件</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/etc/rc.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/rc.d/rc[0~6].d</span><br></span></code></pre></div></div>
<p><strong>例子：</strong> 当我们需要开机启动自己的脚本时，只需要将可执行脚本丢在 <code>/etc/init.d</code> 目录下，然后在 <code>/etc/rc.d/rc*.d</code> 文件中建立软链接即可。</p>
<p>注：此中的 * 代表 0,1,2,3,4,5,6 这七个等级</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@localhost ~]# ln -s /etc/init.d/sshd /etc/rc.d/rc3.d/S100ssh</span><br></span></code></pre></div></div>
<p>此处sshd是具体服务的脚本文件，S100ssh是其软链接，S开头代表加载时自启动；如果是K开头的脚本文件，代表运行级别加载时需要关闭的。</p>
<ul>
<li>检查方法：检查启动项文件 <code>/etc/rc.local</code> 和 <code>/etc/rc.d/rc[0~6].d/*</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2计划任务">2、计划任务<a href="#2计划任务" class="hash-link" aria-label="2、计划任务的直接链接" title="2、计划任务的直接链接">​</a></h3>
<p>(1)、利用 crontab 创建计划任务</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">crontab -l   列出某个用户cron服务的详细内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tips：默认编写的crontab文件会保存在 (/var/spool/cron/用户名 例如: /var/spool/cron/root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">crontab -r   删除每个用户cront任务(谨慎：删除所有的计划任务)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">crontab -e   使用编辑器编辑当前的crontab文件 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">如：*/1 * * * * echo &quot;hello world&quot; &gt;&gt; /tmp/test.txt 每分钟写入文件</span><br></span></code></pre></div></div>
<p>(2)、利用 anacron 命令实现异步定时任务调度</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">每天运行 /home/backup.sh 脚本：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vi /etc/anacrontab </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@daily    10    example.daily   /bin/bash /home/backup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">当机器在 backup.sh 期望被运行时是关机的，anacron会在机器开机十分钟之后运行它，而不用再等待 7天。</span><br></span></code></pre></div></div>
<ul>
<li>检查方法：检查如下目录的内容中，是否包含恶意的脚本</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">more /var/spool/cron/* </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/var/spool/anacron/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/crontab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/cron.d/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/cron.daily/* </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/cron.hourly/* </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/cron.monthly/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/cron.weekly/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/anacrontab</span><br></span></code></pre></div></div>
<ul>
<li>
<p>反解cron表达式</p>
</li>
<li>
<ul>
<li><a href="https://crontab.guru/" target="_blank" rel="noopener noreferrer">https://crontab.guru/</a></li>
</ul>
</li>
<li>
<ul>
<li><a href="https://qqe2.com/dev/cron" target="_blank" rel="noopener noreferrer">https://qqe2.com/dev/cron</a></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3服务">3、服务<a href="#3服务" class="hash-link" aria-label="3、服务的直接链接" title="3、服务的直接链接">​</a></h3>
<ul>
<li>服务自启动<!-- -->
<ul>
<li>第一种修改方法：</li>
</ul>
</li>
</ul>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chkconfig –add httpd   </span><span class="token comment" style="color:#999988;font-style:italic">// 增加httpd服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chkconfig –del httpd    </span><span class="token comment" style="color:#999988;font-style:italic">// 删除httpd服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chkconfig </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">level 运行级别</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">独立服务名</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">on</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">off</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chkconfig –level  </span><span class="token number" style="color:#36acaa">2345</span><span class="token plain"> httpd on  开启自启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chkconfig httpd on （默认level是</span><span class="token number" style="color:#36acaa">2345</span><span class="token plain">）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">运行级别0：系统停机状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">运行级别1：单用户工作状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">运行级别2：多用户状态(没有NFS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">运行级别3：完全的多用户状态(有NFS)，登陆后进入控制台命令行模式</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">运行级别4：系统未使用，保留</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">运行级别5：X11控制台，登陆后进入图形GUI模式</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">运行级别6：系统正常关闭并重启</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre></div></div>
<ul>
<li>
<ul>
<li>第二种修改方法：</li>
</ul>
</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 加入开机启动项</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/re.d/rc.local  </span><span class="token comment" style="color:#999988;font-style:italic"># /etc/rc.local</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 加入</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/init.d/httpd start</span><br></span></code></pre></div></div>
<ul>
<li>
<ul>
<li>第三种修改方法：</li>
</ul>
</li>
</ul>
<p>使用 <code>ntsysv</code>(RedHat各个发行版和CentOS各个版本自带，交互界面) 命令管理自启动。</p>
<p><img decoding="async" loading="lazy" alt="image-20201030144856509" src="/assets/images/image-20201030144856509-83c5cef8137f9fe68d262f76cc9eee80.png" width="1916" height="1092" class="img_ev3q"></p>
<ul>
<li>检查方法：
a、查看服务自启动状态，执行命令 <code>chkconfig --list</code>（RPM包安装的服务，Ubuntu没有这命令）
b、查看安装了哪些服务 <code>ls -la /etc/init.d</code>、<code>ls -la /etc/rc.d/init.d</code>
c、查看服务的状态 <code>service --status-all</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="五系统信息">五、系统信息<a href="#五系统信息" class="hash-link" aria-label="五、系统信息的直接链接" title="五、系统信息的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1可疑的目录和文件">1、可疑的目录和文件<a href="#1可疑的目录和文件" class="hash-link" aria-label="1、可疑的目录和文件的直接链接" title="1、可疑的目录和文件的直接链接">​</a></h3>
<p>检查方法：</p>
<p>a、检查敏感目录，如<code>/tmp</code>、<code>/var/tmp</code>、<code>/usr/tmp</code>等；</p>
<p>b、使用 <a href="https://www.cnblogs.com/klb561/p/10924399.html" target="_blank" rel="noopener noreferrer"><code>find</code></a> 查找最近修改过的文件；</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查找60分钟内内容修改的文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> ./ </span><span class="token parameter variable" style="color:#36acaa">-name</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;*&#x27;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-mmin</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-60</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># +60表示60分钟之前修改过的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查找24小时内内容修改的文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> ./ </span><span class="token parameter variable" style="color:#36acaa">-name</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*&quot;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-mtime</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查找48小时内状态修改的文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> ./ </span><span class="token parameter variable" style="color:#36acaa">-ctime</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查找 2022-10-24 - 2022-11-26 间修改过的文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> ./ </span><span class="token parameter variable" style="color:#36acaa">-type</span><span class="token plain"> f </span><span class="token parameter variable" style="color:#36acaa">-newermt</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-10-24 </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-newermt</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-11-26</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-amin</span><span class="token plain"> n 查找n分钟以前被访问过的所有文件。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-atime</span><span class="token plain"> n 查找n天以前被访问过的所有文件。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-cmin</span><span class="token plain"> n 查找n分钟以前文件状态被修改过的所有文件。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-ctime</span><span class="token plain"> n 查找n天以前文件状态被修改过的所有文件。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-mmin</span><span class="token plain"> n 查找n分钟以前文件内容被修改过的所有文件。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">-mtime</span><span class="token plain"> n 查找n天以前文件内容被修改过的所有文件。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-print：将搜索结果输出到标准输出。 </span><span class="token comment" style="color:#999988;font-style:italic"># </span><br></span></code></pre></div></div>
<p>c、使用<code>find</code>查找指定时间段内修改的文件</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10301500</span><span class="token plain"> file1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10301600</span><span class="token plain"> file2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> ./ </span><span class="token parameter variable" style="color:#36acaa">-newer</span><span class="token plain"> file1 </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-newer</span><span class="token plain"> file2 </span><span class="token comment" style="color:#999988;font-style:italic"># 列出比file新但是比file2旧的文件</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20201101110332918" src="/assets/images/image-20201101110332918-82edd972d3c8ad2f0c95bf58013cebe1.png" width="1694" height="1578" class="img_ev3q"></p>
<p>d、使用<code>find</code>查找特殊权限的文件</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">find</span><span class="token plain"> / </span><span class="token parameter variable" style="color:#36acaa">-name</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.*&quot;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-perm</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4777</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 防止suid提权</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> / </span><span class="token parameter variable" style="color:#36acaa">-perm</span><span class="token plain"> /4000 </span><span class="token comment" style="color:#999988;font-style:italic"># 防止suid提权</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> / </span><span class="token parameter variable" style="color:#36acaa">-uid</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1001</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 找出uid为1001的用户的文件</span><br></span></code></pre></div></div>
<p>e、查找首字符为<code>.</code>的隐藏文件，如果<code>rm -rf</code>不能删除，可能是使用<code>chattr +i</code>锁定了，只需要<code>chattr -i 文件</code>然后<code>rm -rf </code>删除即可</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">find</span><span class="token plain"> ./ </span><span class="token parameter variable" style="color:#36acaa">-name</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.*&quot;</span><br></span></code></pre></div></div>
<p>f、可疑文件可能被<code>touch</code>命令修改过文件时间来混淆，可用<code>stat</code>命令来确认。</p>
<p><img decoding="async" loading="lazy" alt="image-20201030152244194" src="/assets/images/image-20201030152244194-1feb50d35c89fab4089a84c1c1277a6b.png" width="1536" height="836" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2系统环境变量">2、系统环境变量<a href="#2系统环境变量" class="hash-link" aria-label="2、系统环境变量的直接链接" title="2、系统环境变量的直接链接">​</a></h3>
<ul>
<li>分析有无敏感可疑信息</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">$PATH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> ~/.bashrc</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3命令被替换排查">3、命令被替换排查<a href="#3命令被替换排查" class="hash-link" aria-label="3、命令被替换排查的直接链接" title="3、命令被替换排查的直接链接">​</a></h3>
<ul>
<li>
<p>通常被替换的程序有login、ls、ps、ifconfig、du、find、netstat、ss等。执行一些命令参数，查看程序是否被替换。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-lath</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">netstat</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-antlp</span><br></span></code></pre></div></div>
</li>
<li>
<p>通过检查md5sum和文件大小，判断是否被替换（不适用Ubuntu）</p>
<ul>
<li>Ubuntu版本不一样，md5也不一样</li>
</ul>
</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Ubuntu" src="/assets/images/image-20201031160600572-7dfe206335192bd821cf06d3f4c4d5ef.png" width="2802" height="332" class="img_ev3q"></p>
<ul>
<li>
<ul>
<li>CentOS版本不一样，但计算出的md5一样</li>
</ul>
</li>
</ul>
<p><img decoding="async" loading="lazy" alt="image-20201031165305151" src="/assets/images/image-20201031165305151-266ffb93aa88e8ab699922d4224126a4.png" width="2884" height="250" class="img_ev3q"></p>
<ul>
<li>按时间排序查看二进制命令目录列表，查看是否有修改的痕迹</li>
</ul>
<p><img decoding="async" loading="lazy" alt="image-20201102083618534" src="/assets/images/image-20201102083618534-84226ef1a23a9736a843d56801856cd7.png" width="2204" height="572" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="image-20201102083749269" src="/assets/images/image-20201102083749269-a7c41ba70718275c25f2b9479f4fe879.png" width="1474" height="560" class="img_ev3q"></p>
<ul>
<li>CentOS可以参考一下下方的“RPM check”，不过作用不是很大</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4异常流量">4、异常流量<a href="#4异常流量" class="hash-link" aria-label="4、异常流量的直接链接" title="4、异常流量的直接链接">​</a></h3>
<p>后门不一定会是TCP的，可能是走的其他协议比如DNS后门</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 捕获DNS和ICMP的流量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcpdump </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> eth0 </span><span class="token string" style="color:#e3116c">&#x27;icmp or (udp port 53)&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20240711下午82008330" src="/assets/images/image-20240711下午82008330-91f474959a945927e74efb6e464ed2ac.png" width="3126" height="1922" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="六自动化查杀">六、自动化查杀<a href="#六自动化查杀" class="hash-link" aria-label="六、自动化查杀的直接链接" title="六、自动化查杀的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1rootkit查杀">1、Rootkit查杀<a href="#1rootkit查杀" class="hash-link" aria-label="1、Rootkit查杀的直接链接" title="1、Rootkit查杀的直接链接">​</a></h3>
<ul>
<li>chkrootkit
网址：<a href="http://www.chkrootkit.org" target="_blank" rel="noopener noreferrer">http://www.chkrootkit.org</a></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 使用方法：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> ftp://ftp.pangeia.com.br/pub/seg/pac/chkrootkit.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> zxvf chkrootkit.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> chkrootkit-0.52</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> sense</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#编译完成没有报错的话执行检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./chkrootkit</span><br></span></code></pre></div></div>
<ul>
<li>
<p>rkhunter</p>
<p>网址：<a href="http://rkhunter.sourceforge.net" target="_blank" rel="noopener noreferrer">http://rkhunter.sourceforge.net</a></p>
</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 使用方法：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://nchc.dl.sourceforge.net/project/rkhunter/rkhunter/1.4.4/rkhunter-1.4.4.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-zxvf</span><span class="token plain"> rkhunter-1.4.4.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> rkhunter-1.4.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./installer.sh </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rkhunter </span><span class="token parameter variable" style="color:#36acaa">-c</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2病毒查杀">2、病毒查杀<a href="#2病毒查杀" class="hash-link" aria-label="2、病毒查杀的直接链接" title="2、病毒查杀的直接链接">​</a></h3>
<ul>
<li>
<p>Clamav</p>
<p>网址：<a href="http://www.clamav.net/download.html" target="_blank" rel="noopener noreferrer">http://www.clamav.net/download.html</a></p>
<p>安装方式一：</p>
</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#安装 zlib：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> http://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.7/zlib-1.2.7.tar.gz </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-zxvf</span><span class="token plain">  zlib-1.2.7.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> zlib-1.2.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#安装一下gcc编译环境： yum install gcc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CFLAGS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;-O3 -fPIC&quot;</span><span class="token plain"> ./configure </span><span class="token parameter variable" style="color:#36acaa">--prefix</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> /usr/local/zlib/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#2、添加用户组 clamav 和组成员 clamav：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">groupadd</span><span class="token plain"> clamav</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">useradd</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> clamav </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> /bin/false </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Clam AntiVirus&quot;</span><span class="token plain"> clamav</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#3、安装 Clamav</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> –zxvf clamav-0.97.6.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> clamav-0.97.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure </span><span class="token parameter variable" style="color:#36acaa">--prefix</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/opt/clamav --disable-clamav -with-zlib</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/zlib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#4、配置 Clamav</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /opt/clamav/logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /opt/clamav/updata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> /opt/clamav/logs/freshclam.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> /opt/clamav/logs/clamd.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /opt/clamav/logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> clamav:clamav clamd.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> clamav:clamav freshclam.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#5、ClamAV 使用：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/clamav/bin/freshclam 升级病毒库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./clamscan –h 查看相应的帮助信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./clamscan </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain"> /home  扫描所有用户的主目录就使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./clamscan </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--bell</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> /bin  扫描bin目录并且显示有问题的文件的扫描结果</span><br></span></code></pre></div></div>
<p>安装方式二：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#安装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-y</span><span class="token plain"> clamav</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#更新病毒库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">freshclam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#扫描方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clamscan </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain"> /etc --max-dir-recursion</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> /root/etcclamav.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clamscan </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain"> /bin --max-dir-recursion</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> /root/binclamav.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clamscan </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain"> /usr --max-dir-recursion</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> /root/usrclamav.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#扫描并杀毒</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clamscan </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--remove</span><span class="token plain">  /usr/bin/bsd-port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clamscan </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--remove</span><span class="token plain">  /usr/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clamscan </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--remove</span><span class="token plain">  /usr/local/zabbix/sbin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#查看日志发现</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /root/usrclamav.log </span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> FOUND</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3rpm-check-检查不适用ubuntu">3、RPM check 检查（不适用Ubuntu）<a href="#3rpm-check-检查不适用ubuntu" class="hash-link" aria-label="3、RPM check 检查（不适用Ubuntu）的直接链接" title="3、RPM check 检查（不适用Ubuntu）的直接链接">​</a></h3>
<p>系统完整性可以通过rpm自带的-Va来校验检查所有的<strong>rpm软件包</strong>，查看哪些命令是否被替换了，防止rpm也被替换,上传一个安全干净稳定版本rpm二进制到服务器上进行检查</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./rpm </span><span class="token parameter variable" style="color:#36acaa">-Va</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rpm.log</span><br></span></code></pre></div></div>
<p>如果一切均校验正常将不会产生任何输出，如果有不一致的地方，就会显示出来，输出格式是8位长字符串，每个字符都用以表示文件与RPM数据库中一种属性的比较结果 ，如果是. (点) 则表示测试通过。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">验证内容中的8个信息的具体内容如下：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        S         文件大小是否改变</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        M         文件的类型或文件的权限（rwx）是否被改变</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        5         文件MD5校验是否改变（可以看成文件内容是否改变）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        D         设备中，从代码是否改变</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        L         文件路径是否改变</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        U         文件的属主（所有者）是否改变</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        G         文件的属组是否改变</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        T         文件的修改时间是否改变</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>如果命令被替换了，如果还原回来：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">文件提取还原案例：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm  -qf /bin/ls  查询 ls 命令属于哪个软件包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv  /bin/ls /tmp  先把 ls 转移到 tmp 目录下，造成 ls 命令丢失的假象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm2cpio /mnt/cdrom/Packages/coreutils-8.4-19.el6.i686.rpm | cpio -idv ./bin/ls 提取 rpm 包中 ls 命令到当前目录的 /bin/ls 下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp /root/bin/ls  /bin/ 把 ls 命令复制到 /bin/ 目录 修复文件丢失</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="七github优秀脚本">七、Github优秀脚本<a href="#七github优秀脚本" class="hash-link" aria-label="七、Github优秀脚本的直接链接" title="七、Github优秀脚本的直接链接">​</a></h2>
<ul>
<li><a href="https://github.com/al0ne/LinuxCheck" target="_blank" rel="noopener noreferrer">https://github.com/al0ne/LinuxCheck</a>(一个linux信息搜集小脚本 主要用于应急响应，在Debian或Centos下都可使用)</li>
<li><a href="https://github.com/grayddq/GScan" target="_blank" rel="noopener noreferrer">https://github.com/grayddq/GScan</a>(本程序旨在为安全应急响应人员对Linux主机排查时提供便利，实现主机侧Checklist的自动全面化检测，根据检测结果自动数据聚合，进行黑客攻击路径溯源。)</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>d4m1ts</b> <!-- -->于 <b><time datetime="2025-06-14T04:13:25.000Z" itemprop="dateModified">2025年6月14日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/应急响应/入侵排查/Windows入侵排查"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Windows入侵排查</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/应急响应/入侵排查/WEB入侵排查"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">WEB入侵排查</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一账号" class="table-of-contents__link toc-highlight">一、账号</a><ul><li><a href="#1是否为弱口令" class="table-of-contents__link toc-highlight">1、是否为弱口令</a></li><li><a href="#2查询是否有可疑账号" class="table-of-contents__link toc-highlight">2、查询是否有可疑账号</a></li><li><a href="#3查询特权用户uid0" class="table-of-contents__link toc-highlight">3、查询特权用户(uid=0)</a></li><li><a href="#4查询可以远程登录的账号" class="table-of-contents__link toc-highlight">4、查询可以远程登录的账号</a></li><li><a href="#5其他账号是否拥有sudo权限" class="table-of-contents__link toc-highlight">5、其他账号是否拥有sudo权限</a></li><li><a href="#6公私钥免密登陆" class="table-of-contents__link toc-highlight">6、公私钥免密登陆</a></li><li><a href="#7登陆日志" class="table-of-contents__link toc-highlight">7、登陆日志</a></li></ul></li><li><a href="#二历史命令" class="table-of-contents__link toc-highlight">二、历史命令</a><ul><li><a href="#1查看系统执行过的历史命令" class="table-of-contents__link toc-highlight">1、查看系统执行过的历史命令</a></li></ul></li><li><a href="#三端口和进程" class="table-of-contents__link toc-highlight">三、端口和进程</a><ul><li><a href="#1检查是否有异常连接的端口" class="table-of-contents__link toc-highlight">1、检查是否有异常连接的端口</a></li><li><a href="#2检查异常进程" class="table-of-contents__link toc-highlight">2、检查异常进程</a></li></ul></li><li><a href="#四开机启动项计划任务服务" class="table-of-contents__link toc-highlight">四、开机启动项、计划任务、服务</a><ul><li><a href="#1开机启动项" class="table-of-contents__link toc-highlight">1、开机启动项</a></li><li><a href="#2计划任务" class="table-of-contents__link toc-highlight">2、计划任务</a></li><li><a href="#3服务" class="table-of-contents__link toc-highlight">3、服务</a></li></ul></li><li><a href="#五系统信息" class="table-of-contents__link toc-highlight">五、系统信息</a><ul><li><a href="#1可疑的目录和文件" class="table-of-contents__link toc-highlight">1、可疑的目录和文件</a></li><li><a href="#2系统环境变量" class="table-of-contents__link toc-highlight">2、系统环境变量</a></li><li><a href="#3命令被替换排查" class="table-of-contents__link toc-highlight">3、命令被替换排查</a></li><li><a href="#4异常流量" class="table-of-contents__link toc-highlight">4、异常流量</a></li></ul></li><li><a href="#六自动化查杀" class="table-of-contents__link toc-highlight">六、自动化查杀</a><ul><li><a href="#1rootkit查杀" class="table-of-contents__link toc-highlight">1、Rootkit查杀</a></li><li><a href="#2病毒查杀" class="table-of-contents__link toc-highlight">2、病毒查杀</a></li><li><a href="#3rpm-check-检查不适用ubuntu" class="table-of-contents__link toc-highlight">3、RPM check 检查（不适用Ubuntu）</a></li></ul></li><li><a href="#七github优秀脚本" class="table-of-contents__link toc-highlight">七、Github优秀脚本</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">内容导航</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/friends">友情链接</a></li><li class="footer__item"><a class="footer__link-item" href="/promotions">我的推广</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">实用工具</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://markdown.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">在线Markdown<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://rshell.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reverse Shell Generator<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://gtfobins.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GTFOBins<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">关注我</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/damit5/damit5.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:admin@gm7.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">联系我<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 d4m1ts 知识库</div></div></div></footer></div>
</body>
</html>