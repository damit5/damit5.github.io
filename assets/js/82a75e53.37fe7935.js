"use strict";(self.webpackChunkblog_source_2025=self.webpackChunkblog_source_2025||[]).push([[2079],{15809:(t,e,n)=>{n.d(e,{A:()=>r});const r=n.p+"assets/images/image-20220121124642839-5e2c1bb698a16446c7fc7598199f6df1.png"},28453:(t,e,n)=>{n.d(e,{R:()=>s,x:()=>a});var r=n(96540);const i={},o=r.createContext(i);function s(t){const e=r.useContext(o);return r.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function a(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(i):t.components||i:s(t.components),r.createElement(o.Provider,{value:e},t.children)}},29647:(t,e,n)=>{n.d(e,{A:()=>r});const r=n.p+"assets/images/image-20220121124500395-5268bcd1595f7b01a104541ba6b510e2.png"},38145:(t,e,n)=>{n.d(e,{A:()=>r});const r=n.p+"assets/images/image-20220121134709904-af1de6834e38d19f1f0f1452d5ecb341.png"},59118:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"\u7f16\u7a0b\u5f00\u53d1/GO/GO\u5b9e\u4f8b/\u4f7f\u7528GO\u4e0a\u4f20\u56fe\u7247","title":"\u4f7f\u7528GO\u4e0a\u4f20\u56fe\u7247","description":"\u524d\u8a00","source":"@site/docs/03.\u7f16\u7a0b\u5f00\u53d1/GO/02.GO\u5b9e\u4f8b/06.\u4f7f\u7528GO\u4e0a\u4f20\u56fe\u7247.md","sourceDirName":"03.\u7f16\u7a0b\u5f00\u53d1/GO/02.GO\u5b9e\u4f8b","slug":"/\u7f16\u7a0b\u5f00\u53d1/GO/GO\u5b9e\u4f8b/\u4f7f\u7528GO\u4e0a\u4f20\u56fe\u7247","permalink":"/docs/\u7f16\u7a0b\u5f00\u53d1/GO/GO\u5b9e\u4f8b/\u4f7f\u7528GO\u4e0a\u4f20\u56fe\u7247","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"d4m1ts","lastUpdatedAt":1749874405000,"sidebarPosition":6,"frontMatter":{},"sidebar":"knowledgeBaseSidebar","previous":{"title":"\u9650\u5236GO\u5e76\u53d1\u6570","permalink":"/docs/\u7f16\u7a0b\u5f00\u53d1/GO/GO\u5b9e\u4f8b/\u9650\u5236GO\u5e76\u53d1\u6570"},"next":{"title":"goproxy\u88ab\u52a8\u4ee3\u7406","permalink":"/docs/\u7f16\u7a0b\u5f00\u53d1/GO/GO\u5b9e\u4f8b/goproxy\u88ab\u52a8\u4ee3\u7406"}}');var i=n(74848),o=n(28453);const s={},a=void 0,d={},l=[{value:"\u524d\u8a00",id:"\u524d\u8a00",level:2},{value:"\u57fa\u7840\u7248",id:"\u57fa\u7840\u7248",level:2},{value:"\u8fdb\u9636\u7248",id:"\u8fdb\u9636\u7248",level:2},{value:"\u5b8c\u6574\u7248",id:"\u5b8c\u6574\u7248",level:2}];function c(t){const e={a:"a",code:"code",h2:"h2",hr:"hr",img:"img",p:"p",pre:"pre",...(0,o.R)(),...t.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h2,{id:"\u524d\u8a00",children:"\u524d\u8a00"}),"\n",(0,i.jsx)(e.p,{children:"\u9700\u8981\u6279\u91cf\u4e0a\u4f20\u56fe\u7247\u5230\u56fe\u5e8a\uff0c\u4e4b\u524d\u7528python\u5199\u811a\u672c\u5012\u662f\u5f88\u7b80\u5355\uff0c\u4e0d\u8fc7GO\u56e0\u4e3a\u5e76\u53d1\u592a\u5f3a\u5927\u4e86\uff0c\u6240\u4ee5\u8fd9\u6b21\u7528GO\u6765\u8bd5\u8bd5"}),"\n",(0,i.jsx)(e.h2,{id:"\u57fa\u7840\u7248",children:"\u57fa\u7840\u7248"}),"\n",(0,i.jsxs)(e.p,{children:["\u6784\u5efa\u4e00\u4e2a\u4e0a\u4f20\u56fe\u7247\u7684\u8bf7\u6c42\uff0c\u4e3b\u8981\u4ee3\u7801\u5728",(0,i.jsx)(e.code,{children:"imgkr()"}),"\u51fd\u6570\u4e2d"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"bytes"\n\t"fmt"\n\t"golang.org/x/net/publicsuffix"\n\t"io"\n\t"math/rand"\n\t"mime/multipart"\n\t"net/http"\n\t"net/http/cookiejar"\n\t"os"\n\t"path/filepath"\n)\n\nvar client http.Client\n\nfunc imgkr() {\n\t// \u8981\u4e0a\u4f20\u7684\u6587\u4ef6\n\timgFilePath := "/Users/d4m1ts/d4m1ts/Upload/logo.png"\n\tfile, _ := os.Open(imgFilePath)\n\tdefer file.Close()\n\n\t// \u8bbe\u7f6ebody\u6570\u636e\u5e76\u5199\u5165\u7f13\u51b2\u533a\n\tbodyBuff := bytes.NewBufferString("") //bodyBuff := &bytes.Buffer{}\n\tbodyWriter := multipart.NewWriter(bodyBuff)\n\t_ = bodyWriter.SetBoundary(fmt.Sprintf("-----------------------------%d", rand.Int()))\n\t// \u52a0\u5165\u56fe\u7247\u4e8c\u8fdb\u5236\n\tpart, _ := bodyWriter.CreateFormFile("source", filepath.Base(file.Name()))\n\t_, _ = io.Copy(part, file)\n    // \u5176\u4ed6\u5b57\u6bb5\n\t_ = bodyWriter.WriteField("a", "b")\n\n\t// \u81ea\u52a8\u8865\u5145boundary\u7ed3\u5c3e\n\tbodyWriter.Close()\n\n\tfmt.Println(bodyBuff) //\u6784\u5efa\u7684\u5b8c\u6574\u6570\u636e\u5305\uff0c\u6ca1\u6709header\n\n\t// \u7ec4\u5408\u521b\u5efa\u6570\u636e\u5305\n\treq, _ := http.NewRequest("POST", "http://127.0.0.1:8000", bodyBuff)\n\treq.ContentLength = int64(bodyBuff.Len())\n\treq.Header.Set("Content-Type", bodyWriter.FormDataContentType())\n\treq.Header.Set("User-Agent", "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:89.0) Gecko/20100101 Firefox/89.0")\n\n\tclient.Do(req)\n}\n\n\nfunc main() {\n\tjar, _ := cookiejar.New(&cookiejar.Options{PublicSuffixList: publicsuffix.List})\n\tclient = http.Client{Jar: jar}\n\timgkr()\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u63a5\u6536\u5230\u7684\u6570\u636e\u5305"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"image-20220121124500395",src:n(29647).A+"",width:"3582",height:"1654"})}),"\n",(0,i.jsx)(e.h2,{id:"\u8fdb\u9636\u7248",children:"\u8fdb\u9636\u7248"}),"\n",(0,i.jsxs)(e.p,{children:["\u4e0a\u9762\u7684\u6570\u636e\u5305\u5927\u6982\u662f\u6ca1\u4ec0\u4e48\u95ee\u9898\uff0c\u4f46\u662f\u56fe\u7247\u7684",(0,i.jsx)(e.code,{children:"Content-Type"}),"\u662f",(0,i.jsx)(e.code,{children:"application/octet-stream"}),"\uff0c\u800c\u4e00\u822c\u60c5\u51b5\u4e0b\u56fe\u7247\u7684\u5e94\u8be5\u662f\u5f62\u5982",(0,i.jsx)(e.code,{children:"image/png"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u5206\u6790\u4e86\u4e00\u4e0b\u539f\u56e0\uff0c\u662f\u56e0\u4e3a",(0,i.jsx)(e.code,{children:"CreateFormFile"}),"\u51fd\u6570\u91cc\u9762\u786c\u7f16\u7801\u4e86"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"image-20220121124642839",src:n(15809).A+"",width:"1756",height:"308"})}),"\n",(0,i.jsxs)(e.p,{children:["\u770b\u91cc\u9762\u7684\u4e00\u4e9b\u51fd\u6570\uff0c\u4e5f\u6ca1\u627e\u5230\u76f4\u63a5\u8bbe\u7f6e\u8fd9\u4e2a\u5730\u65b9\u7684",(0,i.jsx)(e.code,{children:"Content-Type"}),"\u7684\uff0c\u6240\u4ee5\u6211\u51b3\u5b9a\u6839\u636e\u4ed6\u7684\u89c4\u5219\u91cd\u65b0\u5199\u4e00\u4e0b\u3002"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsxs)(e.p,{children:["\u5206\u6790\u8fd9\u4e2a\u51fd\u6570\uff0c\u524d\u9762",(0,i.jsx)(e.code,{children:"h"}),"\u662fheader\u5934\uff0c\u4e5f\u662f\u6211\u4eec\u8981\u4fee\u6539\u7684\u5730\u65b9\uff0c\u540e\u9762\u662f\u8c03\u7528",(0,i.jsx)(e.code,{children:"*Writer.CreatePart"}),"\uff0c\u6211\u4eec\u4e5f\u6a21\u62df\u8fd9\u4e2a\u884c\u4e3a\u5c31\u53ef\u4ee5\u4e86"]}),"\n",(0,i.jsxs)(e.p,{children:["\u6240\u4ee5\u5fae\u8c03\u4e00\u4e0b\u4ee3\u7801\uff08\u76f4\u63a5\u7ed9\u4ee3\u7801\u590d\u5236\u7c98\u8d34\u8fc7\u6765\u6539\u5c31\u53ef\u4ee5\u4e86\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5",(0,i.jsxs)(e.a,{href:"https://stackoverflow.com/questions/36320947/go-http-file-upload",children:["\u91cd\u5199",(0,i.jsx)(e.code,{children:"CreateFormFile"}),"\u51fd\u6570"]}),"\uff0c\u540e\u8005\u7a0d\u5fae\u9ebb\u70e6\u4e00\u70b9\u70b9\uff09"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"image-20220121125248539",src:n(65159).A+"",width:"2638",height:"258"})}),"\n",(0,i.jsx)(e.p,{children:"\u6548\u679c"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"image-20220121125505840",src:n(90056).A+"",width:"3578",height:"1636"})}),"\n",(0,i.jsx)(e.p,{children:"\u76ee\u6807\u8fbe\u6210\uff0c\u5b8c\u6574\u4ee3\u7801"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"bytes"\n\t"fmt"\n\t"golang.org/x/net/publicsuffix"\n\t"io"\n\t"math/rand"\n\t"mime/multipart"\n\t"net/http"\n\t"net/http/cookiejar"\n\t"net/textproto"\n\t"os"\n\t"path/filepath"\n\t"strings"\n)\n\nvar client http.Client\nvar quoteEscaper = strings.NewReplacer("\\\\", "\\\\\\\\", `"`, "\\\\\\"")\n\nfunc escapeQuotes(s string) string {\n\treturn quoteEscaper.Replace(s)\n}\n\nfunc imgkr() {\n\t// \u8981\u4e0a\u4f20\u7684\u6587\u4ef6\n\timgFilePath := "/Users/d4m1ts/d4m1ts/Upload/logo.png"\n\tfile, _ := os.Open(imgFilePath)\n\tdefer file.Close()\n\n\t// \u8bbe\u7f6ebody\u6570\u636e\u5e76\u5199\u5165\u7f13\u51b2\u533a\n\tbodyBuff := bytes.NewBufferString("") //bodyBuff := &bytes.Buffer{}\n\tbodyWriter := multipart.NewWriter(bodyBuff)\n\t_ = bodyWriter.SetBoundary(fmt.Sprintf("-----------------------------%d", rand.Int()))\n\t// \u52a0\u5165\u56fe\u7247\u4e8c\u8fdb\u5236\n\th := make(textproto.MIMEHeader)\n\th.Set("Content-Disposition", fmt.Sprintf(`form-data; name="%s"; filename="%s"`, escapeQuotes("source"), escapeQuotes(filepath.Base(file.Name()))))\n\th.Set("Content-Type", "image/png")\n\tpart, _ := bodyWriter.CreatePart(h)\n\t_, _ = io.Copy(part, file)\n\t// \u5176\u4ed6\u5b57\u6bb5\n\t_ = bodyWriter.WriteField("a", "b")\n\n\t// \u81ea\u52a8\u8865\u5145boundary\u7ed3\u5c3e\n\tbodyWriter.Close()\n\n\tfmt.Println(bodyBuff) //\u6784\u5efa\u7684\u5b8c\u6574\u6570\u636e\u5305\uff0c\u6ca1\u6709header\n\n\t// \u7ec4\u5408\u521b\u5efa\u6570\u636e\u5305\n\treq, _ := http.NewRequest("POST", "http://127.0.0.1:8000", bodyBuff)\n\treq.ContentLength = int64(bodyBuff.Len())\n\treq.Header.Set("Content-Type", bodyWriter.FormDataContentType())\n\treq.Header.Set("User-Agent", "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:89.0) Gecko/20100101 Firefox/89.0")\n\n\tclient.Do(req)\n}\n\n\nfunc main() {\n\tjar, _ := cookiejar.New(&cookiejar.Options{PublicSuffixList: publicsuffix.List})\n\tclient = http.Client{Jar: jar}\n\timgkr()\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u5b8c\u6574\u7248",children:"\u5b8c\u6574\u7248"}),"\n",(0,i.jsxs)(e.p,{children:["\u5199\u4e86\u4e00\u4e2a\u4e0a\u4f20\u5230",(0,i.jsx)(e.a,{href:"https://imgtu.com/%E7%9A%84%EF%BC%8C%E5%A4%A7%E5%AE%B6%E6%9C%89%E9%9C%80%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83",children:"https://imgtu.com/\u7684\uff0c\u5927\u5bb6\u6709\u9700\u53ef\u4ee5\u53c2\u8003"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u4e3a\u4e86\u65b9\u4fbf\u4ee5\u540e\u7684\u590d\u5236\u7c98\u8d34\uff0c\u7ed9\u6784\u9020\u4e0a\u4f20\u56fe\u7247\u8bf7\u6c42\u5355\u72ec\u5199\u5230",(0,i.jsx)(e.code,{children:"imgkr()"}),"\u51fd\u6570\u4e2d\u7684\uff0c\u4e0d\u7136\u5e94\u8be5\u7ed9\u7ed3\u679c\u89e3\u6790\u4e5f\u5199\u91cc\u9762\u7684"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"bytes"\n\t"fmt"\n\t"golang.org/x/net/publicsuffix"\n\t"io"\n\t"io/ioutil"\n\t"math/rand"\n\t"mime/multipart"\n\t"net/http"\n\t"net/http/cookiejar"\n\t"net/textproto"\n\t"os"\n\t"path/filepath"\n\t"regexp"\n\t"strings"\n\t"time"\n\t"github.com/json-iterator/go"\n)\n\nvar client http.Client\nvar quoteEscaper = strings.NewReplacer("\\\\", "\\\\\\\\", `"`, "\\\\\\"")\n\nfunc escapeQuotes(s string) string {\n\treturn quoteEscaper.Replace(s)\n}\n\n/*\n\u83b7\u53d6\u4e0a\u4f20\u56fe\u7247\u9700\u8981\u7684token\n */\nfunc getToken() string {\n\tu := "https://imgtu.com/"\n\treq, _ := http.NewRequest("GET", u, nil)\n\treq.Header.Set("User-Agent", "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:89.0) Gecko/20100101 Firefox/89.0")\n\tresp, _ := client.Do(req)\n\tres,_ := ioutil.ReadAll(resp.Body)\n\tregex, _ := regexp.Compile("PF.obj.config.auth_token = \\"(.*?)\\";")\n\tif regex.MatchString(string(res)){\n\t\ttoken := regex.FindStringSubmatch(string(res))[1]\n\t\treturn token\n\t}\n\treturn ""\n\n}\n\n/*\n\u6784\u9020\u4e0a\u4f20\u8bf7\u6c42\n */\nfunc imgkr(token string, imgFilePath string) *http.Request {\n\t// \u4e0a\u4f20\u7f51\u5740\n\ttarget := "https://imgtu.com/json"\n\t// \u8981\u4e0a\u4f20\u7684\u6587\u4ef6\n\tfile, _ := os.Open(imgFilePath)\n\tdefer file.Close()\n\n\t// \u8bbe\u7f6ebody\u6570\u636e\u5e76\u5199\u5165\u7f13\u51b2\u533a\n\tbodyBuff := bytes.NewBufferString("") //bodyBuff := &bytes.Buffer{}\n\tbodyWriter := multipart.NewWriter(bodyBuff)\n\t_ = bodyWriter.SetBoundary(fmt.Sprintf("-----------------------------%d", rand.Int()))\n\t// \u52a0\u5165\u56fe\u7247\u4e8c\u8fdb\u5236\n\th := make(textproto.MIMEHeader)\n\th.Set("Content-Disposition", fmt.Sprintf(`form-data; name="%s"; filename="%s"`, escapeQuotes("source"), escapeQuotes(filepath.Base(file.Name()))))\n\th.Set("Content-Type", "image/png")\n\tpart, _ := bodyWriter.CreatePart(h)\n\t_, _ = io.Copy(part, file)\n\t// \u5176\u4ed6\u5b57\u6bb5\n\t_ = bodyWriter.WriteField("type", "file")\n\t_ = bodyWriter.WriteField("action", "upload")\n\t_ = bodyWriter.WriteField("timestamp", fmt.Sprintf("%d", time.Now().UnixNano()/1e6))\n\t_ = bodyWriter.WriteField("auth_token", token)\n\t_ = bodyWriter.WriteField("nsfw", "0")\n\t// \u81ea\u52a8\u8865\u5145boundary\u7ed3\u5c3e\n\t_ = bodyWriter.Close()\n\n\t//fmt.Println(bodyBuff) //\u6784\u5efa\u7684\u5b8c\u6574\u6570\u636e\u5305\uff0c\u6ca1\u6709header\n\n\t// \u521b\u5efa\u8bf7\u6c42\n\treq, _ := http.NewRequest("POST", target, bodyBuff)\n\treq.ContentLength = int64(bodyBuff.Len())\n\treq.Header.Set("Content-Type", bodyWriter.FormDataContentType())\n\treq.Header.Set("User-Agent", "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:89.0) Gecko/20100101 Firefox/89.0")\n\n\treturn req\n}\n\n\nfunc main() {\n\tjar, _ := cookiejar.New(&cookiejar.Options{PublicSuffixList: publicsuffix.List})\n\tclient = http.Client{Jar: jar}\n\n\ttoken := getToken()\n\treq := imgkr(token, "/Users/d4m1ts/d4m1ts/Upload/logo.png")\n\n\tresp, _ := client.Do(req)\n\tres, _ := ioutil.ReadAll(resp.Body)\n\timageUrl := jsoniter.Get(res, "image").Get("url")\n\tfmt.Println(imageUrl.ToString())\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u6548\u679c"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"image-20220121134709904",src:n(38145).A+"",width:"2456",height:"316"})})]})}function p(t={}){const{wrapper:e}={...(0,o.R)(),...t.components};return e?(0,i.jsx)(e,{...t,children:(0,i.jsx)(c,{...t})}):c(t)}},65159:(t,e,n)=>{n.d(e,{A:()=>r});const r=n.p+"assets/images/image-20220121125248539-c361e8cea5045e6949a6d7259e5d7def.png"},90056:(t,e,n)=>{n.d(e,{A:()=>r});const r=n.p+"assets/images/image-20220121125505840-0a0101fc2ea82b121f4d05afc7f3fd65.png"}}]);