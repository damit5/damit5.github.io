"use strict";(self.webpackChunkblog_source_2025=self.webpackChunkblog_source_2025||[]).push([[6120],{28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>a});var t=s(96540);const r={},o=t.createContext(r);function l(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(o.Provider,{value:n},e.children)}},30516:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/image-20230412\u4e0a\u5348122816180-b6a971b5e9d63b3840bbf874154cebab.png"},47029:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"\u6682\u672a\u5206\u7c7b/\u5b9e\u7528\u6280\u5de7/\u9650\u5b9a\u6e90\u7aef\u53e3\u8bbf\u95ee\u76ee\u6807","title":"\u9650\u5b9a\u6e90\u7aef\u53e3\u8bbf\u95ee\u76ee\u6807","description":"\u8d77\u56e0","source":"@site/docs/99.\u6682\u672a\u5206\u7c7b/06.\u5b9e\u7528\u6280\u5de7/02.\u9650\u5b9a\u6e90\u7aef\u53e3\u8bbf\u95ee\u76ee\u6807.md","sourceDirName":"99.\u6682\u672a\u5206\u7c7b/06.\u5b9e\u7528\u6280\u5de7","slug":"/\u6682\u672a\u5206\u7c7b/\u5b9e\u7528\u6280\u5de7/\u9650\u5b9a\u6e90\u7aef\u53e3\u8bbf\u95ee\u76ee\u6807","permalink":"/docs/\u6682\u672a\u5206\u7c7b/\u5b9e\u7528\u6280\u5de7/\u9650\u5b9a\u6e90\u7aef\u53e3\u8bbf\u95ee\u76ee\u6807","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"d4m1ts","lastUpdatedAt":1749874405000,"sidebarPosition":2,"frontMatter":{},"sidebar":"knowledgeBaseSidebar","previous":{"title":"\u901a\u8fc7CloudFlare\u5b9e\u73b030x\u8df3\u8f6c","permalink":"/docs/\u6682\u672a\u5206\u7c7b/\u5b9e\u7528\u6280\u5de7/\u901a\u8fc7CloudFlare\u5b9e\u73b030x\u8df3\u8f6c"},"next":{"title":"Mac2Mac\u8fdc\u7a0b\u684c\u9762\u63a7\u5236","permalink":"/docs/\u6682\u672a\u5206\u7c7b/\u5b9e\u7528\u6280\u5de7/Mac2Mac\u8fdc\u7a0b\u684c\u9762\u63a7\u5236"}}');var r=s(74848),o=s(28453);const l={},a=void 0,c={},d=[{value:"\u8d77\u56e0",id:"\u8d77\u56e0",level:2},{value:"\u6ce8\u610f",id:"\u6ce8\u610f",level:2},{value:"\u65b9\u6cd5\u4e00\uff1aNC",id:"\u65b9\u6cd5\u4e00nc",level:2},{value:"\u65b9\u6cd5\u4e8c\uff1a\u6279\u91cf\u5360\u7528\u7aef\u53e3",id:"\u65b9\u6cd5\u4e8c\u6279\u91cf\u5360\u7528\u7aef\u53e3",level:2},{value:"\u65b9\u6cd5\u4e09\uff1a\u624b\u52a8\u5b9e\u73b0\u4ee3\u7406\u8f6c\u53d1",id:"\u65b9\u6cd5\u4e09\u624b\u52a8\u5b9e\u73b0\u4ee3\u7406\u8f6c\u53d1",level:2},{value:"\u5c1d\u8bd5\u8fc7\u7684\u5931\u8d25\u65b9\u6cd5\u8bb0\u5f55",id:"\u5c1d\u8bd5\u8fc7\u7684\u5931\u8d25\u65b9\u6cd5\u8bb0\u5f55",level:2}];function i(e){const n={admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"\u8d77\u56e0",children:"\u8d77\u56e0"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u6e17\u900f\u6d4b\u8bd5\u65f6\uff0c\u5ba2\u6237\u9700\u8981\u5bf9\u6211\u4eec\u7684\u6d4b\u8bd5IP\u8fdb\u884c\u52a0\u767d\uff0c\u4f46\u662f\u6b64\u6b21\u5ba2\u6237\u8981\u6c42\u7cbe\u786e\u5230\u56fa\u5b9a\u7aef\u53e3\u6216\u8005\u5c0f\u8303\u56f4\u7aef\u53e3\uff08\u4e0d\u80fd1-65535\uff09\uff0c\u6839\u636e\u4ee5\u524d\u7684\u7ecf\u9a8c\uff0c\u9ed8\u8ba4\u662f\u52a0\u767dIP\u548c\u5168\u7aef\u53e3\uff0c\u56e0\u4e3a\u4ee3\u7406\u5efa\u7acb\u8fde\u63a5\u4f7f\u7528\u7684\u7aef\u53e3\u662f\u968f\u673a\u7684\uff0c\u6240\u4ee5\u8fd9\u6b21\u7b97\u662f\u4ece\u5934\u67e5\u627e\u8d44\u6599\u603b\u7ed3\u4e00\u4e0b\u5404\u79cd\u6307\u5b9a\u6e90\u7aef\u53e3\u7684\u65b9\u5f0f\u3002"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u8fd9\u91cc\u7684\u7aef\u53e3\u662f\u6307\u4e0e\u76ee\u6807\u5efa\u7acb\u8fde\u63a5\u65f6\u4f7f\u7528\u7684\u6e90\u7aef\u53e3\uff0c\u800c\u4e0d\u662f\u4ee3\u7406\u76d1\u542c\u7684\u7aef\u53e3\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u6ce8\u610f",children:"\u6ce8\u610f"}),"\n",(0,r.jsx)(n.p,{children:"\u6700\u597d\u4f7f\u7528\u670d\u52a1\u5668\uff08VPS\uff09\u53d1\u9001\u8bf7\u6c42\u3002\u5982\u679c\u5728\u5c40\u57df\u7f51\u5185\u5411\u5916\u7f51\u53d1\u8d77\u8bf7\u6c42\uff0c\u5373\u4f7f\u672c\u673a\u6307\u5b9a\u4e86\u7aef\u53e3\uff0c\u4e5f\u65e0\u6d4e\u4e8e\u4e8b\uff0c\u56e0\u4e3a\u5b9e\u9645\u53d1\u51fa\u8bf7\u6c42\u7684\u662f\u6700\u5916\u5c42\u7f51\u7edc\u8bbe\u5907\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u65b9\u6cd5\u4e00nc",children:"\u65b9\u6cd5\u4e00\uff1aNC"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"# \u6307\u5b9a12345\u7aef\u53e3\uff0c\u7f3a\u70b9\u662f\u4e00\u6b21\u4e00\u7528\uff0c\u6bd4\u8f83\u9ebb\u70e6\nnc <IP> <Port> -p 12345\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"nc",src:s(53987).A+"",width:"2850",height:"152"})}),"\n",(0,r.jsx)(n.h2,{id:"\u65b9\u6cd5\u4e8c\u6279\u91cf\u5360\u7528\u7aef\u53e3",children:"\u65b9\u6cd5\u4e8c\uff1a\u6279\u91cf\u5360\u7528\u7aef\u53e3"}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u627e\u4e86\u5f88\u591a\u8d44\u6599\uff0c\u4f46\u90fd\u6ca1\u80fd\u627e\u5230\u5408\u9002\u7684\u5de5\u5177\u3002\u6700\u7ec8\u6211\u60f3\u5230\u4e86\u4e00\u79cd\u7b28\u62d9\u7684\u65b9\u6cd5\uff1a\u5f3a\u5236\u5360\u7528\u6240\u6709\u53ef\u7528\u7684\u7aef\u53e3\u3002\u8fd9\u6837\u5f53\u4ee3\u7406\u53d1\u8d77\u8bf7\u6c42\u65f6\uff0c\u5c31\u4f1a\u81ea\u52a8\u9009\u62e9\u672a\u88ab\u5360\u7528\u7684\u7aef\u53e3\u3002python\u4ee3\u7801\u4e3e\u4f8b\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import socket\nimport time\n\n# \u8981\u5360\u7528\u7684\u7aef\u53e3\u8303\u56f4\nstart_port = 1\nend_port = 60000\n\n# \u521b\u5efa\u5957\u63a5\u5b57\nsocks = []\nfor port in range(start_port, end_port+1):\n    try:\n        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n        sock.bind(('0.0.0.0', port))\n        sock.listen(1)\n        socks.append(sock)\n    except:\n        print(f\"{port} \u88ab\u5176\u4ed6\u5e94\u7528\u5360\u7528\")\n\nprint(f'\u5df2\u5360\u7528\u7aef\u53e3\u8303\u56f4: {start_port} - {end_port}')\n\n# \u957f\u671f\u5360\u7528\u7aef\u53e3\nwhile True:\n    time.sleep(60)\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6548\u679c\u5982\u4e0b\uff0c\u53ef\u89c1\u90fd\u662f60000\u540e\u7684\u7aef\u53e3\u8fde\u63a5\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"\u6279\u91cf\u5360\u7528\u7aef\u53e3",src:s(49217).A+"",width:"1708",height:"1312"})}),"\n",(0,r.jsx)(n.h2,{id:"\u65b9\u6cd5\u4e09\u624b\u52a8\u5b9e\u73b0\u4ee3\u7406\u8f6c\u53d1",children:"\u65b9\u6cd5\u4e09\uff1a\u624b\u52a8\u5b9e\u73b0\u4ee3\u7406\u8f6c\u53d1"}),"\n",(0,r.jsx)(n.p,{children:"\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e2a\u4ee3\u7406\u3002\u76d1\u542c\u4e00\u4e2a\u7aef\u53e3\uff0c\u7136\u540e\u5c06\u6d41\u91cf\u53d1\u9001\u5230\u4ee3\u7406\u4e2d\uff0c\u518d\u7531\u4ee3\u7406\u53bb\u56fa\u5b9a\u6e90\u7aef\u53e3\u53d1\u9001\u8bf7\u6c42\u5e76\u8fd4\u56de\u7ed3\u679c\u3002"}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["\u56e0\u4e3a\u90fd\u662f\u8d70\u7684\u8fd9\u4e2a\u7aef\u53e3\u53bb\u5efa\u7acb\u8fde\u63a5\uff0c\u4e00\u65e6\u51fa\u73b0\u5f02\u5e38\u60c5\u51b5\uff0c\u90a3\u8fd9\u4e2a\u7aef\u53e3\u53ef\u80fd\u4f1a\u957f\u671f\u4fdd\u6301",(0,r.jsx)(n.code,{children:"TIME_WAIT"}),"\u72b6\u6001\u4ece\u800c\u5bfc\u81f4\u65e0\u6cd5\u6b63\u5e38\u4f7f\u7528\u3002"]})}),"\n",(0,r.jsx)(n.p,{children:"python\u4ee3\u7801\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import http.server                  # \u5bfc\u5165HTTP\u670d\u52a1\u5668\u76f8\u5173\u7684\u6a21\u5757\nimport socketserver                 # \u5bfc\u5165socket\u670d\u52a1\u5668\u76f8\u5173\u7684\u6a21\u5757\nimport http.client                  # \u5bfc\u5165HTTP\u5ba2\u6237\u7aef\u76f8\u5173\u7684\u6a21\u5757\nimport urllib.parse                 # \u5bfc\u5165URL\u89e3\u6790\u76f8\u5173\u7684\u6a21\u5757\nimport socket                       # \u5bfc\u5165socket\u76f8\u5173\u7684\u6a21\u5757\nfrom loguru import logger           # \u5bfc\u5165\u65e5\u5fd7\u5e93\n\nLISTEN_PORT = 8080                  # \u672c\u5730\u76d1\u542c\u7aef\u53e3\nCONNECT_PORT = 22333                # \u7528\u4e8e\u5efa\u7acb\u4ee3\u7406\u670d\u52a1\u5668\u4e0e\u76ee\u6807\u670d\u52a1\u5668\u8fde\u63a5\u7684\u672c\u5730\u7aef\u53e3\n\n# \u7ee7\u627fhttp.server.BaseHTTPRequestHandler\u7c7b\uff0c\u5b9e\u73b0\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u5904\u7406\nclass ProxyRequestHandler(http.server.BaseHTTPRequestHandler):\n\n    # \u5904\u7406CONNECT\u65b9\u6cd5\n    def do_CONNECT(self):\n        # \u89e3\u6790URL\n        u = urllib.parse.urlparse('http://' + self.path)\n        # \u5efa\u7acb\u4e00\u4e2a\u65b0\u7684\u5957\u63a5\u5b57\n        p_sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        # \u5c06\u8be5\u5957\u63a5\u5b57\u7ed1\u5b9a\u5230\u672c\u5730\u7aef\u53e3\n        p_sock.bind(('0.0.0.0', CONNECT_PORT))\n        # \u5efa\u7acb\u8fde\u63a5\n        p_sock.connect((u.hostname, u.port or 80))\n        # \u8fd4\u56de200\u8fde\u63a5\u5df2\u5efa\u7acb\u54cd\u5e94\n        self.wfile.write(b'HTTP/1.1 200 Connection Established\\r\\n\\r\\n')\n        # \u5c06\u8be5\u5957\u63a5\u5b57\u8bbe\u7f6e\u4e3a\u975e\u963b\u585e\u6a21\u5f0f\n        p_sock.setblocking(False)\n        self.connection.setblocking(False)\n        while True:\n            try:\n                # \u4ece\u4ee3\u7406\u670d\u52a1\u5668\u63a5\u6536\u6570\u636e\n                data = self.connection.recv(1024)\n                if not data:\n                    break\n                # \u5c06\u6570\u636e\u53d1\u9001\u5230\u76ee\u6807\u670d\u52a1\u5668\n                p_sock.sendall(data)\n            except:\n                pass\n            try:\n                # \u4ece\u76ee\u6807\u670d\u52a1\u5668\u63a5\u6536\u6570\u636e\n                data = p_sock.recv(1024)\n                if not data:\n                    break\n                # \u5c06\u6570\u636e\u53d1\u9001\u5230\u4ee3\u7406\u670d\u52a1\u5668\n                self.connection.sendall(data)\n            except:\n                pass\n        # \u5173\u95ed\u8fde\u63a5\n        self.connection.close()\n        p_sock.close()\n\n    # \u5904\u7406GET\u65b9\u6cd5\n    def do_GET(self):\n        # \u89e3\u6790URL\n        u = urllib.parse.urlparse(self.path)\n        # \u521b\u5efa\u4e00\u4e2aHTTP\u8fde\u63a5\n        conn = http.client.HTTPConnection(u.hostname, port=u.port or 80, timeout=10, source_address=('0.0.0.0', CONNECT_PORT))\n        # \u53d1\u9001HTTP\u8bf7\u6c42\n        conn.request(self.command, self.path, headers=self.headers)\n        # \u83b7\u53d6HTTP\u54cd\u5e94\n        resp = conn.getresponse()\n        # \u53d1\u9001HTTP\u54cd\u5e94\u5934\n        self.send_response(resp.status)\n        for header, value in resp.getheaders():\n            self.send_header(header, value)\n        self.end_headers()\n        # \u53d1\u9001HTTP\u54cd\u5e94\u4f53\n        while True:\n            data = resp.read(1024)\n            if not data:\n                break\n            self.wfile.write(data)\n\n    # \u5904\u7406POST\u65b9\u6cd5\n    def do_POST(self):\n        # \u89e3\u6790URL\n        u = urllib.parse.urlparse(self.path)\n        # \u83b7\u53d6\u8bf7\u6c42\u4f53\u957f\u5ea6\n        content_len = int(self.headers.get('Content-Length', 0))\n        # \u8bfb\u53d6\u8bf7\u6c42\u4f53\n        content_len = int(self.headers.get('Content-Length', 0))  # \u83b7\u53d6\u8bf7\u6c42\u4f53\u957f\u5ea6\n        body = self.rfile.read(content_len)  # \u8bfb\u53d6\u8bf7\u6c42\u4f53\u6570\u636e\n        conn = http.client.HTTPConnection(u.hostname, port=u.port or 80, timeout=10,\n                                          source_address=('0.0.0.0', CONNECT_PORT))  # \u521b\u5efa HTTP \u8fde\u63a5\u5bf9\u8c61\n        conn.request(self.command, self.path, body=body, headers=self.headers)  # \u53d1\u9001 HTTP POST \u8bf7\u6c42\n        resp = conn.getresponse()  # \u83b7\u53d6\u54cd\u5e94\u5bf9\u8c61\n\n        self.send_response(resp.status)  # \u53d1\u9001 HTTP \u54cd\u5e94\u72b6\u6001\u7801\n        for header, value in resp.getheaders():  # \u904d\u5386\u54cd\u5e94\u5934\u90e8\u4fe1\u606f\n            self.send_header(header, value)  # \u53d1\u9001\u54cd\u5e94\u5934\u90e8\u4fe1\u606f\n        self.end_headers()  # \u7ed3\u675f\u54cd\u5e94\u5934\u90e8\u4fe1\u606f\u7684\u53d1\u9001\n\n        while True:\n            data = resp.read(1024)  # \u6309\u7167\u6bcf\u6b21\u8bfb\u53d6 1024 \u5b57\u8282\u7684\u65b9\u5f0f\u83b7\u53d6\u54cd\u5e94\u6570\u636e\n            if not data:  # \u5982\u679c\u8bfb\u53d6\u5b8c\u6bd5\uff0c\u8df3\u51fa\u5faa\u73af\n                break\n            self.wfile.write(data)  # \u5c06\u54cd\u5e94\u6570\u636e\u5199\u5165\u8fde\u63a5\uff0c\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\n\nif __name__ == '__main__':\n    try:\n        # \u521b\u5efa\u4e00\u4e2a TCPServer \u5bf9\u8c61\uff0c\u7ed1\u5b9a\u5230 0.0.0.0:LISTEN_PORT \u7684\u5730\u5740\uff0c\u7528\u4e8e\u76d1\u542c\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u5f53\u6709\u8fde\u63a5\u8bf7\u6c42\u65f6\uff0c\u5c06\u4f7f\u7528 ProxyRequestHandler \u7c7b\u8fdb\u884c\u5904\u7406\u3002\n        httpd = socketserver.TCPServer(('0.0.0.0', LISTEN_PORT), ProxyRequestHandler)\n        logger.info(f\"Proxy server is listening on port {LISTEN_PORT}\")\n        #  \u5f00\u59cb\u76d1\u542c\u5e76\u63a5\u53d7\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u76f4\u5230\u51fa\u73b0 KeyboardInterrupt \u5f02\u5e38\u4e3a\u6b62\n        httpd.serve_forever()\n    except KeyboardInterrupt:\n        httpd.server_close()\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6548\u679c\u5982\u4e0b\uff0c\u5747\u4e3a",(0,r.jsx)(n.code,{children:"22333"}),"\u7aef\u53e3\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"\u6548\u679c",src:s(30516).A+"",width:"1636",height:"1478"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5c1d\u8bd5\u8fc7\u7684\u5931\u8d25\u65b9\u6cd5\u8bb0\u5f55",children:"\u5c1d\u8bd5\u8fc7\u7684\u5931\u8d25\u65b9\u6cd5\u8bb0\u5f55"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Nginx\u53cd\u5411\u4ee3\u7406"}),"\n",(0,r.jsxs)(n.li,{children:["SSH\u52a8\u6001\u4ee3\u7406 ",(0,r.jsx)(n.code,{children:"ssh -N -D 0.0.0.0:9999 ubuntu@hongkong"})]}),"\n",(0,r.jsxs)(n.li,{children:["socat ",(0,r.jsx)(n.code,{children:"sudo socat TCP-LISTEN:<new_source_port>,fork,reuseaddr TCP:<destination_IP>:<destination_port>"})]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},49217:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/image-20230411\u4e0b\u534850634417-994fe739246cee0a1bd02250fb1afc3a.png"},53987:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/image-20230411103614954-6dd8708ed6a403c0d29f4411021e24a2.png"}}]);